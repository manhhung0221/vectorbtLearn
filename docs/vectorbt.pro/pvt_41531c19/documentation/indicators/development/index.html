<!doctype html><html lang=en class=no-js> 
<!-- Mirrored from vectorbt.pro/pvt_41531c19/documentation/indicators/development/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 22 Nov 2025 03:46:55 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Documentation on developing indicators in VectorBT PRO"><meta name=author content="Oleg Polakow"><link href=https://vectorbt.pro/documentation/indicators/development/ rel=canonical><link href=../index.html rel=prev><link href=../analysis/index.html rel=next><link rel=icon href=../../../assets/logo/favicon.png><meta name=generator content="mkdocs-1.6.0, mkdocs-material-9.6.21+insiders-4.53.17"><title>Development - VectorBT® PRO</title><link rel=stylesheet href=../../../assets/stylesheets/main.010a373c.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=../../../../../fonts.gstatic.com/index.html crossorigin><link rel=stylesheet href="../../../../../fonts.googleapis.com/cssbe43.css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../assets/stylesheets/extra.css><link rel=stylesheet href=../../../assets/stylesheets/custom-light.css><link rel=stylesheet href=../../../assets/stylesheets/custom-dark.css><link rel=stylesheet href=../../../assets/stylesheets/pygments-light.css><link rel=stylesheet href=../../../assets/stylesheets/pygments-dark.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-0C5VNYCFHL"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-0C5VNYCFHL",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="../../../../../www.googletagmanager.com/gtag/jsc6c8?id=G-0C5VNYCFHL",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script><meta name=robots content="noindex, nofollow"><meta property=og:title content=Development><meta property=og:type content=website><meta content=https://vectorbt.pro/documentation/indicators/development/ property=og:url><meta property=og:image:url content=https://vectorbt.pro/pvt_41531c19/assets/logo/social-new.png><meta property=og:image:type content=image/png><meta property=og:description content="Documentation on developing indicators in VectorBT PRO"><meta property=og:locale content=en-GB><link rel=apple-touch-icon sizes=180x180 href=https://vectorbt.pro/pvt_41531c19/assets/logo/apple-touch-icon.png><link rel=icon type=image/svg+xml href=https://vectorbt.pro/pvt_41531c19/assets/logo/favicon.svg><link rel=icon type=image/png sizes=32x32 href=https://vectorbt.pro/pvt_41531c19/assets/logo/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://vectorbt.pro/pvt_41531c19/assets/logo/favicon-16x16.png><link rel=manifest href=https://vectorbt.pro/pvt_41531c19/assets/logo/site.webmanifest><link rel=mask-icon href=https://vectorbt.pro/pvt_41531c19/assets/logo/safari-pinned-tab.svg color=#1e1f22><link rel="shortcut icon" href=https://vectorbt.pro/pvt_41531c19/assets/logo/favicon.ico><meta name=msapplication-TileColor content=#1e1f22><meta name=msapplication-config content=https://vectorbt.pro/pvt_41531c19/assets/logo/browserconfig.xml><meta name=theme-color content=#1e1f22><link href=https://unpkg.com/aos@2.3.4/dist/aos.css rel=stylesheet><script src=https://unpkg.com/aos@2.3.4/dist/aos.js></script><link href=http://fonts.cdnfonts.com/css/uni-neue rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" crossorigin=anonymous referrerpolicy=no-referrer><script src=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/js/all.min.js integrity="sha512-8pHNiqTlsrRjVD4A/3va++W1sMbUHwWxxRPWNyVlql3T+Hgfd81Qc6FC5WMXDC+tSauxxzp1tgiAvSKFu1qIlA==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js integrity="sha512-q583ppKrCRc7N5O0n2nzUiJ+suUv7Et1JGels4bXOaMFQcamPk9HjdUknZuuFjBNs7tsMuadge5k9RzdmO+1GQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><link rel=preconnect href=https://fonts.googleapis.com/><link rel=preconnect href=https://fonts.gstatic.com/ crossorigin></head> <body dir=ltr data-md-color-scheme=custom-dark data-md-color-primary=custom-dark data-md-color-accent=custom-dark> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#development class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <button class="md-banner__button md-icon" aria-label="Don't show this again"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> <i>What's new</i>: New LLM providers, reasoning steps, function calling, YAML & TOML support, and <a href=https://vectorbt.pro/pvt_41531c19/getting-started/release-notes><strong>more</strong></a> <span class="twemoji announce-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="m153.6 29.9 16-21.3c4-5.4 10.4-8.6 17.1-8.6C198.4 0 208 9.6 208 21.3v22.1c0 13.1 5.4 25.7 14.9 34.7l84.7 80.9c48.8 46.6 76.4 111.2 76.4 178.7C384 434 306 512 209.7 512H192C86 512 0 426 0 320v-3.8c0-48.8 19.4-95.6 53.9-130.1l3.5-3.5c4.2-4.2 10-6.6 16-6.6 12.5 0 22.6 10.1 22.6 22.6V288c0 35.3 28.7 64 64 64s64-28.7 64-64v-3.9c0-18-7.2-35.3-19.9-48l-38.6-38.6c-24-24-37.5-56.7-37.5-90.7 0-27.7 9-54.8 25.6-76.9"/></svg></span> </div> <script>var el=document.querySelector("[data-md-component=announce]");if(el){var content=el.querySelector(".md-typeset");__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0)}</script> </aside> </div> <!-- Determine class according to configuration --> <!-- Header --> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=header.title> <!-- Link to home --> <a href=https://vectorbt.pro/pvt_41531c19/ title="VectorBT® PRO" class="md-header__button md-logo" aria-label="VectorBT® PRO" data-md-component=logo> <img src=https://vectorbt.pro/pvt_41531c19/assets/logo/logo.svg alt=logo class=logo> </a> <!-- Button to open drawer --> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <!-- Header title --> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> VectorBT® PRO <span class=md-version> v2025.10.15 </span> <span class=unlock-icon><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M192 32c-35.3 0-64 28.7-64 64v64h192c35.3 0 64 28.7 64 64v224c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V224c0-35.3 28.7-64 64-64V96c0-70.7 57.3-128 128-128 63.5 0 116.1 46.1 126.2 106.7 2.9 17.4-8.8 33.9-26.3 36.9S258 102.8 255 85.3C250 55.1 223.7 32 192 32m40 328c13.3 0 24-10.7 24-24s-10.7-24-24-24h-80c-13.3 0-24 10.7-24 24s10.7 24 24 24z"/></svg></span> </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Development </span> </div> </div> </div> <!-- Color palette --> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=custom-dark data-md-color-primary=custom-dark data-md-color-accent=custom-dark aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=custom-light data-md-color-primary=custom-light data-md-color-accent=custom-light aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <!-- Site language selector --> <!-- Button to open search modal --> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <!-- Search interface --> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <!-- Repository information --> <div class=md-header__source> <a href=https://github.com/polakowo/vectorbt.pro title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> vectorbt.pro </div> </a> </div> </nav> <!-- Navigation tabs (sticky) --> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/ class=md-tabs__link> Getting started </a> </li> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/features/overview/ class=md-tabs__link> Features </a> </li> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/overview/ class=md-tabs__link> Tutorials </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=https://vectorbt.pro/pvt_41531c19/documentation/overview/ class=md-tabs__link> Documentation </a> </li> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/cookbook/overview/ class=md-tabs__link> Cookbook </a> </li> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/api/ class=md-tabs__link> API </a> </li> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/terms/terms-of-use/ class=md-tabs__link> Terms </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://vectorbt.pro/pvt_41531c19/ title="VectorBT® PRO" class="md-nav__button md-logo" aria-label="VectorBT® PRO" data-md-component=logo> <img src=https://vectorbt.pro/pvt_41531c19/assets/logo/logo.svg alt=logo class=logo> </a> VectorBT® PRO </label> <div class=md-nav__source> <a href=https://github.com/polakowo/vectorbt.pro title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> vectorbt.pro </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/ class=md-nav__link> <span class=md-ellipsis> Getting started </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/features/overview/ class=md-nav__link> <span class=md-ellipsis> Features </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/overview/ class=md-nav__link> <span class=md-ellipsis> Tutorials </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Documentation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Documentation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/documentation/overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/documentation/fundamentals/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 7a2 2 0 0 0-2 2v8h2v-4h2v4h2V9a2 2 0 0 0-2-2zm0 2h2v2H3m12-.5V9a2 2 0 0 0-2-2H9v10h4a2 2 0 0 0 2-2v-1.5a1.54 1.54 0 0 0-1.5-1.5 1.54 1.54 0 0 0 1.5-1.5M13 15h-2v-2h2zm0-4h-2V9h2m6-2a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-1h-2v1h-2V9h2v1h2V9a2 2 0 0 0-2-2Z"/></svg> <span class=md-ellipsis> Fundamentals </span> </a> </li> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/documentation/building-blocks/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 16.5c0 .38-.21.71-.53.88l-7.9 4.44c-.16.12-.36.18-.57.18s-.41-.06-.57-.18l-7.9-4.44A.99.99 0 0 1 3 16.5v-9c0-.38.21-.71.53-.88l7.9-4.44c.16-.12.36-.18.57-.18s.41.06.57.18l7.9 4.44c.32.17.53.5.53.88zM12 4.15 6.04 7.5 12 10.85l5.96-3.35zM5 15.91l6 3.38v-6.71L5 9.21zm14 0v-6.7l-6 3.37v6.71z"/></svg> <span class=md-ellipsis> Building blocks </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/documentation/data/ class=md-nav__link> <span class=md-ellipsis> Data </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_5 checked> <label class=md-nav__link for=__nav_4_5 id=__nav_4_5_label tabindex=0> <span class=md-ellipsis> Indicators </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_5_label aria-expanded=true> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> Indicators </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/documentation/indicators/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m3 14 .5.07L8.07 9.5a1.95 1.95 0 0 1 .52-1.91c.78-.79 2.04-.79 2.82 0 .53.52.7 1.26.52 1.91l2.57 2.57.5-.07c.18 0 .35 0 .5.07l3.57-3.57C19 8.35 19 8.18 19 8a2 2 0 0 1 2-2 2 2 0 0 1 2 2 2 2 0 0 1-2 2c-.18 0-.35 0-.5-.07l-3.57 3.57c.07.15.07.32.07.5a2 2 0 0 1-2 2 2 2 0 0 1-2-2l.07-.5-2.57-2.57c-.32.07-.68.07-1 0L4.93 15.5 5 16a2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2"/></svg> <span class=md-ellipsis> Indicators </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 3c-1.11 0-2 .89-2 2v4c0 1.11.89 2 2 2h4c1.11 0 2-.89 2-2V5c0-1.11-.89-2-2-2m.2 1.5 1.06 1.05L5.27 9.5 2.74 6.95 3.81 5.9l1.47 1.49M4 13c-1.11 0-2 .89-2 2v4c0 1.11.89 2 2 2h4c1.11 0 2-.89 2-2v-4c0-1.11-.89-2-2-2m-4 2h4v4H4m8-14h10v2H12m0 12v-2h10v2m-10-8h10v2H12Z"/></svg> <span class=md-ellipsis> Development </span> <span class="md-nav__icon md-icon"></span> </label> <a href=https://vectorbt.pro/pvt_41531c19/documentation/indicators/development/ class="md-nav__link md-nav__link--active"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 3c-1.11 0-2 .89-2 2v4c0 1.11.89 2 2 2h4c1.11 0 2-.89 2-2V5c0-1.11-.89-2-2-2m.2 1.5 1.06 1.05L5.27 9.5 2.74 6.95 3.81 5.9l1.47 1.49M4 13c-1.11 0-2 .89-2 2v4c0 1.11.89 2 2 2h4c1.11 0 2-.89 2-2v-4c0-1.11-.89-2-2-2m-4 2h4v4H4m8-14h10v2H12m0 12v-2h10v2m-10-8h10v2H12Z"/></svg> <span class=md-ellipsis> Development </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#parameters class=md-nav__link> <span class=md-ellipsis> Parameters </span> </a> <nav class=md-nav aria-label=Parameters> <ul class=md-nav__list> <li class=md-nav__item> <a href=#defaults class=md-nav__link> <span class=md-ellipsis> Defaults </span> </a> </li> <li class=md-nav__item> <a href=#array-like class=md-nav__link> <span class=md-ellipsis> Array-like </span> </a> </li> <li class=md-nav__item> <a href=#lazy-broadcasting class=md-nav__link> <span class=md-ellipsis> Lazy broadcasting </span> </a> <nav class=md-nav aria-label="Lazy broadcasting"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#with-numba class=md-nav__link> <span class=md-ellipsis> With Numba </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#parameterless class=md-nav__link> <span class=md-ellipsis> Parameterless </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#inputs class=md-nav__link> <span class=md-ellipsis> Inputs </span> </a> <nav class=md-nav aria-label=Inputs> <ul class=md-nav__list> <li class=md-nav__item> <a href=#one-dim class=md-nav__link> <span class=md-ellipsis> One dim </span> </a> </li> <li class=md-nav__item> <a href=#defaults_1 class=md-nav__link> <span class=md-ellipsis> Defaults </span> </a> </li> <li class=md-nav__item> <a href=#using-pandas class=md-nav__link> <span class=md-ellipsis> Using Pandas </span> </a> </li> <li class=md-nav__item> <a href=#inputless class=md-nav__link> <span class=md-ellipsis> Inputless </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#outputs class=md-nav__link> <span class=md-ellipsis> Outputs </span> </a> <nav class=md-nav aria-label=Outputs> <ul class=md-nav__list> <li class=md-nav__item> <a href=#regular class=md-nav__link> <span class=md-ellipsis> Regular </span> </a> </li> <li class=md-nav__item> <a href=#in-place class=md-nav__link> <span class=md-ellipsis> In-place </span> </a> <nav class=md-nav aria-label=In-place> <ul class=md-nav__list> <li class=md-nav__item> <a href=#defaults_2 class=md-nav__link> <span class=md-ellipsis> Defaults </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#extra class=md-nav__link> <span class=md-ellipsis> Extra </span> </a> </li> <li class=md-nav__item> <a href=#lazy class=md-nav__link> <span class=md-ellipsis> Lazy </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#custom-arguments class=md-nav__link> <span class=md-ellipsis> Custom arguments </span> </a> <nav class=md-nav aria-label="Custom arguments"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#optional class=md-nav__link> <span class=md-ellipsis> Optional </span> </a> </li> <li class=md-nav__item> <a href=#variable class=md-nav__link> <span class=md-ellipsis> Variable </span> </a> </li> <li class=md-nav__item> <a href=#positional class=md-nav__link> <span class=md-ellipsis> Positional </span> </a> </li> <li class=md-nav__item> <a href=#keyword-only class=md-nav__link> <span class=md-ellipsis> Keyword-only </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#built-in-caching class=md-nav__link> <span class=md-ellipsis> Built-in caching </span> </a> <nav class=md-nav aria-label="Built-in caching"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#reusing-cache class=md-nav__link> <span class=md-ellipsis> Reusing cache </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#manual-caching class=md-nav__link> <span class=md-ellipsis> Manual caching </span> </a> <nav class=md-nav aria-label="Manual caching"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#per-column class=md-nav__link> <span class=md-ellipsis> Per column </span> </a> </li> <li class=md-nav__item> <a href=#reusing-cache_1 class=md-nav__link> <span class=md-ellipsis> Reusing cache </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#stacking class=md-nav__link> <span class=md-ellipsis> Stacking </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/documentation/indicators/analysis/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 8c-1.5 0-2.3 1.4-1.9 2.5l-3.6 3.6c-.3-.1-.7-.1-1 0l-2.6-2.6c.4-1.1-.4-2.5-1.9-2.5-1.4 0-2.3 1.4-1.9 2.5L3.5 16c-1.1-.3-2.5.5-2.5 2 0 1.1.9 2 2 2 1.4 0 2.3-1.4 1.9-2.5l4.5-4.6c.3.1.7.1 1 0l2.6 2.6c-.3 1 .5 2.5 2 2.5s2.3-1.4 1.9-2.5l3.6-3.6c1.1.3 2.5-.5 2.5-1.9 0-1.1-.9-2-2-2m-6 1 .9-2.1L18 6l-2.1-.9L15 3l-.9 2.1L12 6l2.1.9zM3.5 11 4 9l2-.5L4 8l-.5-2L3 8l-2 .5L3 9z"/></svg> <span class=md-ellipsis> Analysis </span> </a> </li> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/documentation/indicators/parsers/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m14.6 16.6 4.6-4.6-4.6-4.6L16 6l6 6-6 6zm-5.2 0L4.8 12l4.6-4.6L8 6l-6 6 6 6z"/></svg> <span class=md-ellipsis> Parsers </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/documentation/portfolio/ class=md-nav__link> <span class=md-ellipsis> Portfolio </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/documentation/to-be-continued/ class=md-nav__link> <span class=md-ellipsis> To be continued... </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/cookbook/overview/ class=md-nav__link> <span class=md-ellipsis> Cookbook </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/api/ class=md-nav__link> <span class=md-ellipsis> API </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/terms/terms-of-use/ class=md-nav__link> <span class=md-ellipsis> Terms </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <nav class=md-path aria-label=Navigation> <ol class=md-path__list> <li class=md-path__item> <a href=https://vectorbt.pro/pvt_41531c19/documentation/overview/ class=md-path__link> <span class=md-ellipsis> Documentation </span> </a> </li> <li class=md-path__item> <a href=https://vectorbt.pro/pvt_41531c19/documentation/indicators/ class=md-path__link> <span class=md-ellipsis> Indicators </span> </a> </li> </ol> </nav> <article class="md-content__inner md-typeset"> <h1 id=development><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 3c-1.11 0-2 .89-2 2v4c0 1.11.89 2 2 2h4c1.11 0 2-.89 2-2V5c0-1.11-.89-2-2-2m.2 1.5 1.06 1.05L5.27 9.5 2.74 6.95 3.81 5.9l1.47 1.49M4 13c-1.11 0-2 .89-2 2v4c0 1.11.89 2 2 2h4c1.11 0 2-.89 2-2v-4c0-1.11-.89-2-2-2m-4 2h4v4H4m8-14h10v2H12m0 12v-2h10v2m-10-8h10v2H12Z"/></svg></span> Development<a class=headerlink href=#development title="Permanent link">&para;</a></h1> <p>VBT offers a wide range of functions and arguments to simplify indicator development. All you need is an indicator function and a way to specify how it should be handled.</p> <h2 id=parameters>Parameters<a class=headerlink href=#parameters title="Permanent link">&para;</a></h2> <p><a href=https://vectorbt.pro/pvt_41531c19/api/indicators/factory/#vectorbtpro.indicators.factory.IndicatorFactory>IndicatorFactory</a> allows you to define any parameter grids you need. An indicator can have one or more parameters. Each parameter can accept one or more values, which can be scalars (such as integers), arrays, or any other objects.</p> <p>If an indicator has multiple parameters, and one or more of them have several values, their values will broadcast together. For example, if the parameter <code>w1</code> has only a single value <code>2</code> and the parameter <code>w2</code> has two values <code>3</code> and <code>4</code>, then <code>w1</code> will be stretched to two values: <code>2</code> and <code>2</code>. This allows the indicator to <a href=https://realpython.com/python-zip-function/ >zip</a> both parameters and create two parameter combinations: <code>(2, 3)</code> and <code>(2, 4)</code>. The indicator will then iterate through these combinations and apply a function to each one. The example below illustrates broadcasting:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span><span class=w> </span><span class=nn>vectorbtpro</span><span class=w> </span><span class=kn>import</span> <span class=o>*</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>broadcast_params</span><span class=p>(</span><span class=o>*</span><span class=n>params</span><span class=p>):</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=gp>... </span>    <span class=k>return</span> <span class=nb>list</span><span class=p>(</span><span class=nb>zip</span><span class=p>(</span><span class=o>*</span><span class=n>vbt</span><span class=o>.</span><span class=n>broadcast</span><span class=p>(</span><span class=o>*</span><span class=p>[</span><span class=n>vbt</span><span class=o>.</span><span class=n>to_1d_array</span><span class=p>(</span><span class=n>p</span><span class=p>)</span> <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>params</span><span class=p>])))</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>broadcast_params</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=go>[(2, 3)]</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>broadcast_params</span><span class=p>([</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span> <span class=mi>4</span><span class=p>)</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=go>[(2, 4), (3, 4)]</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>broadcast_params</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>])</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=go>[(2, 3), (2, 4)]</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=gp>&gt;&gt;&gt; </span><span class=n>broadcast_params</span><span class=p>([</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span> <span class=p>[</span><span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>])</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a><span class=go>[(2, 4), (3, 5)]</span>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a><span class=gp>&gt;&gt;&gt; </span><span class=n>broadcast_params</span><span class=p>([</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span> <span class=p>[</span><span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>])</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a><span class=go>ValueError: Could not broadcast shapes: {0: (2,), 1: (3,)}</span>
</span></code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Do not confuse broadcasting with a product operation. The product of <code>[2, 3]</code> and <code>[4, 5]</code> would result in 4 combinations: <code>[2, 4]</code>, <code>[2, 5]</code>, <code>[3, 4]</code>, and <code>[3, 5]</code>. In broadcasting, smaller arrays are simply stretched to match the length of larger arrays for zipping.</p> </div> <p>To illustrate how parameters are used in indicators, here is a simple example. This indicator returns 1 when the rolling mean is above an upper bound, -1 when it is below a lower bound, and 0 when it is between the upper and lower bounds:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>apply_func</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>window</span><span class=p>,</span> <span class=n>lower</span><span class=p>,</span> <span class=n>upper</span><span class=p>):</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=gp>... </span>    <span class=n>out</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>full_like</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=n>float_</span><span class=p>)</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=gp>... </span>    <span class=n>ts_mean</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>rolling_mean_nb</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>window</span><span class=p>)</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=gp>... </span>    <span class=n>out</span><span class=p>[</span><span class=n>ts_mean</span> <span class=o>&gt;=</span> <span class=n>upper</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=gp>... </span>    <span class=n>out</span><span class=p>[</span><span class=n>ts_mean</span> <span class=o>&lt;=</span> <span class=n>lower</span><span class=p>]</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=gp>... </span>    <span class=n>out</span><span class=p>[(</span><span class=n>ts_mean</span> <span class=o>&gt;</span> <span class=n>lower</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>ts_mean</span> <span class=o>&lt;</span> <span class=n>upper</span><span class=p>)]</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>out</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>Bounded</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>IF</span><span class=p>(</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=gp>... </span>    <span class=n>class_name</span><span class=o>=</span><span class=s2>&quot;Bounded&quot;</span><span class=p>,</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=gp>... </span>    <span class=n>input_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;ts&#39;</span><span class=p>],</span>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=gp>... </span>    <span class=n>param_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;window&#39;</span><span class=p>,</span> <span class=s1>&#39;lower&#39;</span><span class=p>,</span> <span class=s1>&#39;upper&#39;</span><span class=p>],</span>
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=gp>... </span>    <span class=n>output_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;out&#39;</span><span class=p>]</span>
</span><span id=__span-1-14><a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_apply_func</span><span class=p>(</span><span class=n>apply_func</span><span class=p>)</span>
</span><span id=__span-1-15><a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a>
</span><span id=__span-1-16><a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>generate_index</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
</span><span id=__span-1-17><a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>vbt</span><span class=o>.</span><span class=n>date_range</span><span class=p>(</span><span class=s2>&quot;2020-01-01&quot;</span><span class=p>,</span> <span class=n>periods</span><span class=o>=</span><span class=n>n</span><span class=p>)</span>
</span><span id=__span-1-18><a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a>
</span><span id=__span-1-19><a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a><span class=gp>&gt;&gt;&gt; </span><span class=n>ts</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span><span id=__span-1-20><a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a><span class=gp>... </span>    <span class=s1>&#39;a&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>5</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>],</span>
</span><span id=__span-1-21><a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a><span class=gp>... </span>    <span class=s1>&#39;b&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>]</span>
</span><span id=__span-1-22><a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a><span class=gp>... </span><span class=p>},</span> <span class=n>index</span><span class=o>=</span><span class=n>generate_index</span><span class=p>(</span><span class=mi>7</span><span class=p>))</span>
</span><span id=__span-1-23><a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a><span class=gp>&gt;&gt;&gt; </span><span class=n>bounded</span> <span class=o>=</span> <span class=n>Bounded</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span>
</span></code></pre></div> <p>To retrieve the list of parameter names:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>bounded</span><span class=o>.</span><span class=n>param_names</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=go>(&#39;window&#39;, &#39;lower&#39;, &#39;upper&#39;)</span>
</span></code></pre></div> <p>The broadcasted values of each parameter are accessible as attributes of the indicator instance, using the parameter name followed by <code>_list</code>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>bounded</span><span class=o>.</span><span class=n>window_list</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=go>[2]</span>
</span></code></pre></div> <p>By default, when <code>per_column</code> is set to False, each parameter combination is applied to every column in the input. For example, if your input array has 20 columns and you want to test 5 parameter combinations, you will get <code>20 * 5 = 100</code> columns in total.</p> <p>A single parameter combination:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>Bounded</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=gp>... </span>    <span class=n>ts</span><span class=p>,</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=gp>... </span>    <span class=n>window</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=gp>... </span>    <span class=n>lower</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=gp>... </span>    <span class=n>upper</span><span class=o>=</span><span class=mi>5</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>out</span>  <span class=c1># (1)!</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=go>bounded_window           2</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=go>bounded_lower            3</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=go>bounded_upper            5</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=go>                    a    b</span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=go>2020-01-01        NaN  NaN</span>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a><span class=go>2020-01-02        0.0 -1.0</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a><span class=go>2020-01-03        0.0  0.0</span>
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a><span class=go>2020-01-04       -1.0  0.0</span>
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a><span class=go>2020-01-05       -1.0  0.0</span>
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a><span class=go>2020-01-06        0.0  0.0</span>
</span><span id=__span-4-17><a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a><span class=go>2020-01-07        0.0 -1.0</span>
</span></code></pre></div> <ol> <li><code>2 * 1 = 2</code> output columns.</li> </ol> <p>Multiple parameter combinations:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>Bounded</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=gp>... </span>    <span class=n>ts</span><span class=p>,</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=gp>... </span>    <span class=n>window</span><span class=o>=</span><span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=gp>... </span>    <span class=n>lower</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=gp>... </span>    <span class=n>upper</span><span class=o>=</span><span class=mi>5</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>out</span>  <span class=c1># (1)!</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=go>bounded_window           2         3</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=go>bounded_lower            3         3</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=go>bounded_upper            5         5</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=go>                    a    b    a    b</span>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=go>2020-01-01        NaN  NaN  NaN  NaN</span>
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=go>2020-01-02        0.0 -1.0  NaN  NaN</span>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a><span class=go>2020-01-03        0.0  0.0  0.0 -1.0</span>
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a><span class=go>2020-01-04       -1.0  0.0 -1.0  0.0</span>
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a><span class=go>2020-01-05       -1.0  0.0 -1.0  0.0</span>
</span><span id=__span-5-16><a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a><span class=go>2020-01-06        0.0  0.0 -1.0  0.0</span>
</span><span id=__span-5-17><a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a><span class=go>2020-01-07        0.0 -1.0  0.0 -1.0</span>
</span></code></pre></div> <ol> <li><code>2 * 2 = 4</code> output columns.</li> </ol> <p>Product of parameter combinations:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>Bounded</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=gp>... </span>    <span class=n>ts</span><span class=p>,</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=gp>... </span>    <span class=n>window</span><span class=o>=</span><span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=gp>... </span>    <span class=n>lower</span><span class=o>=</span><span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>],</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=gp>... </span>    <span class=n>upper</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=gp>... </span>    <span class=n>param_product</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>out</span>  <span class=c1># (1)!</span>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=go>bounded_window                     2                   3</span>
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=go>bounded_lower            3         4         3         4</span>
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=go>bounded_upper            5         5         5         5</span>
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=go>                    a    b    a    b    a    b    a    b</span>
</span><span id=__span-6-12><a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a><span class=go>2020-01-01        NaN  NaN  NaN  NaN  NaN  NaN  NaN  NaN</span>
</span><span id=__span-6-13><a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a><span class=go>2020-01-02        0.0 -1.0  0.0 -1.0  NaN  NaN  NaN  NaN</span>
</span><span id=__span-6-14><a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a><span class=go>2020-01-03        0.0  0.0 -1.0 -1.0  0.0 -1.0 -1.0 -1.0</span>
</span><span id=__span-6-15><a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a><span class=go>2020-01-04       -1.0  0.0 -1.0  0.0 -1.0  0.0 -1.0 -1.0</span>
</span><span id=__span-6-16><a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a><span class=go>2020-01-05       -1.0  0.0 -1.0  0.0 -1.0  0.0 -1.0  0.0</span>
</span><span id=__span-6-17><a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a><span class=go>2020-01-06        0.0  0.0 -1.0 -1.0 -1.0  0.0 -1.0 -1.0</span>
</span><span id=__span-6-18><a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a><span class=go>2020-01-07        0.0 -1.0  0.0 -1.0  0.0 -1.0 -1.0 -1.0</span>
</span></code></pre></div> <ol> <li><code>2 * 2 * 2 = 8</code> output columns.</li> </ol> <p>You can build more complex parameter combinations using the <a href=https://vectorbt.pro/pvt_41531c19/api/utils/params/#vectorbtpro.utils.params.generate_param_combs>generate_param_combs</a> function. For example, if the lower bound should always remain below the upper bound, you can control this relationship using <a href=https://docs.python.org/3/library/itertools.html#itertools.combinations>itertools.combinations</a>. After that, you can create a Cartesian product with the window using <a href=https://docs.python.org/3/library/itertools.html#itertools.product>itertools.product</a>.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>bound_combs_op</span> <span class=o>=</span> <span class=p>(</span><span class=n>combinations</span><span class=p>,</span> <span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>],</span> <span class=mi>2</span><span class=p>)</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>product_op</span> <span class=o>=</span> <span class=p>(</span><span class=n>product</span><span class=p>,</span> <span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span> <span class=n>bound_combs_op</span><span class=p>)</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>windows</span><span class=p>,</span> <span class=n>lowers</span><span class=p>,</span> <span class=n>uppers</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>generate_param_combs</span><span class=p>(</span><span class=n>product_op</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>Bounded</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=gp>... </span>    <span class=n>ts</span><span class=p>,</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=gp>... </span>    <span class=n>window</span><span class=o>=</span><span class=n>windows</span><span class=p>,</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=gp>... </span>    <span class=n>lower</span><span class=o>=</span><span class=n>lowers</span><span class=p>,</span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=gp>... </span>    <span class=n>upper</span><span class=o>=</span><span class=n>uppers</span>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>out</span>  <span class=c1># (2)!</span>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=go>bounded_window                               2                             3</span>
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a><span class=go>bounded_lower                      3         4                   3         4</span>
</span><span id=__span-7-13><a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a><span class=go>bounded_upper            4         5         5         4         5         5</span>
</span><span id=__span-7-14><a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a><span class=go>                    a    b    a    b    a    b    a    b    a    b    a    b</span>
</span><span id=__span-7-15><a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a><span class=go>2020-01-01        NaN  NaN  NaN  NaN  NaN  NaN  NaN  NaN  NaN  NaN  NaN  NaN</span>
</span><span id=__span-7-16><a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a><span class=go>2020-01-02        1.0 -1.0  0.0 -1.0  0.0 -1.0  NaN  NaN  NaN  NaN  NaN  NaN</span>
</span><span id=__span-7-17><a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a><span class=go>2020-01-03        0.0  0.0  0.0  0.0 -1.0 -1.0  1.0 -1.0  0.0 -1.0 -1.0 -1.0</span>
</span><span id=__span-7-18><a id=__codelineno-7-18 name=__codelineno-7-18 href=#__codelineno-7-18></a><span class=go>2020-01-04       -1.0  1.0 -1.0  0.0 -1.0  0.0 -1.0  1.0 -1.0  0.0 -1.0 -1.0</span>
</span><span id=__span-7-19><a id=__codelineno-7-19 name=__codelineno-7-19 href=#__codelineno-7-19></a><span class=go>2020-01-05       -1.0  1.0 -1.0  0.0 -1.0  0.0 -1.0  1.0 -1.0  0.0 -1.0  0.0</span>
</span><span id=__span-7-20><a id=__codelineno-7-20 name=__codelineno-7-20 href=#__codelineno-7-20></a><span class=go>2020-01-06        0.0  0.0  0.0  0.0 -1.0 -1.0 -1.0  1.0 -1.0  0.0 -1.0 -1.0</span>
</span><span id=__span-7-21><a id=__codelineno-7-21 name=__codelineno-7-21 href=#__codelineno-7-21></a><span class=go>2020-01-07        1.0 -1.0  0.0 -1.0  0.0 -1.0  1.0 -1.0  0.0 -1.0 -1.0 -1.0</span>
</span></code></pre></div> <ol> <li>Each tuple represents a combinatoric operation. Tuples can accept other tuples as inputs.</li> <li><code>2 * 2 * 2 * 3 / 2 = 12</code> output columns.</li> </ol> <p>One parameter combination per column:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>Bounded</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=gp>... </span>    <span class=n>ts</span><span class=p>,</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=gp>... </span>    <span class=n>window</span><span class=o>=</span><span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=gp>... </span>    <span class=n>lower</span><span class=o>=</span><span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>],</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=gp>... </span>    <span class=n>upper</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=gp>... </span>    <span class=n>per_column</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>out</span>  <span class=c1># (1)!</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=go>bounded_window      2    3</span>
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=go>bounded_lower       3    4</span>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=go>bounded_upper       5    5</span>
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=go>                    a    b</span>
</span><span id=__span-8-12><a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class=go>2020-01-01        NaN  NaN</span>
</span><span id=__span-8-13><a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a><span class=go>2020-01-02        0.0  NaN</span>
</span><span id=__span-8-14><a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a><span class=go>2020-01-03        0.0 -1.0</span>
</span><span id=__span-8-15><a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a><span class=go>2020-01-04       -1.0 -1.0</span>
</span><span id=__span-8-16><a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a><span class=go>2020-01-05       -1.0  0.0</span>
</span><span id=__span-8-17><a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a><span class=go>2020-01-06        0.0 -1.0</span>
</span><span id=__span-8-18><a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a><span class=go>2020-01-07        0.0 -1.0</span>
</span></code></pre></div> <ol> <li>The number of output columns matches the number of input columns.</li> </ol> <h3 id=defaults>Defaults<a class=headerlink href=#defaults title="Permanent link">&para;</a></h3> <p>Any argument passed to <a href=https://vectorbt.pro/pvt_41531c19/api/indicators/factory/#vectorbtpro.indicators.factory.IndicatorFactory.with_custom_func>IndicatorFactory.with_custom_func</a> that is not listed among the arguments of <a href=https://vectorbt.pro/pvt_41531c19/api/indicators/factory/#vectorbtpro.indicators.factory.IndicatorBase.run_pipeline>IndicatorBase.run_pipeline</a> is intended to be used as a default argument for the calculation function. Since most methods, including <a href=https://vectorbt.pro/pvt_41531c19/api/indicators/factory/#vectorbtpro.indicators.factory.IndicatorFactory.with_apply_func>IndicatorFactory.with_apply_func</a>, call this method, you can easily set parameter defaults by passing them along with the function:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>Bounded</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>IF</span><span class=p>(</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=gp>... </span>    <span class=n>class_name</span><span class=o>=</span><span class=s2>&quot;Bounded&quot;</span><span class=p>,</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=gp>... </span>    <span class=n>input_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;ts&#39;</span><span class=p>],</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=gp>... </span>    <span class=n>param_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;window&#39;</span><span class=p>,</span> <span class=s1>&#39;lower&#39;</span><span class=p>,</span> <span class=s1>&#39;upper&#39;</span><span class=p>],</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=gp>... </span>    <span class=n>output_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;out&#39;</span><span class=p>]</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_apply_func</span><span class=p>(</span><span class=n>apply_func</span><span class=p>,</span> <span class=n>window</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>lower</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>upper</span><span class=o>=</span><span class=mi>4</span><span class=p>)</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>Bounded</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>ts</span><span class=p>)</span><span class=o>.</span><span class=n>out</span>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=go>              a    b</span>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=go>2020-01-01  NaN  NaN</span>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a><span class=go>2020-01-02  1.0 -1.0</span>
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=go>2020-01-03  0.0  0.0</span>
</span><span id=__span-9-13><a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a><span class=go>2020-01-04 -1.0  1.0</span>
</span><span id=__span-9-14><a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a><span class=go>2020-01-05 -1.0  1.0</span>
</span><span id=__span-9-15><a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a><span class=go>2020-01-06  0.0  0.0</span>
</span><span id=__span-9-16><a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a><span class=go>2020-01-07  1.0 -1.0</span>
</span><span id=__span-9-17><a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a>
</span><span id=__span-9-18><a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a><span class=gp>&gt;&gt;&gt; </span><span class=n>Bounded</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>upper</span><span class=o>=</span><span class=p>[</span><span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>])</span><span class=o>.</span><span class=n>out</span>
</span><span id=__span-9-19><a id=__codelineno-9-19 name=__codelineno-9-19 href=#__codelineno-9-19></a><span class=go>bounded_upper           5         6</span>
</span><span id=__span-9-20><a id=__codelineno-9-20 name=__codelineno-9-20 href=#__codelineno-9-20></a><span class=go>                   a    b    a    b</span>
</span><span id=__span-9-21><a id=__codelineno-9-21 name=__codelineno-9-21 href=#__codelineno-9-21></a><span class=go>2020-01-01       NaN  NaN  NaN  NaN</span>
</span><span id=__span-9-22><a id=__codelineno-9-22 name=__codelineno-9-22 href=#__codelineno-9-22></a><span class=go>2020-01-02       0.0 -1.0  0.0 -1.0</span>
</span><span id=__span-9-23><a id=__codelineno-9-23 name=__codelineno-9-23 href=#__codelineno-9-23></a><span class=go>2020-01-03       0.0  0.0  0.0  0.0</span>
</span><span id=__span-9-24><a id=__codelineno-9-24 name=__codelineno-9-24 href=#__codelineno-9-24></a><span class=go>2020-01-04      -1.0  0.0 -1.0  0.0</span>
</span><span id=__span-9-25><a id=__codelineno-9-25 name=__codelineno-9-25 href=#__codelineno-9-25></a><span class=go>2020-01-05      -1.0  0.0 -1.0  0.0</span>
</span><span id=__span-9-26><a id=__codelineno-9-26 name=__codelineno-9-26 href=#__codelineno-9-26></a><span class=go>2020-01-06       0.0  0.0  0.0  0.0</span>
</span><span id=__span-9-27><a id=__codelineno-9-27 name=__codelineno-9-27 href=#__codelineno-9-27></a><span class=go>2020-01-07       0.0 -1.0  0.0 -1.0</span>
</span></code></pre></div> <p>The reason why the parameters <code>window</code> and <code>lower</code> do not appear in the column hierarchy above is that default values are hidden by default. To display them, set <code>hide_default</code> to False:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>Bounded</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>hide_default</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span><span class=o>.</span><span class=n>out</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=go>bounded_window           2     </span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=go>bounded_lower            3     </span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=go>bounded_upper            4     </span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=go>                    a    b</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=go>2020-01-01        NaN  NaN</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=go>2020-01-02        1.0 -1.0</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=go>2020-01-03        0.0  0.0</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=go>2020-01-04       -1.0  1.0</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=go>2020-01-05       -1.0  1.0</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=go>2020-01-06        0.0  0.0</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=go>2020-01-07        1.0 -1.0</span>
</span></code></pre></div> <h3 id=array-like>Array-like<a class=headerlink href=#array-like title="Permanent link">&para;</a></h3> <p>Some parameters are intended to be specified per row, column, or element of the input. By default, if you pass a parameter value as an array, the indicator will treat this array as a list of multiple values, one per input. To make the indicator interpret this array as a single value, set the flag <code>is_array_like</code> to True in <code>param_settings</code>. To automatically broadcast the parameter value to the input shape, set <code>bc_to_input</code> to True, 0 (index axis), or 1 (column axis).</p> <p>In our example, the parameter <code>window</code> can be broadcast per column, and both parameters <code>lower</code> and <code>upper</code> can be broadcast per element. To enable this, we need to rewrite <code>apply_func</code> to apply the rolling mean on each column instead of the entire input:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>apply_func</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>window</span><span class=p>,</span> <span class=n>lower</span><span class=p>,</span> <span class=n>upper</span><span class=p>):</span>  <span class=c1># (1)!</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=gp>... </span>    <span class=n>out</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>full_like</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=n>float_</span><span class=p>)</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=gp>... </span>    <span class=n>ts_means</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>ts</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>]):</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=gp>... </span>        <span class=n>ts_means</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>rolling_mean_1d_nb</span><span class=p>(</span><span class=n>ts</span><span class=p>[:,</span> <span class=n>col</span><span class=p>],</span> <span class=n>window</span><span class=p>[</span><span class=n>col</span><span class=p>]))</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=gp>... </span>    <span class=n>ts_mean</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>column_stack</span><span class=p>(</span><span class=n>ts_means</span><span class=p>)</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=gp>... </span>    <span class=n>out</span><span class=p>[</span><span class=n>ts_mean</span> <span class=o>&gt;=</span> <span class=n>upper</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=gp>... </span>    <span class=n>out</span><span class=p>[</span><span class=n>ts_mean</span> <span class=o>&lt;=</span> <span class=n>lower</span><span class=p>]</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=gp>... </span>    <span class=n>out</span><span class=p>[(</span><span class=n>ts_mean</span> <span class=o>&gt;</span> <span class=n>lower</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>ts_mean</span> <span class=o>&lt;</span> <span class=n>upper</span><span class=p>)]</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>out</span>
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a>
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>Bounded</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>IF</span><span class=p>(</span>
</span><span id=__span-11-13><a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a><span class=gp>... </span>    <span class=n>class_name</span><span class=o>=</span><span class=s2>&quot;Bounded&quot;</span><span class=p>,</span>
</span><span id=__span-11-14><a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=gp>... </span>    <span class=n>input_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;ts&#39;</span><span class=p>],</span>
</span><span id=__span-11-15><a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a><span class=gp>... </span>    <span class=n>param_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;window&#39;</span><span class=p>,</span> <span class=s1>&#39;lower&#39;</span><span class=p>,</span> <span class=s1>&#39;upper&#39;</span><span class=p>],</span>
</span><span id=__span-11-16><a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a><span class=gp>... </span>    <span class=n>output_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;out&#39;</span><span class=p>]</span>
</span><span id=__span-11-17><a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_apply_func</span><span class=p>(</span>
</span><span id=__span-11-18><a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a><span class=gp>... </span>    <span class=n>apply_func</span><span class=p>,</span>
</span><span id=__span-11-19><a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a><span class=gp>... </span>    <span class=n>param_settings</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-11-20><a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a><span class=gp>... </span>        <span class=n>window</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>is_array_like</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>bc_to_input</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>per_column</span><span class=o>=</span><span class=kc>True</span><span class=p>),</span>
</span><span id=__span-11-21><a id=__codelineno-11-21 name=__codelineno-11-21 href=#__codelineno-11-21></a><span class=gp>... </span>        <span class=n>lower</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>is_array_like</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>bc_to_input</span><span class=o>=</span><span class=kc>True</span><span class=p>),</span>
</span><span id=__span-11-22><a id=__codelineno-11-22 name=__codelineno-11-22 href=#__codelineno-11-22></a><span class=gp>... </span>        <span class=n>upper</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>is_array_like</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>bc_to_input</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-11-23><a id=__codelineno-11-23 name=__codelineno-11-23 href=#__codelineno-11-23></a><span class=gp>... </span>    <span class=p>)</span>
</span><span id=__span-11-24><a id=__codelineno-11-24 name=__codelineno-11-24 href=#__codelineno-11-24></a><span class=gp>... </span><span class=p>)</span>
</span></code></pre></div> <ol> <li>All parameters are now arrays that can broadcast against <code>ts</code>.</li> </ol> <p>Both bound parameters can now be passed as a scalar (one value for the entire input), a one-dimensional array (one value per row or column, depending on whether the input is a Series or a DataFrame), a two-dimensional array (one value per element), or a list containing any of these. This approach allows for maximum parameter flexibility.</p> <p>For example, let's build a grid of two parameter combinations:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>Bounded</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=gp>... </span>    <span class=n>ts</span><span class=p>,</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=gp>... </span>    <span class=n>window</span><span class=o>=</span><span class=p>[</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>]),</span> <span class=mi>4</span><span class=p>],</span>  <span class=c1># (1)!</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=gp>... </span>    <span class=n>lower</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>]]),</span>  <span class=c1># (2)!</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=gp>... </span>    <span class=n>upper</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>6</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>]),</span>  <span class=c1># (3)!</span>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>out</span>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=go>bounded_window         2       3               4</span>
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=go>bounded_lower    array_0 array_0 array_1 array_1  </span>
</span><span id=__span-12-9><a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=go>bounded_upper    array_0 array_0 array_1 array_1</span>
</span><span id=__span-12-10><a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=go>                       a       b       a       b</span>
</span><span id=__span-12-11><a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=go>2020-01-01           NaN     NaN     NaN     NaN</span>
</span><span id=__span-12-12><a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a><span class=go>2020-01-02           0.0     NaN     NaN     NaN</span>
</span><span id=__span-12-13><a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a><span class=go>2020-01-03           0.0     0.0     NaN     NaN</span>
</span><span id=__span-12-14><a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a><span class=go>2020-01-04           0.0     1.0     1.0     1.0</span>
</span><span id=__span-12-15><a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a><span class=go>2020-01-05           0.0     1.0     0.0     1.0</span>
</span><span id=__span-12-16><a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a><span class=go>2020-01-06           0.0     0.0     0.0     0.0</span>
</span><span id=__span-12-17><a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a><span class=go>2020-01-07           0.0     0.0     0.0     0.0</span>
</span></code></pre></div> <ol> <li>One combination with a value per column and one with a value per input.</li> <li>Value per column.</li> <li>Value per row.</li> </ol> <p>Our <code>apply_func</code> gets called twice, once for each parameter combination in <code>window</code>. If you print the shapes of the passed arguments, you will see that each window array now matches the number of columns in <code>ts</code>, while each bound array exactly matches the shape of <code>ts</code>:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a>Combination 1:
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a>(7, 2)
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a>(2,)
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a>(7, 2)
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>(7, 2)
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a>Combination 2:
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a>(7, 2)
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a>(2,)
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a>(7, 2)
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a>(7, 2)
</span></code></pre></div> <h3 id=lazy-broadcasting>Lazy broadcasting<a class=headerlink href=#lazy-broadcasting title="Permanent link">&para;</a></h3> <p>Broadcasting a large number of parameters to the input shape can use a lot of memory, especially when the arrays are materialized. Fortunately, VBT can preserve the original (smaller) dimensions of each parameter array and give you full control over broadcasting. This requires setting <code>keep_flex</code> to True in <code>broadcast_kwargs</code>, which will make the factory first check whether the array can be broadcast, and then expand it to either one or two dimensions in the most memory-efficient way. There are two configs in <a href=https://vectorbt.pro/pvt_41531c19/api/indicators/configs>configs</a> for this purpose: one for column-wise broadcasting and one for element-wise broadcasting.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>apply_func</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>window</span><span class=p>,</span> <span class=n>lower</span><span class=p>,</span> <span class=n>upper</span><span class=p>):</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=gp>... </span>    <span class=n>window</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>broadcast_to</span><span class=p>(</span><span class=n>window</span><span class=p>,</span> <span class=n>ts</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>  <span class=c1># (1)!</span>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=gp>... </span>    <span class=n>lower</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>broadcast_to</span><span class=p>(</span><span class=n>lower</span><span class=p>,</span> <span class=n>ts</span><span class=o>.</span><span class=n>shape</span><span class=p>)</span>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=gp>... </span>    <span class=n>upper</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>broadcast_to</span><span class=p>(</span><span class=n>upper</span><span class=p>,</span> <span class=n>ts</span><span class=o>.</span><span class=n>shape</span><span class=p>)</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=gp>... </span>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=gp>... </span>    <span class=n>out</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>full_like</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=n>float_</span><span class=p>)</span>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=gp>... </span>    <span class=n>ts_means</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>ts</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>]):</span>
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=gp>... </span>        <span class=n>ts_means</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>rolling_mean_1d_nb</span><span class=p>(</span><span class=n>ts</span><span class=p>[:,</span> <span class=n>col</span><span class=p>],</span> <span class=n>window</span><span class=p>[</span><span class=n>col</span><span class=p>]))</span>
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=gp>... </span>    <span class=n>ts_mean</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>column_stack</span><span class=p>(</span><span class=n>ts_means</span><span class=p>)</span>
</span><span id=__span-14-11><a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a><span class=gp>... </span>    <span class=n>out</span><span class=p>[</span><span class=n>ts_mean</span> <span class=o>&gt;=</span> <span class=n>upper</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span><span id=__span-14-12><a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a><span class=gp>... </span>    <span class=n>out</span><span class=p>[</span><span class=n>ts_mean</span> <span class=o>&lt;=</span> <span class=n>lower</span><span class=p>]</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>
</span><span id=__span-14-13><a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a><span class=gp>... </span>    <span class=n>out</span><span class=p>[(</span><span class=n>ts_mean</span> <span class=o>&gt;</span> <span class=n>lower</span><span class=p>)</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>ts_mean</span> <span class=o>&lt;</span> <span class=n>upper</span><span class=p>)]</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-14-14><a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>out</span>
</span><span id=__span-14-15><a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a>
</span><span id=__span-14-16><a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a><span class=gp>&gt;&gt;&gt; </span><span class=n>Bounded</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>IF</span><span class=p>(</span>
</span><span id=__span-14-17><a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a><span class=gp>... </span>    <span class=n>class_name</span><span class=o>=</span><span class=s2>&quot;Bounded&quot;</span><span class=p>,</span>
</span><span id=__span-14-18><a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a><span class=gp>... </span>    <span class=n>input_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;ts&#39;</span><span class=p>],</span>
</span><span id=__span-14-19><a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a><span class=gp>... </span>    <span class=n>param_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;window&#39;</span><span class=p>,</span> <span class=s1>&#39;lower&#39;</span><span class=p>,</span> <span class=s1>&#39;upper&#39;</span><span class=p>],</span>
</span><span id=__span-14-20><a id=__codelineno-14-20 name=__codelineno-14-20 href=#__codelineno-14-20></a><span class=gp>... </span>    <span class=n>output_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;out&#39;</span><span class=p>]</span>
</span><span id=__span-14-21><a id=__codelineno-14-21 name=__codelineno-14-21 href=#__codelineno-14-21></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_apply_func</span><span class=p>(</span>
</span><span id=__span-14-22><a id=__codelineno-14-22 name=__codelineno-14-22 href=#__codelineno-14-22></a><span class=gp>... </span>    <span class=n>apply_func</span><span class=p>,</span>
</span><span id=__span-14-23><a id=__codelineno-14-23 name=__codelineno-14-23 href=#__codelineno-14-23></a><span class=gp>... </span>    <span class=n>param_settings</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-14-24><a id=__codelineno-14-24 name=__codelineno-14-24 href=#__codelineno-14-24></a><span class=gp>... </span>        <span class=n>window</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>flex_col_param_config</span><span class=p>,</span>
</span><span id=__span-14-25><a id=__codelineno-14-25 name=__codelineno-14-25 href=#__codelineno-14-25></a><span class=gp>... </span>        <span class=n>lower</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>flex_elem_param_config</span><span class=p>,</span>
</span><span id=__span-14-26><a id=__codelineno-14-26 name=__codelineno-14-26 href=#__codelineno-14-26></a><span class=gp>... </span>        <span class=n>upper</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>flex_elem_param_config</span>
</span><span id=__span-14-27><a id=__codelineno-14-27 name=__codelineno-14-27 href=#__codelineno-14-27></a><span class=gp>... </span>    <span class=p>)</span>
</span><span id=__span-14-28><a id=__codelineno-14-28 name=__codelineno-14-28 href=#__codelineno-14-28></a><span class=gp>... </span><span class=p>)</span>
</span></code></pre></div> <ol> <li>Bring to the full shape.</li> </ol> <p>Well done! This is the most flexible and memory-efficient way to implement an indicator. Instead of broadcasting all array-like parameter values immediately, we delay this operation until it is actually needed.</p> <h4 id=with-numba>With Numba<a class=headerlink href=#with-numba title="Permanent link">&para;</a></h4> <p>The implementation above is very flexible, but it is not the most optimized because it iterates over the input shape multiple times. As a bonus, let's rewrite our <code>apply_func</code> to be Numba-compiled: this version will iterate over columns and rows, select each parameter value <a href=https://vectorbt.pro/pvt_41531c19/documentation/fundamentals/#flexible-indexing>flexibly</a> without any broadcasting, and fill the output array step by step.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=gp>... </span><span class=k>def</span><span class=w> </span><span class=nf>apply_func_nb</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>window</span><span class=p>,</span> <span class=n>lower</span><span class=p>,</span> <span class=n>upper</span><span class=p>):</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=gp>... </span>    <span class=n>out</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>full_like</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=n>float_</span><span class=p>)</span>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=gp>...</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>ts</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>]):</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=gp>... </span>        <span class=n>_window</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>flex_select_1d_pc_nb</span><span class=p>(</span><span class=n>window</span><span class=p>,</span> <span class=n>col</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=gp>...</span>
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=gp>... </span>        <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>ts</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]):</span>
</span><span id=__span-15-9><a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a><span class=gp>... </span>            <span class=n>window_start</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>row</span> <span class=o>+</span> <span class=mi>1</span> <span class=o>-</span> <span class=n>_window</span><span class=p>)</span>
</span><span id=__span-15-10><a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a><span class=gp>... </span>            <span class=n>window_end</span> <span class=o>=</span> <span class=n>row</span> <span class=o>+</span> <span class=mi>1</span>
</span><span id=__span-15-11><a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a><span class=gp>... </span>            <span class=k>if</span> <span class=n>window_end</span> <span class=o>-</span> <span class=n>window_start</span> <span class=o>&gt;=</span> <span class=n>_window</span><span class=p>:</span>
</span><span id=__span-15-12><a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a><span class=gp>... </span>                <span class=n>_lower</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>flex_select_nb</span><span class=p>(</span><span class=n>lower</span><span class=p>,</span> <span class=n>row</span><span class=p>,</span> <span class=n>col</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-15-13><a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a><span class=gp>... </span>                <span class=n>_upper</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>flex_select_nb</span><span class=p>(</span><span class=n>upper</span><span class=p>,</span> <span class=n>row</span><span class=p>,</span> <span class=n>col</span><span class=p>)</span>  <span class=c1># (3)!</span>
</span><span id=__span-15-14><a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a><span class=gp>...</span>
</span><span id=__span-15-15><a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a><span class=gp>... </span>                <span class=n>mean</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nanmean</span><span class=p>(</span><span class=n>ts</span><span class=p>[</span><span class=n>window_start</span><span class=p>:</span><span class=n>window_end</span><span class=p>,</span> <span class=n>col</span><span class=p>])</span>  <span class=c1># (4)!</span>
</span><span id=__span-15-16><a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a><span class=gp>... </span>                <span class=k>if</span> <span class=n>mean</span> <span class=o>&gt;=</span> <span class=n>_upper</span><span class=p>:</span>
</span><span id=__span-15-17><a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a><span class=gp>... </span>                    <span class=n>out</span><span class=p>[</span><span class=n>row</span><span class=p>,</span> <span class=n>col</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span><span id=__span-15-18><a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a><span class=gp>... </span>                <span class=k>elif</span> <span class=n>mean</span> <span class=o>&lt;=</span> <span class=n>_lower</span><span class=p>:</span>
</span><span id=__span-15-19><a id=__codelineno-15-19 name=__codelineno-15-19 href=#__codelineno-15-19></a><span class=gp>... </span>                    <span class=n>out</span><span class=p>[</span><span class=n>row</span><span class=p>,</span> <span class=n>col</span><span class=p>]</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span>
</span><span id=__span-15-20><a id=__codelineno-15-20 name=__codelineno-15-20 href=#__codelineno-15-20></a><span class=gp>... </span>                <span class=k>elif</span> <span class=n>_lower</span> <span class=o>&lt;</span> <span class=n>mean</span> <span class=o>&lt;</span> <span class=n>_upper</span><span class=p>:</span>
</span><span id=__span-15-21><a id=__codelineno-15-21 name=__codelineno-15-21 href=#__codelineno-15-21></a><span class=gp>... </span>                    <span class=n>out</span><span class=p>[</span><span class=n>row</span><span class=p>,</span> <span class=n>col</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-15-22><a id=__codelineno-15-22 name=__codelineno-15-22 href=#__codelineno-15-22></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>out</span>
</span></code></pre></div> <ol> <li>Get the window defined for this column.</li> <li>Get the lower bound defined for this element.</li> <li>Get the upper bound defined for this element.</li> <li>Get the mean of this window.</li> </ol> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>This is perfectly valid Python code. Even if you remove the <code>@njit</code> decorator, it will still work!</p> </div> <p>Remember that executing code compiled with Numba can provide performance increases many times greater than standard Python and even Pandas <img alt=🐌 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f40c.svg title=:snail:></p> <h3 id=parameterless>Parameterless<a class=headerlink href=#parameterless title="Permanent link">&para;</a></h3> <p>Indicators can also be parameterless, such as <a href=https://vectorbt.pro/pvt_41531c19/api/indicators/custom/obv/#vectorbtpro.indicators.custom.obv.OBV>OBV</a>.</p> <h2 id=inputs>Inputs<a class=headerlink href=#inputs title="Permanent link">&para;</a></h2> <p><a href=https://vectorbt.pro/pvt_41531c19/api/indicators/factory/#vectorbtpro.indicators.factory.IndicatorFactory>IndicatorFactory</a> allows you to pass none, one, or multiple inputs. If multiple inputs are provided, it will try to broadcast them into a single shape using <a href=https://vectorbt.pro/pvt_41531c19/api/base/reshaping/#vectorbtpro.base.reshaping.broadcast>broadcast</a> (see <a href=https://vectorbt.pro/pvt_41531c19/documentation/fundamentals/#broadcasting>Broadcasting</a>).</p> <p>Remember, in VBT each column represents a separate backtest. So, to work with multiple pieces of data such as OHLCV, you should provide them as separate Pandas objects, not as a single monolithic DataFrame (see <a href=https://vectorbt.pro/pvt_41531c19/documentation/fundamentals/#multidimensionality>Multidimensionality</a>).</p> <p>Let's create a parameterless indicator that calculates the position of the closing price relative to the candle:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>apply_func</span><span class=p>(</span><span class=n>high</span><span class=p>,</span> <span class=n>low</span><span class=p>,</span> <span class=n>close</span><span class=p>):</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=gp>... </span>    <span class=k>return</span> <span class=p>(</span><span class=n>close</span> <span class=o>-</span> <span class=n>low</span><span class=p>)</span> <span class=o>/</span> <span class=p>(</span><span class=n>high</span> <span class=o>-</span> <span class=n>low</span><span class=p>)</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>RelClose</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>IF</span><span class=p>(</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=gp>... </span>    <span class=n>input_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;high&#39;</span><span class=p>,</span> <span class=s1>&#39;low&#39;</span><span class=p>,</span> <span class=s1>&#39;close&#39;</span><span class=p>],</span>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=gp>... </span>    <span class=n>output_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;out&#39;</span><span class=p>]</span>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_apply_func</span><span class=p>(</span><span class=n>apply_func</span><span class=p>)</span>
</span><span id=__span-16-8><a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a>
</span><span id=__span-16-9><a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>close</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>],</span> <span class=n>index</span><span class=o>=</span><span class=n>generate_index</span><span class=p>(</span><span class=mi>5</span><span class=p>))</span>
</span><span id=__span-16-10><a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>high</span> <span class=o>=</span> <span class=n>close</span> <span class=o>*</span> <span class=mf>1.2</span>
</span><span id=__span-16-11><a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>low</span> <span class=o>=</span> <span class=n>close</span> <span class=o>*</span> <span class=mf>0.8</span>
</span><span id=__span-16-12><a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a>
</span><span id=__span-16-13><a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a><span class=gp>&gt;&gt;&gt; </span><span class=n>rel_close</span> <span class=o>=</span> <span class=n>RelClose</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>high</span><span class=p>,</span> <span class=n>low</span><span class=p>,</span> <span class=n>close</span><span class=p>)</span>
</span><span id=__span-16-14><a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a><span class=gp>&gt;&gt;&gt; </span><span class=n>rel_close</span><span class=o>.</span><span class=n>out</span>
</span><span id=__span-16-15><a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a><span class=go>2020-01-01    0.5</span>
</span><span id=__span-16-16><a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a><span class=go>2020-01-02    0.5</span>
</span><span id=__span-16-17><a id=__codelineno-16-17 name=__codelineno-16-17 href=#__codelineno-16-17></a><span class=go>2020-01-03    0.5</span>
</span><span id=__span-16-18><a id=__codelineno-16-18 name=__codelineno-16-18 href=#__codelineno-16-18></a><span class=go>2020-01-04    0.5</span>
</span><span id=__span-16-19><a id=__codelineno-16-19 name=__codelineno-16-19 href=#__codelineno-16-19></a><span class=go>2020-01-05    0.5</span>
</span><span id=__span-16-20><a id=__codelineno-16-20 name=__codelineno-16-20 href=#__codelineno-16-20></a><span class=go>dtype: float64</span>
</span></code></pre></div> <p>To see the list of input names:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>rel_close</span><span class=o>.</span><span class=n>input_names</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=go>(&#39;high&#39;, &#39;low&#39;, &#39;close&#39;)</span>
</span></code></pre></div> <p>You can access any (broadcasted and tiled) input array as an attribute of the indicator instance:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>rel_close</span><span class=o>.</span><span class=n>high</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=go>2020-01-01    1.2</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=go>2020-01-02    2.4</span>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=go>2020-01-03    3.6</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=go>2020-01-04    4.8</span>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=go>2020-01-05    6.0</span>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=go>dtype: float64</span>
</span></code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The input array attached to the indicator instance may look different from what you passed in: 1) it has been broadcasted with the other inputs, and 2) when you access the attribute, it is automatically tiled by the number of parameter combinations to make it easier to compare with outputs. To access the original array, prepend an underscore (<code>_high</code>).</p> </div> <p>To demonstrate broadcasting, let's pass <code>high</code> as a scalar, <code>low</code> as a Series, and <code>close</code> as a DataFrame (even if this combination does not make sense):</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>high</span> <span class=o>=</span> <span class=mi>10</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>low</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>],</span> <span class=n>index</span><span class=o>=</span><span class=n>generate_index</span><span class=p>(</span><span class=mi>5</span><span class=p>))</span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>close</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=gp>... </span>    <span class=s1>&#39;a&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=gp>... </span>    <span class=s1>&#39;b&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>5</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>]</span>
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=gp>... </span><span class=p>},</span> <span class=n>index</span><span class=o>=</span><span class=n>generate_index</span><span class=p>(</span><span class=mi>5</span><span class=p>))</span>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>RelClose</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>high</span><span class=p>,</span> <span class=n>low</span><span class=p>,</span> <span class=n>close</span><span class=p>)</span><span class=o>.</span><span class=n>out</span>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=go>                   a         b</span>
</span><span id=__span-19-9><a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=go>2020-01-01  0.222222  0.444444</span>
</span><span id=__span-19-10><a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a><span class=go>2020-01-02  0.000000  0.250000</span>
</span><span id=__span-19-11><a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a><span class=go>2020-01-03 -0.285714  0.000000</span>
</span><span id=__span-19-12><a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a><span class=go>2020-01-04 -0.333333  0.000000</span>
</span><span id=__span-19-13><a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a><span class=go>2020-01-05 -0.400000  0.000000</span>
</span></code></pre></div> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>By default, if all inputs are Series, they are automatically converted into two-dimensional NumPy arrays. This provides a unified array interface, as most VBT functions mainly work with two-dimensional data. To keep their original dimensions, set <code>to_2d</code> to False in <a href=https://vectorbt.pro/pvt_41531c19/api/indicators/factory/#vectorbtpro.indicators.factory.IndicatorFactory.with_apply_func>IndicatorFactory.with_apply_func</a> or any other factory method.</p> </div> <p>To change broadcasting rules, you can pass a dict called <code>broadcast_kwargs</code>, which is unpacked and forwarded to <a href=https://vectorbt.pro/pvt_41531c19/api/base/reshaping/#vectorbtpro.base.reshaping.broadcast>broadcast</a>. For example, let's tell the broadcaster to cast all three arrays to <code>np.float16</code>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>RelClose</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=gp>... </span>    <span class=n>high</span><span class=p>,</span> <span class=n>low</span><span class=p>,</span> <span class=n>close</span><span class=p>,</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=gp>... </span>    <span class=n>broadcast_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>require_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>float16</span><span class=p>))</span>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>out</span><span class=o>.</span><span class=n>dtypes</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=go>a    float16</span>
</span><span id=__span-20-6><a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=go>b    float16</span>
</span><span id=__span-20-7><a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=go>dtype: object</span>
</span></code></pre></div> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>Remember that any additional keyword arguments passed to a <code>run</code> method are forwarded to <a href=https://vectorbt.pro/pvt_41531c19/api/indicators/factory/#vectorbtpro.indicators.factory.IndicatorBase.run_pipeline>IndicatorBase.run_pipeline</a>. This allows you to set up the pipeline during both indicator creation and execution.</p> </div> <p>Since all arrays are passed directly to <a href=https://vectorbt.pro/pvt_41531c19/api/base/reshaping/#vectorbtpro.base.reshaping.broadcast>broadcast</a>, you can also wrap any of them using the <a href=https://vectorbt.pro/pvt_41531c19/api/base/reshaping/#vectorbtpro.base.reshaping.BCO>BCO</a> class to override broadcasting rules for that particular array only:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>RelClose</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>BCO</span><span class=p>(</span><span class=n>high</span><span class=p>,</span> <span class=n>require_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>float16</span><span class=p>)),</span> 
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>BCO</span><span class=p>(</span><span class=n>low</span><span class=p>,</span> <span class=n>require_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>float16</span><span class=p>)),</span> 
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>BCO</span><span class=p>(</span><span class=n>close</span><span class=p>,</span> <span class=n>require_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>float16</span><span class=p>))</span>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>out</span><span class=o>.</span><span class=n>dtypes</span>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a><span class=go>a    float16</span>
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a><span class=go>b    float16</span>
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a><span class=go>dtype: object</span>
</span></code></pre></div> <h3 id=one-dim>One dim<a class=headerlink href=#one-dim title="Permanent link">&para;</a></h3> <p>Sometimes, adapting your indicator function to work with two-dimensional data is not straightforward. For example, when using a TA-Lib indicator in <code>apply_func</code>, you may need to pass only one column at a time. To instruct <a href=https://vectorbt.pro/pvt_41531c19/api/indicators/factory/#vectorbtpro.indicators.factory.IndicatorFactory.with_apply_func>IndicatorFactory.with_apply_func</a> to split any input and in-place output (Pandas or NumPy) array by column, use the <code>takes_1d</code> argument:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=gp>&gt;&gt;&gt; </span><span class=kn>import</span><span class=w> </span><span class=nn>talib</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>apply_func_1d</span><span class=p>(</span><span class=n>close</span><span class=p>,</span> <span class=n>timeperiod</span><span class=p>):</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>talib</span><span class=o>.</span><span class=n>SMA</span><span class=p>(</span><span class=n>close</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>double</span><span class=p>),</span> <span class=n>timeperiod</span><span class=p>)</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a>
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>SMA</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>IF</span><span class=p>(</span>
</span><span id=__span-22-7><a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a><span class=gp>... </span>    <span class=n>input_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;ts&#39;</span><span class=p>],</span>
</span><span id=__span-22-8><a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a><span class=gp>... </span>    <span class=n>param_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;timeperiod&#39;</span><span class=p>],</span>
</span><span id=__span-22-9><a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a><span class=gp>... </span>    <span class=n>output_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;sma&#39;</span><span class=p>]</span>
</span><span id=__span-22-10><a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_apply_func</span><span class=p>(</span><span class=n>apply_func_1d</span><span class=p>,</span> <span class=n>takes_1d</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-22-11><a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a>
</span><span id=__span-22-12><a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sma</span> <span class=o>=</span> <span class=n>SMA</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>])</span>
</span><span id=__span-22-13><a id=__codelineno-22-13 name=__codelineno-22-13 href=#__codelineno-22-13></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sma</span><span class=o>.</span><span class=n>sma</span>
</span><span id=__span-22-14><a id=__codelineno-22-14 name=__codelineno-22-14 href=#__codelineno-22-14></a><span class=go>custom_timeperiod                   3         4</span>
</span><span id=__span-22-15><a id=__codelineno-22-15 name=__codelineno-22-15 href=#__codelineno-22-15></a><span class=go>                          a         b    a    b</span>
</span><span id=__span-22-16><a id=__codelineno-22-16 name=__codelineno-22-16 href=#__codelineno-22-16></a><span class=go>2020-01-01              NaN       NaN  NaN  NaN</span>
</span><span id=__span-22-17><a id=__codelineno-22-17 name=__codelineno-22-17 href=#__codelineno-22-17></a><span class=go>2020-01-02              NaN       NaN  NaN  NaN</span>
</span><span id=__span-22-18><a id=__codelineno-22-18 name=__codelineno-22-18 href=#__codelineno-22-18></a><span class=go>2020-01-03         4.000000  3.000000  NaN  NaN</span>
</span><span id=__span-22-19><a id=__codelineno-22-19 name=__codelineno-22-19 href=#__codelineno-22-19></a><span class=go>2020-01-04         3.000000  4.000000  3.5  3.5</span>
</span><span id=__span-22-20><a id=__codelineno-22-20 name=__codelineno-22-20 href=#__codelineno-22-20></a><span class=go>2020-01-05         2.666667  4.333333  3.0  4.0</span>
</span><span id=__span-22-21><a id=__codelineno-22-21 name=__codelineno-22-21 href=#__codelineno-22-21></a><span class=go>2020-01-06         3.000000  4.000000  3.0  4.0</span>
</span><span id=__span-22-22><a id=__codelineno-22-22 name=__codelineno-22-22 href=#__codelineno-22-22></a><span class=go>2020-01-07         4.000000  3.000000  3.5  3.5</span>
</span></code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Do not confuse this with <code>per_column</code>, which also splits by column but applies one parameter combination to one column instead of all columns.</p> </div> <h3 id=defaults_1>Defaults<a class=headerlink href=#defaults_1 title="Permanent link">&para;</a></h3> <p>Just like with parameters, you can define defaults for your inputs:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>RelClose</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>IF</span><span class=p>(</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=gp>... </span>    <span class=n>input_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;high&#39;</span><span class=p>,</span> <span class=s1>&#39;low&#39;</span><span class=p>,</span> <span class=s1>&#39;close&#39;</span><span class=p>],</span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=gp>... </span>    <span class=n>output_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;out&#39;</span><span class=p>]</span>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_apply_func</span><span class=p>(</span>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=gp>... </span>    <span class=n>apply_func</span><span class=p>,</span>
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=gp>... </span>    <span class=n>high</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=gp>... </span>    <span class=n>low</span><span class=o>=</span><span class=mi>10</span>
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-23-9><a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a>
</span><span id=__span-23-10><a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>RelClose</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>close</span><span class=p>)</span><span class=o>.</span><span class=n>out</span>
</span><span id=__span-23-11><a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a><span class=go>              a    b</span>
</span><span id=__span-23-12><a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a><span class=go>2020-01-01  0.7  0.5</span>
</span><span id=__span-23-13><a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a><span class=go>2020-01-02  0.8  0.6</span>
</span><span id=__span-23-14><a id=__codelineno-23-14 name=__codelineno-23-14 href=#__codelineno-23-14></a><span class=go>2020-01-03  0.9  0.7</span>
</span><span id=__span-23-15><a id=__codelineno-23-15 name=__codelineno-23-15 href=#__codelineno-23-15></a><span class=go>2020-01-04  0.8  0.6</span>
</span><span id=__span-23-16><a id=__codelineno-23-16 name=__codelineno-23-16 href=#__codelineno-23-16></a><span class=go>2020-01-05  0.7  0.5</span>
</span></code></pre></div> <p>However, unlike parameters, setting inputs to scalars is often not ideal. Instead, you may want to set them to other inputs, which is possible using <a href=https://vectorbt.pro/pvt_41531c19/api/base/reshaping/#vectorbtpro.base.reshaping.Ref>Ref</a>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>RelClose</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>IF</span><span class=p>(</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=gp>... </span>    <span class=n>input_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;high&#39;</span><span class=p>,</span> <span class=s1>&#39;low&#39;</span><span class=p>,</span> <span class=s1>&#39;close&#39;</span><span class=p>],</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=gp>... </span>    <span class=n>output_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;out&#39;</span><span class=p>]</span>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_apply_func</span><span class=p>(</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=gp>... </span>    <span class=n>apply_func</span><span class=p>,</span>
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=gp>... </span>    <span class=n>high</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Ref</span><span class=p>(</span><span class=s1>&#39;close&#39;</span><span class=p>),</span>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=gp>... </span>    <span class=n>low</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Ref</span><span class=p>(</span><span class=s1>&#39;close&#39;</span><span class=p>)</span>
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-24-9><a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a>
</span><span id=__span-24-10><a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>RelClose</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>high</span><span class=o>=</span><span class=n>high</span><span class=p>,</span> <span class=n>close</span><span class=o>=</span><span class=n>close</span><span class=p>)</span><span class=o>.</span><span class=n>out</span>
</span><span id=__span-24-11><a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a><span class=go>              a    b</span>
</span><span id=__span-24-12><a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a><span class=go>2020-01-01  0.0  0.0</span>
</span><span id=__span-24-13><a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a><span class=go>2020-01-02  0.0  0.0</span>
</span><span id=__span-24-14><a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a><span class=go>2020-01-03  0.0  0.0</span>
</span><span id=__span-24-15><a id=__codelineno-24-15 name=__codelineno-24-15 href=#__codelineno-24-15></a><span class=go>2020-01-04  0.0  0.0</span>
</span><span id=__span-24-16><a id=__codelineno-24-16 name=__codelineno-24-16 href=#__codelineno-24-16></a><span class=go>2020-01-05  0.0  0.0</span>
</span></code></pre></div> <h3 id=using-pandas>Using Pandas<a class=headerlink href=#using-pandas title="Permanent link">&para;</a></h3> <p>Working only with NumPy arrays is not always the best choice: sometimes you want to take advantage of Pandas metadata or VBT's Pandas extensions. To prevent conversion of Pandas objects to NumPy arrays, you can set <code>keep_pd</code> to True.</p> <p>For example, let's create an indicator that takes a DataFrame and normalizes it against the mean of each group of columns. The interesting part is that the <code>group_by</code> for grouping columns will be a parameter!</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>apply_func</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>group_by</span><span class=p>):</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>ts</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>demean</span><span class=p>(</span><span class=n>group_by</span><span class=o>=</span><span class=n>group_by</span><span class=p>)</span>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>Demeaner</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>IF</span><span class=p>(</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=gp>... </span>    <span class=n>input_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;ts&#39;</span><span class=p>],</span>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=gp>... </span>    <span class=n>param_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;group_by&#39;</span><span class=p>],</span>
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a><span class=gp>... </span>    <span class=n>output_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;out&#39;</span><span class=p>]</span>
</span><span id=__span-25-8><a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_apply_func</span><span class=p>(</span><span class=n>apply_func</span><span class=p>,</span> <span class=n>keep_pd</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-25-9><a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a>
</span><span id=__span-25-10><a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>ts_wide</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span><span id=__span-25-11><a id=__codelineno-25-11 name=__codelineno-25-11 href=#__codelineno-25-11></a><span class=gp>... </span>    <span class=s1>&#39;a&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>],</span>
</span><span id=__span-25-12><a id=__codelineno-25-12 name=__codelineno-25-12 href=#__codelineno-25-12></a><span class=gp>... </span>    <span class=s1>&#39;b&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>5</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>],</span>
</span><span id=__span-25-13><a id=__codelineno-25-13 name=__codelineno-25-13 href=#__codelineno-25-13></a><span class=gp>... </span>    <span class=s1>&#39;c&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span>
</span><span id=__span-25-14><a id=__codelineno-25-14 name=__codelineno-25-14 href=#__codelineno-25-14></a><span class=gp>... </span>    <span class=s1>&#39;d&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>]</span>
</span><span id=__span-25-15><a id=__codelineno-25-15 name=__codelineno-25-15 href=#__codelineno-25-15></a><span class=gp>... </span><span class=p>},</span> <span class=n>index</span><span class=o>=</span><span class=n>generate_index</span><span class=p>(</span><span class=mi>5</span><span class=p>))</span>
</span><span id=__span-25-16><a id=__codelineno-25-16 name=__codelineno-25-16 href=#__codelineno-25-16></a><span class=gp>&gt;&gt;&gt; </span><span class=n>demeaner</span> <span class=o>=</span> <span class=n>Demeaner</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>ts_wide</span><span class=p>,</span> <span class=n>group_by</span><span class=o>=</span><span class=p>[(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>),</span> <span class=kc>True</span><span class=p>])</span>
</span><span id=__span-25-17><a id=__codelineno-25-17 name=__codelineno-25-17 href=#__codelineno-25-17></a><span class=gp>&gt;&gt;&gt; </span><span class=n>demeaner</span><span class=o>.</span><span class=n>out</span>
</span><span id=__span-25-18><a id=__codelineno-25-18 name=__codelineno-25-18 href=#__codelineno-25-18></a><span class=go>custom_group_by                tuple_0                True</span>
</span><span id=__span-25-19><a id=__codelineno-25-19 name=__codelineno-25-19 href=#__codelineno-25-19></a><span class=go>                      a    b    c    d    a    b    c    d</span>
</span><span id=__span-25-20><a id=__codelineno-25-20 name=__codelineno-25-20 href=#__codelineno-25-20></a><span class=go>2020-01-01         -2.0  2.0  1.0 -1.0 -1.5  2.5  0.5 -1.5</span>
</span><span id=__span-25-21><a id=__codelineno-25-21 name=__codelineno-25-21 href=#__codelineno-25-21></a><span class=go>2020-01-02         -1.0  1.0  0.0  0.0 -0.5  1.5 -0.5 -0.5</span>
</span><span id=__span-25-22><a id=__codelineno-25-22 name=__codelineno-25-22 href=#__codelineno-25-22></a><span class=go>2020-01-03          0.0  0.0 -1.0  1.0  0.5  0.5 -1.5  0.5</span>
</span><span id=__span-25-23><a id=__codelineno-25-23 name=__codelineno-25-23 href=#__codelineno-25-23></a><span class=go>2020-01-04          1.0 -1.0  0.0  0.0  1.5 -0.5 -0.5 -0.5</span>
</span><span id=__span-25-24><a id=__codelineno-25-24 name=__codelineno-25-24 href=#__codelineno-25-24></a><span class=go>2020-01-05          2.0 -2.0  1.0 -1.0  2.5 -1.5  0.5 -1.5</span>
</span></code></pre></div> <p>Alternatively, you can have <a href=https://vectorbt.pro/pvt_41531c19/api/indicators/factory/#vectorbtpro.indicators.factory.IndicatorBase.run_pipeline>IndicatorBase.run_pipeline</a> pass inputs as NumPy arrays, along with a <a href=https://vectorbt.pro/pvt_41531c19/documentation/building-blocks/#wrapping>wrapper</a> that includes the Pandas metadata:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>apply_func</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>group_by</span><span class=p>,</span> <span class=n>wrapper</span><span class=p>):</span>  <span class=c1># (1)!</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=gp>... </span>    <span class=n>group_map</span> <span class=o>=</span> <span class=n>wrapper</span><span class=o>.</span><span class=n>grouper</span><span class=o>.</span><span class=n>get_group_map</span><span class=p>(</span><span class=n>group_by</span><span class=o>=</span><span class=n>group_by</span><span class=p>)</span>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>demean_nb</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>group_map</span><span class=p>)</span>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>Demeaner</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>IF</span><span class=p>(</span>
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=gp>... </span>    <span class=n>input_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;ts&#39;</span><span class=p>],</span>
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=gp>... </span>    <span class=n>param_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;group_by&#39;</span><span class=p>],</span>
</span><span id=__span-26-8><a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=gp>... </span>    <span class=n>output_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;out&#39;</span><span class=p>]</span>
</span><span id=__span-26-9><a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_apply_func</span><span class=p>(</span><span class=n>apply_func</span><span class=p>,</span> <span class=n>pass_wrapper</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></code></pre></div> <ol> <li><code>ts</code> is a two-dimensional NumPy array, which can be used in most Numba-compiled functions provided by VBT.</li> </ol> <h3 id=inputless>Inputless<a class=headerlink href=#inputless title="Permanent link">&para;</a></h3> <p>What if an indicator does not take any input arrays? For example, you may want to create an indicator that takes an input shape, creates one or more output arrays of that shape, and fills them using information provided as additional arguments. To do this, you can require the user to provide an input shape using <code>require_input_shape</code>.</p> <p>Let's define a generator that emulates random returns and generates a synthetic price. This is a parameterized way of implementing <a href=https://vectorbt.pro/pvt_41531c19/api/data/custom/random/#vectorbtpro.data.custom.random.RandomData>RandomData</a>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>apply_func</span><span class=p>(</span><span class=n>input_shape</span><span class=p>,</span> <span class=n>start</span><span class=p>,</span> <span class=n>mean</span><span class=p>,</span> <span class=n>std</span><span class=p>):</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=gp>... </span>    <span class=n>rand_returns</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>normal</span><span class=p>(</span><span class=n>mean</span><span class=p>,</span> <span class=n>std</span><span class=p>,</span> <span class=n>input_shape</span><span class=p>)</span>
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>start</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>cumprod</span><span class=p>(</span><span class=mi>1</span> <span class=o>+</span> <span class=n>rand_returns</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a>
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>RandPrice</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>IF</span><span class=p>(</span>
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a><span class=gp>... </span>    <span class=n>class_name</span><span class=o>=</span><span class=s2>&quot;RandPrice&quot;</span><span class=p>,</span>
</span><span id=__span-27-7><a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a><span class=gp>... </span>    <span class=n>param_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;start&#39;</span><span class=p>,</span> <span class=s1>&#39;mean&#39;</span><span class=p>,</span> <span class=s1>&#39;std&#39;</span><span class=p>],</span>
</span><span id=__span-27-8><a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a><span class=gp>... </span>    <span class=n>output_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;out&#39;</span><span class=p>]</span>
</span><span id=__span-27-9><a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_apply_func</span><span class=p>(</span>
</span><span id=__span-27-10><a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a><span class=gp>... </span>    <span class=n>apply_func</span><span class=p>,</span>
</span><span id=__span-27-11><a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a><span class=gp>... </span>    <span class=n>require_input_shape</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-27-12><a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a><span class=gp>... </span>    <span class=n>start</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-27-13><a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a><span class=gp>... </span>    <span class=n>mean</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>  <span class=c1># (2)!</span>
</span><span id=__span-27-14><a id=__codelineno-27-14 name=__codelineno-27-14 href=#__codelineno-27-14></a><span class=gp>... </span>    <span class=n>std</span><span class=o>=</span><span class=mf>0.01</span><span class=p>,</span>  <span class=c1># (3)!</span>
</span><span id=__span-27-15><a id=__codelineno-27-15 name=__codelineno-27-15 href=#__codelineno-27-15></a><span class=gp>... </span>    <span class=n>seed</span><span class=o>=</span><span class=mi>42</span>  <span class=c1># (4)!</span>
</span><span id=__span-27-16><a id=__codelineno-27-16 name=__codelineno-27-16 href=#__codelineno-27-16></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-27-17><a id=__codelineno-27-17 name=__codelineno-27-17 href=#__codelineno-27-17></a>
</span><span id=__span-27-18><a id=__codelineno-27-18 name=__codelineno-27-18 href=#__codelineno-27-18></a><span class=gp>&gt;&gt;&gt; </span><span class=n>RandPrice</span><span class=o>.</span><span class=n>run</span><span class=p>((</span><span class=mi>5</span><span class=p>,</span> <span class=mi>2</span><span class=p>))</span><span class=o>.</span><span class=n>out</span>
</span><span id=__span-27-19><a id=__codelineno-27-19 name=__codelineno-27-19 href=#__codelineno-27-19></a><span class=go>            0           1</span>
</span><span id=__span-27-20><a id=__codelineno-27-20 name=__codelineno-27-20 href=#__codelineno-27-20></a><span class=go>0  100.496714   99.861736</span>
</span><span id=__span-27-21><a id=__codelineno-27-21 name=__codelineno-27-21 href=#__codelineno-27-21></a><span class=go>1  101.147620  101.382660</span>
</span><span id=__span-27-22><a id=__codelineno-27-22 name=__codelineno-27-22 href=#__codelineno-27-22></a><span class=go>2  100.910779  101.145285</span>
</span><span id=__span-27-23><a id=__codelineno-27-23 name=__codelineno-27-23 href=#__codelineno-27-23></a><span class=go>3  102.504375  101.921510</span>
</span><span id=__span-27-24><a id=__codelineno-27-24 name=__codelineno-27-24 href=#__codelineno-27-24></a><span class=go>4  102.023143  102.474495</span>
</span></code></pre></div> <ol> <li>Default starting value.</li> <li>Default mean ("center") of the distribution.</li> <li>Default standard deviation (spread or "width") of the distribution.</li> <li><a href=https://vectorbt.pro/pvt_41531c19/api/indicators/factory/#vectorbtpro.indicators.factory.IndicatorBase.run_pipeline>IndicatorBase.run_pipeline</a> supports random seeds.</li> </ol> <div class="admonition info"> <p class=admonition-title>Info</p> <p>When <code>require_input_shape</code> is True, <a href=https://vectorbt.pro/pvt_41531c19/api/indicators/factory/#vectorbtpro.indicators.factory.IndicatorFactory>IndicatorFactory</a> prepends an <code>input_shape</code> argument to the <code>run</code> method's signature. Without this argument, the <code>apply_func</code> itself must determine the input shape.</p> </div> <p>However, having integer columns and index is not very convenient. Fortunately, VBT allows you to pass <code>input_index</code> and <code>input_columns</code>!</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>RandPrice</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=gp>... </span>    <span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span>
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=gp>... </span>    <span class=n>input_index</span><span class=o>=</span><span class=n>generate_index</span><span class=p>(</span><span class=mi>5</span><span class=p>),</span>
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=gp>... </span>    <span class=n>input_columns</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>],</span>
</span><span id=__span-28-5><a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a><span class=gp>... </span>    <span class=n>mean</span><span class=o>=</span><span class=p>[</span><span class=o>-</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>]</span>
</span><span id=__span-28-6><a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>out</span>
</span><span id=__span-28-7><a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a><span class=go>randprice_mean                  -0.1                     0.1</span>
</span><span id=__span-28-8><a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a><span class=go>                        a          b           a           b</span>
</span><span id=__span-28-9><a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a><span class=go>2020-01-01      90.496714  89.861736  109.536582  109.534270</span>
</span><span id=__span-28-10><a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a><span class=go>2020-01-02      82.033180  82.244183  120.755278  118.392000</span>
</span><span id=__span-28-11><a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a><span class=go>2020-01-03      73.637778  73.827201  130.747876  129.565496</span>
</span><span id=__span-28-12><a id=__codelineno-28-12 name=__codelineno-28-12 href=#__codelineno-28-12></a><span class=go>2020-01-04      67.436898  67.011056  142.498409  142.929202</span>
</span><span id=__span-28-13><a id=__codelineno-28-13 name=__codelineno-28-13 href=#__codelineno-28-13></a><span class=go>2020-01-05      60.376609  60.673526  155.454330  155.203528</span>
</span></code></pre></div> <p>You can even build an indicator that decides on the output shape dynamically. Let's create a fun indicator that returns an array with a random shape:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>custom_func</span><span class=p>(</span><span class=n>min_rows</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>max_rows</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span> <span class=n>min_cols</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>max_cols</span><span class=o>=</span><span class=mi>3</span><span class=p>):</span>  <span class=c1># (1)!</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=gp>... </span>    <span class=n>n_rows</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=n>min_rows</span><span class=p>,</span> <span class=n>max_rows</span><span class=p>)</span>
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=gp>... </span>    <span class=n>n_cols</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=n>min_cols</span><span class=p>,</span> <span class=n>max_cols</span><span class=p>)</span>
</span><span id=__span-29-4><a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=n>size</span><span class=o>=</span><span class=p>(</span><span class=n>n_rows</span><span class=p>,</span> <span class=n>n_cols</span><span class=p>))</span>
</span><span id=__span-29-5><a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a>
</span><span id=__span-29-6><a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>RandShaped</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>IF</span><span class=p>(</span>
</span><span id=__span-29-7><a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a><span class=gp>... </span>    <span class=n>output_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;out&#39;</span><span class=p>]</span>
</span><span id=__span-29-8><a id=__codelineno-29-8 name=__codelineno-29-8 href=#__codelineno-29-8></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_custom_func</span><span class=p>(</span><span class=n>custom_func</span><span class=p>)</span>
</span><span id=__span-29-9><a id=__codelineno-29-9 name=__codelineno-29-9 href=#__codelineno-29-9></a>
</span><span id=__span-29-10><a id=__codelineno-29-10 name=__codelineno-29-10 href=#__codelineno-29-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>RandShaped</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>seed</span><span class=o>=</span><span class=mi>42</span><span class=p>)</span><span class=o>.</span><span class=n>out</span>
</span><span id=__span-29-11><a id=__codelineno-29-11 name=__codelineno-29-11 href=#__codelineno-29-11></a><span class=go>          0         1</span>
</span><span id=__span-29-12><a id=__codelineno-29-12 name=__codelineno-29-12 href=#__codelineno-29-12></a><span class=go>0  0.950714  0.731994</span>
</span><span id=__span-29-13><a id=__codelineno-29-13 name=__codelineno-29-13 href=#__codelineno-29-13></a><span class=go>1  0.598658  0.156019</span>
</span><span id=__span-29-14><a id=__codelineno-29-14 name=__codelineno-29-14 href=#__codelineno-29-14></a><span class=go>2  0.155995  0.058084</span>
</span><span id=__span-29-15><a id=__codelineno-29-15 name=__codelineno-29-15 href=#__codelineno-29-15></a>
</span><span id=__span-29-16><a id=__codelineno-29-16 name=__codelineno-29-16 href=#__codelineno-29-16></a><span class=gp>&gt;&gt;&gt; </span><span class=n>RandShaped</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>seed</span><span class=o>=</span><span class=mi>43</span><span class=p>)</span><span class=o>.</span><span class=n>out</span>
</span><span id=__span-29-17><a id=__codelineno-29-17 name=__codelineno-29-17 href=#__codelineno-29-17></a><span class=go>0    0.609067</span>
</span><span id=__span-29-18><a id=__codelineno-29-18 name=__codelineno-29-18 href=#__codelineno-29-18></a><span class=go>dtype: float64</span>
</span><span id=__span-29-19><a id=__codelineno-29-19 name=__codelineno-29-19 href=#__codelineno-29-19></a>
</span><span id=__span-29-20><a id=__codelineno-29-20 name=__codelineno-29-20 href=#__codelineno-29-20></a><span class=gp>&gt;&gt;&gt; </span><span class=n>RandShaped</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>seed</span><span class=o>=</span><span class=mi>44</span><span class=p>)</span><span class=o>.</span><span class=n>out</span>
</span><span id=__span-29-21><a id=__codelineno-29-21 name=__codelineno-29-21 href=#__codelineno-29-21></a><span class=go>          0        1</span>
</span><span id=__span-29-22><a id=__codelineno-29-22 name=__codelineno-29-22 href=#__codelineno-29-22></a><span class=go>0  0.104796  0.74464</span>
</span></code></pre></div> <ol> <li>We use <code>custom_func</code> instead of <code>apply_func</code> because this indicator cannot be parameterized, and no iteration takes place.</li> </ol> <h2 id=outputs>Outputs<a class=headerlink href=#outputs title="Permanent link">&para;</a></h2> <p><a href=https://vectorbt.pro/pvt_41531c19/api/indicators/factory/#vectorbtpro.indicators.factory.IndicatorFactory>IndicatorFactory</a> supports returning one or more outputs. There are two types of outputs: regular outputs and in-place outputs (also called "in-place outputs").</p> <h3 id=regular>Regular<a class=headerlink href=#regular title="Permanent link">&para;</a></h3> <p>Regular outputs are arrays explicitly returned by the calculation function. Each output must have the same shape and match the number of columns in the input, multiplied by the number of parameter combinations. This requirement only needs special attention when using <code>custom_func</code>, as <code>apply_func</code> handles the tiling automatically. If there is only one output, an array must be returned. If there are multiple outputs, a tuple containing multiple arrays must be returned.</p> <p>Let's demonstrate multiple regular outputs by computing and returning the entries and exits from a moving average crossover:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>apply_func</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>fastw</span><span class=p>,</span> <span class=n>sloww</span><span class=p>,</span> <span class=n>minp</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=gp>... </span>    <span class=n>fast_ma</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>rolling_mean_nb</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>fastw</span><span class=p>,</span> <span class=n>minp</span><span class=o>=</span><span class=n>minp</span><span class=p>)</span>
</span><span id=__span-30-3><a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a><span class=gp>... </span>    <span class=n>slow_ma</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>rolling_mean_nb</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>sloww</span><span class=p>,</span> <span class=n>minp</span><span class=o>=</span><span class=n>minp</span><span class=p>)</span>
</span><span id=__span-30-4><a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a><span class=gp>... </span>    <span class=n>entries</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>crossed_above_nb</span><span class=p>(</span><span class=n>fast_ma</span><span class=p>,</span> <span class=n>slow_ma</span><span class=p>)</span>
</span><span id=__span-30-5><a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a><span class=gp>... </span>    <span class=n>exits</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>crossed_above_nb</span><span class=p>(</span><span class=n>slow_ma</span><span class=p>,</span> <span class=n>fast_ma</span><span class=p>)</span>
</span><span id=__span-30-6><a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a><span class=gp>... </span>    <span class=k>return</span> <span class=p>(</span><span class=n>fast_ma</span><span class=p>,</span> <span class=n>slow_ma</span><span class=p>,</span> <span class=n>entries</span><span class=p>,</span> <span class=n>exits</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-30-7><a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a>
</span><span id=__span-30-8><a id=__codelineno-30-8 name=__codelineno-30-8 href=#__codelineno-30-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>CrossSig</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>IF</span><span class=p>(</span>
</span><span id=__span-30-9><a id=__codelineno-30-9 name=__codelineno-30-9 href=#__codelineno-30-9></a><span class=gp>... </span>    <span class=n>class_name</span><span class=o>=</span><span class=s2>&quot;CrossSig&quot;</span><span class=p>,</span>
</span><span id=__span-30-10><a id=__codelineno-30-10 name=__codelineno-30-10 href=#__codelineno-30-10></a><span class=gp>... </span>    <span class=n>input_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;ts&#39;</span><span class=p>],</span>
</span><span id=__span-30-11><a id=__codelineno-30-11 name=__codelineno-30-11 href=#__codelineno-30-11></a><span class=gp>... </span>    <span class=n>param_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;fastw&#39;</span><span class=p>,</span> <span class=s1>&#39;sloww&#39;</span><span class=p>],</span>
</span><span id=__span-30-12><a id=__codelineno-30-12 name=__codelineno-30-12 href=#__codelineno-30-12></a><span class=gp>... </span>    <span class=n>output_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;fast_ma&#39;</span><span class=p>,</span> <span class=s1>&#39;slow_ma&#39;</span><span class=p>,</span> <span class=s1>&#39;entries&#39;</span><span class=p>,</span> <span class=s1>&#39;exits&#39;</span><span class=p>]</span>
</span><span id=__span-30-13><a id=__codelineno-30-13 name=__codelineno-30-13 href=#__codelineno-30-13></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_apply_func</span><span class=p>(</span><span class=n>apply_func</span><span class=p>)</span>
</span><span id=__span-30-14><a id=__codelineno-30-14 name=__codelineno-30-14 href=#__codelineno-30-14></a>
</span><span id=__span-30-15><a id=__codelineno-30-15 name=__codelineno-30-15 href=#__codelineno-30-15></a><span class=gp>&gt;&gt;&gt; </span><span class=n>ts2</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span><span id=__span-30-16><a id=__codelineno-30-16 name=__codelineno-30-16 href=#__codelineno-30-16></a><span class=gp>... </span>    <span class=s1>&#39;a&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span>
</span><span id=__span-30-17><a id=__codelineno-30-17 name=__codelineno-30-17 href=#__codelineno-30-17></a><span class=gp>... </span>    <span class=s1>&#39;b&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>]</span>
</span><span id=__span-30-18><a id=__codelineno-30-18 name=__codelineno-30-18 href=#__codelineno-30-18></a><span class=gp>... </span><span class=p>},</span> <span class=n>index</span><span class=o>=</span><span class=n>generate_index</span><span class=p>(</span><span class=mi>7</span><span class=p>))</span>
</span><span id=__span-30-19><a id=__codelineno-30-19 name=__codelineno-30-19 href=#__codelineno-30-19></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cross_sig</span> <span class=o>=</span> <span class=n>CrossSig</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>ts2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>4</span><span class=p>)</span>
</span></code></pre></div> <ol> <li>Also return the fast and slow moving average for analysis.</li> </ol> <div class="admonition important"> <p class=admonition-title>Important</p> <p>Any output registered in <code>output_names</code> must have the same shape as the broadcasted inputs. This requirement makes it possible to index the indicator instance.</p> </div> <p>To get the list of output names:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cross_sig</span><span class=o>.</span><span class=n>output_names</span>
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=go>(&#39;fast_ma&#39;, &#39;slow_ma&#39;, &#39;entries&#39;, &#39;exits&#39;)</span>
</span></code></pre></div> <p>Any (broadcasted and tiled) output array can be accessed as an attribute of the indicator instance:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cross_sig</span><span class=o>.</span><span class=n>entries</span>
</span><span id=__span-32-2><a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a><span class=go>crosssig_fastw      2      2</span>
</span><span id=__span-32-3><a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a><span class=go>crosssig_sloww      4      4</span>
</span><span id=__span-32-4><a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a><span class=go>                    a      b</span>
</span><span id=__span-32-5><a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a><span class=go>2020-01-01      False  False</span>
</span><span id=__span-32-6><a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a><span class=go>2020-01-02      False  False</span>
</span><span id=__span-32-7><a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a><span class=go>2020-01-03      False  False</span>
</span><span id=__span-32-8><a id=__codelineno-32-8 name=__codelineno-32-8 href=#__codelineno-32-8></a><span class=go>2020-01-04      False  False</span>
</span><span id=__span-32-9><a id=__codelineno-32-9 name=__codelineno-32-9 href=#__codelineno-32-9></a><span class=go>2020-01-05      False   True</span>
</span><span id=__span-32-10><a id=__codelineno-32-10 name=__codelineno-32-10 href=#__codelineno-32-10></a><span class=go>2020-01-06      False  False</span>
</span><span id=__span-32-11><a id=__codelineno-32-11 name=__codelineno-32-11 href=#__codelineno-32-11></a><span class=go>2020-01-07       True  False</span>
</span></code></pre></div> <h3 id=in-place>In-place<a class=headerlink href=#in-place title="Permanent link">&para;</a></h3> <p>In-place outputs are arrays that are not returned but modified in place. They act as regular inputs when entering the pipeline and as regular outputs when exiting. In particular:</p> <ol> <li>They broadcast together with regular inputs if provided. Otherwise, an empty array is created.</li> <li>They are tiled by the number of hyperparameter combinations.</li> <li>Each tile is modified in place (they are <strong>not</strong> returned).</li> <li>After calculation, all the tiles are concatenated to form an output.</li> </ol> <p>By default, in-place outputs are created as empty arrays with uninitialized floating point values. This allows for the creation of optional outputs that, if not written to, do not consume much memory. Since not all outputs should have the <code>float</code> data type, you can pass <code>dtype</code> in the <code>in_output_settings</code>.</p> <p>Let's modify the indicator above by converting both signal arrays to in-place outputs:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>apply_func</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>entries</span><span class=p>,</span> <span class=n>exits</span><span class=p>,</span> <span class=n>fastw</span><span class=p>,</span> <span class=n>sloww</span><span class=p>,</span> <span class=n>minp</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a><span class=gp>... </span>    <span class=n>fast_ma</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>rolling_mean_nb</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>fastw</span><span class=p>,</span> <span class=n>minp</span><span class=o>=</span><span class=n>minp</span><span class=p>)</span>
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a><span class=gp>... </span>    <span class=n>slow_ma</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>rolling_mean_nb</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>sloww</span><span class=p>,</span> <span class=n>minp</span><span class=o>=</span><span class=n>minp</span><span class=p>)</span>
</span><span id=__span-33-4><a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a><span class=gp>... </span>    <span class=n>entries</span><span class=p>[:]</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>crossed_above_nb</span><span class=p>(</span><span class=n>fast_ma</span><span class=p>,</span> <span class=n>slow_ma</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-33-5><a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a><span class=gp>... </span>    <span class=n>exits</span><span class=p>[:]</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>crossed_above_nb</span><span class=p>(</span><span class=n>slow_ma</span><span class=p>,</span> <span class=n>fast_ma</span><span class=p>)</span>
</span><span id=__span-33-6><a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a><span class=gp>... </span>    <span class=k>return</span> <span class=p>(</span><span class=n>fast_ma</span><span class=p>,</span> <span class=n>slow_ma</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-33-7><a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a>
</span><span id=__span-33-8><a id=__codelineno-33-8 name=__codelineno-33-8 href=#__codelineno-33-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>CrossSig</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>IF</span><span class=p>(</span>
</span><span id=__span-33-9><a id=__codelineno-33-9 name=__codelineno-33-9 href=#__codelineno-33-9></a><span class=gp>... </span>    <span class=n>class_name</span><span class=o>=</span><span class=s2>&quot;CrossSig&quot;</span><span class=p>,</span>
</span><span id=__span-33-10><a id=__codelineno-33-10 name=__codelineno-33-10 href=#__codelineno-33-10></a><span class=gp>... </span>    <span class=n>input_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;ts&#39;</span><span class=p>],</span>
</span><span id=__span-33-11><a id=__codelineno-33-11 name=__codelineno-33-11 href=#__codelineno-33-11></a><span class=gp>... </span>    <span class=n>in_output_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;entries&#39;</span><span class=p>,</span> <span class=s1>&#39;exits&#39;</span><span class=p>],</span>
</span><span id=__span-33-12><a id=__codelineno-33-12 name=__codelineno-33-12 href=#__codelineno-33-12></a><span class=gp>... </span>    <span class=n>param_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;fastw&#39;</span><span class=p>,</span> <span class=s1>&#39;sloww&#39;</span><span class=p>],</span>
</span><span id=__span-33-13><a id=__codelineno-33-13 name=__codelineno-33-13 href=#__codelineno-33-13></a><span class=gp>... </span>    <span class=n>output_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;fast_ma&#39;</span><span class=p>,</span> <span class=s1>&#39;slow_ma&#39;</span><span class=p>]</span>
</span><span id=__span-33-14><a id=__codelineno-33-14 name=__codelineno-33-14 href=#__codelineno-33-14></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_apply_func</span><span class=p>(</span>
</span><span id=__span-33-15><a id=__codelineno-33-15 name=__codelineno-33-15 href=#__codelineno-33-15></a><span class=gp>... </span>    <span class=n>apply_func</span><span class=p>,</span>
</span><span id=__span-33-16><a id=__codelineno-33-16 name=__codelineno-33-16 href=#__codelineno-33-16></a><span class=gp>... </span>    <span class=n>in_output_settings</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-33-17><a id=__codelineno-33-17 name=__codelineno-33-17 href=#__codelineno-33-17></a><span class=gp>... </span>        <span class=n>entries</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>bool_</span><span class=p>),</span>  <span class=c1># (3)!</span>
</span><span id=__span-33-18><a id=__codelineno-33-18 name=__codelineno-33-18 href=#__codelineno-33-18></a><span class=gp>... </span>        <span class=n>exits</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>bool_</span><span class=p>)</span>
</span><span id=__span-33-19><a id=__codelineno-33-19 name=__codelineno-33-19 href=#__codelineno-33-19></a><span class=gp>... </span>    <span class=p>)</span>
</span><span id=__span-33-20><a id=__codelineno-33-20 name=__codelineno-33-20 href=#__codelineno-33-20></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-33-21><a id=__codelineno-33-21 name=__codelineno-33-21 href=#__codelineno-33-21></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cross_sig</span> <span class=o>=</span> <span class=n>CrossSig</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>ts2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>4</span><span class=p>)</span>
</span></code></pre></div> <ol> <li>Both arrays are modified in place.</li> <li>Both arrays are no longer returned.</li> <li>Instruct <a href=https://vectorbt.pro/pvt_41531c19/api/indicators/factory/#vectorbtpro.indicators.factory.IndicatorBase.run_pipeline>IndicatorBase.run_pipeline</a> to initialize both signal arrays with the boolean data type.</li> </ol> <p>If you print the <code>output_names</code>, you will see that <code>entries</code> and <code>exits</code> are no longer included:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cross_sig</span><span class=o>.</span><span class=n>output_names</span>
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a><span class=go>(&#39;fast_ma&#39;, &#39;slow_ma&#39;)</span>
</span></code></pre></div> <p>To see all in-place output arrays, use the <code>in_output_names</code> attribute:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-35-1><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cross_sig</span><span class=o>.</span><span class=n>in_output_names</span>
</span><span id=__span-35-2><a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a><span class=go>(&#39;entries&#39;, &#39;exits&#39;)</span>
</span></code></pre></div> <p>Both signal arrays can be accessed as usual:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-36-1><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cross_sig</span><span class=o>.</span><span class=n>entries</span>
</span><span id=__span-36-2><a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a><span class=go>crosssig_fastw             2</span>
</span><span id=__span-36-3><a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a><span class=go>crosssig_sloww             4</span>
</span><span id=__span-36-4><a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a><span class=go>                    a      b</span>
</span><span id=__span-36-5><a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a><span class=go>2020-01-01      False  False</span>
</span><span id=__span-36-6><a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a><span class=go>2020-01-02      False  False</span>
</span><span id=__span-36-7><a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a><span class=go>2020-01-03      False  False</span>
</span><span id=__span-36-8><a id=__codelineno-36-8 name=__codelineno-36-8 href=#__codelineno-36-8></a><span class=go>2020-01-04      False  False</span>
</span><span id=__span-36-9><a id=__codelineno-36-9 name=__codelineno-36-9 href=#__codelineno-36-9></a><span class=go>2020-01-05      False   True</span>
</span><span id=__span-36-10><a id=__codelineno-36-10 name=__codelineno-36-10 href=#__codelineno-36-10></a><span class=go>2020-01-06      False  False</span>
</span><span id=__span-36-11><a id=__codelineno-36-11 name=__codelineno-36-11 href=#__codelineno-36-11></a><span class=go>2020-01-07       True  False</span>
</span></code></pre></div> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>An interesting scenario occurs when there are no regular outputs, only in-place outputs. In this case, you should set <code>output_names</code> to an empty list, modify all arrays in place, and return <code>None</code>. See the example below.</p> </div> <h4 id=defaults_2>Defaults<a class=headerlink href=#defaults_2 title="Permanent link">&para;</a></h4> <p>You might be wondering: <em>"Why should we bother using in-place outputs when we can just return regular outputs?"</em> The answer is that we can provide custom data and overwrite it without using additional memory. Consider the following example, where we keep the first <code>n</code> signals in a boolean time series:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-37-1><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
</span><span id=__span-37-2><a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class=gp>... </span><span class=k>def</span><span class=w> </span><span class=nf>apply_func_nb</span><span class=p>(</span><span class=n>signals</span><span class=p>,</span> <span class=n>n</span><span class=p>):</span>
</span><span id=__span-37-3><a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>signals</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>]):</span>
</span><span id=__span-37-4><a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a><span class=gp>... </span>        <span class=n>n_found</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-37-5><a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a><span class=gp>... </span>        <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>signals</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]):</span>
</span><span id=__span-37-6><a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a><span class=gp>... </span>            <span class=k>if</span> <span class=n>signals</span><span class=p>[</span><span class=n>row</span><span class=p>,</span> <span class=n>col</span><span class=p>]:</span>
</span><span id=__span-37-7><a id=__codelineno-37-7 name=__codelineno-37-7 href=#__codelineno-37-7></a><span class=gp>... </span>                <span class=k>if</span> <span class=n>n_found</span> <span class=o>&gt;=</span> <span class=n>n</span><span class=p>:</span>
</span><span id=__span-37-8><a id=__codelineno-37-8 name=__codelineno-37-8 href=#__codelineno-37-8></a><span class=gp>... </span>                    <span class=n>signals</span><span class=p>[</span><span class=n>row</span><span class=p>,</span> <span class=n>col</span><span class=p>]</span> <span class=o>=</span> <span class=kc>False</span>
</span><span id=__span-37-9><a id=__codelineno-37-9 name=__codelineno-37-9 href=#__codelineno-37-9></a><span class=gp>... </span>                <span class=k>else</span><span class=p>:</span>
</span><span id=__span-37-10><a id=__codelineno-37-10 name=__codelineno-37-10 href=#__codelineno-37-10></a><span class=gp>... </span>                    <span class=n>n_found</span> <span class=o>+=</span> <span class=mi>1</span>
</span><span id=__span-37-11><a id=__codelineno-37-11 name=__codelineno-37-11 href=#__codelineno-37-11></a>
</span><span id=__span-37-12><a id=__codelineno-37-12 name=__codelineno-37-12 href=#__codelineno-37-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>FirstNSig</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>IF</span><span class=p>(</span>
</span><span id=__span-37-13><a id=__codelineno-37-13 name=__codelineno-37-13 href=#__codelineno-37-13></a><span class=gp>... </span>    <span class=n>class_name</span><span class=o>=</span><span class=s2>&quot;FirstNSig&quot;</span><span class=p>,</span>
</span><span id=__span-37-14><a id=__codelineno-37-14 name=__codelineno-37-14 href=#__codelineno-37-14></a><span class=gp>... </span>    <span class=n>in_output_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;signals&#39;</span><span class=p>],</span>
</span><span id=__span-37-15><a id=__codelineno-37-15 name=__codelineno-37-15 href=#__codelineno-37-15></a><span class=gp>... </span>    <span class=n>param_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;n&#39;</span><span class=p>]</span>
</span><span id=__span-37-16><a id=__codelineno-37-16 name=__codelineno-37-16 href=#__codelineno-37-16></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_apply_func</span><span class=p>(</span><span class=n>apply_func_nb</span><span class=p>)</span>
</span><span id=__span-37-17><a id=__codelineno-37-17 name=__codelineno-37-17 href=#__codelineno-37-17></a>
</span><span id=__span-37-18><a id=__codelineno-37-18 name=__codelineno-37-18 href=#__codelineno-37-18></a><span class=gp>&gt;&gt;&gt; </span><span class=n>signals</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span><span class=kc>False</span><span class=p>,</span> <span class=kc>True</span><span class=p>,</span> <span class=kc>True</span><span class=p>,</span> <span class=kc>True</span><span class=p>,</span> <span class=kc>False</span><span class=p>])</span>
</span><span id=__span-37-19><a id=__codelineno-37-19 name=__codelineno-37-19 href=#__codelineno-37-19></a><span class=gp>&gt;&gt;&gt; </span><span class=n>first_n_sig</span> <span class=o>=</span> <span class=n>FirstNSig</span><span class=o>.</span><span class=n>run</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span> <span class=n>signals</span><span class=o>=</span><span class=n>signals</span><span class=p>)</span>
</span><span id=__span-37-20><a id=__codelineno-37-20 name=__codelineno-37-20 href=#__codelineno-37-20></a><span class=gp>&gt;&gt;&gt; </span><span class=n>first_n_sig</span><span class=o>.</span><span class=n>signals</span>
</span><span id=__span-37-21><a id=__codelineno-37-21 name=__codelineno-37-21 href=#__codelineno-37-21></a><span class=go>firstnsig_n      1      2      3</span>
</span><span id=__span-37-22><a id=__codelineno-37-22 name=__codelineno-37-22 href=#__codelineno-37-22></a><span class=go>0            False  False  False</span>
</span><span id=__span-37-23><a id=__codelineno-37-23 name=__codelineno-37-23 href=#__codelineno-37-23></a><span class=go>1             True   True   True</span>
</span><span id=__span-37-24><a id=__codelineno-37-24 name=__codelineno-37-24 href=#__codelineno-37-24></a><span class=go>2            False   True   True</span>
</span><span id=__span-37-25><a id=__codelineno-37-25 name=__codelineno-37-25 href=#__codelineno-37-25></a><span class=go>3            False  False   True</span>
</span><span id=__span-37-26><a id=__codelineno-37-26 name=__codelineno-37-26 href=#__codelineno-37-26></a><span class=go>4            False  False  False</span>
</span></code></pre></div> <p>As you can see, one array fulfills the job of two, and this is done without modifying the passed <code>signals</code> array!</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-38-1><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>signals</span>
</span><span id=__span-38-2><a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a><span class=go>0    False</span>
</span><span id=__span-38-3><a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a><span class=go>1     True</span>
</span><span id=__span-38-4><a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a><span class=go>2     True</span>
</span><span id=__span-38-5><a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a><span class=go>3     True</span>
</span><span id=__span-38-6><a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a><span class=go>4    False</span>
</span><span id=__span-38-7><a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a><span class=go>dtype: bool</span>
</span></code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Unlike regular inputs, none of the in-place outputs is required when running an indicator, so they appear in the signature of the <code>run</code> method as keyword arguments with <code>None</code> as the default value. Be sure to pass each in-place output as a keyword argument after other positional arguments (such as inputs and parameters).</p> </div> <h3 id=extra>Extra<a class=headerlink href=#extra title="Permanent link">&para;</a></h3> <p>Any additional output returned by <code>custom_func</code> that is not registered in <code>output_names</code> is returned in a raw format along with the indicator instance. Such outputs can be objects of any type, especially arrays whose shapes differ from those of the inputs. They are not included in the indicator instance because the indicator factory does not know how to wrap, index, and analyze them; only the user does. For example, let's return the rolling mean along with its maximum in each column:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-39-1><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>custom_func</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>window</span><span class=p>):</span>  <span class=c1># (1)!</span>
</span><span id=__span-39-2><a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a><span class=gp>... </span>    <span class=n>ts_mas</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-39-3><a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a><span class=gp>... </span>    <span class=n>ts_ma_maxs</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-39-4><a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>w</span> <span class=ow>in</span> <span class=n>window</span><span class=p>:</span>
</span><span id=__span-39-5><a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a><span class=gp>... </span>        <span class=n>ts_ma</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>rolling_mean_nb</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>w</span><span class=p>)</span>
</span><span id=__span-39-6><a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a><span class=gp>... </span>        <span class=n>ts_mas</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>ts_ma</span><span class=p>)</span>
</span><span id=__span-39-7><a id=__codelineno-39-7 name=__codelineno-39-7 href=#__codelineno-39-7></a><span class=gp>... </span>        <span class=n>ts_ma_maxs</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>nanmax</span><span class=p>(</span><span class=n>ts_ma</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>))</span>
</span><span id=__span-39-8><a id=__codelineno-39-8 name=__codelineno-39-8 href=#__codelineno-39-8></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>column_stack</span><span class=p>(</span><span class=n>ts_mas</span><span class=p>),</span> <span class=n>np</span><span class=o>.</span><span class=n>concatenate</span><span class=p>(</span><span class=n>ts_ma_maxs</span><span class=p>)</span>
</span><span id=__span-39-9><a id=__codelineno-39-9 name=__codelineno-39-9 href=#__codelineno-39-9></a>
</span><span id=__span-39-10><a id=__codelineno-39-10 name=__codelineno-39-10 href=#__codelineno-39-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>MAMax</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>IF</span><span class=p>(</span>
</span><span id=__span-39-11><a id=__codelineno-39-11 name=__codelineno-39-11 href=#__codelineno-39-11></a><span class=gp>... </span>    <span class=n>class_name</span><span class=o>=</span><span class=s1>&#39;MAMax&#39;</span><span class=p>,</span>
</span><span id=__span-39-12><a id=__codelineno-39-12 name=__codelineno-39-12 href=#__codelineno-39-12></a><span class=gp>... </span>    <span class=n>input_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;ts&#39;</span><span class=p>],</span>
</span><span id=__span-39-13><a id=__codelineno-39-13 name=__codelineno-39-13 href=#__codelineno-39-13></a><span class=gp>... </span>    <span class=n>param_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;window&#39;</span><span class=p>],</span>
</span><span id=__span-39-14><a id=__codelineno-39-14 name=__codelineno-39-14 href=#__codelineno-39-14></a><span class=gp>... </span>    <span class=n>output_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;ma&#39;</span><span class=p>],</span>
</span><span id=__span-39-15><a id=__codelineno-39-15 name=__codelineno-39-15 href=#__codelineno-39-15></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_custom_func</span><span class=p>(</span><span class=n>custom_func</span><span class=p>)</span>
</span><span id=__span-39-16><a id=__codelineno-39-16 name=__codelineno-39-16 href=#__codelineno-39-16></a>
</span><span id=__span-39-17><a id=__codelineno-39-17 name=__codelineno-39-17 href=#__codelineno-39-17></a><span class=gp>&gt;&gt;&gt; </span><span class=n>ma_ind</span><span class=p>,</span> <span class=n>ma_max</span> <span class=o>=</span> <span class=n>MAMax</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>ts2</span><span class=p>,</span> <span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>])</span>  <span class=c1># (2)!</span>
</span><span id=__span-39-18><a id=__codelineno-39-18 name=__codelineno-39-18 href=#__codelineno-39-18></a><span class=gp>&gt;&gt;&gt; </span><span class=n>ma_ind</span>
</span><span id=__span-39-19><a id=__codelineno-39-19 name=__codelineno-39-19 href=#__codelineno-39-19></a><span class=go>mamax_window         2                   3</span>
</span><span id=__span-39-20><a id=__codelineno-39-20 name=__codelineno-39-20 href=#__codelineno-39-20></a><span class=go>                a    b         a         b</span>
</span><span id=__span-39-21><a id=__codelineno-39-21 name=__codelineno-39-21 href=#__codelineno-39-21></a><span class=go>2020-01-01    NaN  NaN       NaN       NaN</span>
</span><span id=__span-39-22><a id=__codelineno-39-22 name=__codelineno-39-22 href=#__codelineno-39-22></a><span class=go>2020-01-02    1.5  2.5       NaN       NaN</span>
</span><span id=__span-39-23><a id=__codelineno-39-23 name=__codelineno-39-23 href=#__codelineno-39-23></a><span class=go>2020-01-03    2.5  1.5  2.000000  2.000000</span>
</span><span id=__span-39-24><a id=__codelineno-39-24 name=__codelineno-39-24 href=#__codelineno-39-24></a><span class=go>2020-01-04    2.5  1.5  2.333333  1.666667</span>
</span><span id=__span-39-25><a id=__codelineno-39-25 name=__codelineno-39-25 href=#__codelineno-39-25></a><span class=go>2020-01-05    1.5  2.5  2.000000  2.000000</span>
</span><span id=__span-39-26><a id=__codelineno-39-26 name=__codelineno-39-26 href=#__codelineno-39-26></a><span class=go>2020-01-06    1.5  2.5  1.666667  2.333333</span>
</span><span id=__span-39-27><a id=__codelineno-39-27 name=__codelineno-39-27 href=#__codelineno-39-27></a><span class=go>2020-01-07    2.5  1.5  2.000000  2.000000</span>
</span><span id=__span-39-28><a id=__codelineno-39-28 name=__codelineno-39-28 href=#__codelineno-39-28></a>
</span><span id=__span-39-29><a id=__codelineno-39-29 name=__codelineno-39-29 href=#__codelineno-39-29></a><span class=gp>&gt;&gt;&gt; </span><span class=n>ma_ind</span><span class=o>.</span><span class=n>wrapper</span><span class=o>.</span><span class=n>wrap_reduced</span><span class=p>(</span><span class=n>ma_max</span><span class=p>)</span>  <span class=c1># (3)!</span>
</span><span id=__span-39-30><a id=__codelineno-39-30 name=__codelineno-39-30 href=#__codelineno-39-30></a><span class=go>mamax_window   </span>
</span><span id=__span-39-31><a id=__codelineno-39-31 name=__codelineno-39-31 href=#__codelineno-39-31></a><span class=go>2             a    2.500000</span>
</span><span id=__span-39-32><a id=__codelineno-39-32 name=__codelineno-39-32 href=#__codelineno-39-32></a><span class=go>              b    2.500000</span>
</span><span id=__span-39-33><a id=__codelineno-39-33 name=__codelineno-39-33 href=#__codelineno-39-33></a><span class=go>3             a    2.333333</span>
</span><span id=__span-39-34><a id=__codelineno-39-34 name=__codelineno-39-34 href=#__codelineno-39-34></a><span class=go>              b    2.333333</span>
</span><span id=__span-39-35><a id=__codelineno-39-35 name=__codelineno-39-35 href=#__codelineno-39-35></a><span class=go>dtype: float64</span>
</span></code></pre></div> <ol> <li><code>apply_func</code> does not support extra outputs, only <code>custom_func</code>.</li> <li>Extra outputs are returned along with the indicator instance.</li> <li>Wrap the reduced array using the wrapper of the indicator instance.</li> </ol> <h3 id=lazy>Lazy<a class=headerlink href=#lazy title="Permanent link">&para;</a></h3> <p>Use the <code>lazy_outputs</code> argument when constructing an indicator to define lazy outputs— outputs that are computed from "normal" outputs and are only calculated when explicitly requested. They are available as regular cacheable properties of the indicator instance and can be of any type. Continuing with the previous example, let's add a cached property that returns the maximum of the rolling mean:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-40-1><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>MAMax</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>IF</span><span class=p>(</span>
</span><span id=__span-40-2><a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a><span class=gp>... </span>    <span class=n>class_name</span><span class=o>=</span><span class=s1>&#39;MAMax&#39;</span><span class=p>,</span>
</span><span id=__span-40-3><a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a><span class=gp>... </span>    <span class=n>input_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;ts&#39;</span><span class=p>],</span>
</span><span id=__span-40-4><a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a><span class=gp>... </span>    <span class=n>param_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;window&#39;</span><span class=p>],</span>
</span><span id=__span-40-5><a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a><span class=gp>... </span>    <span class=n>output_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;ma&#39;</span><span class=p>],</span>
</span><span id=__span-40-6><a id=__codelineno-40-6 name=__codelineno-40-6 href=#__codelineno-40-6></a><span class=gp>... </span>    <span class=n>lazy_outputs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-40-7><a id=__codelineno-40-7 name=__codelineno-40-7 href=#__codelineno-40-7></a><span class=gp>... </span>        <span class=n>ma_max</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>cached_property</span><span class=p>(</span><span class=k>lambda</span> <span class=bp>self</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>ma</span><span class=o>.</span><span class=n>max</span><span class=p>())</span>
</span><span id=__span-40-8><a id=__codelineno-40-8 name=__codelineno-40-8 href=#__codelineno-40-8></a><span class=gp>... </span>    <span class=p>)</span>
</span><span id=__span-40-9><a id=__codelineno-40-9 name=__codelineno-40-9 href=#__codelineno-40-9></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_apply_func</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>rolling_mean_nb</span><span class=p>)</span>
</span><span id=__span-40-10><a id=__codelineno-40-10 name=__codelineno-40-10 href=#__codelineno-40-10></a>
</span><span id=__span-40-11><a id=__codelineno-40-11 name=__codelineno-40-11 href=#__codelineno-40-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>ma_ind</span> <span class=o>=</span> <span class=n>MAMax</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>ts2</span><span class=p>,</span> <span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>])</span>
</span><span id=__span-40-12><a id=__codelineno-40-12 name=__codelineno-40-12 href=#__codelineno-40-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>ma_ind</span><span class=o>.</span><span class=n>ma_max</span>
</span><span id=__span-40-13><a id=__codelineno-40-13 name=__codelineno-40-13 href=#__codelineno-40-13></a><span class=go>mamax_window   </span>
</span><span id=__span-40-14><a id=__codelineno-40-14 name=__codelineno-40-14 href=#__codelineno-40-14></a><span class=go>2             a    2.500000</span>
</span><span id=__span-40-15><a id=__codelineno-40-15 name=__codelineno-40-15 href=#__codelineno-40-15></a><span class=go>              b    2.500000</span>
</span><span id=__span-40-16><a id=__codelineno-40-16 name=__codelineno-40-16 href=#__codelineno-40-16></a><span class=go>3             a    2.333333</span>
</span><span id=__span-40-17><a id=__codelineno-40-17 name=__codelineno-40-17 href=#__codelineno-40-17></a><span class=go>              b    2.333333</span>
</span><span id=__span-40-18><a id=__codelineno-40-18 name=__codelineno-40-18 href=#__codelineno-40-18></a><span class=go>dtype: float64</span>
</span></code></pre></div> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>You can achieve the same result by subclassing <code>MAMax</code> and defining the property in the subclass.</p> </div> <h2 id=custom-arguments>Custom arguments<a class=headerlink href=#custom-arguments title="Permanent link">&para;</a></h2> <p>Sometimes, you may need to pass arguments that are not inputs, in-place outputs, or parameters.</p> <h3 id=optional>Optional<a class=headerlink href=#optional title="Permanent link">&para;</a></h3> <p>If you review the <code>apply_func</code> of <code>CrossSig</code>, you will notice it takes another optional argument, <code>minp</code>, which controls the minimum number of observations in a window required to have a value. Listing a keyword argument with its default in <code>custom_func</code> or <code>apply_func</code> is one way to provide a default value. Another way is to make the argument positional and provide its default to <a href=https://vectorbt.pro/pvt_41531c19/api/indicators/factory/#vectorbtpro.indicators.factory.IndicatorFactory.with_custom_func>IndicatorFactory.with_custom_func</a> or another factory method. The default can also be set during execution in the <code>run</code> method.</p> <h3 id=variable>Variable<a class=headerlink href=#variable title="Permanent link">&para;</a></h3> <p>Variable arguments, often appearing as <code>*args</code>, are used to accept a <em>variable</em> number of arguments. To enable variable arguments, you need to set <code>var_args</code> to True. The reason is as follows: when <a href=https://vectorbt.pro/pvt_41531c19/api/indicators/factory/#vectorbtpro.indicators.factory.IndicatorFactory.with_custom_func>IndicatorFactory.with_custom_func</a> builds the <code>run</code> method, it must rearrange the arguments so that required arguments appear before optional arguments. Without the <code>var_args</code> flag, the <code>run</code> method does not expect any additional positional arguments to be passed, which can lead to an error or, even worse, a corrupted result.</p> <p>Let's add a variable number of inputs:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-41-1><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>custom_func</span><span class=p>(</span><span class=o>*</span><span class=n>arrs</span><span class=p>):</span>
</span><span id=__span-41-2><a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a><span class=gp>... </span>    <span class=n>out</span> <span class=o>=</span> <span class=kc>None</span>
</span><span id=__span-41-3><a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>arr</span> <span class=ow>in</span> <span class=n>arrs</span><span class=p>:</span>
</span><span id=__span-41-4><a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a><span class=gp>... </span>        <span class=k>if</span> <span class=n>out</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-41-5><a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a><span class=gp>... </span>            <span class=n>out</span> <span class=o>=</span> <span class=n>arr</span>
</span><span id=__span-41-6><a id=__codelineno-41-6 name=__codelineno-41-6 href=#__codelineno-41-6></a><span class=gp>... </span>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-41-7><a id=__codelineno-41-7 name=__codelineno-41-7 href=#__codelineno-41-7></a><span class=gp>... </span>            <span class=n>out</span> <span class=o>+=</span> <span class=n>arr</span>
</span><span id=__span-41-8><a id=__codelineno-41-8 name=__codelineno-41-8 href=#__codelineno-41-8></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>out</span>
</span><span id=__span-41-9><a id=__codelineno-41-9 name=__codelineno-41-9 href=#__codelineno-41-9></a>
</span><span id=__span-41-10><a id=__codelineno-41-10 name=__codelineno-41-10 href=#__codelineno-41-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>VarArgAdder</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>IF</span><span class=p>(</span>
</span><span id=__span-41-11><a id=__codelineno-41-11 name=__codelineno-41-11 href=#__codelineno-41-11></a><span class=gp>... </span>    <span class=n>output_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;out&#39;</span><span class=p>]</span>  <span class=c1># (1)!</span>
</span><span id=__span-41-12><a id=__codelineno-41-12 name=__codelineno-41-12 href=#__codelineno-41-12></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_custom_func</span><span class=p>(</span><span class=n>custom_func</span><span class=p>,</span> <span class=n>var_args</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-41-13><a id=__codelineno-41-13 name=__codelineno-41-13 href=#__codelineno-41-13></a>
</span><span id=__span-41-14><a id=__codelineno-41-14 name=__codelineno-41-14 href=#__codelineno-41-14></a><span class=gp>&gt;&gt;&gt; </span><span class=n>VarArgAdder</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-41-15><a id=__codelineno-41-15 name=__codelineno-41-15 href=#__codelineno-41-15></a><span class=gp>... </span>    <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>]),</span>
</span><span id=__span-41-16><a id=__codelineno-41-16 name=__codelineno-41-16 href=#__codelineno-41-16></a><span class=gp>... </span>    <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span><span class=mi>10</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>30</span><span class=p>]),</span>
</span><span id=__span-41-17><a id=__codelineno-41-17 name=__codelineno-41-17 href=#__codelineno-41-17></a><span class=gp>... </span>    <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span><span class=mi>100</span><span class=p>,</span> <span class=mi>200</span><span class=p>,</span> <span class=mi>300</span><span class=p>])</span>
</span><span id=__span-41-18><a id=__codelineno-41-18 name=__codelineno-41-18 href=#__codelineno-41-18></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>out</span>
</span><span id=__span-41-19><a id=__codelineno-41-19 name=__codelineno-41-19 href=#__codelineno-41-19></a><span class=go>0    111</span>
</span><span id=__span-41-20><a id=__codelineno-41-20 name=__codelineno-41-20 href=#__codelineno-41-20></a><span class=go>1    222</span>
</span><span id=__span-41-21><a id=__codelineno-41-21 name=__codelineno-41-21 href=#__codelineno-41-21></a><span class=go>2    333</span>
</span><span id=__span-41-22><a id=__codelineno-41-22 name=__codelineno-41-22 href=#__codelineno-41-22></a><span class=go>dtype: int64</span>
</span></code></pre></div> <ol> <li>No inputs.</li> </ol> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The indicator above is effectively inputless: inputs that are not registered in <code>input_names</code> will not broadcast automatically and are not available as attributes of an indicator instance.</p> </div> <h3 id=positional>Positional<a class=headerlink href=#positional title="Permanent link">&para;</a></h3> <p>Positional arguments are handled in the same way as variable arguments.</p> <h3 id=keyword-only>Keyword-only<a class=headerlink href=#keyword-only title="Permanent link">&para;</a></h3> <p>You can set <code>keyword_only_args</code> to True to require that all arguments be used as keyword-only arguments. This can help avoid accidentally placing arguments in the wrong position. </p> <p>For example, consider the <code>RelClose</code> indicator:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-42-1><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>apply_func</span><span class=p>(</span><span class=n>high</span><span class=p>,</span> <span class=n>low</span><span class=p>,</span> <span class=n>close</span><span class=p>):</span>
</span><span id=__span-42-2><a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a><span class=gp>... </span>    <span class=k>return</span> <span class=p>(</span><span class=n>close</span> <span class=o>-</span> <span class=n>low</span><span class=p>)</span> <span class=o>/</span> <span class=p>(</span><span class=n>high</span> <span class=o>-</span> <span class=n>low</span><span class=p>)</span>
</span><span id=__span-42-3><a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a>
</span><span id=__span-42-4><a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>RelClose</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>IF</span><span class=p>(</span>
</span><span id=__span-42-5><a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a><span class=gp>... </span>    <span class=n>input_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;high&#39;</span><span class=p>,</span> <span class=s1>&#39;low&#39;</span><span class=p>,</span> <span class=s1>&#39;close&#39;</span><span class=p>],</span>
</span><span id=__span-42-6><a id=__codelineno-42-6 name=__codelineno-42-6 href=#__codelineno-42-6></a><span class=gp>... </span>    <span class=n>output_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;out&#39;</span><span class=p>]</span>
</span><span id=__span-42-7><a id=__codelineno-42-7 name=__codelineno-42-7 href=#__codelineno-42-7></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_apply_func</span><span class=p>(</span><span class=n>apply_func</span><span class=p>)</span>
</span><span id=__span-42-8><a id=__codelineno-42-8 name=__codelineno-42-8 href=#__codelineno-42-8></a>
</span><span id=__span-42-9><a id=__codelineno-42-9 name=__codelineno-42-9 href=#__codelineno-42-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>RelClose</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>close</span><span class=p>,</span> <span class=n>high</span><span class=p>,</span> <span class=n>low</span><span class=p>)</span><span class=o>.</span><span class=n>out</span>  <span class=c1># (1)!</span>
</span><span id=__span-42-10><a id=__codelineno-42-10 name=__codelineno-42-10 href=#__codelineno-42-10></a><span class=go>                   a         b</span>
</span><span id=__span-42-11><a id=__codelineno-42-11 name=__codelineno-42-11 href=#__codelineno-42-11></a><span class=go>2020-01-01  1.285714  1.800000</span>
</span><span id=__span-42-12><a id=__codelineno-42-12 name=__codelineno-42-12 href=#__codelineno-42-12></a><span class=go>2020-01-02  1.000000  1.333333</span>
</span><span id=__span-42-13><a id=__codelineno-42-13 name=__codelineno-42-13 href=#__codelineno-42-13></a><span class=go>2020-01-03  0.777778  1.000000</span>
</span><span id=__span-42-14><a id=__codelineno-42-14 name=__codelineno-42-14 href=#__codelineno-42-14></a><span class=go>2020-01-04  0.750000  1.000000</span>
</span><span id=__span-42-15><a id=__codelineno-42-15 name=__codelineno-42-15 href=#__codelineno-42-15></a><span class=go>2020-01-05  0.714286  1.000000</span>
</span><span id=__span-42-16><a id=__codelineno-42-16 name=__codelineno-42-16 href=#__codelineno-42-16></a>
</span><span id=__span-42-17><a id=__codelineno-42-17 name=__codelineno-42-17 href=#__codelineno-42-17></a><span class=gp>&gt;&gt;&gt; </span><span class=n>RelClose</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>IF</span><span class=p>(</span>
</span><span id=__span-42-18><a id=__codelineno-42-18 name=__codelineno-42-18 href=#__codelineno-42-18></a><span class=gp>... </span>    <span class=n>input_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;high&#39;</span><span class=p>,</span> <span class=s1>&#39;low&#39;</span><span class=p>,</span> <span class=s1>&#39;close&#39;</span><span class=p>],</span>
</span><span id=__span-42-19><a id=__codelineno-42-19 name=__codelineno-42-19 href=#__codelineno-42-19></a><span class=gp>... </span>    <span class=n>output_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;out&#39;</span><span class=p>]</span>
</span><span id=__span-42-20><a id=__codelineno-42-20 name=__codelineno-42-20 href=#__codelineno-42-20></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_apply_func</span><span class=p>(</span><span class=n>apply_func</span><span class=p>,</span> <span class=n>keyword_only_args</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-42-21><a id=__codelineno-42-21 name=__codelineno-42-21 href=#__codelineno-42-21></a>
</span><span id=__span-42-22><a id=__codelineno-42-22 name=__codelineno-42-22 href=#__codelineno-42-22></a><span class=gp>&gt;&gt;&gt; </span><span class=n>RelClose</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>close</span><span class=p>,</span> <span class=n>high</span><span class=p>,</span> <span class=n>low</span><span class=p>)</span><span class=o>.</span><span class=n>out</span>  <span class=c1># (2)!</span>
</span><span id=__span-42-23><a id=__codelineno-42-23 name=__codelineno-42-23 href=#__codelineno-42-23></a><span class=go>TypeError: run() takes 1 positional argument but 4 were given</span>
</span><span id=__span-42-24><a id=__codelineno-42-24 name=__codelineno-42-24 href=#__codelineno-42-24></a>
</span><span id=__span-42-25><a id=__codelineno-42-25 name=__codelineno-42-25 href=#__codelineno-42-25></a><span class=gp>&gt;&gt;&gt; </span><span class=n>RelClose</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>close</span><span class=o>=</span><span class=n>close</span><span class=p>,</span> <span class=n>high</span><span class=o>=</span><span class=n>high</span><span class=p>,</span> <span class=n>low</span><span class=o>=</span><span class=n>low</span><span class=p>)</span><span class=o>.</span><span class=n>out</span>  <span class=c1># (3)!</span>
</span><span id=__span-42-26><a id=__codelineno-42-26 name=__codelineno-42-26 href=#__codelineno-42-26></a><span class=go>                   a         b</span>
</span><span id=__span-42-27><a id=__codelineno-42-27 name=__codelineno-42-27 href=#__codelineno-42-27></a><span class=go>2020-01-01  0.222222  0.444444</span>
</span><span id=__span-42-28><a id=__codelineno-42-28 name=__codelineno-42-28 href=#__codelineno-42-28></a><span class=go>2020-01-02  0.000000  0.250000</span>
</span><span id=__span-42-29><a id=__codelineno-42-29 name=__codelineno-42-29 href=#__codelineno-42-29></a><span class=go>2020-01-03 -0.285714  0.000000</span>
</span><span id=__span-42-30><a id=__codelineno-42-30 name=__codelineno-42-30 href=#__codelineno-42-30></a><span class=go>2020-01-04 -0.333333  0.000000</span>
</span><span id=__span-42-31><a id=__codelineno-42-31 name=__codelineno-42-31 href=#__codelineno-42-31></a><span class=go>2020-01-05 -0.400000  0.000000</span>
</span></code></pre></div> <ol> <li><code>close</code> is incorrectly passed as the high price—no error is thrown!</li> <li>An error is shown, meaning you must use keyword arguments.</li> <li><code>close</code> is now correctly passed as the closing price.</li> </ol> <h2 id=built-in-caching>Built-in caching<a class=headerlink href=#built-in-caching title="Permanent link">&para;</a></h2> <p><a href=https://vectorbt.pro/pvt_41531c19/api/indicators/factory/#vectorbtpro.indicators.factory.IndicatorFactory>IndicatorFactory</a> reuses calculation artifacts whenever possible. Since it was originally designed for hyperparameter optimization and parameter combinations may get repeated, preventing the repeated processing of the same parameter combination is essential for good performance.</p> <p>First, look at a typical raw output by passing repeated parameter combinations and setting <code>return_raw</code> to True:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-43-1><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>raw</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>MA</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-43-2><a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a><span class=gp>... </span>    <span class=n>ts2</span><span class=p>,</span> 
</span><span id=__span-43-3><a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a><span class=gp>... </span>    <span class=n>window</span><span class=o>=</span><span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span> 
</span><span id=__span-43-4><a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a><span class=gp>... </span>    <span class=n>wtype</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;simple&quot;</span><span class=p>,</span> <span class=s2>&quot;simple&quot;</span><span class=p>,</span> <span class=s2>&quot;exp&quot;</span><span class=p>],</span>  <span class=c1># (1)!</span>
</span><span id=__span-43-5><a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a><span class=gp>... </span>    <span class=n>return_raw</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-43-6><a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>raw</span>
</span><span id=__span-43-7><a id=__codelineno-43-7 name=__codelineno-43-7 href=#__codelineno-43-7></a><span class=go>([array([[     nan,      nan,      nan,      nan,      nan,      nan],</span>
</span><span id=__span-43-8><a id=__codelineno-43-8 name=__codelineno-43-8 href=#__codelineno-43-8></a><span class=go>         [1.5     , 2.5     , 1.5     , 2.5     ,      nan,      nan],</span>
</span><span id=__span-43-9><a id=__codelineno-43-9 name=__codelineno-43-9 href=#__codelineno-43-9></a><span class=go>         [2.5     , 1.5     , 2.5     , 1.5     , 2.25    , 1.75    ],</span>
</span><span id=__span-43-10><a id=__codelineno-43-10 name=__codelineno-43-10 href=#__codelineno-43-10></a><span class=go>         [2.5     , 1.5     , 2.5     , 1.5     , 2.125   , 1.875   ],</span>
</span><span id=__span-43-11><a id=__codelineno-43-11 name=__codelineno-43-11 href=#__codelineno-43-11></a><span class=go>         [1.5     , 2.5     , 1.5     , 2.5     , 1.5625  , 2.4375  ],</span>
</span><span id=__span-43-12><a id=__codelineno-43-12 name=__codelineno-43-12 href=#__codelineno-43-12></a><span class=go>         [1.5     , 2.5     , 1.5     , 2.5     , 1.78125 , 2.21875 ],</span>
</span><span id=__span-43-13><a id=__codelineno-43-13 name=__codelineno-43-13 href=#__codelineno-43-13></a><span class=go>         [2.5     , 1.5     , 2.5     , 1.5     , 2.390625, 1.609375]])],</span>
</span><span id=__span-43-14><a id=__codelineno-43-14 name=__codelineno-43-14 href=#__codelineno-43-14></a><span class=go> [(2, 0), (2, 0), (3, 2)],</span>
</span><span id=__span-43-15><a id=__codelineno-43-15 name=__codelineno-43-15 href=#__codelineno-43-15></a><span class=go> 2,</span>
</span><span id=__span-43-16><a id=__codelineno-43-16 name=__codelineno-43-16 href=#__codelineno-43-16></a><span class=go> [])</span>
</span></code></pre></div> <ol> <li>Three parameter combinations, with two of them being identical.</li> </ol> <p>The raw output consists of:</p> <ol> <li>The list of returned output arrays.</li> <li>The list of zipped parameter combinations.</li> <li>The number of input columns.</li> <li>Other objects returned along with output arrays but not listed in <code>output_names</code>.</li> </ol> <div class="admonition info"> <p class=admonition-title>Info</p> <p>A raw output represents the context of running an indicator. If any parameter combination appears in the list of zipped parameter combinations, it means that it was actually run, not cached.</p> </div> <p>You can see that the calculation function was executed for the same parameter combination twice. This is not a problem if your calculation is fast enough that you do not mind re-running the same procedure. However, if your indicator is very complex and slow to compute, you can instruct <a href=https://vectorbt.pro/pvt_41531c19/api/indicators/factory/#vectorbtpro.indicators.factory.IndicatorBase.run_pipeline>IndicatorBase.run_pipeline</a> to run the indicator on unique parameter combinations only by passing <code>run_unique</code>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-44-1><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>raw</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>MA</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-44-2><a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a><span class=gp>... </span>    <span class=n>ts2</span><span class=p>,</span> 
</span><span id=__span-44-3><a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a><span class=gp>... </span>    <span class=n>window</span><span class=o>=</span><span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span> 
</span><span id=__span-44-4><a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a><span class=gp>... </span>    <span class=n>wtype</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;simple&quot;</span><span class=p>,</span> <span class=s2>&quot;simple&quot;</span><span class=p>,</span> <span class=s2>&quot;exp&quot;</span><span class=p>],</span> 
</span><span id=__span-44-5><a id=__codelineno-44-5 name=__codelineno-44-5 href=#__codelineno-44-5></a><span class=gp>... </span>    <span class=n>return_raw</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> 
</span><span id=__span-44-6><a id=__codelineno-44-6 name=__codelineno-44-6 href=#__codelineno-44-6></a><span class=gp>... </span>    <span class=n>run_unique</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> 
</span><span id=__span-44-7><a id=__codelineno-44-7 name=__codelineno-44-7 href=#__codelineno-44-7></a><span class=gp>... </span>    <span class=n>silence_warnings</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-44-8><a id=__codelineno-44-8 name=__codelineno-44-8 href=#__codelineno-44-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>raw</span>
</span><span id=__span-44-9><a id=__codelineno-44-9 name=__codelineno-44-9 href=#__codelineno-44-9></a><span class=go>([array([[     nan,      nan,      nan,      nan],</span>
</span><span id=__span-44-10><a id=__codelineno-44-10 name=__codelineno-44-10 href=#__codelineno-44-10></a><span class=go>         [1.5     , 2.5     ,      nan,      nan],</span>
</span><span id=__span-44-11><a id=__codelineno-44-11 name=__codelineno-44-11 href=#__codelineno-44-11></a><span class=go>         [2.5     , 1.5     , 2.25    , 1.75    ],</span>
</span><span id=__span-44-12><a id=__codelineno-44-12 name=__codelineno-44-12 href=#__codelineno-44-12></a><span class=go>         [2.5     , 1.5     , 2.125   , 1.875   ],</span>
</span><span id=__span-44-13><a id=__codelineno-44-13 name=__codelineno-44-13 href=#__codelineno-44-13></a><span class=go>         [1.5     , 2.5     , 1.5625  , 2.4375  ],</span>
</span><span id=__span-44-14><a id=__codelineno-44-14 name=__codelineno-44-14 href=#__codelineno-44-14></a><span class=go>         [1.5     , 2.5     , 1.78125 , 2.21875 ],</span>
</span><span id=__span-44-15><a id=__codelineno-44-15 name=__codelineno-44-15 href=#__codelineno-44-15></a><span class=go>         [2.5     , 1.5     , 2.390625, 1.609375]])],</span>
</span><span id=__span-44-16><a id=__codelineno-44-16 name=__codelineno-44-16 href=#__codelineno-44-16></a><span class=go> [(2, 0), (3, 2)],</span>
</span><span id=__span-44-17><a id=__codelineno-44-17 name=__codelineno-44-17 href=#__codelineno-44-17></a><span class=go> 2,</span>
</span><span id=__span-44-18><a id=__codelineno-44-18 name=__codelineno-44-18 href=#__codelineno-44-18></a><span class=go> [])</span>
</span></code></pre></div> <ol> <li>Without <code>silence_warnings</code>, you would get a warning that the raw output contains only unique parameter combinations. You can ignore this.</li> </ol> <p>Let's compare the performance of running the same parameter combination repeatedly with and without <code>run_unique</code>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-45-1><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>a</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=n>size</span><span class=o>=</span><span class=p>(</span><span class=mi>1000</span><span class=p>,))</span>
</span><span id=__span-45-2><a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a>
</span><span id=__span-45-3><a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a><span class=gp>&gt;&gt;&gt; </span><span class=o>%</span><span class=n>timeit</span> <span class=n>vbt</span><span class=o>.</span><span class=n>MA</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>full</span><span class=p>(</span><span class=mi>1000</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span> <span class=n>run_unique</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-45-4><a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a><span class=go>11.6 ms ± 1.26 ms per loop (mean ± std. dev. of 7 runs, 100 loops each)</span>
</span><span id=__span-45-5><a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a>
</span><span id=__span-45-6><a id=__codelineno-45-6 name=__codelineno-45-6 href=#__codelineno-45-6></a><span class=gp>&gt;&gt;&gt; </span><span class=o>%</span><span class=n>timeit</span> <span class=n>vbt</span><span class=o>.</span><span class=n>MA</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>full</span><span class=p>(</span><span class=mi>1000</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span> <span class=n>run_unique</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-45-7><a id=__codelineno-45-7 name=__codelineno-45-7 href=#__codelineno-45-7></a><span class=go>5.91 ms ± 220 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)</span>
</span></code></pre></div> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>The moving average is one of the fastest indicators available. Try this example on a more complex indicator to see the impact of built-in caching.</p> </div> <p>As a rule of thumb:</p> <ul> <li>Enable <code>run_unique</code> if input arrays have few columns, the calculation function is slow, and there are duplicates among parameter combinations.</li> <li>Disable <code>run_unique</code> if input arrays have many columns, the calculation function is very fast, or if two identical parameter combinations can lead to different results (for example, when using a <code>custom_func</code> that makes decisions based on the entire parameter grid, or when there is some randomness involved).</li> </ul> <div class="admonition note"> <p class=admonition-title>Note</p> <p><code>run_unique</code> is disabled by default.</p> </div> <h3 id=reusing-cache>Reusing cache<a class=headerlink href=#reusing-cache title="Permanent link">&para;</a></h3> <p>Internally, <code>run_unique</code> uses the raw output computed from unique parameter combinations to produce the output for all parameter combinations. But what if you already have your own raw output? You can pass it as <code>use_raw</code>. This does not call the calculation function, but instead stacks raw outputs in the order their parameter combinations appear in the requested grid. If some requested parameter combinations cannot be found in <code>use_raw</code>, it will raise an error:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-46-1><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>raw</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>MA</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-46-2><a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a><span class=gp>... </span>    <span class=n>ts2</span><span class=p>,</span> 
</span><span id=__span-46-3><a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a><span class=gp>... </span>    <span class=n>window</span><span class=o>=</span><span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span> 
</span><span id=__span-46-4><a id=__codelineno-46-4 name=__codelineno-46-4 href=#__codelineno-46-4></a><span class=gp>... </span>    <span class=n>wtype</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;simple&quot;</span><span class=p>,</span> <span class=s2>&quot;exp&quot;</span><span class=p>],</span>
</span><span id=__span-46-5><a id=__codelineno-46-5 name=__codelineno-46-5 href=#__codelineno-46-5></a><span class=gp>... </span>    <span class=n>return_raw</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-46-6><a id=__codelineno-46-6 name=__codelineno-46-6 href=#__codelineno-46-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>MA</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>ts2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=s2>&quot;simple&quot;</span><span class=p>,</span> <span class=n>use_raw</span><span class=o>=</span><span class=n>raw</span><span class=p>)</span><span class=o>.</span><span class=n>ma</span>
</span><span id=__span-46-7><a id=__codelineno-46-7 name=__codelineno-46-7 href=#__codelineno-46-7></a><span class=go>ma_window            2     </span>
</span><span id=__span-46-8><a id=__codelineno-46-8 name=__codelineno-46-8 href=#__codelineno-46-8></a><span class=go>ma_wtype        simple     </span>
</span><span id=__span-46-9><a id=__codelineno-46-9 name=__codelineno-46-9 href=#__codelineno-46-9></a><span class=go>                a    b</span>
</span><span id=__span-46-10><a id=__codelineno-46-10 name=__codelineno-46-10 href=#__codelineno-46-10></a><span class=go>2020-01-01    NaN  NaN</span>
</span><span id=__span-46-11><a id=__codelineno-46-11 name=__codelineno-46-11 href=#__codelineno-46-11></a><span class=go>2020-01-02    1.5  2.5</span>
</span><span id=__span-46-12><a id=__codelineno-46-12 name=__codelineno-46-12 href=#__codelineno-46-12></a><span class=go>2020-01-03    2.5  1.5</span>
</span><span id=__span-46-13><a id=__codelineno-46-13 name=__codelineno-46-13 href=#__codelineno-46-13></a><span class=go>2020-01-04    2.5  1.5</span>
</span><span id=__span-46-14><a id=__codelineno-46-14 name=__codelineno-46-14 href=#__codelineno-46-14></a><span class=go>2020-01-05    1.5  2.5</span>
</span><span id=__span-46-15><a id=__codelineno-46-15 name=__codelineno-46-15 href=#__codelineno-46-15></a><span class=go>2020-01-06    1.5  2.5</span>
</span><span id=__span-46-16><a id=__codelineno-46-16 name=__codelineno-46-16 href=#__codelineno-46-16></a><span class=go>2020-01-07    2.5  1.5</span>
</span><span id=__span-46-17><a id=__codelineno-46-17 name=__codelineno-46-17 href=#__codelineno-46-17></a>
</span><span id=__span-46-18><a id=__codelineno-46-18 name=__codelineno-46-18 href=#__codelineno-46-18></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>MA</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>ts2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=s2>&quot;exp&quot;</span><span class=p>,</span> <span class=n>use_raw</span><span class=o>=</span><span class=n>raw</span><span class=p>)</span><span class=o>.</span><span class=n>ma</span>
</span><span id=__span-46-19><a id=__codelineno-46-19 name=__codelineno-46-19 href=#__codelineno-46-19></a><span class=go>ValueError: (2, 2) is not in list</span>
</span></code></pre></div> <p>This allows you to pre-compute indicators.</p> <h2 id=manual-caching>Manual caching<a class=headerlink href=#manual-caching title="Permanent link">&para;</a></h2> <p>Another performance boost can be achieved by caching manually, which must be implemented inside <code>custom_func</code>. Additionally, <code>custom_func</code> must accept a <code>return_cache</code> argument to return the cache and a <code>use_cache</code> argument to reuse the cache (similar to <code>return_raw</code> and <code>use_raw</code>). Fortunately, <a href=https://vectorbt.pro/pvt_41531c19/api/indicators/factory/#vectorbtpro.indicators.factory.IndicatorFactory.with_apply_func>IndicatorFactory.with_apply_func</a> accepts a <code>cache_func</code> and provides a <code>custom_func</code> that meets these requirements.</p> <p>Consider this scenario: you want to calculate the relative distance between two computationally expensive rolling windows. You have already decided on the value for the first window, and want to test thousands of values for the second window. Without caching, and even with <code>run_unique</code> enabled, the first rolling window will be recalculated many times, wasting resources:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-47-1><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>roll_mean_expensive_nb</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>w</span><span class=p>):</span>
</span><span id=__span-47-2><a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>):</span>
</span><span id=__span-47-3><a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a><span class=gp>... </span>        <span class=n>out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>rolling_mean_nb</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>w</span><span class=p>)</span>
</span><span id=__span-47-4><a id=__codelineno-47-4 name=__codelineno-47-4 href=#__codelineno-47-4></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>out</span>
</span><span id=__span-47-5><a id=__codelineno-47-5 name=__codelineno-47-5 href=#__codelineno-47-5></a>
</span><span id=__span-47-6><a id=__codelineno-47-6 name=__codelineno-47-6 href=#__codelineno-47-6></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>apply_func</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>w1</span><span class=p>,</span> <span class=n>w2</span><span class=p>):</span>
</span><span id=__span-47-7><a id=__codelineno-47-7 name=__codelineno-47-7 href=#__codelineno-47-7></a><span class=gp>... </span>    <span class=n>roll_mean1</span> <span class=o>=</span> <span class=n>roll_mean_expensive_nb</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>w1</span><span class=p>)</span>
</span><span id=__span-47-8><a id=__codelineno-47-8 name=__codelineno-47-8 href=#__codelineno-47-8></a><span class=gp>... </span>    <span class=n>roll_mean2</span> <span class=o>=</span> <span class=n>roll_mean_expensive_nb</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>w2</span><span class=p>)</span>
</span><span id=__span-47-9><a id=__codelineno-47-9 name=__codelineno-47-9 href=#__codelineno-47-9></a><span class=gp>... </span>    <span class=k>return</span> <span class=p>(</span><span class=n>roll_mean2</span> <span class=o>-</span> <span class=n>roll_mean1</span><span class=p>)</span> <span class=o>/</span> <span class=n>roll_mean1</span>
</span><span id=__span-47-10><a id=__codelineno-47-10 name=__codelineno-47-10 href=#__codelineno-47-10></a>
</span><span id=__span-47-11><a id=__codelineno-47-11 name=__codelineno-47-11 href=#__codelineno-47-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>RelMADist</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>IF</span><span class=p>(</span>
</span><span id=__span-47-12><a id=__codelineno-47-12 name=__codelineno-47-12 href=#__codelineno-47-12></a><span class=gp>... </span>    <span class=n>class_name</span><span class=o>=</span><span class=s2>&quot;RelMADist&quot;</span><span class=p>,</span>
</span><span id=__span-47-13><a id=__codelineno-47-13 name=__codelineno-47-13 href=#__codelineno-47-13></a><span class=gp>... </span>    <span class=n>input_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;ts&#39;</span><span class=p>],</span>
</span><span id=__span-47-14><a id=__codelineno-47-14 name=__codelineno-47-14 href=#__codelineno-47-14></a><span class=gp>... </span>    <span class=n>param_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;w1&#39;</span><span class=p>,</span> <span class=s1>&#39;w2&#39;</span><span class=p>],</span>
</span><span id=__span-47-15><a id=__codelineno-47-15 name=__codelineno-47-15 href=#__codelineno-47-15></a><span class=gp>... </span>    <span class=n>output_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;out&#39;</span><span class=p>],</span>
</span><span id=__span-47-16><a id=__codelineno-47-16 name=__codelineno-47-16 href=#__codelineno-47-16></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_apply_func</span><span class=p>(</span><span class=n>apply_func</span><span class=p>)</span>
</span><span id=__span-47-17><a id=__codelineno-47-17 name=__codelineno-47-17 href=#__codelineno-47-17></a>
</span><span id=__span-47-18><a id=__codelineno-47-18 name=__codelineno-47-18 href=#__codelineno-47-18></a><span class=gp>&gt;&gt;&gt; </span><span class=n>RelMADist</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>ts2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span><span class=o>.</span><span class=n>out</span>
</span><span id=__span-47-19><a id=__codelineno-47-19 name=__codelineno-47-19 href=#__codelineno-47-19></a><span class=go>relmadist_w1                   2</span>
</span><span id=__span-47-20><a id=__codelineno-47-20 name=__codelineno-47-20 href=#__codelineno-47-20></a><span class=go>relmadist_w2                   3</span>
</span><span id=__span-47-21><a id=__codelineno-47-21 name=__codelineno-47-21 href=#__codelineno-47-21></a><span class=go>                     a         b</span>
</span><span id=__span-47-22><a id=__codelineno-47-22 name=__codelineno-47-22 href=#__codelineno-47-22></a><span class=go>2020-01-01         NaN       NaN</span>
</span><span id=__span-47-23><a id=__codelineno-47-23 name=__codelineno-47-23 href=#__codelineno-47-23></a><span class=go>2020-01-02         NaN       NaN</span>
</span><span id=__span-47-24><a id=__codelineno-47-24 name=__codelineno-47-24 href=#__codelineno-47-24></a><span class=go>2020-01-03   -0.200000  0.333333</span>
</span><span id=__span-47-25><a id=__codelineno-47-25 name=__codelineno-47-25 href=#__codelineno-47-25></a><span class=go>2020-01-04   -0.066667  0.111111</span>
</span><span id=__span-47-26><a id=__codelineno-47-26 name=__codelineno-47-26 href=#__codelineno-47-26></a><span class=go>2020-01-05    0.333333 -0.200000</span>
</span><span id=__span-47-27><a id=__codelineno-47-27 name=__codelineno-47-27 href=#__codelineno-47-27></a><span class=go>2020-01-06    0.111111 -0.066667</span>
</span><span id=__span-47-28><a id=__codelineno-47-28 name=__codelineno-47-28 href=#__codelineno-47-28></a><span class=go>2020-01-07   -0.200000  0.333333</span>
</span><span id=__span-47-29><a id=__codelineno-47-29 name=__codelineno-47-29 href=#__codelineno-47-29></a>
</span><span id=__span-47-30><a id=__codelineno-47-30 name=__codelineno-47-30 href=#__codelineno-47-30></a><span class=gp>&gt;&gt;&gt; </span><span class=o>%</span><span class=n>timeit</span> <span class=n>RelMADist</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>ts2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>1000</span><span class=p>))</span>
</span><span id=__span-47-31><a id=__codelineno-47-31 name=__codelineno-47-31 href=#__codelineno-47-31></a><span class=go>294 ms ± 52.9 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)</span>
</span></code></pre></div> <p>To avoid this, pre-compute all unique rolling windows in <code>cache_func</code> and use them in <code>apply_func</code>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-48-1><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>cache_func</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>w1</span><span class=p>,</span> <span class=n>w2</span><span class=p>):</span>  <span class=c1># (1)!</span>
</span><span id=__span-48-2><a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a><span class=gp>... </span>    <span class=n>cache_dict</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>()</span>
</span><span id=__span-48-3><a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>w</span> <span class=ow>in</span> <span class=n>w1</span> <span class=o>+</span> <span class=n>w2</span><span class=p>:</span>
</span><span id=__span-48-4><a id=__codelineno-48-4 name=__codelineno-48-4 href=#__codelineno-48-4></a><span class=gp>... </span>        <span class=k>if</span> <span class=n>w</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>cache_dict</span><span class=p>:</span>
</span><span id=__span-48-5><a id=__codelineno-48-5 name=__codelineno-48-5 href=#__codelineno-48-5></a><span class=gp>... </span>            <span class=n>cache_dict</span><span class=p>[</span><span class=n>w</span><span class=p>]</span> <span class=o>=</span> <span class=n>roll_mean_expensive_nb</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>w</span><span class=p>)</span>
</span><span id=__span-48-6><a id=__codelineno-48-6 name=__codelineno-48-6 href=#__codelineno-48-6></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>cache_dict</span>
</span><span id=__span-48-7><a id=__codelineno-48-7 name=__codelineno-48-7 href=#__codelineno-48-7></a>
</span><span id=__span-48-8><a id=__codelineno-48-8 name=__codelineno-48-8 href=#__codelineno-48-8></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>apply_func</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>w1</span><span class=p>,</span> <span class=n>w2</span><span class=p>,</span> <span class=n>cache_dict</span><span class=p>):</span>  <span class=c1># (2)!</span>
</span><span id=__span-48-9><a id=__codelineno-48-9 name=__codelineno-48-9 href=#__codelineno-48-9></a><span class=gp>... </span>    <span class=k>return</span> <span class=p>(</span><span class=n>cache_dict</span><span class=p>[</span><span class=n>w2</span><span class=p>]</span> <span class=o>-</span> <span class=n>cache_dict</span><span class=p>[</span><span class=n>w1</span><span class=p>])</span> <span class=o>/</span> <span class=n>cache_dict</span><span class=p>[</span><span class=n>w1</span><span class=p>]</span>
</span><span id=__span-48-10><a id=__codelineno-48-10 name=__codelineno-48-10 href=#__codelineno-48-10></a>
</span><span id=__span-48-11><a id=__codelineno-48-11 name=__codelineno-48-11 href=#__codelineno-48-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>RelMADist</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>IF</span><span class=p>(</span>
</span><span id=__span-48-12><a id=__codelineno-48-12 name=__codelineno-48-12 href=#__codelineno-48-12></a><span class=gp>... </span>    <span class=n>class_name</span><span class=o>=</span><span class=s2>&quot;RelMADist&quot;</span><span class=p>,</span>
</span><span id=__span-48-13><a id=__codelineno-48-13 name=__codelineno-48-13 href=#__codelineno-48-13></a><span class=gp>... </span>    <span class=n>input_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;ts&#39;</span><span class=p>],</span>
</span><span id=__span-48-14><a id=__codelineno-48-14 name=__codelineno-48-14 href=#__codelineno-48-14></a><span class=gp>... </span>    <span class=n>param_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;w1&#39;</span><span class=p>,</span> <span class=s1>&#39;w2&#39;</span><span class=p>],</span>
</span><span id=__span-48-15><a id=__codelineno-48-15 name=__codelineno-48-15 href=#__codelineno-48-15></a><span class=gp>... </span>    <span class=n>output_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;out&#39;</span><span class=p>],</span>
</span><span id=__span-48-16><a id=__codelineno-48-16 name=__codelineno-48-16 href=#__codelineno-48-16></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_apply_func</span><span class=p>(</span><span class=n>apply_func</span><span class=p>,</span> <span class=n>cache_func</span><span class=o>=</span><span class=n>cache_func</span><span class=p>)</span>
</span><span id=__span-48-17><a id=__codelineno-48-17 name=__codelineno-48-17 href=#__codelineno-48-17></a>
</span><span id=__span-48-18><a id=__codelineno-48-18 name=__codelineno-48-18 href=#__codelineno-48-18></a><span class=gp>&gt;&gt;&gt; </span><span class=n>RelMADist</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>ts2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span><span class=o>.</span><span class=n>out</span>
</span><span id=__span-48-19><a id=__codelineno-48-19 name=__codelineno-48-19 href=#__codelineno-48-19></a><span class=go>relmadist_w1                   2</span>
</span><span id=__span-48-20><a id=__codelineno-48-20 name=__codelineno-48-20 href=#__codelineno-48-20></a><span class=go>relmadist_w2                   3</span>
</span><span id=__span-48-21><a id=__codelineno-48-21 name=__codelineno-48-21 href=#__codelineno-48-21></a><span class=go>                     a         b</span>
</span><span id=__span-48-22><a id=__codelineno-48-22 name=__codelineno-48-22 href=#__codelineno-48-22></a><span class=go>2020-01-01         NaN       NaN</span>
</span><span id=__span-48-23><a id=__codelineno-48-23 name=__codelineno-48-23 href=#__codelineno-48-23></a><span class=go>2020-01-02         NaN       NaN</span>
</span><span id=__span-48-24><a id=__codelineno-48-24 name=__codelineno-48-24 href=#__codelineno-48-24></a><span class=go>2020-01-03   -0.200000  0.333333</span>
</span><span id=__span-48-25><a id=__codelineno-48-25 name=__codelineno-48-25 href=#__codelineno-48-25></a><span class=go>2020-01-04   -0.066667  0.111111</span>
</span><span id=__span-48-26><a id=__codelineno-48-26 name=__codelineno-48-26 href=#__codelineno-48-26></a><span class=go>2020-01-05    0.333333 -0.200000</span>
</span><span id=__span-48-27><a id=__codelineno-48-27 name=__codelineno-48-27 href=#__codelineno-48-27></a><span class=go>2020-01-06    0.111111 -0.066667</span>
</span><span id=__span-48-28><a id=__codelineno-48-28 name=__codelineno-48-28 href=#__codelineno-48-28></a><span class=go>2020-01-07   -0.200000  0.333333</span>
</span><span id=__span-48-29><a id=__codelineno-48-29 name=__codelineno-48-29 href=#__codelineno-48-29></a>
</span><span id=__span-48-30><a id=__codelineno-48-30 name=__codelineno-48-30 href=#__codelineno-48-30></a><span class=gp>&gt;&gt;&gt; </span><span class=o>%</span><span class=n>timeit</span> <span class=n>RelMADist</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>ts2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>1000</span><span class=p>))</span>
</span><span id=__span-48-31><a id=__codelineno-48-31 name=__codelineno-48-31 href=#__codelineno-48-31></a><span class=go>119 ms ± 335 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)</span>
</span></code></pre></div> <ol> <li><code>cache_func</code> accepts the same arguments as <code>apply_func</code>, but parameters are now lists instead of single values.</li> <li><code>apply_func</code> accepts the output of <code>cache_func</code> as its last argument. If there are multiple outputs, they all must appear as separate arguments.</li> </ol> <p>This method cuts processing time by half!</p> <h3 id=per-column>Per column<a class=headerlink href=#per-column title="Permanent link">&para;</a></h3> <p>What happens when you pass <code>per_column=True</code> to apply each parameter combination per column? Internally, <a href=https://vectorbt.pro/pvt_41531c19/api/indicators/factory/#vectorbtpro.indicators.factory.IndicatorFactory.with_apply_func>IndicatorFactory.with_apply_func</a> splits any input, in-place output, and parameter array per column, passing one element from each to <code>apply_func</code> at a time. However, the same splitting cannot be done for <code>cache_func</code>, because you would then get 1) a list of input arrays instead of a single array (which would cause an error if the caching function was Numba-compiled, since Numba does not allow the same argument with two different types), and 2) each input array in the list could be different, so maintaining a single caching dictionary with parameter combinations as keys would not be sufficient.</p> <p>To handle this edge case, VBT passes input and in-place output arrays in their regular shape (not split), and also provides a <code>per_column</code> argument set to True, so <code>cache_func</code> knows that each parameter corresponds to only one column in the input. In the caching function, you can use this flag to decide how to proceed. Usually, you simply disable caching and perform all calculations directly in the apply function.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-49-1><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>cache_func</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>w1</span><span class=p>,</span> <span class=n>w2</span><span class=p>,</span> <span class=n>per_column</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
</span><span id=__span-49-2><a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a><span class=gp>... </span>    <span class=k>if</span> <span class=n>per_column</span><span class=p>:</span>
</span><span id=__span-49-3><a id=__codelineno-49-3 name=__codelineno-49-3 href=#__codelineno-49-3></a><span class=gp>... </span>        <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-49-4><a id=__codelineno-49-4 name=__codelineno-49-4 href=#__codelineno-49-4></a><span class=gp>... </span>    <span class=n>cache_dict</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>()</span>
</span><span id=__span-49-5><a id=__codelineno-49-5 name=__codelineno-49-5 href=#__codelineno-49-5></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>w</span> <span class=ow>in</span> <span class=n>w1</span> <span class=o>+</span> <span class=n>w2</span><span class=p>:</span>
</span><span id=__span-49-6><a id=__codelineno-49-6 name=__codelineno-49-6 href=#__codelineno-49-6></a><span class=gp>... </span>        <span class=k>if</span> <span class=n>w</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>cache_dict</span><span class=p>:</span>
</span><span id=__span-49-7><a id=__codelineno-49-7 name=__codelineno-49-7 href=#__codelineno-49-7></a><span class=gp>... </span>            <span class=n>cache_dict</span><span class=p>[</span><span class=n>w</span><span class=p>]</span> <span class=o>=</span> <span class=n>roll_mean_expensive_nb</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>w</span><span class=p>)</span>
</span><span id=__span-49-8><a id=__codelineno-49-8 name=__codelineno-49-8 href=#__codelineno-49-8></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>cache_dict</span>
</span><span id=__span-49-9><a id=__codelineno-49-9 name=__codelineno-49-9 href=#__codelineno-49-9></a>
</span><span id=__span-49-10><a id=__codelineno-49-10 name=__codelineno-49-10 href=#__codelineno-49-10></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>apply_func</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>w1</span><span class=p>,</span> <span class=n>w2</span><span class=p>,</span> <span class=n>cache_dict</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>  <span class=c1># (1)!</span>
</span><span id=__span-49-11><a id=__codelineno-49-11 name=__codelineno-49-11 href=#__codelineno-49-11></a><span class=gp>... </span>    <span class=k>if</span> <span class=n>cache_dict</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-49-12><a id=__codelineno-49-12 name=__codelineno-49-12 href=#__codelineno-49-12></a><span class=gp>... </span>        <span class=n>roll_mean1</span> <span class=o>=</span> <span class=n>roll_mean_expensive_nb</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>w1</span><span class=p>)</span>
</span><span id=__span-49-13><a id=__codelineno-49-13 name=__codelineno-49-13 href=#__codelineno-49-13></a><span class=gp>... </span>        <span class=n>roll_mean2</span> <span class=o>=</span> <span class=n>roll_mean_expensive_nb</span><span class=p>(</span><span class=n>ts</span><span class=p>,</span> <span class=n>w2</span><span class=p>)</span>
</span><span id=__span-49-14><a id=__codelineno-49-14 name=__codelineno-49-14 href=#__codelineno-49-14></a><span class=gp>... </span>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-49-15><a id=__codelineno-49-15 name=__codelineno-49-15 href=#__codelineno-49-15></a><span class=gp>... </span>        <span class=n>roll_mean1</span> <span class=o>=</span> <span class=n>cache_dict</span><span class=p>[</span><span class=n>w1</span><span class=p>]</span>
</span><span id=__span-49-16><a id=__codelineno-49-16 name=__codelineno-49-16 href=#__codelineno-49-16></a><span class=gp>... </span>        <span class=n>roll_mean2</span> <span class=o>=</span> <span class=n>cache_dict</span><span class=p>[</span><span class=n>w2</span><span class=p>]</span>
</span><span id=__span-49-17><a id=__codelineno-49-17 name=__codelineno-49-17 href=#__codelineno-49-17></a><span class=gp>... </span>    <span class=k>return</span> <span class=p>(</span><span class=n>roll_mean2</span> <span class=o>-</span> <span class=n>roll_mean1</span><span class=p>)</span> <span class=o>/</span> <span class=n>roll_mean1</span>
</span><span id=__span-49-18><a id=__codelineno-49-18 name=__codelineno-49-18 href=#__codelineno-49-18></a><span class=gp>... </span>    
</span><span id=__span-49-19><a id=__codelineno-49-19 name=__codelineno-49-19 href=#__codelineno-49-19></a>
</span><span id=__span-49-20><a id=__codelineno-49-20 name=__codelineno-49-20 href=#__codelineno-49-20></a><span class=gp>&gt;&gt;&gt; </span><span class=n>RelMADist</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>IF</span><span class=p>(</span>
</span><span id=__span-49-21><a id=__codelineno-49-21 name=__codelineno-49-21 href=#__codelineno-49-21></a><span class=gp>... </span>    <span class=n>class_name</span><span class=o>=</span><span class=s2>&quot;RelMADist&quot;</span><span class=p>,</span>
</span><span id=__span-49-22><a id=__codelineno-49-22 name=__codelineno-49-22 href=#__codelineno-49-22></a><span class=gp>... </span>    <span class=n>input_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;ts&#39;</span><span class=p>],</span>
</span><span id=__span-49-23><a id=__codelineno-49-23 name=__codelineno-49-23 href=#__codelineno-49-23></a><span class=gp>... </span>    <span class=n>param_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;w1&#39;</span><span class=p>,</span> <span class=s1>&#39;w2&#39;</span><span class=p>],</span>
</span><span id=__span-49-24><a id=__codelineno-49-24 name=__codelineno-49-24 href=#__codelineno-49-24></a><span class=gp>... </span>    <span class=n>output_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;out&#39;</span><span class=p>],</span>
</span><span id=__span-49-25><a id=__codelineno-49-25 name=__codelineno-49-25 href=#__codelineno-49-25></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_apply_func</span><span class=p>(</span><span class=n>apply_func</span><span class=p>,</span> <span class=n>cache_func</span><span class=o>=</span><span class=n>cache_func</span><span class=p>)</span>
</span><span id=__span-49-26><a id=__codelineno-49-26 name=__codelineno-49-26 href=#__codelineno-49-26></a>
</span><span id=__span-49-27><a id=__codelineno-49-27 name=__codelineno-49-27 href=#__codelineno-49-27></a><span class=gp>&gt;&gt;&gt; </span><span class=n>RelMADist</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>ts2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span><span class=o>.</span><span class=n>out</span>
</span><span id=__span-49-28><a id=__codelineno-49-28 name=__codelineno-49-28 href=#__codelineno-49-28></a><span class=go>relmadist_w1                   2</span>
</span><span id=__span-49-29><a id=__codelineno-49-29 name=__codelineno-49-29 href=#__codelineno-49-29></a><span class=go>relmadist_w2                   3</span>
</span><span id=__span-49-30><a id=__codelineno-49-30 name=__codelineno-49-30 href=#__codelineno-49-30></a><span class=go>                     a         b</span>
</span><span id=__span-49-31><a id=__codelineno-49-31 name=__codelineno-49-31 href=#__codelineno-49-31></a><span class=go>2020-01-01         NaN       NaN</span>
</span><span id=__span-49-32><a id=__codelineno-49-32 name=__codelineno-49-32 href=#__codelineno-49-32></a><span class=go>2020-01-02         NaN       NaN</span>
</span><span id=__span-49-33><a id=__codelineno-49-33 name=__codelineno-49-33 href=#__codelineno-49-33></a><span class=go>2020-01-03   -0.200000  0.333333</span>
</span><span id=__span-49-34><a id=__codelineno-49-34 name=__codelineno-49-34 href=#__codelineno-49-34></a><span class=go>2020-01-04   -0.066667  0.111111</span>
</span><span id=__span-49-35><a id=__codelineno-49-35 name=__codelineno-49-35 href=#__codelineno-49-35></a><span class=go>2020-01-05    0.333333 -0.200000</span>
</span><span id=__span-49-36><a id=__codelineno-49-36 name=__codelineno-49-36 href=#__codelineno-49-36></a><span class=go>2020-01-06    0.111111 -0.066667</span>
</span><span id=__span-49-37><a id=__codelineno-49-37 name=__codelineno-49-37 href=#__codelineno-49-37></a><span class=go>2020-01-07   -0.200000  0.333333</span>
</span><span id=__span-49-38><a id=__codelineno-49-38 name=__codelineno-49-38 href=#__codelineno-49-38></a>
</span><span id=__span-49-39><a id=__codelineno-49-39 name=__codelineno-49-39 href=#__codelineno-49-39></a><span class=gp>&gt;&gt;&gt; </span><span class=n>RelMADist</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>ts2</span><span class=p>,</span> <span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>],</span> <span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>],</span> <span class=n>per_column</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span><span class=o>.</span><span class=n>out</span>
</span><span id=__span-49-40><a id=__codelineno-49-40 name=__codelineno-49-40 href=#__codelineno-49-40></a><span class=go>relmadist_w1                   2</span>
</span><span id=__span-49-41><a id=__codelineno-49-41 name=__codelineno-49-41 href=#__codelineno-49-41></a><span class=go>relmadist_w2         3         4</span>
</span><span id=__span-49-42><a id=__codelineno-49-42 name=__codelineno-49-42 href=#__codelineno-49-42></a><span class=go>                     a         b</span>
</span><span id=__span-49-43><a id=__codelineno-49-43 name=__codelineno-49-43 href=#__codelineno-49-43></a><span class=go>2020-01-01         NaN       NaN</span>
</span><span id=__span-49-44><a id=__codelineno-49-44 name=__codelineno-49-44 href=#__codelineno-49-44></a><span class=go>2020-01-02         NaN       NaN</span>
</span><span id=__span-49-45><a id=__codelineno-49-45 name=__codelineno-49-45 href=#__codelineno-49-45></a><span class=go>2020-01-03   -0.200000       NaN</span>
</span><span id=__span-49-46><a id=__codelineno-49-46 name=__codelineno-49-46 href=#__codelineno-49-46></a><span class=go>2020-01-04   -0.066667  0.333333</span>
</span><span id=__span-49-47><a id=__codelineno-49-47 name=__codelineno-49-47 href=#__codelineno-49-47></a><span class=go>2020-01-05    0.333333 -0.200000</span>
</span><span id=__span-49-48><a id=__codelineno-49-48 name=__codelineno-49-48 href=#__codelineno-49-48></a><span class=go>2020-01-06    0.111111 -0.200000</span>
</span><span id=__span-49-49><a id=__codelineno-49-49 name=__codelineno-49-49 href=#__codelineno-49-49></a><span class=go>2020-01-07   -0.200000  0.333333</span>
</span></code></pre></div> <ol> <li>Make cache optional.</li> </ol> <p>This design is even better than the previous one because caching is now optional, and any other function can call <code>apply_func</code> without needing to handle caching. This approach also works with Numba.</p> <h3 id=reusing-cache_1>Reusing cache<a class=headerlink href=#reusing-cache_1 title="Permanent link">&para;</a></h3> <p>Similar to raw outputs, you can force <a href=https://vectorbt.pro/pvt_41531c19/api/indicators/factory/#vectorbtpro.indicators.factory.IndicatorBase.run_pipeline>IndicatorBase.run_pipeline</a> and <code>custom_func</code> to return the cache, allowing you to reuse it in other calculations or even indicators. The clear advantage of this method is that you are not limited to a fixed set of parameter combinations, but can instead use the actual parameter values, providing more control over performance management.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-50-1><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cache</span> <span class=o>=</span> <span class=n>RelMADist</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-50-2><a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a><span class=gp>... </span>    <span class=n>ts2</span><span class=p>,</span> 
</span><span id=__span-50-3><a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a><span class=gp>... </span>    <span class=n>w1</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> 
</span><span id=__span-50-4><a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a><span class=gp>... </span>    <span class=n>w2</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>1000</span><span class=p>),</span> 
</span><span id=__span-50-5><a id=__codelineno-50-5 name=__codelineno-50-5 href=#__codelineno-50-5></a><span class=gp>... </span>    <span class=n>return_cache</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-50-6><a id=__codelineno-50-6 name=__codelineno-50-6 href=#__codelineno-50-6></a>
</span><span id=__span-50-7><a id=__codelineno-50-7 name=__codelineno-50-7 href=#__codelineno-50-7></a><span class=gp>&gt;&gt;&gt; </span><span class=o>%</span><span class=n>timeit</span> <span class=n>RelMADist</span><span class=o>.</span><span class=n>run</span><span class=p>(</span> \
</span><span id=__span-50-8><a id=__codelineno-50-8 name=__codelineno-50-8 href=#__codelineno-50-8></a><span class=gp>... </span>    <span class=n>ts2</span><span class=p>,</span> \
</span><span id=__span-50-9><a id=__codelineno-50-9 name=__codelineno-50-9 href=#__codelineno-50-9></a><span class=gp>... </span>    <span class=n>w1</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>1000</span><span class=p>),</span> \
</span><span id=__span-50-10><a id=__codelineno-50-10 name=__codelineno-50-10 href=#__codelineno-50-10></a><span class=gp>... </span>    <span class=n>w2</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>1000</span><span class=p>),</span> \
</span><span id=__span-50-11><a id=__codelineno-50-11 name=__codelineno-50-11 href=#__codelineno-50-11></a><span class=gp>... </span>    <span class=n>use_cache</span><span class=o>=</span><span class=n>cache</span><span class=p>)</span>
</span><span id=__span-50-12><a id=__codelineno-50-12 name=__codelineno-50-12 href=#__codelineno-50-12></a><span class=go>7.7 ms ± 153 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)</span>
</span></code></pre></div> <h2 id=stacking>Stacking<a class=headerlink href=#stacking title="Permanent link">&para;</a></h2> <p>Like regular functions, indicators can depend on each other. To build a stacked indicator, the first step is to merge their inputs and parameters. Consider the classic moving average crossover, where we want to use the TA-Lib <code>SMA</code> indicator twice: once for the fast moving average and once for the slow moving average. By checking the arguments accepted by the indicator's <code>run</code> method, we see that it takes a time series <code>close</code> and a parameter <code>timeperiod</code>. Since both moving averages use the same time series, our only input is <code>close</code>. However, the parameter <code>timeperiod</code> should be different for each moving average, so we need to define two parameters: <code>timeperiod1</code> and <code>timeperiod2</code> (feel free to use any other names).</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-51-1><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>phelp</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>talib</span><span class=p>(</span><span class=s1>&#39;SMA&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>run</span><span class=p>)</span>
</span><span id=__span-51-2><a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a><span class=go>SMA.run(</span>
</span><span id=__span-51-3><a id=__codelineno-51-3 name=__codelineno-51-3 href=#__codelineno-51-3></a><span class=go>    close,</span>
</span><span id=__span-51-4><a id=__codelineno-51-4 name=__codelineno-51-4 href=#__codelineno-51-4></a><span class=go>    timeperiod=Default(value=30),</span>
</span><span id=__span-51-5><a id=__codelineno-51-5 name=__codelineno-51-5 href=#__codelineno-51-5></a><span class=go>    short_name=&#39;sma&#39;,</span>
</span><span id=__span-51-6><a id=__codelineno-51-6 name=__codelineno-51-6 href=#__codelineno-51-6></a><span class=go>    hide_params=None,</span>
</span><span id=__span-51-7><a id=__codelineno-51-7 name=__codelineno-51-7 href=#__codelineno-51-7></a><span class=go>    hide_default=True,</span>
</span><span id=__span-51-8><a id=__codelineno-51-8 name=__codelineno-51-8 href=#__codelineno-51-8></a><span class=go>    **kwargs</span>
</span><span id=__span-51-9><a id=__codelineno-51-9 name=__codelineno-51-9 href=#__codelineno-51-9></a><span class=go>):</span>
</span><span id=__span-51-10><a id=__codelineno-51-10 name=__codelineno-51-10 href=#__codelineno-51-10></a><span class=go>    Run `SMA` indicator.</span>
</span><span id=__span-51-11><a id=__codelineno-51-11 name=__codelineno-51-11 href=#__codelineno-51-11></a>
</span><span id=__span-51-12><a id=__codelineno-51-12 name=__codelineno-51-12 href=#__codelineno-51-12></a><span class=go>    * Inputs: `close`</span>
</span><span id=__span-51-13><a id=__codelineno-51-13 name=__codelineno-51-13 href=#__codelineno-51-13></a><span class=go>    * Parameters: `timeperiod`</span>
</span><span id=__span-51-14><a id=__codelineno-51-14 name=__codelineno-51-14 href=#__codelineno-51-14></a><span class=go>    * Outputs: `real`</span>
</span><span id=__span-51-15><a id=__codelineno-51-15 name=__codelineno-51-15 href=#__codelineno-51-15></a>
</span><span id=__span-51-16><a id=__codelineno-51-16 name=__codelineno-51-16 href=#__codelineno-51-16></a><span class=go>    Pass a list of parameter names as `hide_params` to hide their column levels.</span>
</span><span id=__span-51-17><a id=__codelineno-51-17 name=__codelineno-51-17 href=#__codelineno-51-17></a><span class=go>    Set `hide_default` to False to show the column levels of the parameters with a default value.</span>
</span><span id=__span-51-18><a id=__codelineno-51-18 name=__codelineno-51-18 href=#__codelineno-51-18></a>
</span><span id=__span-51-19><a id=__codelineno-51-19 name=__codelineno-51-19 href=#__codelineno-51-19></a><span class=go>    Other keyword arguments are passed to `SMA.run_pipeline`.</span>
</span><span id=__span-51-20><a id=__codelineno-51-20 name=__codelineno-51-20 href=#__codelineno-51-20></a>
</span><span id=__span-51-21><a id=__codelineno-51-21 name=__codelineno-51-21 href=#__codelineno-51-21></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>apply_func</span><span class=p>(</span><span class=n>close</span><span class=p>,</span> <span class=n>timeperiod1</span><span class=p>,</span> <span class=n>timeperiod2</span><span class=p>):</span>
</span><span id=__span-51-22><a id=__codelineno-51-22 name=__codelineno-51-22 href=#__codelineno-51-22></a><span class=gp>... </span>    <span class=n>fast_ma</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>talib</span><span class=p>(</span><span class=s1>&#39;SMA&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>close</span><span class=p>,</span> <span class=n>timeperiod1</span><span class=p>)</span>
</span><span id=__span-51-23><a id=__codelineno-51-23 name=__codelineno-51-23 href=#__codelineno-51-23></a><span class=gp>... </span>    <span class=n>slow_ma</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>talib</span><span class=p>(</span><span class=s1>&#39;SMA&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>close</span><span class=p>,</span> <span class=n>timeperiod2</span><span class=p>)</span>
</span><span id=__span-51-24><a id=__codelineno-51-24 name=__codelineno-51-24 href=#__codelineno-51-24></a><span class=gp>... </span>    <span class=n>entries</span> <span class=o>=</span> <span class=n>fast_ma</span><span class=o>.</span><span class=n>real_crossed_above</span><span class=p>(</span><span class=n>slow_ma</span><span class=p>)</span>
</span><span id=__span-51-25><a id=__codelineno-51-25 name=__codelineno-51-25 href=#__codelineno-51-25></a><span class=gp>... </span>    <span class=n>exits</span> <span class=o>=</span> <span class=n>fast_ma</span><span class=o>.</span><span class=n>real_crossed_below</span><span class=p>(</span><span class=n>slow_ma</span><span class=p>)</span>
</span><span id=__span-51-26><a id=__codelineno-51-26 name=__codelineno-51-26 href=#__codelineno-51-26></a><span class=gp>... </span>    <span class=k>return</span> <span class=p>(</span><span class=n>fast_ma</span><span class=o>.</span><span class=n>real</span><span class=p>,</span> <span class=n>slow_ma</span><span class=o>.</span><span class=n>real</span><span class=p>,</span> <span class=n>entries</span><span class=p>,</span> <span class=n>exits</span><span class=p>)</span>
</span><span id=__span-51-27><a id=__codelineno-51-27 name=__codelineno-51-27 href=#__codelineno-51-27></a>
</span><span id=__span-51-28><a id=__codelineno-51-28 name=__codelineno-51-28 href=#__codelineno-51-28></a><span class=gp>&gt;&gt;&gt; </span><span class=n>MACrossover</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>IF</span><span class=p>(</span>
</span><span id=__span-51-29><a id=__codelineno-51-29 name=__codelineno-51-29 href=#__codelineno-51-29></a><span class=gp>... </span>    <span class=n>class_name</span><span class=o>=</span><span class=s2>&quot;CrossSig&quot;</span><span class=p>,</span>
</span><span id=__span-51-30><a id=__codelineno-51-30 name=__codelineno-51-30 href=#__codelineno-51-30></a><span class=gp>... </span>    <span class=n>input_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;close&#39;</span><span class=p>],</span>
</span><span id=__span-51-31><a id=__codelineno-51-31 name=__codelineno-51-31 href=#__codelineno-51-31></a><span class=gp>... </span>    <span class=n>param_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;timeperiod1&#39;</span><span class=p>,</span> <span class=s1>&#39;timeperiod2&#39;</span><span class=p>],</span>
</span><span id=__span-51-32><a id=__codelineno-51-32 name=__codelineno-51-32 href=#__codelineno-51-32></a><span class=gp>... </span>    <span class=n>output_names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;fast_ma&#39;</span><span class=p>,</span> <span class=s1>&#39;slow_ma&#39;</span><span class=p>,</span> <span class=s1>&#39;entries&#39;</span><span class=p>,</span> <span class=s1>&#39;exits&#39;</span><span class=p>],</span>
</span><span id=__span-51-33><a id=__codelineno-51-33 name=__codelineno-51-33 href=#__codelineno-51-33></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>with_apply_func</span><span class=p>(</span><span class=n>apply_func</span><span class=p>)</span>
</span><span id=__span-51-34><a id=__codelineno-51-34 name=__codelineno-51-34 href=#__codelineno-51-34></a>
</span><span id=__span-51-35><a id=__codelineno-51-35 name=__codelineno-51-35 href=#__codelineno-51-35></a><span class=gp>&gt;&gt;&gt; </span><span class=n>MACrossover</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>ts2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span><span class=o>.</span><span class=n>entries</span>
</span><span id=__span-51-36><a id=__codelineno-51-36 name=__codelineno-51-36 href=#__codelineno-51-36></a><span class=go>crosssig_timeperiod1             2</span>
</span><span id=__span-51-37><a id=__codelineno-51-37 name=__codelineno-51-37 href=#__codelineno-51-37></a><span class=go>crosssig_timeperiod2             3</span>
</span><span id=__span-51-38><a id=__codelineno-51-38 name=__codelineno-51-38 href=#__codelineno-51-38></a><span class=go>                          a      b</span>
</span><span id=__span-51-39><a id=__codelineno-51-39 name=__codelineno-51-39 href=#__codelineno-51-39></a><span class=go>2020-01-01            False  False</span>
</span><span id=__span-51-40><a id=__codelineno-51-40 name=__codelineno-51-40 href=#__codelineno-51-40></a><span class=go>2020-01-02            False  False</span>
</span><span id=__span-51-41><a id=__codelineno-51-41 name=__codelineno-51-41 href=#__codelineno-51-41></a><span class=go>2020-01-03            False  False</span>
</span><span id=__span-51-42><a id=__codelineno-51-42 name=__codelineno-51-42 href=#__codelineno-51-42></a><span class=go>2020-01-04            False  False</span>
</span><span id=__span-51-43><a id=__codelineno-51-43 name=__codelineno-51-43 href=#__codelineno-51-43></a><span class=go>2020-01-05            False   True</span>
</span><span id=__span-51-44><a id=__codelineno-51-44 name=__codelineno-51-44 href=#__codelineno-51-44></a><span class=go>2020-01-06            False  False</span>
</span><span id=__span-51-45><a id=__codelineno-51-45 name=__codelineno-51-45 href=#__codelineno-51-45></a><span class=go>2020-01-07             True  False</span>
</span></code></pre></div> <p>This implementation does have one drawback: it needlessly creates two indicator instances and repeatedly converts between NumPy arrays and Pandas objects. An ideal implementation would use only NumPy and Numba. Fortunately, any indicator constructed by <a href=https://vectorbt.pro/pvt_41531c19/api/indicators/factory/#vectorbtpro.indicators.factory.IndicatorFactory>IndicatorFactory</a> supports the <code>return_raw</code> argument, which allows you to access the actual NumPy array(s) returned by the calculation function.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-52-1><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>sma</span><span class=p>(</span><span class=n>close</span><span class=p>,</span> <span class=n>timeperiod</span><span class=p>):</span>
</span><span id=__span-52-2><a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>vbt</span><span class=o>.</span><span class=n>talib</span><span class=p>(</span><span class=s1>&#39;SMA&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>close</span><span class=p>,</span> <span class=n>timeperiod</span><span class=p>,</span> <span class=n>return_raw</span><span class=o>=</span><span class=kc>True</span><span class=p>)[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-52-3><a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a>
</span><span id=__span-52-4><a id=__codelineno-52-4 name=__codelineno-52-4 href=#__codelineno-52-4></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>apply_func</span><span class=p>(</span><span class=n>close</span><span class=p>,</span> <span class=n>timeperiod1</span><span class=p>,</span> <span class=n>timeperiod2</span><span class=p>):</span>
</span><span id=__span-52-5><a id=__codelineno-52-5 name=__codelineno-52-5 href=#__codelineno-52-5></a><span class=gp>... </span>    <span class=n>fast_ma</span> <span class=o>=</span> <span class=n>sma</span><span class=p>(</span><span class=n>close</span><span class=p>,</span> <span class=n>timeperiod1</span><span class=p>)</span>
</span><span id=__span-52-6><a id=__codelineno-52-6 name=__codelineno-52-6 href=#__codelineno-52-6></a><span class=gp>... </span>    <span class=n>slow_ma</span> <span class=o>=</span> <span class=n>sma</span><span class=p>(</span><span class=n>close</span><span class=p>,</span> <span class=n>timeperiod2</span><span class=p>)</span>
</span><span id=__span-52-7><a id=__codelineno-52-7 name=__codelineno-52-7 href=#__codelineno-52-7></a><span class=gp>... </span>    <span class=n>entries</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>crossed_above_nb</span><span class=p>(</span><span class=n>fast_ma</span><span class=p>,</span> <span class=n>slow_ma</span><span class=p>)</span>
</span><span id=__span-52-8><a id=__codelineno-52-8 name=__codelineno-52-8 href=#__codelineno-52-8></a><span class=gp>... </span>    <span class=n>exits</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>crossed_above_nb</span><span class=p>(</span><span class=n>slow_ma</span><span class=p>,</span> <span class=n>fast_ma</span><span class=p>)</span>
</span><span id=__span-52-9><a id=__codelineno-52-9 name=__codelineno-52-9 href=#__codelineno-52-9></a><span class=gp>... </span>    <span class=k>return</span> <span class=p>(</span><span class=n>fast_ma</span><span class=p>,</span> <span class=n>slow_ma</span><span class=p>,</span> <span class=n>entries</span><span class=p>,</span> <span class=n>exits</span><span class=p>)</span>
</span></code></pre></div> <p>Looking for another approach? Any indicator class created by <a href=https://vectorbt.pro/pvt_41531c19/api/indicators/factory/#vectorbtpro.indicators.factory.IndicatorFactory.with_custom_func>IndicatorFactory.with_custom_func</a> has a <code>custom_func</code> attribute to access the custom function. Similarly, any indicator class created by <a href=https://vectorbt.pro/pvt_41531c19/api/indicators/factory/#vectorbtpro.indicators.factory.IndicatorFactory.with_apply_func>IndicatorFactory.with_apply_func</a> has an <code>apply_func</code> attribute to access the apply function. This lets you call an indicator's <code>custom_func</code> from your own <code>custom_func</code> and its <code>apply_func</code> from your own <code>apply_func</code>. Note that the <code>apply_func</code> of all parsed indicators is created dynamically with <code>pass_packed</code> set to True, so it accepts arguments in the packed form:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-53-1><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>phelp</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>talib</span><span class=p>(</span><span class=s1>&#39;SMA&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>apply_func</span><span class=p>)</span>
</span><span id=__span-53-2><a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a><span class=go>apply_func(</span>
</span><span id=__span-53-3><a id=__codelineno-53-3 name=__codelineno-53-3 href=#__codelineno-53-3></a><span class=go>    input_tuple,</span>
</span><span id=__span-53-4><a id=__codelineno-53-4 name=__codelineno-53-4 href=#__codelineno-53-4></a><span class=go>    in_output_tuple,</span>
</span><span id=__span-53-5><a id=__codelineno-53-5 name=__codelineno-53-5 href=#__codelineno-53-5></a><span class=go>    param_tuple,</span>
</span><span id=__span-53-6><a id=__codelineno-53-6 name=__codelineno-53-6 href=#__codelineno-53-6></a><span class=go>    **_kwargs</span>
</span><span id=__span-53-7><a id=__codelineno-53-7 name=__codelineno-53-7 href=#__codelineno-53-7></a><span class=go>)</span>
</span><span id=__span-53-8><a id=__codelineno-53-8 name=__codelineno-53-8 href=#__codelineno-53-8></a>
</span><span id=__span-53-9><a id=__codelineno-53-9 name=__codelineno-53-9 href=#__codelineno-53-9></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>sma</span><span class=p>(</span><span class=n>close</span><span class=p>,</span> <span class=n>timeperiod</span><span class=p>):</span>
</span><span id=__span-53-10><a id=__codelineno-53-10 name=__codelineno-53-10 href=#__codelineno-53-10></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>vbt</span><span class=o>.</span><span class=n>talib</span><span class=p>(</span><span class=s1>&#39;SMA&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>apply_func</span><span class=p>((</span><span class=n>close</span><span class=p>,),</span> <span class=p>(),</span> <span class=p>(</span><span class=n>timeperiod</span><span class=p>,))</span>
</span></code></pre></div> <p>This approach is as fast as it gets!</p> <p><a class=md-button href=https://vectorbt.pro/pvt_41531c19/assets/jupytext/documentation/indicators/development.py.txt target=blank_><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19.14 7.5A2.86 2.86 0 0 1 22 10.36v3.78A2.86 2.86 0 0 1 19.14 17H12c0 .39.32.96.71.96H17v1.68a2.86 2.86 0 0 1-2.86 2.86H9.86A2.86 2.86 0 0 1 7 19.64v-3.75a2.85 2.85 0 0 1 2.86-2.85h5.25a2.85 2.85 0 0 0 2.85-2.86V7.5zm-4.28 11.79c-.4 0-.72.3-.72.89s.32.71.72.71a.71.71 0 0 0 .71-.71c0-.59-.32-.89-.71-.89m-10-1.79A2.86 2.86 0 0 1 2 14.64v-3.78A2.86 2.86 0 0 1 4.86 8H12c0-.39-.32-.96-.71-.96H7V5.36A2.86 2.86 0 0 1 9.86 2.5h4.28A2.86 2.86 0 0 1 17 5.36v3.75a2.85 2.85 0 0 1-2.86 2.85H8.89a2.85 2.85 0 0 0-2.85 2.86v2.68zM9.14 5.71c.4 0 .72-.3.72-.89s-.32-.71-.72-.71c-.39 0-.71.12-.71.71s.32.89.71.89"/></svg></span> Python code</a></p> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=https://vectorbt.pro/pvt_41531c19/documentation/indicators/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Indicators"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Indicators </div> </div> </a> <a href=https://vectorbt.pro/pvt_41531c19/documentation/indicators/analysis/ class="md-footer__link md-footer__link--next" aria-label="Next: Analysis"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Analysis </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2021-2025 Oleg Polakow. All rights reserved. </div> </div> <div class=md-social> <a href=https://www.linkedin.com/in/polakowo target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> <a href=https://github.com/polakowo target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">Accept</button> <label class=md-button for=__settings>Manage settings</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script> <script id=__config type=application/json>{"annotate": null, "base": "../../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.instant", "navigation.instant.progress", "navigation.top", "navigation.prune", "navigation.path", "navigation.footer", "search.suggest", "search.share", "content.code.annotate", "content.code.copy", "content.code.select", "content.tooltips", "content.tabs.link", "toc.follow", "toc.integrate", "announce.dismiss"], "search": "../../../assets/javascripts/workers/search.26099bd0.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=https://vectorbt.pro/pvt_41531c19/assets/javascripts/bundle.9d1edc04.min.js></script> <script src=https://vectorbt.pro/pvt_41531c19/assets/scripts/extra.js></script> <script src=https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js></script> </body> 
<!-- Mirrored from vectorbt.pro/pvt_41531c19/documentation/indicators/development/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 22 Nov 2025 03:46:55 GMT -->
</html>