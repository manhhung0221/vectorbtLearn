<!doctype html><html lang=en class=no-js> 
<!-- Mirrored from vectorbt.pro/pvt_41531c19/documentation/building-blocks/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 22 Nov 2025 03:46:38 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Documentation on main building blocks of VectorBT PRO"><meta name=author content="Oleg Polakow"><link href=https://vectorbt.pro/documentation/building-blocks/ rel=canonical><link href=../fundamentals/index.html rel=prev><link href=../data/index.html rel=next><link rel=icon href=../../assets/logo/favicon.png><meta name=generator content="mkdocs-1.6.0, mkdocs-material-9.6.21+insiders-4.53.17"><title>Building blocks - VectorBTÂ® PRO</title><link rel=stylesheet href=../../assets/stylesheets/main.010a373c.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=../../../../fonts.gstatic.com/index.html crossorigin><link rel=stylesheet href="../../../../fonts.googleapis.com/cssbe43.css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/stylesheets/extra.css><link rel=stylesheet href=../../assets/stylesheets/custom-light.css><link rel=stylesheet href=../../assets/stylesheets/custom-dark.css><link rel=stylesheet href=../../assets/stylesheets/pygments-light.css><link rel=stylesheet href=../../assets/stylesheets/pygments-dark.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-0C5VNYCFHL"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-0C5VNYCFHL",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="../../../../www.googletagmanager.com/gtag/jsc6c8?id=G-0C5VNYCFHL",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script><meta name=robots content="noindex, nofollow"><meta property=og:title content="Building blocks"><meta property=og:type content=website><meta content=https://vectorbt.pro/documentation/building-blocks/ property=og:url><meta property=og:image:url content=https://vectorbt.pro/pvt_41531c19/assets/logo/social-new.png><meta property=og:image:type content=image/png><meta property=og:description content="Documentation on main building blocks of VectorBT PRO"><meta property=og:locale content=en-GB><link rel=apple-touch-icon sizes=180x180 href=https://vectorbt.pro/pvt_41531c19/assets/logo/apple-touch-icon.png><link rel=icon type=image/svg+xml href=https://vectorbt.pro/pvt_41531c19/assets/logo/favicon.svg><link rel=icon type=image/png sizes=32x32 href=https://vectorbt.pro/pvt_41531c19/assets/logo/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://vectorbt.pro/pvt_41531c19/assets/logo/favicon-16x16.png><link rel=manifest href=https://vectorbt.pro/pvt_41531c19/assets/logo/site.webmanifest><link rel=mask-icon href=https://vectorbt.pro/pvt_41531c19/assets/logo/safari-pinned-tab.svg color=#1e1f22><link rel="shortcut icon" href=https://vectorbt.pro/pvt_41531c19/assets/logo/favicon.ico><meta name=msapplication-TileColor content=#1e1f22><meta name=msapplication-config content=https://vectorbt.pro/pvt_41531c19/assets/logo/browserconfig.xml><meta name=theme-color content=#1e1f22><link href=https://unpkg.com/aos@2.3.4/dist/aos.css rel=stylesheet><script src=https://unpkg.com/aos@2.3.4/dist/aos.js></script><link href=http://fonts.cdnfonts.com/css/uni-neue rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" crossorigin=anonymous referrerpolicy=no-referrer><script src=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/js/all.min.js integrity="sha512-8pHNiqTlsrRjVD4A/3va++W1sMbUHwWxxRPWNyVlql3T+Hgfd81Qc6FC5WMXDC+tSauxxzp1tgiAvSKFu1qIlA==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js integrity="sha512-q583ppKrCRc7N5O0n2nzUiJ+suUv7Et1JGels4bXOaMFQcamPk9HjdUknZuuFjBNs7tsMuadge5k9RzdmO+1GQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><link rel=preconnect href=https://fonts.googleapis.com/><link rel=preconnect href=https://fonts.gstatic.com/ crossorigin></head> <body dir=ltr data-md-color-scheme=custom-dark data-md-color-primary=custom-dark data-md-color-accent=custom-dark> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#building-blocks class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <button class="md-banner__button md-icon" aria-label="Don't show this again"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> <i>What's new</i>: New LLM providers, reasoning steps, function calling, YAML & TOML support, and <a href=https://vectorbt.pro/pvt_41531c19/getting-started/release-notes><strong>more</strong></a> <span class="twemoji announce-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="m153.6 29.9 16-21.3c4-5.4 10.4-8.6 17.1-8.6C198.4 0 208 9.6 208 21.3v22.1c0 13.1 5.4 25.7 14.9 34.7l84.7 80.9c48.8 46.6 76.4 111.2 76.4 178.7C384 434 306 512 209.7 512H192C86 512 0 426 0 320v-3.8c0-48.8 19.4-95.6 53.9-130.1l3.5-3.5c4.2-4.2 10-6.6 16-6.6 12.5 0 22.6 10.1 22.6 22.6V288c0 35.3 28.7 64 64 64s64-28.7 64-64v-3.9c0-18-7.2-35.3-19.9-48l-38.6-38.6c-24-24-37.5-56.7-37.5-90.7 0-27.7 9-54.8 25.6-76.9"/></svg></span> </div> <script>var el=document.querySelector("[data-md-component=announce]");if(el){var content=el.querySelector(".md-typeset");__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0)}</script> </aside> </div> <!-- Determine class according to configuration --> <!-- Header --> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=header.title> <!-- Link to home --> <a href=https://vectorbt.pro/pvt_41531c19/ title="VectorBTÂ® PRO" class="md-header__button md-logo" aria-label="VectorBTÂ® PRO" data-md-component=logo> <img src=https://vectorbt.pro/pvt_41531c19/assets/logo/logo.svg alt=logo class=logo> </a> <!-- Button to open drawer --> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <!-- Header title --> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> VectorBTÂ® PRO <span class=md-version> v2025.10.15 </span> <span class=unlock-icon><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M192 32c-35.3 0-64 28.7-64 64v64h192c35.3 0 64 28.7 64 64v224c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V224c0-35.3 28.7-64 64-64V96c0-70.7 57.3-128 128-128 63.5 0 116.1 46.1 126.2 106.7 2.9 17.4-8.8 33.9-26.3 36.9S258 102.8 255 85.3C250 55.1 223.7 32 192 32m40 328c13.3 0 24-10.7 24-24s-10.7-24-24-24h-80c-13.3 0-24 10.7-24 24s10.7 24 24 24z"/></svg></span> </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Building blocks </span> </div> </div> </div> <!-- Color palette --> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=custom-dark data-md-color-primary=custom-dark data-md-color-accent=custom-dark aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=custom-light data-md-color-primary=custom-light data-md-color-accent=custom-light aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <!-- Site language selector --> <!-- Button to open search modal --> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <!-- Search interface --> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <!-- Repository information --> <div class=md-header__source> <a href=https://github.com/polakowo/vectorbt.pro title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> vectorbt.pro </div> </a> </div> </nav> <!-- Navigation tabs (sticky) --> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/ class=md-tabs__link> Getting started </a> </li> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/features/overview/ class=md-tabs__link> Features </a> </li> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/overview/ class=md-tabs__link> Tutorials </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=https://vectorbt.pro/pvt_41531c19/documentation/overview/ class=md-tabs__link> Documentation </a> </li> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/cookbook/overview/ class=md-tabs__link> Cookbook </a> </li> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/api/ class=md-tabs__link> API </a> </li> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/terms/terms-of-use/ class=md-tabs__link> Terms </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://vectorbt.pro/pvt_41531c19/ title="VectorBTÂ® PRO" class="md-nav__button md-logo" aria-label="VectorBTÂ® PRO" data-md-component=logo> <img src=https://vectorbt.pro/pvt_41531c19/assets/logo/logo.svg alt=logo class=logo> </a> VectorBTÂ® PRO </label> <div class=md-nav__source> <a href=https://github.com/polakowo/vectorbt.pro title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> vectorbt.pro </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/ class=md-nav__link> <span class=md-ellipsis> Getting started </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/features/overview/ class=md-nav__link> <span class=md-ellipsis> Features </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/overview/ class=md-nav__link> <span class=md-ellipsis> Tutorials </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Documentation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Documentation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/documentation/overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/documentation/fundamentals/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 7a2 2 0 0 0-2 2v8h2v-4h2v4h2V9a2 2 0 0 0-2-2zm0 2h2v2H3m12-.5V9a2 2 0 0 0-2-2H9v10h4a2 2 0 0 0 2-2v-1.5a1.54 1.54 0 0 0-1.5-1.5 1.54 1.54 0 0 0 1.5-1.5M13 15h-2v-2h2zm0-4h-2V9h2m6-2a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-1h-2v1h-2V9h2v1h2V9a2 2 0 0 0-2-2Z"/></svg> <span class=md-ellipsis> Fundamentals </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 16.5c0 .38-.21.71-.53.88l-7.9 4.44c-.16.12-.36.18-.57.18s-.41-.06-.57-.18l-7.9-4.44A.99.99 0 0 1 3 16.5v-9c0-.38.21-.71.53-.88l7.9-4.44c.16-.12.36-.18.57-.18s.41.06.57.18l7.9 4.44c.32.17.53.5.53.88zM12 4.15 6.04 7.5 12 10.85l5.96-3.35zM5 15.91l6 3.38v-6.71L5 9.21zm14 0v-6.7l-6 3.37v6.71z"/></svg> <span class=md-ellipsis> Building blocks </span> <span class="md-nav__icon md-icon"></span> </label> <a href=https://vectorbt.pro/pvt_41531c19/documentation/building-blocks/ class="md-nav__link md-nav__link--active"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 16.5c0 .38-.21.71-.53.88l-7.9 4.44c-.16.12-.36.18-.57.18s-.41-.06-.57-.18l-7.9-4.44A.99.99 0 0 1 3 16.5v-9c0-.38.21-.71.53-.88l7.9-4.44c.16-.12.36-.18.57-.18s.41.06.57.18l7.9 4.44c.32.17.53.5.53.88zM12 4.15 6.04 7.5 12 10.85l5.96-3.35zM5 15.91l6 3.38v-6.71L5 9.21zm14 0v-6.7l-6 3.37v6.71z"/></svg> <span class=md-ellipsis> Building blocks </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#utilities class=md-nav__link> <span class=md-ellipsis> Utilities </span> </a> <nav class=md-nav aria-label=Utilities> <ul class=md-nav__list> <li class=md-nav__item> <a href=#formatting class=md-nav__link> <span class=md-ellipsis> Formatting </span> </a> </li> <li class=md-nav__item> <a href=#pickling class=md-nav__link> <span class=md-ellipsis> Pickling </span> </a> </li> <li class=md-nav__item> <a href=#configuring class=md-nav__link> <span class=md-ellipsis> Configuring </span> </a> </li> <li class=md-nav__item> <a href=#attribute-resolution class=md-nav__link> <span class=md-ellipsis> Attribute resolution </span> </a> </li> <li class=md-nav__item> <a href=#templating class=md-nav__link> <span class=md-ellipsis> Templating </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#base class=md-nav__link> <span class=md-ellipsis> Base </span> </a> <nav class=md-nav aria-label=Base> <ul class=md-nav__list> <li class=md-nav__item> <a href=#grouping class=md-nav__link> <span class=md-ellipsis> Grouping </span> </a> </li> <li class=md-nav__item> <a href=#indexing class=md-nav__link> <span class=md-ellipsis> Indexing </span> </a> </li> <li class=md-nav__item> <a href=#wrapping class=md-nav__link> <span class=md-ellipsis> Wrapping </span> </a> </li> <li class=md-nav__item> <a href=#base-accessor class=md-nav__link> <span class=md-ellipsis> Base accessor </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#generic class=md-nav__link> <span class=md-ellipsis> Generic </span> </a> <nav class=md-nav aria-label=Generic> <ul class=md-nav__list> <li class=md-nav__item> <a href=#builder-mixins class=md-nav__link> <span class=md-ellipsis> Builder mixins </span> </a> </li> <li class=md-nav__item> <a href=#analyzing class=md-nav__link> <span class=md-ellipsis> Analyzing </span> </a> </li> <li class=md-nav__item> <a href=#generic-accessor class=md-nav__link> <span class=md-ellipsis> Generic accessor </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#records class=md-nav__link> <span class=md-ellipsis> Records </span> </a> <nav class=md-nav aria-label=Records> <ul class=md-nav__list> <li class=md-nav__item> <a href=#column-mapper class=md-nav__link> <span class=md-ellipsis> Column mapper </span> </a> </li> <li class=md-nav__item> <a href=#mapped-arrays class=md-nav__link> <span class=md-ellipsis> Mapped arrays </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#summary class=md-nav__link> <span class=md-ellipsis> Summary </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/documentation/data/ class=md-nav__link> <span class=md-ellipsis> Data </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/documentation/indicators/ class=md-nav__link> <span class=md-ellipsis> Indicators </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/documentation/portfolio/ class=md-nav__link> <span class=md-ellipsis> Portfolio </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/documentation/to-be-continued/ class=md-nav__link> <span class=md-ellipsis> To be continued... </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/cookbook/overview/ class=md-nav__link> <span class=md-ellipsis> Cookbook </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/api/ class=md-nav__link> <span class=md-ellipsis> API </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/terms/terms-of-use/ class=md-nav__link> <span class=md-ellipsis> Terms </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=building-blocks><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 16.5c0 .38-.21.71-.53.88l-7.9 4.44c-.16.12-.36.18-.57.18s-.41-.06-.57-.18l-7.9-4.44A.99.99 0 0 1 3 16.5v-9c0-.38.21-.71.53-.88l7.9-4.44c.16-.12.36-.18.57-.18s.41.06.57.18l7.9 4.44c.32.17.53.5.53.88zM12 4.15 6.04 7.5 12 10.85l5.96-3.35zM5 15.91l6 3.38v-6.71L5 9.21zm14 0v-6.7l-6 3.37v6.71z"/></svg></span> Building blocks<a class=headerlink href=#building-blocks title="Permanent link">&para;</a></h1> <p>In the following sections, we will explore some sub-packages, modules, and especially classes that serve as building blocks for advanced functionalities in VBT, such as <a href=https://vectorbt.pro/pvt_41531c19/api/portfolio/base/#vectorbtpro.portfolio.base.Portfolio>Portfolio</a>. To demonstrate this, we will gradually build a custom class, <code>CorrStats</code>, which enables us to analyze the correlation between two arrays in the most efficient and flexible way <img alt=ðŸ§  class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f9e0.svg title=:brain:></p> <h2 id=utilities>Utilities<a class=headerlink href=#utilities title="Permanent link">&para;</a></h2> <pre class=mermaid><code>flowchart TD;
    Config --&gt;|inherits| Pickleable;
    Config --&gt;|inherits| Prettified;
    Configured --&gt;|inherits| Pickleable;
    Configured --&gt;|inherits| Prettified;
    Configured -.-&gt;|references| Config;
    AttrResolverMixin;</code></pre> <p>(Reload the page if the diagram does not appear.)</p> <p>VBT uses a modular project structure composed of several subpackages. Each subpackage is designed for a specific area of analysis.</p> <p>The <a href=https://vectorbt.pro/pvt_41531c19/api/utils/ >utils</a> subpackage provides a set of utilities that power every part of VBT <img alt=âš¡ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/26a1.svg title=:zap:> These utilities are loosely connected and offer small but powerful reusable code snippets that can be used independently of other functionality.</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>The main reason we avoid importing third-party packages and instead implement many utilities from scratch is to maintain full control over execution and code quality.</p> </div> <h3 id=formatting>Formatting<a class=headerlink href=#formatting title="Permanent link">&para;</a></h3> <p>VBT includes its own formatting engine that can pretty-print any Python object. It is much more advanced than formatting with <a href=https://en.wikipedia.org/wiki/JSON>JSON</a> because it recognizes native Python data types and adds intelligent formatting for more structured data types, such as <code>np.dtype</code> and <code>namedtuple</code>. In many cases, you can even convert the formatted string back into a Python object using <code>eval</code>.</p> <p>Let's beautify a nested dictionary using <a href=https://vectorbt.pro/pvt_41531c19/api/utils/formatting/#vectorbtpro.utils.formatting.prettify>prettify</a> and then convert the string back into an object:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span><span class=w> </span><span class=nn>vectorbtpro</span><span class=w> </span><span class=kn>import</span> <span class=o>*</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>dct</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;planet&#39;</span> <span class=p>:</span> <span class=p>{</span><span class=s1>&#39;has&#39;</span><span class=p>:</span> <span class=p>{</span><span class=s1>&#39;plants&#39;</span><span class=p>:</span> <span class=s1>&#39;yes&#39;</span><span class=p>,</span> <span class=s1>&#39;animals&#39;</span><span class=p>:</span> <span class=s1>&#39;yes&#39;</span><span class=p>,</span> <span class=s1>&#39;cryptonite&#39;</span><span class=p>:</span> <span class=s1>&#39;no&#39;</span><span class=p>},</span> <span class=s1>&#39;name&#39;</span><span class=p>:</span> <span class=s1>&#39;Earth&#39;</span><span class=p>}}</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=gp>&gt;&gt;&gt; </span><span class=nb>print</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>prettify</span><span class=p>(</span><span class=n>dct</span><span class=p>))</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=go>{</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=go>    &#39;planet&#39;: {</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=go>        &#39;has&#39;: {</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=go>            &#39;plants&#39;: &#39;yes&#39;,</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=go>            &#39;animals&#39;: &#39;yes&#39;,</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=go>            &#39;cryptonite&#39;: &#39;no&#39;</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=go>        },</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=go>        &#39;name&#39;: &#39;Earth&#39;</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=go>    }</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=go>}</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a><span class=gp>&gt;&gt;&gt; </span><span class=nb>eval</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>prettify</span><span class=p>(</span><span class=n>dct</span><span class=p>))</span> <span class=o>==</span> <span class=n>dct</span>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a><span class=go>True</span>
</span></code></pre></div> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>Curious why we used <code>vbt.prettify</code> instead of <code>vbt.utils.formatting.prettify</code>? Any utility that may be useful to the end user can be accessed directly from <code>vbt</code>.</p> <p>To see which utilities are accessible from the root of the package, visit <a href=https://github.com/polakowo/vectorbt.pro/blob/main/vectorbtpro/utils/__init__.py>vectorbtpro/utils/__init__.py</a> or any other subpackage, and look for the objects that are listed in <code>__all__</code>.</p> </div> <p>The <a href=https://vectorbt.pro/pvt_41531c19/api/utils/pickling/#vectorbtpro.utils.formatting.Prettified>Prettified</a> class implements the abstract method <a href=https://vectorbt.pro/pvt_41531c19/api/utils/formatting/#vectorbtpro.utils.formatting.Prettified.prettify>Prettified.prettify</a>, which can be overridden by a subclass to pretty-print an instance using <a href=https://vectorbt.pro/pvt_41531c19/api/utils/formatting/#vectorbtpro.utils.formatting.prettify>prettify</a>. Read below to learn how this method can be used to introspect instances of various classes.</p> <h3 id=pickling>Pickling<a class=headerlink href=#pickling title="Permanent link">&para;</a></h3> <p>Pickling is the process of converting a Python object into a byte stream to store it in a file or database. The <a href=https://vectorbt.pro/pvt_41531c19/api/utils/pickling/#vectorbtpro.utils.pickling.Pickleable>Pickleable</a> class enables pickling of objects of any complexity using <a href=https://dill.readthedocs.io/en/latest/ >Dill</a> (or <a href=https://docs.python.org/3/library/pickle.html>pickle</a> if Dill is not installed). Each subclass inherits ready-to-use methods for serializing, deserializing, saving to a file, and loading from a file. This is especially powerful because it allows us to persist objects containing any type of data, including instances of <a href=https://vectorbt.pro/pvt_41531c19/api/data/base/#vectorbtpro.data.base.Data>Data</a> and <a href=https://vectorbt.pro/pvt_41531c19/api/portfolio/base/#vectorbtpro.portfolio.base.Portfolio>Portfolio</a>.</p> <h3 id=configuring>Configuring<a class=headerlink href=#configuring title="Permanent link">&para;</a></h3> <p>VBT relies heavily on automation driven by specifications. The specification for most repetitive tasks is usually stored in "configs," which serve as settings for specific tasks, data structures, or even classes. This approach makes most parts of VBT transparent, easily traversable, and programmatically changeable.</p> <p>The <a href=https://vectorbt.pro/pvt_41531c19/api/utils/config/#vectorbtpro.utils.config.Config>Config</a> class is like a dictionary on steroids: it extends Python's <code>dict</code> with various configuration features, such as frozen keys, read-only values, dot notation access to keys, and nested updates. The most notable feature is the ability to reset a config to its initial state and even create checkpoints, which is especially useful for settings. In addition, since <a href=https://vectorbt.pro/pvt_41531c19/api/utils/config/#vectorbtpro.utils.config.Config>Config</a> inherits from <a href=https://vectorbt.pro/pvt_41531c19/api/utils/pickling/#vectorbtpro.utils.pickling.Pickleable>Pickleable</a>, we can save any configuration to disk, and by subclassing <a href=https://vectorbt.pro/pvt_41531c19/api/utils/pickling/#vectorbtpro.utils.formatting.Prettified>Prettified</a> we can beautify it (this approach is used to generate the API reference):</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nb>print</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>Records</span><span class=o>.</span><span class=n>field_config</span><span class=p>)</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=go>Config(</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=go>    dtype=None,</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=go>    settings={</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=go>        &#39;id&#39;: {</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=go>            &#39;name&#39;: &#39;id&#39;,</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=go>            &#39;title&#39;: &#39;Id&#39;</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=go>        },</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=go>        &#39;col&#39;: {</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=go>            &#39;name&#39;: &#39;col&#39;,</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=go>            &#39;title&#39;: &#39;Column&#39;,</span>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=go>            &#39;mapping&#39;: &#39;columns&#39;</span>
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=go>        },</span>
</span><span id=__span-1-14><a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=go>        &#39;idx&#39;: {</span>
</span><span id=__span-1-15><a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a><span class=go>            &#39;name&#39;: &#39;idx&#39;,</span>
</span><span id=__span-1-16><a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a><span class=go>            &#39;title&#39;: &#39;Timestamp&#39;,</span>
</span><span id=__span-1-17><a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a><span class=go>            &#39;mapping&#39;: &#39;index&#39;</span>
</span><span id=__span-1-18><a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a><span class=go>        }</span>
</span><span id=__span-1-19><a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a><span class=go>    }</span>
</span><span id=__span-1-20><a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a><span class=go>)</span>
</span></code></pre></div> <p>Configs are very common structures in VBT. There are three main types of configs (that either subclass or partially use <a href=https://vectorbt.pro/pvt_41531c19/api/utils/config/#vectorbtpro.utils.config.Config>Config</a>) used throughout VBT:</p> <ol> <li><a href=https://vectorbt.pro/pvt_41531c19/api/utils/config/#vectorbtpro.utils.config.ReadonlyConfig>ReadonlyConfig</a> is used for configurations that are not meant to be modified, such as <a href=https://vectorbt.pro/pvt_41531c19/api/generic/accessors/#vectorbtpro.generic.accessors.nb_config>nb_config</a>, which is used to attach a number of Numba-compiled functions to <a href=https://vectorbt.pro/pvt_41531c19/api/generic/accessors/#vectorbtpro.generic.accessors.GenericAccessor>GenericAccessor</a> only once when importing VBT. Since modifications would have no effect anyway, these configs are locked.</li> <li><a href=https://vectorbt.pro/pvt_41531c19/api/utils/config/#vectorbtpro.utils.config.HybridConfig>HybridConfig</a> is used for configurations that are intended to be modified. The best examples are <a href=https://vectorbt.pro/pvt_41531c19/api/portfolio/base/#vectorbtpro.portfolio.base.Portfolio.metrics>Portfolio.metrics</a> and <a href=https://vectorbt.pro/pvt_41531c19/api/portfolio/base/#vectorbtpro.portfolio.base.Portfolio.subplots>Portfolio.subplots</a>, which list all the metrics and subplots supported by <a href=https://vectorbt.pro/pvt_41531c19/api/portfolio/base/#vectorbtpro.portfolio.base.Portfolio>Portfolio</a>. They can be easily changed and extended, and reset if you make breaking changes.</li> <li><a href=https://vectorbt.pro/pvt_41531c19/api/_settings/#vectorbtpro._settings.SettingsConfig>SettingsConfig</a> holds the global settings defined in <a href=https://vectorbt.pro/pvt_41531c19/api/_settings/ >_settings</a>. It is a custom subclass of <a href=https://vectorbt.pro/pvt_41531c19/api/utils/config/#vectorbtpro.utils.config.Config>Config</a> that can change Plotly themes and convert any sub-configs of type <code>dict</code> to smaller settings accessible via dot notation (<code>vbt.settings.portfolio.log</code> instead of <code>vbt.settings['portfolio']['log']</code>).</li> </ol> <p>You can create a config just like a regular <code>dict</code>. To provide options for the config, use the <code>options_</code> argument (note the trailing underscore):</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cfg</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Config</span><span class=p>(</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=gp>... </span>    <span class=n>hello</span><span class=o>=</span><span class=s2>&quot;world&quot;</span><span class=p>,</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=gp>... </span>    <span class=n>options_</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>readonly</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=gp>&gt;&gt;&gt; </span><span class=nb>print</span><span class=p>(</span><span class=n>cfg</span><span class=p>)</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=go>Config(</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=go>    hello=&#39;world&#39;</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=go>)</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cfg</span><span class=p>[</span><span class=s2>&quot;change&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;something&quot;</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=go>TypeError: Config is read-only</span>
</span></code></pre></div> <p>In addition to the cases above, <a href=https://vectorbt.pro/pvt_41531c19/api/utils/config/#vectorbtpro.utils.config.Config>Config</a> is also used by the <a href=https://vectorbt.pro/pvt_41531c19/api/utils/config/#vectorbtpro.utils.config.Configured>Configured</a> class, which is a base class for most core classes in VBT. This read-only class holds a config of type <a href=https://vectorbt.pro/pvt_41531c19/api/utils/config/#vectorbtpro.utils.config.Config>Config</a> containing all arguments passed during initialization. Any time you initialize a subclass of <a href=https://vectorbt.pro/pvt_41531c19/api/utils/config/#vectorbtpro.utils.config.Configured>Configured</a>, all named arguments you pass to the initializer (<code>__init__</code>) are stored inside <a href=https://vectorbt.pro/pvt_41531c19/api/utils/config/#vectorbtpro.utils.config.Configured.config>Configured.config</a>. In this way, the created instance is described and managed entirely by its config:</p> <ul> <li>You can copy or modify the config and pass it to the class to initialize another instance (<code>new_instance = ConfiguredClass(**old_instance.config)</code>).</li> <li>You can pickle both the class and the config to pickle the entire instance.</li> <li>You can compare instances based on their classes and configs.</li> </ul> <p>The main requirement for all of this to work correctly is <strong>immutability</strong>. This brings us to an important design decision: most classes in VBT to be immutable (read-only), and it is discouraged to change any attribute unless it is listed in a special variable called <code>_writeable_attrs</code>. There are several reasons why immutability is required:</p> <ol> <li>Immutable instances can be easily recreated and manipulated using their configs.</li> <li>Immutable instances are free of side effects and can have cached attributes.</li> <li>Immutable instances can be hashed.</li> </ol> <p>Let's create a custom class that returns some correlation statistics of two arrays. Specifically, it will compute the Pearson correlation coefficient and its rolling version using Pandas.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>class</span><span class=w> </span><span class=nc>CorrStats</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>Configured</span><span class=p>):</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=gp>... </span>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>obj1</span><span class=p>,</span> <span class=n>obj2</span><span class=p>):</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=gp>... </span>        <span class=n>vbt</span><span class=o>.</span><span class=n>Configured</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>obj1</span><span class=o>=</span><span class=n>obj1</span><span class=p>,</span> <span class=n>obj2</span><span class=o>=</span><span class=n>obj2</span><span class=p>)</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=gp>...</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=gp>... </span>        <span class=bp>self</span><span class=o>.</span><span class=n>_obj1</span> <span class=o>=</span> <span class=n>obj1</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=gp>... </span>        <span class=bp>self</span><span class=o>.</span><span class=n>_obj2</span> <span class=o>=</span> <span class=n>obj2</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=gp>...</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=gp>... </span>    <span class=nd>@property</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class=gp>... </span>    <span class=k>def</span><span class=w> </span><span class=nf>obj1</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=gp>... </span>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_obj1</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=gp>...</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a><span class=gp>... </span>    <span class=nd>@property</span>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a><span class=gp>... </span>    <span class=k>def</span><span class=w> </span><span class=nf>obj2</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a><span class=gp>... </span>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_obj2</span>
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a><span class=gp>...</span>
</span><span id=__span-3-16><a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a><span class=gp>... </span>    <span class=k>def</span><span class=w> </span><span class=nf>corr</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-3-17><a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a><span class=gp>... </span>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>obj1</span><span class=p>,</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>):</span>
</span><span id=__span-3-18><a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a><span class=gp>... </span>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>obj1</span><span class=o>.</span><span class=n>corr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>obj2</span><span class=p>)</span>
</span><span id=__span-3-19><a id=__codelineno-3-19 name=__codelineno-3-19 href=#__codelineno-3-19></a><span class=gp>... </span>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>obj1</span><span class=o>.</span><span class=n>corrwith</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>obj2</span><span class=p>)</span>
</span><span id=__span-3-20><a id=__codelineno-3-20 name=__codelineno-3-20 href=#__codelineno-3-20></a><span class=gp>...</span>
</span><span id=__span-3-21><a id=__codelineno-3-21 name=__codelineno-3-21 href=#__codelineno-3-21></a><span class=gp>... </span>    <span class=k>def</span><span class=w> </span><span class=nf>rolling_corr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>window</span><span class=p>):</span>
</span><span id=__span-3-22><a id=__codelineno-3-22 name=__codelineno-3-22 href=#__codelineno-3-22></a><span class=gp>... </span>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>obj1</span><span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=n>window</span><span class=p>)</span><span class=o>.</span><span class=n>corr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>obj2</span><span class=p>)</span>
</span></code></pre></div> <p>This is how most configured classes in VBT, such as <a href=https://vectorbt.pro/pvt_41531c19/api/portfolio/base/#vectorbtpro.portfolio.base.Portfolio>Portfolio</a>, are designed. Any argument passed to <code>CorrStats</code> is forwarded to <a href=https://vectorbt.pro/pvt_41531c19/api/utils/config/#vectorbtpro.utils.config.Configured>Configured</a> to create a new config:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>index</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>date_range</span><span class=p>(</span><span class=s2>&quot;2020&quot;</span><span class=p>,</span> <span class=n>periods</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>df1</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=gp>... </span>    <span class=s1>&#39;a&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=gp>... </span>    <span class=s1>&#39;b&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>5</span><span class=p>]</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=gp>... </span><span class=p>},</span> <span class=n>index</span><span class=o>=</span><span class=n>index</span><span class=p>)</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>df2</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=gp>... </span>    <span class=s1>&#39;a&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>],</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=gp>... </span>    <span class=s1>&#39;b&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>5</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>]</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=gp>... </span><span class=p>},</span> <span class=n>index</span><span class=o>=</span><span class=n>index</span><span class=p>)</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>corrstats</span> <span class=o>=</span> <span class=n>CorrStats</span><span class=p>(</span><span class=n>df1</span><span class=p>,</span> <span class=n>df2</span><span class=p>)</span>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a><span class=gp>&gt;&gt;&gt; </span><span class=nb>print</span><span class=p>(</span><span class=n>corrstats</span><span class=o>.</span><span class=n>config</span><span class=p>)</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a><span class=go>Config(</span>
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a><span class=go>    obj1=&lt;DataFrame object at 0x7fd490461400 of shape (5, 2)&gt;,</span>
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a><span class=go>    obj2=&lt;DataFrame object at 0x7fd490461240 of shape (5, 2)&gt;</span>
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a><span class=go>)</span>
</span></code></pre></div> <p>Access to any attribute is read-only. If you try to set a read-only property or modify the config, an expected error will be raised:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>df3</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=gp>... </span>    <span class=s1>&#39;a&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>4</span><span class=p>],</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=gp>... </span>    <span class=s1>&#39;b&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>]</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=gp>... </span><span class=p>},</span> <span class=n>index</span><span class=o>=</span><span class=n>index</span><span class=p>)</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>corrstats</span><span class=o>.</span><span class=n>obj1</span> <span class=o>=</span> <span class=n>df3</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=go>AttributeError: can&#39;t set attribute</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>corrstats</span><span class=o>.</span><span class=n>config</span><span class=p>[</span><span class=s1>&#39;obj1&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>df3</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=go>TypeError: Config is read-only</span>
</span></code></pre></div> <p>However, it will not (and cannot) throw an error when setting a private attribute (with a leading underscore) or if any of the attributes are modified in place, which is a common pitfall to avoid.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>corrstats</span><span class=o>.</span><span class=n>_obj1</span> <span class=o>=</span> <span class=n>df3</span>  <span class=c1># (1)!</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>corrstats</span><span class=o>.</span><span class=n>obj1</span><span class=o>.</span><span class=n>iloc</span><span class=p>[:]</span> <span class=o>=</span> <span class=n>df3</span>  <span class=c1># (2)!</span>
</span></code></pre></div> <ol> <li>This would work, but at what cost?</li> <li>This would work too, unfortunately.</li> </ol> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>VBT assumes that the data in a configured instance always remains the same. If there is a change to the data, VBT will not register it, and this can result in erroneous outcomes later.</p> <p>The only approved way to change data in an instance is to create a new instance!</p> </div> <p>To change any data, pass the new value to <a href=https://vectorbt.pro/pvt_41531c19/api/utils/config/#vectorbtpro.utils.config.Configured.replace>Configured.replace</a>, which takes the same arguments as the class, but as keyword-only arguments. These are merged with the old config and then passed as keyword arguments to the class for instantiation.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>new_corrstats</span> <span class=o>=</span> <span class=n>corrstats</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=n>obj1</span><span class=o>=</span><span class=n>df3</span><span class=p>)</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>new_corrstats</span><span class=o>.</span><span class=n>obj1</span>  <span class=c1># (1)!</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=go>            a  b</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=go>2020-01-01  3  4</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=go>2020-01-02  2  5</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=go>2020-01-03  1  1</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=go>2020-01-04  5  2</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=go>2020-01-05  4  3</span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>new_corrstats</span><span class=o>.</span><span class=n>obj2</span>  <span class=c1># (2)!</span>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=go>            a  b</span>
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a><span class=go>2020-01-01  1  5</span>
</span><span id=__span-7-13><a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a><span class=go>2020-01-02  2  4</span>
</span><span id=__span-7-14><a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a><span class=go>2020-01-03  3  3</span>
</span><span id=__span-7-15><a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a><span class=go>2020-01-04  4  2</span>
</span><span id=__span-7-16><a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a><span class=go>2020-01-05  5  1</span>
</span></code></pre></div> <ol> <li><code>df1</code> has been replaced with <code>df3</code>.</li> <li><code>df2</code> remains unchanged.</li> </ol> <p>Now that all of our data is stored inside a config, we can perform actions on the instance just as we would on the config itself, such as saving to disk (thanks to <a href=#pickling>Pickling</a>):</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>corrstats</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=s1>&#39;corrstats&#39;</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>corrstats</span> <span class=o>=</span> <span class=n>CorrStats</span><span class=o>.</span><span class=n>load</span><span class=p>(</span><span class=s1>&#39;corrstats&#39;</span><span class=p>)</span>
</span></code></pre></div> <ol> <li>Saves the instance along with both objects.</li> </ol> <h3 id=attribute-resolution>Attribute resolution<a class=headerlink href=#attribute-resolution title="Permanent link">&para;</a></h3> <p>Attribute resolution is useful for accessing attributes by strings or based on specific logic, which is implemented by the <a href=https://vectorbt.pro/pvt_41531c19/api/utils/attr_/#vectorbtpro.utils.attr_.AttrResolverMixin>AttrResolverMixin</a>. You can think of it as adding custom logic to the <code>getattr</code> operation. It is used extensively in <a href=https://vectorbt.pro/pvt_41531c19/api/generic/stats_builder/#vectorbtpro.generic.stats_builder.StatsBuilderMixin>StatsBuilderMixin</a> and <a href=https://vectorbt.pro/pvt_41531c19/api/generic/plots_builder/#vectorbtpro.generic.plots_builder.PlotsBuilderMixin>PlotsBuilderMixin</a> to execute metrics and subplots as chains of commands. In other classes, such as <a href=https://vectorbt.pro/pvt_41531c19/api/portfolio/base/#vectorbtpro.portfolio.base.Portfolio>Portfolio</a>, it is used for accessing shortcut properties, caching attribute access, and more. It works with <a href=https://vectorbt.pro/pvt_41531c19/api/utils/attr_/#vectorbtpro.utils.attr_.deep_getattr>deep_getattr</a>, which accesses a chain of attributes provided as a specification.</p> <p>Let's compute the minimum of the rolling mean using only Pandas and deep attribute resolution:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sr</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>])</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>attr_chain</span> <span class=o>=</span> <span class=p>[(</span><span class=s1>&#39;rolling&#39;</span><span class=p>,</span> <span class=p>(</span><span class=mi>3</span><span class=p>,)),</span> <span class=s1>&#39;mean&#39;</span><span class=p>,</span> <span class=s1>&#39;min&#39;</span><span class=p>]</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>deep_getattr</span><span class=p>(</span><span class=n>sr</span><span class=p>,</span> <span class=n>attr_chain</span><span class=p>)</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=go>2.0</span>
</span></code></pre></div> <p>If any of the above operations were performed on a subclass of <a href=https://vectorbt.pro/pvt_41531c19/api/utils/attr_/#vectorbtpro.utils.attr_.AttrResolverMixin>AttrResolverMixin</a>, they could be easily preprocessed and postprocessed.</p> <h3 id=templating>Templating<a class=headerlink href=#templating title="Permanent link">&para;</a></h3> <p>Templates play an important role in the VBT stem. They allow you to postpone data resolution until more information becomes available. There are several templating classes, such as <a href=https://vectorbt.pro/pvt_41531c19/api/utils/template/#vectorbtpro.utils.template.Rep>Rep</a> for replacing an entire string, and <a href=https://vectorbt.pro/pvt_41531c19/api/utils/template/#vectorbtpro.utils.template.Sub>Sub</a> for substituting only parts of a string (those starting with <code>$</code>).</p> <p>You can think of templates as callbacks that are executed at some point during execution, usually after broadcasting or merging keyword arguments. Some functions provide multiple possible substitution points; in such cases, they may try to substitute the template multiple times until successful, or match the template with a specific evaluation id (<code>eval_id</code>), if given. The actual evaluation is performed by <a href=https://vectorbt.pro/pvt_41531c19/api/utils/template/#vectorbtpro.utils.template.substitute_templates>substitute_templates</a>.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>some_function</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=gp>... </span>    <span class=n>context</span> <span class=o>=</span> <span class=p>{}</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=gp>... </span>    <span class=n>args</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>substitute_templates</span><span class=p>(</span><span class=n>args</span><span class=p>,</span> <span class=n>context</span><span class=o>=</span><span class=n>context</span><span class=p>,</span> <span class=n>strict</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=gp>... </span>    <span class=n>kwargs</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>substitute_templates</span><span class=p>(</span><span class=n>kwargs</span><span class=p>,</span> <span class=n>context</span><span class=o>=</span><span class=n>context</span><span class=p>,</span> <span class=n>strict</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=n>args</span><span class=p>)</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=gp>... </span>    
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=gp>... </span>    <span class=n>context</span><span class=p>[</span><span class=s1>&#39;result&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mi>100</span>  <span class=c1># (1)!</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=gp>... </span>    <span class=n>args</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>substitute_templates</span><span class=p>(</span><span class=n>args</span><span class=p>,</span> <span class=n>context</span><span class=o>=</span><span class=n>context</span><span class=p>)</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=gp>... </span>    <span class=n>kwargs</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>substitute_templates</span><span class=p>(</span><span class=n>kwargs</span><span class=p>,</span> <span class=n>context</span><span class=o>=</span><span class=n>context</span><span class=p>)</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=n>args</span><span class=p>)</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=gp>... </span>    <span class=nb>print</span><span class=p>(</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=gp>&gt;&gt;&gt; </span><span class=n>some_function</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>Rep</span><span class=p>(</span><span class=s1>&#39;result&#39;</span><span class=p>),</span> <span class=n>double_result</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>RepEval</span><span class=p>(</span><span class=s1>&#39;result * 2&#39;</span><span class=p>))</span>
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a><span class=go>(Rep(template=&#39;result&#39;, context=None, strict=None, eval_id=None),)</span>
</span><span id=__span-10-16><a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a><span class=go>{&#39;double_result&#39;: RepEval(template=&#39;result * 2&#39;, context=None, strict=None, eval_id=None)}</span>
</span><span id=__span-10-17><a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a><span class=go>(100,)</span>
</span><span id=__span-10-18><a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a><span class=go>{&#39;double_result&#39;: 200}</span>
</span></code></pre></div> <ol> <li>New context</li> </ol> <h2 id=base>Base<a class=headerlink href=#base title="Permanent link">&para;</a></h2> <pre class=mermaid><code>flowchart TD;
    Grouper --&gt;|inherits| Configured;
    ArrayWrapper --&gt;|inherits| Configured;
    ArrayWrapper --&gt;|inherits| PandasIndexer;
    ArrayWrapper -.-&gt;|references| Grouper;
    Wrapping --&gt;|inherits| Configured;
    Wrapping --&gt;|inherits| PandasIndexer;
    Wrapping --&gt;|inherits| AttrResolverMixin;
    Wrapping -.-&gt;|references| ArrayWrapper;
    BaseAccessor --&gt;|inherits| Wrapping;</code></pre> <p>The <a href=https://vectorbt.pro/pvt_41531c19/api/base/ >base</a> subpackage is the non-computational core of VBT. It offers a variety of modules for working with and converting between Pandas and NumPy objects. In particular, it provides functions and classes for broadcasting, combining, and wrapping NumPy arrays, grouping columns, managing <a href=https://pandas.pydata.org/pandas-docs/stable/user_guide/advanced.html>MultiIndex</a>, and more. These operations are essential for extending Pandas and reproducing some of its functionality in custom classes.</p> <h3 id=grouping>Grouping<a class=headerlink href=#grouping title="Permanent link">&para;</a></h3> <p>Since VBT is often used to process multi-column data, where each column (or "line") represents a separate backtesting instance, being able to group these columns into different groups is an essential feature.</p> <p>The <a href=https://vectorbt.pro/pvt_41531c19/api/base/grouping/#vectorbtpro.base.grouping.base.Grouper>Grouper</a> class provides functionality to validate and build groups from any Pandas Index, especially columns. It can translate various metadata, such as <a href=https://pandas.pydata.org/docs/reference/groupby.html>GroupBy objects</a> and column levels, into special NumPy arrays that can be used by Numba-compiled functions to aggregate multiple columns of data. This is particularly useful for multi-asset portfolios, where each group contains one or more assets.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>columns</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>MultiIndex</span><span class=o>.</span><span class=n>from_tuples</span><span class=p>([</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=gp>... </span>    <span class=p>(</span><span class=s1>&#39;BTC-USD&#39;</span><span class=p>,</span> <span class=s1>&#39;group1&#39;</span><span class=p>),</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=gp>... </span>    <span class=p>(</span><span class=s1>&#39;ETH-USD&#39;</span><span class=p>,</span> <span class=s1>&#39;group1&#39;</span><span class=p>),</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=gp>... </span>    <span class=p>(</span><span class=s1>&#39;ADA-USD&#39;</span><span class=p>,</span> <span class=s1>&#39;group2&#39;</span><span class=p>),</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=gp>... </span>    <span class=p>(</span><span class=s1>&#39;SOL-USD&#39;</span><span class=p>,</span> <span class=s1>&#39;group2&#39;</span><span class=p>)</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=gp>... </span><span class=p>],</span> <span class=n>names</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;symbol&#39;</span><span class=p>,</span> <span class=s1>&#39;group&#39;</span><span class=p>])</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Grouper</span><span class=p>(</span><span class=n>columns</span><span class=p>,</span> <span class=s1>&#39;group&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>get_groups</span><span class=p>()</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=go>array([0, 0, 1, 1])</span>
</span></code></pre></div> <h3 id=indexing>Indexing<a class=headerlink href=#indexing title="Permanent link">&para;</a></h3> <p>In VBT, the main purpose of indexing is to provide Pandas-style indexing to any custom class that holds Pandas-like objects, allowing you to select rows, columns, and groups in each object. This is done by forwarding a Pandas indexing operation to each Pandas-like object and instantiating the class using them. This can be done easily with <a href=https://vectorbt.pro/pvt_41531c19/api/utils/config/#vectorbtpro.utils.config.Configured>Configured</a>. With this approach, you can index complex classes that contain many Pandas-like objects using a single command.</p> <p>The main indexer class, <a href=https://vectorbt.pro/pvt_41531c19/api/base/indexing/#vectorbtpro.base.indexing.PandasIndexer>PandasIndexer</a>, mimics a regular Pandas object by exposing the properties <a href=https://vectorbt.pro/pvt_41531c19/api/base/indexing/#vectorbtpro.base.indexing.PandasIndexer.iloc>PandasIndexer.iloc</a>, <a href=https://vectorbt.pro/pvt_41531c19/api/base/indexing/#vectorbtpro.base.indexing.PandasIndexer.loc>PandasIndexer.loc</a>, and <a href=https://vectorbt.pro/pvt_41531c19/api/base/indexing/#vectorbtpro.base.indexing.PandasIndexer.xs>PandasIndexer.xs</a>. To use this, simply subclass this class and override <a href=https://vectorbt.pro/pvt_41531c19/api/base/indexing/#vectorbtpro.base.indexing.IndexingBase.indexing_func>IndexingBase.indexing_func</a>, which should accept <code>pd_indexing_func</code>, apply it to each Pandas-like object, and initialize a new instance.</p> <p>Let's extend our previously created <code>CorrStats</code> class with Pandas indexing:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>class</span><span class=w> </span><span class=nc>CorrStats</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>Configured</span><span class=p>,</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PandasIndexer</span><span class=p>):</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=gp>... </span>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>obj1</span><span class=p>,</span> <span class=n>obj2</span><span class=p>):</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=gp>... </span>        <span class=n>vbt</span><span class=o>.</span><span class=n>Configured</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>obj1</span><span class=o>=</span><span class=n>obj1</span><span class=p>,</span> <span class=n>obj2</span><span class=o>=</span><span class=n>obj2</span><span class=p>)</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=gp>... </span>        <span class=n>vbt</span><span class=o>.</span><span class=n>PandasIndexer</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=gp>...</span>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=gp>... </span>        <span class=bp>self</span><span class=o>.</span><span class=n>_obj1</span> <span class=o>=</span> <span class=n>obj1</span>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=gp>... </span>        <span class=bp>self</span><span class=o>.</span><span class=n>_obj2</span> <span class=o>=</span> <span class=n>obj2</span>
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=gp>...</span>
</span><span id=__span-12-9><a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=gp>... </span>    <span class=k>def</span><span class=w> </span><span class=nf>indexing_func</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>pd_indexing_func</span><span class=p>):</span>  <span class=c1># (1)!</span>
</span><span id=__span-12-10><a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=gp>... </span>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span>
</span><span id=__span-12-11><a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=gp>... </span>            <span class=n>obj1</span><span class=o>=</span><span class=n>pd_indexing_func</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>obj1</span><span class=p>),</span>
</span><span id=__span-12-12><a id=__codelineno-12-12 name=__codelineno-12-12 href=#__codelineno-12-12></a><span class=gp>... </span>            <span class=n>obj2</span><span class=o>=</span><span class=n>pd_indexing_func</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>obj2</span><span class=p>)</span>
</span><span id=__span-12-13><a id=__codelineno-12-13 name=__codelineno-12-13 href=#__codelineno-12-13></a><span class=gp>... </span>        <span class=p>)</span>
</span><span id=__span-12-14><a id=__codelineno-12-14 name=__codelineno-12-14 href=#__codelineno-12-14></a><span class=gp>...</span>
</span><span id=__span-12-15><a id=__codelineno-12-15 name=__codelineno-12-15 href=#__codelineno-12-15></a><span class=gp>... </span>    <span class=nd>@property</span>
</span><span id=__span-12-16><a id=__codelineno-12-16 name=__codelineno-12-16 href=#__codelineno-12-16></a><span class=gp>... </span>    <span class=k>def</span><span class=w> </span><span class=nf>obj1</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-12-17><a id=__codelineno-12-17 name=__codelineno-12-17 href=#__codelineno-12-17></a><span class=gp>... </span>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_obj1</span>
</span><span id=__span-12-18><a id=__codelineno-12-18 name=__codelineno-12-18 href=#__codelineno-12-18></a><span class=gp>...</span>
</span><span id=__span-12-19><a id=__codelineno-12-19 name=__codelineno-12-19 href=#__codelineno-12-19></a><span class=gp>... </span>    <span class=nd>@property</span>
</span><span id=__span-12-20><a id=__codelineno-12-20 name=__codelineno-12-20 href=#__codelineno-12-20></a><span class=gp>... </span>    <span class=k>def</span><span class=w> </span><span class=nf>obj2</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-12-21><a id=__codelineno-12-21 name=__codelineno-12-21 href=#__codelineno-12-21></a><span class=gp>... </span>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_obj2</span>
</span><span id=__span-12-22><a id=__codelineno-12-22 name=__codelineno-12-22 href=#__codelineno-12-22></a><span class=gp>...</span>
</span><span id=__span-12-23><a id=__codelineno-12-23 name=__codelineno-12-23 href=#__codelineno-12-23></a><span class=gp>... </span>    <span class=k>def</span><span class=w> </span><span class=nf>corr</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-12-24><a id=__codelineno-12-24 name=__codelineno-12-24 href=#__codelineno-12-24></a><span class=gp>... </span>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>obj1</span><span class=p>,</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>):</span>
</span><span id=__span-12-25><a id=__codelineno-12-25 name=__codelineno-12-25 href=#__codelineno-12-25></a><span class=gp>... </span>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>obj1</span><span class=o>.</span><span class=n>corr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>obj2</span><span class=p>)</span>
</span><span id=__span-12-26><a id=__codelineno-12-26 name=__codelineno-12-26 href=#__codelineno-12-26></a><span class=gp>... </span>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>obj1</span><span class=o>.</span><span class=n>corrwith</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>obj2</span><span class=p>)</span>
</span><span id=__span-12-27><a id=__codelineno-12-27 name=__codelineno-12-27 href=#__codelineno-12-27></a><span class=gp>...</span>
</span><span id=__span-12-28><a id=__codelineno-12-28 name=__codelineno-12-28 href=#__codelineno-12-28></a><span class=gp>... </span>    <span class=k>def</span><span class=w> </span><span class=nf>rolling_corr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>window</span><span class=p>):</span>
</span><span id=__span-12-29><a id=__codelineno-12-29 name=__codelineno-12-29 href=#__codelineno-12-29></a><span class=gp>... </span>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>obj1</span><span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=n>window</span><span class=p>)</span><span class=o>.</span><span class=n>corr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>obj2</span><span class=p>)</span>
</span><span id=__span-12-30><a id=__codelineno-12-30 name=__codelineno-12-30 href=#__codelineno-12-30></a>
</span><span id=__span-12-31><a id=__codelineno-12-31 name=__codelineno-12-31 href=#__codelineno-12-31></a><span class=gp>&gt;&gt;&gt; </span><span class=n>corrstats</span> <span class=o>=</span> <span class=n>CorrStats</span><span class=p>(</span><span class=n>df1</span><span class=p>,</span> <span class=n>df2</span><span class=p>)</span>
</span><span id=__span-12-32><a id=__codelineno-12-32 name=__codelineno-12-32 href=#__codelineno-12-32></a><span class=gp>&gt;&gt;&gt; </span><span class=n>corrstats</span><span class=o>.</span><span class=n>corr</span><span class=p>()</span>
</span><span id=__span-12-33><a id=__codelineno-12-33 name=__codelineno-12-33 href=#__codelineno-12-33></a><span class=go>a    0.3</span>
</span><span id=__span-12-34><a id=__codelineno-12-34 name=__codelineno-12-34 href=#__codelineno-12-34></a><span class=go>b   -0.3</span>
</span><span id=__span-12-35><a id=__codelineno-12-35 name=__codelineno-12-35 href=#__codelineno-12-35></a><span class=go>dtype: float64</span>
</span><span id=__span-12-36><a id=__codelineno-12-36 name=__codelineno-12-36 href=#__codelineno-12-36></a>
</span><span id=__span-12-37><a id=__codelineno-12-37 name=__codelineno-12-37 href=#__codelineno-12-37></a><span class=gp>&gt;&gt;&gt; </span><span class=n>corrstats</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=s1>&#39;2020-01-01&#39;</span><span class=p>:</span><span class=s1>&#39;2020-01-03&#39;</span><span class=p>,</span> <span class=s1>&#39;a&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>corr</span><span class=p>()</span>  <span class=c1># (2)!</span>
</span><span id=__span-12-38><a id=__codelineno-12-38 name=__codelineno-12-38 href=#__codelineno-12-38></a><span class=go>0.24019223070763066</span>
</span></code></pre></div> <ol> <li>Here, <code>pd_indexing_func</code> is simply <code>lambda x: x.loc[key]</code>.</li> <li>Running the correlation coefficient on a subset of data.</li> </ol> <p>We just indexed two Pandas objects as a single entity. Yay!</p> <h3 id=wrapping>Wrapping<a class=headerlink href=#wrapping title="Permanent link">&para;</a></h3> <p>Remember that VBT specializes in taking a Pandas object, extracting its NumPy array, processing the array, and converting the results back to a Pandas format? The last part is handled by the <a href=https://vectorbt.pro/pvt_41531c19/api/base/wrapping/#vectorbtpro.base.wrapping.ArrayWrapper>ArrayWrapper</a> class, which captures all the necessary metadata, such as the index, columns, and number of dimensions, and provides methods like <a href=https://vectorbt.pro/pvt_41531c19/api/base/wrapping/#vectorbtpro.base.wrapping.ArrayWrapper.wrap>ArrayWrapper.wrap</a> to convert a NumPy object back into a Pandas format.</p> <p>The <a href=https://vectorbt.pro/pvt_41531c19/api/base/wrapping/#vectorbtpro.base.wrapping.ArrayWrapper>ArrayWrapper</a> class integrates many concepts we discussed earlier to behave like a (supercharged) Pandas object. Notably, it uses <a href=#grouping>Grouping</a> to build and manage groups of columns and <a href=#indexing>Indexing</a> to select rows, columns, and groups with Pandas-style indexing. Some of the most powerful features of an array wrapper are 1) the ability to behave like a grouped object, which is not possible with Pandas alone, and 2) the ability to translate a Pandas indexing operation into a range of integer arrays that can be used to index NumPy arrays. This allows for indexing without having to hold Pandas objects, just the wrapper.</p> <p>You can construct a wrapper in several ways, with the easiest being from a Pandas object:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=gp>... </span>    <span class=s1>&#39;a&#39;</span><span class=p>:</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>5</span><span class=p>),</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=gp>... </span>    <span class=s1>&#39;b&#39;</span><span class=p>:</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>10</span><span class=p>),</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=gp>... </span>    <span class=s1>&#39;c&#39;</span><span class=p>:</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>15</span><span class=p>),</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=gp>... </span>    <span class=s1>&#39;d&#39;</span><span class=p>:</span> <span class=nb>range</span><span class=p>(</span><span class=mi>15</span><span class=p>,</span> <span class=mi>20</span><span class=p>)</span>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=gp>... </span><span class=p>},</span> <span class=n>index</span><span class=o>=</span><span class=n>index</span><span class=p>)</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>wrapper</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>ArrayWrapper</span><span class=o>.</span><span class=n>from_obj</span><span class=p>(</span><span class=n>df</span><span class=p>)</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=gp>&gt;&gt;&gt; </span><span class=nb>print</span><span class=p>(</span><span class=n>wrapper</span><span class=p>)</span>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=go>ArrayWrapper(</span>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=go>    index=&lt;DatetimeIndex object at 0x7ff6d8528d68 of shape (5,)&gt;,</span>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=go>    columns=&lt;Index object at 0x7ff6d857fcc0 of shape (4,)&gt;,</span>
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a><span class=go>    ndim=2,</span>
</span><span id=__span-13-13><a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=go>    freq=None,</span>
</span><span id=__span-13-14><a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a><span class=go>    column_only_select=None,</span>
</span><span id=__span-13-15><a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a><span class=go>    group_select=None,</span>
</span><span id=__span-13-16><a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a><span class=go>    grouped_ndim=None,</span>
</span><span id=__span-13-17><a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a><span class=go>    grouper=Grouper(</span>
</span><span id=__span-13-18><a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a><span class=go>        index=&lt;Index object at 0x7ff6d857fcc0 of shape (4,)&gt;,</span>
</span><span id=__span-13-19><a id=__codelineno-13-19 name=__codelineno-13-19 href=#__codelineno-13-19></a><span class=go>        group_by=None,</span>
</span><span id=__span-13-20><a id=__codelineno-13-20 name=__codelineno-13-20 href=#__codelineno-13-20></a><span class=go>        allow_enable=True,</span>
</span><span id=__span-13-21><a id=__codelineno-13-21 name=__codelineno-13-21 href=#__codelineno-13-21></a><span class=go>        allow_disable=True,</span>
</span><span id=__span-13-22><a id=__codelineno-13-22 name=__codelineno-13-22 href=#__codelineno-13-22></a><span class=go>        allow_modify=True</span>
</span><span id=__span-13-23><a id=__codelineno-13-23 name=__codelineno-13-23 href=#__codelineno-13-23></a><span class=go>    )</span>
</span><span id=__span-13-24><a id=__codelineno-13-24 name=__codelineno-13-24 href=#__codelineno-13-24></a><span class=go>)</span>
</span></code></pre></div> <p>Now, let's create a function that sums all elements in each column using NumPy and returns a standard Pandas object:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>sum_per_column</span><span class=p>(</span><span class=n>df</span><span class=p>):</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=gp>... </span>    <span class=n>wrapper</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>ArrayWrapper</span><span class=o>.</span><span class=n>from_obj</span><span class=p>(</span><span class=n>df</span><span class=p>)</span>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=gp>... </span>    <span class=n>result</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>df</span><span class=o>.</span><span class=n>values</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>wrapper</span><span class=o>.</span><span class=n>wrap_reduced</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sum_per_column</span><span class=p>(</span><span class=n>df</span><span class=p>)</span>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=go>a    10</span>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=go>b    35</span>
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=go>c    60</span>
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=go>d    85</span>
</span><span id=__span-14-11><a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a><span class=go>dtype: int64</span>
</span></code></pre></div> <p>The function above is already 20x faster than Pandas <img alt=ðŸ¤¯ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f92f.svg title=:exploding_head:></p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>big_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=n>size</span><span class=o>=</span><span class=p>(</span><span class=mi>1000</span><span class=p>,</span> <span class=mi>1000</span><span class=p>)))</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=gp>&gt;&gt;&gt; </span><span class=o>%</span><span class=n>timeit</span> <span class=n>big_df</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=go>2.52 ms Â± 3.5 Âµs per loop (mean Â± std. dev. of 7 runs, 100 loops each)</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=gp>&gt;&gt;&gt; </span><span class=o>%</span><span class=n>timeit</span> <span class=n>sum_per_column</span><span class=p>(</span><span class=n>big_df</span><span class=p>)</span>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=go>428 Âµs Â± 1.5 Âµs per loop (mean Â± std. dev. of 7 runs, 1000 loops each)</span>
</span></code></pre></div> <p>Since <a href=https://vectorbt.pro/pvt_41531c19/api/base/wrapping/#vectorbtpro.base.wrapping.ArrayWrapper>ArrayWrapper</a> can manage groups of columns, let's adapt our function to sum all elements over each group of columns:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>sum_per_group</span><span class=p>(</span><span class=n>df</span><span class=p>,</span> <span class=n>group_by</span><span class=p>):</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=gp>... </span>    <span class=n>wrapper</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>ArrayWrapper</span><span class=o>.</span><span class=n>from_obj</span><span class=p>(</span><span class=n>df</span><span class=p>,</span> <span class=n>group_by</span><span class=o>=</span><span class=n>group_by</span><span class=p>)</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=gp>... </span>    <span class=n>results</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>group_idxs</span> <span class=ow>in</span> <span class=n>wrapper</span><span class=o>.</span><span class=n>grouper</span><span class=o>.</span><span class=n>iter_group_idxs</span><span class=p>():</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=gp>... </span>        <span class=n>group_result</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>df</span><span class=o>.</span><span class=n>values</span><span class=p>[:,</span> <span class=n>group_idxs</span><span class=p>])</span>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=gp>... </span>        <span class=n>results</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>group_result</span><span class=p>)</span>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>wrapper</span><span class=o>.</span><span class=n>wrap_reduced</span><span class=p>(</span><span class=n>results</span><span class=p>)</span>
</span><span id=__span-16-8><a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a>
</span><span id=__span-16-9><a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sum_per_group</span><span class=p>(</span><span class=n>df</span><span class=p>,</span> <span class=kc>False</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-16-10><a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a><span class=go>a    10</span>
</span><span id=__span-16-11><a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a><span class=go>b    35</span>
</span><span id=__span-16-12><a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a><span class=go>c    60</span>
</span><span id=__span-16-13><a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a><span class=go>d    85</span>
</span><span id=__span-16-14><a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a><span class=go>dtype: int64</span>
</span><span id=__span-16-15><a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a>
</span><span id=__span-16-16><a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sum_per_group</span><span class=p>(</span><span class=n>df</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-16-17><a id=__codelineno-16-17 name=__codelineno-16-17 href=#__codelineno-16-17></a><span class=go>190</span>
</span><span id=__span-16-18><a id=__codelineno-16-18 name=__codelineno-16-18 href=#__codelineno-16-18></a>
</span><span id=__span-16-19><a id=__codelineno-16-19 name=__codelineno-16-19 href=#__codelineno-16-19></a><span class=gp>&gt;&gt;&gt; </span><span class=n>group_by</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Index</span><span class=p>([</span><span class=s1>&#39;group1&#39;</span><span class=p>,</span> <span class=s1>&#39;group1&#39;</span><span class=p>,</span> <span class=s1>&#39;group2&#39;</span><span class=p>,</span> <span class=s1>&#39;group2&#39;</span><span class=p>])</span>
</span><span id=__span-16-20><a id=__codelineno-16-20 name=__codelineno-16-20 href=#__codelineno-16-20></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sum_per_group</span><span class=p>(</span><span class=n>df</span><span class=p>,</span> <span class=n>group_by</span><span class=p>)</span>  <span class=c1># (3)!</span>
</span><span id=__span-16-21><a id=__codelineno-16-21 name=__codelineno-16-21 href=#__codelineno-16-21></a><span class=go>group1     45</span>
</span><span id=__span-16-22><a id=__codelineno-16-22 name=__codelineno-16-22 href=#__codelineno-16-22></a><span class=go>group2    145</span>
</span><span id=__span-16-23><a id=__codelineno-16-23 name=__codelineno-16-23 href=#__codelineno-16-23></a><span class=go>dtype: int64</span>
</span></code></pre></div> <ol> <li>No grouping (one group per column).</li> <li>One group with all columns.</li> <li>Multiple groups with multiple columns.</li> </ol> <p>To avoid creating multiple array wrappers with the same metadata, the <a href=https://vectorbt.pro/pvt_41531c19/api/base/wrapping/#vectorbtpro.base.wrapping.Wrapping>Wrapping</a> class binds a single instance of <a href=https://vectorbt.pro/pvt_41531c19/api/base/wrapping/#vectorbtpro.base.wrapping.ArrayWrapper>ArrayWrapper</a> to manage any number of array-like objects with compatible shapes. Instead of accepting multiple Pandas objects, it takes an array wrapper and any number of objects and arrays in any format (preferably NumPy), and wraps them using this wrapper. In addition, any <a href=https://vectorbt.pro/pvt_41531c19/api/base/wrapping/#vectorbtpro.base.wrapping.Wrapping>Wrapping</a> subclass can use its wrapper to perform Pandas indexing on any kind of object, including NumPy arrays. This is possible because <a href=https://vectorbt.pro/pvt_41531c19/api/base/wrapping/#vectorbtpro.base.wrapping.ArrayWrapper>ArrayWrapper</a> can translate a Pandas indexing operation into universal row, column, and group indices.</p> <p>Returning to our <code>CorrStats</code> class, there are two issues with the current implementation:</p> <ol> <li>Both metrics require Pandas objects with exactly the same layouts as inputs.</li> <li>Both metrics are computed using Pandas, which is relatively slow.</li> </ol> <p>Let's upgrade our <code>CorrStats</code> class to work on NumPy arrays and with an array wrapper:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>class</span><span class=w> </span><span class=nc>CorrStats</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>Wrapping</span><span class=p>):</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=gp>... </span>    <span class=n>_expected_keys</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Wrapping</span><span class=o>.</span><span class=n>_expected_keys</span> <span class=o>|</span> <span class=p>{</span><span class=s2>&quot;obj1&quot;</span><span class=p>,</span> <span class=s2>&quot;obj2&quot;</span><span class=p>}</span>  <span class=c1># (1)!</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=gp>...</span>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=gp>... </span>    <span class=nd>@classmethod</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=gp>... </span>    <span class=k>def</span><span class=w> </span><span class=nf>from_objs</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>obj1</span><span class=p>,</span> <span class=n>obj2</span><span class=p>):</span>  <span class=c1># (2)!</span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=gp>... </span>        <span class=p>(</span><span class=n>obj1</span><span class=p>,</span> <span class=n>obj2</span><span class=p>),</span> <span class=n>wrapper</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>broadcast</span><span class=p>(</span>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=gp>... </span>            <span class=n>obj1</span><span class=p>,</span> <span class=n>obj2</span><span class=p>,</span> 
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class=gp>... </span>            <span class=n>to_pd</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a><span class=gp>... </span>            <span class=n>return_wrapper</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a><span class=gp>... </span>        <span class=p>)</span>
</span><span id=__span-17-11><a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=gp>... </span>        <span class=k>return</span> <span class=bp>cls</span><span class=p>(</span><span class=n>wrapper</span><span class=p>,</span> <span class=n>obj1</span><span class=p>,</span> <span class=n>obj2</span><span class=p>)</span>
</span><span id=__span-17-12><a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a><span class=gp>...</span>
</span><span id=__span-17-13><a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a><span class=gp>... </span>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>wrapper</span><span class=p>,</span> <span class=n>obj1</span><span class=p>,</span> <span class=n>obj2</span><span class=p>):</span>
</span><span id=__span-17-14><a id=__codelineno-17-14 name=__codelineno-17-14 href=#__codelineno-17-14></a><span class=gp>... </span>        <span class=n>vbt</span><span class=o>.</span><span class=n>Wrapping</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>wrapper</span><span class=p>,</span> <span class=n>obj1</span><span class=o>=</span><span class=n>obj1</span><span class=p>,</span> <span class=n>obj2</span><span class=o>=</span><span class=n>obj2</span><span class=p>)</span>
</span><span id=__span-17-15><a id=__codelineno-17-15 name=__codelineno-17-15 href=#__codelineno-17-15></a><span class=gp>...</span>
</span><span id=__span-17-16><a id=__codelineno-17-16 name=__codelineno-17-16 href=#__codelineno-17-16></a><span class=gp>... </span>        <span class=bp>self</span><span class=o>.</span><span class=n>_obj1</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>to_2d_array</span><span class=p>(</span><span class=n>obj1</span><span class=p>)</span>
</span><span id=__span-17-17><a id=__codelineno-17-17 name=__codelineno-17-17 href=#__codelineno-17-17></a><span class=gp>... </span>        <span class=bp>self</span><span class=o>.</span><span class=n>_obj2</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>to_2d_array</span><span class=p>(</span><span class=n>obj2</span><span class=p>)</span>
</span><span id=__span-17-18><a id=__codelineno-17-18 name=__codelineno-17-18 href=#__codelineno-17-18></a><span class=gp>...</span>
</span><span id=__span-17-19><a id=__codelineno-17-19 name=__codelineno-17-19 href=#__codelineno-17-19></a><span class=gp>... </span>    <span class=k>def</span><span class=w> </span><span class=nf>indexing_func</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>pd_indexing_func</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>  <span class=c1># (3)!</span>
</span><span id=__span-17-20><a id=__codelineno-17-20 name=__codelineno-17-20 href=#__codelineno-17-20></a><span class=gp>... </span>        <span class=n>wrapper_meta</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>wrapper</span><span class=o>.</span><span class=n>indexing_func_meta</span><span class=p>(</span><span class=n>pd_indexing_func</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-17-21><a id=__codelineno-17-21 name=__codelineno-17-21 href=#__codelineno-17-21></a><span class=gp>... </span>        <span class=n>new_wrapper</span> <span class=o>=</span> <span class=n>wrapper_meta</span><span class=p>[</span><span class=s2>&quot;new_wrapper&quot;</span><span class=p>]</span>
</span><span id=__span-17-22><a id=__codelineno-17-22 name=__codelineno-17-22 href=#__codelineno-17-22></a><span class=gp>... </span>        <span class=n>row_idxs</span> <span class=o>=</span> <span class=n>wrapper_meta</span><span class=p>[</span><span class=s2>&quot;row_idxs&quot;</span><span class=p>]</span>
</span><span id=__span-17-23><a id=__codelineno-17-23 name=__codelineno-17-23 href=#__codelineno-17-23></a><span class=gp>... </span>        <span class=n>col_idxs</span> <span class=o>=</span> <span class=n>wrapper_meta</span><span class=p>[</span><span class=s2>&quot;col_idxs&quot;</span><span class=p>]</span>
</span><span id=__span-17-24><a id=__codelineno-17-24 name=__codelineno-17-24 href=#__codelineno-17-24></a><span class=gp>... </span>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span>
</span><span id=__span-17-25><a id=__codelineno-17-25 name=__codelineno-17-25 href=#__codelineno-17-25></a><span class=gp>... </span>            <span class=n>wrapper</span><span class=o>=</span><span class=n>new_wrapper</span><span class=p>,</span>
</span><span id=__span-17-26><a id=__codelineno-17-26 name=__codelineno-17-26 href=#__codelineno-17-26></a><span class=gp>... </span>            <span class=n>obj1</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>obj1</span><span class=p>[</span><span class=n>row_idxs</span><span class=p>,</span> <span class=p>:][:,</span> <span class=n>col_idxs</span><span class=p>],</span>
</span><span id=__span-17-27><a id=__codelineno-17-27 name=__codelineno-17-27 href=#__codelineno-17-27></a><span class=gp>... </span>            <span class=n>obj2</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>obj2</span><span class=p>[</span><span class=n>row_idxs</span><span class=p>,</span> <span class=p>:][:,</span> <span class=n>col_idxs</span><span class=p>]</span>
</span><span id=__span-17-28><a id=__codelineno-17-28 name=__codelineno-17-28 href=#__codelineno-17-28></a><span class=gp>... </span>        <span class=p>)</span>
</span><span id=__span-17-29><a id=__codelineno-17-29 name=__codelineno-17-29 href=#__codelineno-17-29></a><span class=gp>...</span>
</span><span id=__span-17-30><a id=__codelineno-17-30 name=__codelineno-17-30 href=#__codelineno-17-30></a><span class=gp>... </span>    <span class=nd>@property</span>
</span><span id=__span-17-31><a id=__codelineno-17-31 name=__codelineno-17-31 href=#__codelineno-17-31></a><span class=gp>... </span>    <span class=k>def</span><span class=w> </span><span class=nf>obj1</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-17-32><a id=__codelineno-17-32 name=__codelineno-17-32 href=#__codelineno-17-32></a><span class=gp>... </span>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_obj1</span>
</span><span id=__span-17-33><a id=__codelineno-17-33 name=__codelineno-17-33 href=#__codelineno-17-33></a><span class=gp>...</span>
</span><span id=__span-17-34><a id=__codelineno-17-34 name=__codelineno-17-34 href=#__codelineno-17-34></a><span class=gp>... </span>    <span class=nd>@property</span>
</span><span id=__span-17-35><a id=__codelineno-17-35 name=__codelineno-17-35 href=#__codelineno-17-35></a><span class=gp>... </span>    <span class=k>def</span><span class=w> </span><span class=nf>obj2</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-17-36><a id=__codelineno-17-36 name=__codelineno-17-36 href=#__codelineno-17-36></a><span class=gp>... </span>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_obj2</span>
</span><span id=__span-17-37><a id=__codelineno-17-37 name=__codelineno-17-37 href=#__codelineno-17-37></a><span class=gp>...</span>
</span><span id=__span-17-38><a id=__codelineno-17-38 name=__codelineno-17-38 href=#__codelineno-17-38></a><span class=gp>... </span>    <span class=k>def</span><span class=w> </span><span class=nf>corr</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>  <span class=c1># (4)!</span>
</span><span id=__span-17-39><a id=__codelineno-17-39 name=__codelineno-17-39 href=#__codelineno-17-39></a><span class=gp>... </span>        <span class=n>out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>nancorr_nb</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>obj1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>obj2</span><span class=p>)</span>
</span><span id=__span-17-40><a id=__codelineno-17-40 name=__codelineno-17-40 href=#__codelineno-17-40></a><span class=gp>... </span>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>wrapper</span><span class=o>.</span><span class=n>wrap_reduced</span><span class=p>(</span><span class=n>out</span><span class=p>)</span>
</span><span id=__span-17-41><a id=__codelineno-17-41 name=__codelineno-17-41 href=#__codelineno-17-41></a><span class=gp>...</span>
</span><span id=__span-17-42><a id=__codelineno-17-42 name=__codelineno-17-42 href=#__codelineno-17-42></a><span class=gp>... </span>    <span class=k>def</span><span class=w> </span><span class=nf>rolling_corr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>window</span><span class=p>):</span>
</span><span id=__span-17-43><a id=__codelineno-17-43 name=__codelineno-17-43 href=#__codelineno-17-43></a><span class=gp>... </span>        <span class=n>out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>rolling_corr_nb</span><span class=p>(</span>
</span><span id=__span-17-44><a id=__codelineno-17-44 name=__codelineno-17-44 href=#__codelineno-17-44></a><span class=gp>... </span>            <span class=bp>self</span><span class=o>.</span><span class=n>obj1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>obj2</span><span class=p>,</span> 
</span><span id=__span-17-45><a id=__codelineno-17-45 name=__codelineno-17-45 href=#__codelineno-17-45></a><span class=gp>... </span>            <span class=n>window</span><span class=p>,</span> <span class=n>minp</span><span class=o>=</span><span class=n>window</span><span class=p>)</span>
</span><span id=__span-17-46><a id=__codelineno-17-46 name=__codelineno-17-46 href=#__codelineno-17-46></a><span class=gp>... </span>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>wrapper</span><span class=o>.</span><span class=n>wrap</span><span class=p>(</span><span class=n>out</span><span class=p>)</span>
</span></code></pre></div> <ol> <li>Specify the argument names that are passed to <a href=https://vectorbt.pro/pvt_41531c19/api/base/wrapping/#vectorbtpro.base.wrapping.Wrapping>Wrapping</a> (or set <code>_expected_keys=None</code> to disable).</li> <li>A convenient class method to broadcast objects, create a wrapper, and pass everything to the constructor.</li> <li>The indexing method uses the wrapper to translate <code>pd_indexing_func</code> to arrays of selected rows and columns, applies them to both NumPy arrays, and creates a new <code>CorrStats</code> instance.</li> <li>Computation is performed on NumPy arrays, and the result is converted into Pandas.</li> </ol> <p>As you may have noticed, we replaced the superclasses <a href=https://vectorbt.pro/pvt_41531c19/api/utils/config/#vectorbtpro.utils.config.Configured>Configured</a> and <a href=https://vectorbt.pro/pvt_41531c19/api/base/indexing/#vectorbtpro.base.indexing.PandasIndexer>PandasIndexer</a> with the single superclass <a href=https://vectorbt.pro/pvt_41531c19/api/base/wrapping/#vectorbtpro.base.wrapping.Wrapping>Wrapping</a>, which already inherits both. Another change is in the arguments taken by <code>CorrStats</code>: instead of taking two Pandas objects, it now accepts a <code>wrapper</code> of type <a href=https://vectorbt.pro/pvt_41531c19/api/base/wrapping/#vectorbtpro.base.wrapping.ArrayWrapper>ArrayWrapper</a> along with the NumPy arrays <code>obj1</code> and <code>obj2</code>. This has several benefits: we keep the Pandas metadata consistent and managed by a single variable, while all calculations are efficiently performed using only NumPy. Whenever we need to present results, we can call <a href=https://vectorbt.pro/pvt_41531c19/api/base/wrapping/#vectorbtpro.base.wrapping.ArrayWrapper.wrap_reduced>ArrayWrapper.wrap_reduced</a> and <a href=https://vectorbt.pro/pvt_41531c19/api/base/wrapping/#vectorbtpro.base.wrapping.ArrayWrapper.wrap>ArrayWrapper.wrap</a> to convert them back into Pandas format, as is done inside the <code>CorrStats.corr</code> and <code>CorrStats.rolling_corr</code> methods.</p> <p>Since we do not want to require users (or ourselves) to create an array wrapper manually, we also implemented the <code>CorrStats.from_objs</code> class method, which broadcasts both arrays and instantiates <code>CorrStats</code>. With this, you can provide any array-like objects, and <code>CorrStats</code> will automatically build the wrapper for you. Let's illustrate this by computing the correlation coefficient for <code>df1</code> and <code>df2</code>, and then for <code>df1</code> and a parameterized <code>df2</code>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>df1</span><span class=o>.</span><span class=n>corrwith</span><span class=p>(</span><span class=n>df2</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=go>a    0.3</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=go>b   -0.3</span>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=go>dtype: float64</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>corrstats</span> <span class=o>=</span> <span class=n>CorrStats</span><span class=o>.</span><span class=n>from_objs</span><span class=p>(</span><span class=n>df1</span><span class=p>,</span> <span class=n>df2</span><span class=p>)</span>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>corrstats</span><span class=o>.</span><span class=n>corr</span><span class=p>()</span>  <span class=c1># (2)!</span>
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a><span class=go>a    0.3</span>
</span><span id=__span-18-9><a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a><span class=go>b   -0.3</span>
</span><span id=__span-18-10><a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a><span class=go>dtype: float64</span>
</span><span id=__span-18-11><a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a>
</span><span id=__span-18-12><a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>df2_sh</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pd_acc</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span>
</span><span id=__span-18-13><a id=__codelineno-18-13 name=__codelineno-18-13 href=#__codelineno-18-13></a><span class=gp>... </span>    <span class=n>df2</span><span class=p>,</span> <span class=n>df2</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>shuffle</span><span class=p>(</span><span class=n>seed</span><span class=o>=</span><span class=mi>42</span><span class=p>),</span> 
</span><span id=__span-18-14><a id=__codelineno-18-14 name=__codelineno-18-14 href=#__codelineno-18-14></a><span class=gp>... </span>    <span class=n>keys</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;plain&#39;</span><span class=p>,</span> <span class=s1>&#39;shuffled&#39;</span><span class=p>])</span>
</span><span id=__span-18-15><a id=__codelineno-18-15 name=__codelineno-18-15 href=#__codelineno-18-15></a><span class=gp>&gt;&gt;&gt; </span><span class=n>df2_sh</span> 
</span><span id=__span-18-16><a id=__codelineno-18-16 name=__codelineno-18-16 href=#__codelineno-18-16></a><span class=go>              plain    shuffled   </span>
</span><span id=__span-18-17><a id=__codelineno-18-17 name=__codelineno-18-17 href=#__codelineno-18-17></a><span class=go>               a  b        a  b</span>
</span><span id=__span-18-18><a id=__codelineno-18-18 name=__codelineno-18-18 href=#__codelineno-18-18></a><span class=go>2020-01-01     1  5        2  2</span>
</span><span id=__span-18-19><a id=__codelineno-18-19 name=__codelineno-18-19 href=#__codelineno-18-19></a><span class=go>2020-01-02     2  4        5  4</span>
</span><span id=__span-18-20><a id=__codelineno-18-20 name=__codelineno-18-20 href=#__codelineno-18-20></a><span class=go>2020-01-03     3  3        3  3</span>
</span><span id=__span-18-21><a id=__codelineno-18-21 name=__codelineno-18-21 href=#__codelineno-18-21></a><span class=go>2020-01-04     4  2        1  5</span>
</span><span id=__span-18-22><a id=__codelineno-18-22 name=__codelineno-18-22 href=#__codelineno-18-22></a><span class=go>2020-01-05     5  1        4  1</span>
</span><span id=__span-18-23><a id=__codelineno-18-23 name=__codelineno-18-23 href=#__codelineno-18-23></a>
</span><span id=__span-18-24><a id=__codelineno-18-24 name=__codelineno-18-24 href=#__codelineno-18-24></a><span class=gp>&gt;&gt;&gt; </span><span class=n>df1</span><span class=o>.</span><span class=n>corrwith</span><span class=p>(</span><span class=n>df2_sh</span><span class=p>)</span>  <span class=c1># (3)!</span>
</span><span id=__span-18-25><a id=__codelineno-18-25 name=__codelineno-18-25 href=#__codelineno-18-25></a><span class=go>ValueError: cannot join with no overlapping index names</span>
</span><span id=__span-18-26><a id=__codelineno-18-26 name=__codelineno-18-26 href=#__codelineno-18-26></a>
</span><span id=__span-18-27><a id=__codelineno-18-27 name=__codelineno-18-27 href=#__codelineno-18-27></a><span class=gp>&gt;&gt;&gt; </span><span class=n>corrstats</span> <span class=o>=</span> <span class=n>CorrStats</span><span class=o>.</span><span class=n>from_objs</span><span class=p>(</span><span class=n>df1</span><span class=p>,</span> <span class=n>df2_sh</span><span class=p>)</span>
</span><span id=__span-18-28><a id=__codelineno-18-28 name=__codelineno-18-28 href=#__codelineno-18-28></a><span class=gp>&gt;&gt;&gt; </span><span class=n>corrstats</span><span class=o>.</span><span class=n>corr</span><span class=p>()</span>  <span class=c1># (4)!</span>
</span><span id=__span-18-29><a id=__codelineno-18-29 name=__codelineno-18-29 href=#__codelineno-18-29></a><span class=go>plain     a    0.3</span>
</span><span id=__span-18-30><a id=__codelineno-18-30 name=__codelineno-18-30 href=#__codelineno-18-30></a><span class=go>          b   -0.3</span>
</span><span id=__span-18-31><a id=__codelineno-18-31 name=__codelineno-18-31 href=#__codelineno-18-31></a><span class=go>shuffled  a    0.4</span>
</span><span id=__span-18-32><a id=__codelineno-18-32 name=__codelineno-18-32 href=#__codelineno-18-32></a><span class=go>          b   -0.9</span>
</span><span id=__span-18-33><a id=__codelineno-18-33 name=__codelineno-18-33 href=#__codelineno-18-33></a><span class=go>dtype: float64</span>
</span></code></pre></div> <ol> <li>Using Pandas.</li> <li>Using our class.</li> <li>Pandas fails to join due to no overlapping index names.</li> <li>VBT works thanks to smart broadcasting.</li> </ol> <p>Here is why we switched from Pandas to Numba:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>big_df1</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=n>size</span><span class=o>=</span><span class=p>(</span><span class=mi>1000</span><span class=p>,</span> <span class=mi>1000</span><span class=p>)))</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>big_df2</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>uniform</span><span class=p>(</span><span class=n>size</span><span class=o>=</span><span class=p>(</span><span class=mi>1000</span><span class=p>,</span> <span class=mi>1000</span><span class=p>)))</span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=gp>&gt;&gt;&gt; </span><span class=o>%</span><span class=n>timeit</span> <span class=n>big_df1</span><span class=o>.</span><span class=n>rolling</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span><span class=o>.</span><span class=n>corr</span><span class=p>(</span><span class=n>big_df2</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=go>271 ms Â± 13.2 ms per loop (mean Â± std. dev. of 7 runs, 1 loop each)</span>
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>corrstats</span> <span class=o>=</span> <span class=n>CorrStats</span><span class=o>.</span><span class=n>from_objs</span><span class=p>(</span><span class=n>big_df1</span><span class=p>,</span> <span class=n>big_df2</span><span class=p>)</span>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=gp>&gt;&gt;&gt; </span><span class=o>%</span><span class=n>timeit</span> <span class=n>corrstats</span><span class=o>.</span><span class=n>rolling_corr</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-19-9><a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=go>12 ms Â± 50.5 Âµs per loop (mean Â± std. dev. of 7 runs, 1 loop each)</span>
</span></code></pre></div> <ol> <li>Using Pandas.</li> <li>Using our class.</li> </ol> <p>There is also an improvement regarding indexing. Because <code>obj1</code> and <code>obj2</code> are no longer regular Pandas objects, we cannot simply apply <code>pd_indexing_func</code> to them. Instead, we use the method <a href=https://vectorbt.pro/pvt_41531c19/api/base/wrapping/#vectorbtpro.base.wrapping.ArrayWrapper.indexing_func_meta>ArrayWrapper.indexing_func_meta</a> to obtain the rows, columns, and groups that this operation would select. We then apply those arrays to both NumPy objects. This approach is especially useful because we can now select any data from the final shape.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>corrstats</span> <span class=o>=</span> <span class=n>CorrStats</span><span class=o>.</span><span class=n>from_objs</span><span class=p>(</span><span class=n>df1</span><span class=p>,</span> <span class=n>df2_sh</span><span class=p>)</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>corrstats</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=s1>&#39;2020-01-02&#39;</span><span class=p>:</span><span class=s1>&#39;2020-01-05&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>rolling_corr</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=go>                         plain            shuffled</span>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=go>                   a         b         a         b</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=go>2020-01-02       NaN       NaN       NaN       NaN</span>
</span><span id=__span-20-6><a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=go>2020-01-03       NaN       NaN       NaN       NaN</span>
</span><span id=__span-20-7><a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=go>2020-01-04 -0.327327  0.327327  0.327327 -0.981981</span>
</span><span id=__span-20-8><a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a><span class=go>2020-01-05  0.500000 -0.240192 -0.654654 -0.960769</span>
</span></code></pre></div> <ol> <li>Compute the rolling correlation coefficient only for 2020-01-02 through 2020-01-05.</li> </ol> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Not all classes support indexing on rows. To ensure you can select rows, check whether the instance property <code>column_only_select</code> is False.</p> </div> <p>This demonstrates how most high-tier classes in VBT are built. As a general rule:</p> <ul> <li>For performance, VBT typically follows this process: Pandas <img alt=âž¡ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/27a1.svg title=:arrow_right:> NumPy/Numba <img alt=âž¡ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/27a1.svg title=:arrow_right:> Pandas. The first stage builds a wrapper from Pandas objects, and the last stage uses the wrapper to present results to the user.</li> <li>Pandas metadata such as shape and index is accessible via the attribute <code>wrapper</code>. For example, <code>wrapper.ndim</code> returns the number of dimensions held by the current instance.</li> <li>Do not call classes directly. Use class methods, which usually begin with the prefix <code>from_</code>. The constructor <code>__init__</code> is most likely reserved for internal use during indexing. (This is why we use <code>vbt.MA.run()</code> instead of <code>vbt.MA()</code>.)</li> <li>The wrapper enables indexing of any objects that have elements aligned by row or column, even those with more complex layouts (see <a href=https://vectorbt.pro/pvt_41531c19/api/records/base/#vectorbtpro.records.base.Records>Records</a>).</li> </ul> <h3 id=base-accessor>Base accessor<a class=headerlink href=#base-accessor title="Permanent link">&para;</a></h3> <p>This subpackage also provides the <a href=https://vectorbt.pro/pvt_41531c19/api/base/accessors/#vectorbtpro.base.accessors.BaseAccessor>BaseAccessor</a>, which exposes many basic operations to the end user and serves as the superclass for all other accessors. It inherits from <a href=https://vectorbt.pro/pvt_41531c19/api/base/wrapping/#vectorbtpro.base.wrapping.Wrapping>Wrapping</a>, so it supports everything you can do with a custom <code>CorrStats</code> class. Why is it called the "base" accessor? Because it is the parent class for all other VBT accessors and provides core combining, reshaping, and indexing features. This includes functions such as <a href=https://vectorbt.pro/pvt_41531c19/api/base/accessors/#vectorbtpro.base.accessors.BaseAccessor.to_2d_array>BaseAccessor.to_2d_array</a>, which converts a Pandas object to a two-dimensional NumPy array.</p> <p>Accessing the accessor is straightforward:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>df</span><span class=o>.</span><span class=n>vbt</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=go>&lt;vectorbtpro.accessors.Vbt_DFAccessor at 0x7fe3c19f7d68&gt;</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>df</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>to_2d_array</span><span class=p>()</span>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=go>array([[ 0,  5, 10, 15],</span>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a><span class=go>       [ 1,  6, 11, 16],</span>
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a><span class=go>       [ 2,  7, 12, 17],</span>
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a><span class=go>       [ 3,  8, 13, 18],</span>
</span><span id=__span-21-9><a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a><span class=go>       [ 4,  9, 14, 19]])</span>
</span></code></pre></div> <p>In this example, <a href=https://vectorbt.pro/pvt_41531c19/api/accessors/#vectorbtpro.accessors.Vbt_DFAccessor>Vbt_DFAccessor</a> is the main accessor for DataFrames, and as you can see from its definition, <a href=https://vectorbt.pro/pvt_41531c19/api/base/accessors/#vectorbtpro.base.accessors.BaseAccessor>BaseAccessor</a> is one of its superclasses.</p> <p>Perhaps the most interesting method is <a href=https://vectorbt.pro/pvt_41531c19/api/base/accessors/#vectorbtpro.base.accessors.BaseAccessor.combine>BaseAccessor.combine</a>, which allows you to broadcast and combine the current Pandas object with any number of other array-like objects using the function <code>combine_func</code> (mainly with NumPy).</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>])</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>combine</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>]]),</span> <span class=n>np</span><span class=o>.</span><span class=n>add</span><span class=p>)</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=go>   0  1  2</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=go>0  5  6  7</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=go>1  6  7  8</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=go>2  7  8  9</span>
</span></code></pre></div> <p><a href=https://vectorbt.pro/pvt_41531c19/api/base/accessors/#vectorbtpro.base.accessors.BaseAccessor>BaseAccessor</a> also implements a range of <a href=https://vectorbt.pro/pvt_41531c19/api/utils/magic_decorators/#vectorbtpro.utils.magic_decorators.unary_magic_config>unary</a> and <a href=https://vectorbt.pro/pvt_41531c19/api/utils/magic_decorators/#vectorbtpro.utils.magic_decorators.binary_magic_config>binary</a> magic methods using this feature. For example, let's call <code>BaseAccessor.__add__</code>, which implements addition:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>])</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>]])</span>  <span class=c1># (1)!</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=go>ValueError: Length of values (1) does not match length of index (3)</span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>])</span><span class=o>.</span><span class=n>vbt</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>6</span><span class=p>]])</span>  <span class=c1># (2)!</span>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=go>   0  1  2</span>
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=go>0  5  6  7</span>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=go>1  6  7  8</span>
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=go>2  7  8  9</span>
</span></code></pre></div> <ol> <li>Without <code>.vbt</code>, Pandas performs the addition.</li> <li>With <code>.vbt</code>, VBT performs the addition.</li> </ol> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>To learn more about <img alt=ðŸª„ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1fa84.svg title=:magic_wand:> methods, see <a href=https://rszalski.github.io/magicmethods/ >A Guide to Python's Magic Methods</a>.</p> </div> <p>All of these magic methods were added using class decorators. There are many class decorators for various tasks in VBT. Usually, they take a config and attach many attributes at once in an automated way.</p> <h2 id=generic>Generic<a class=headerlink href=#generic title="Permanent link">&para;</a></h2> <pre class=mermaid><code>flowchart TD;
    Analyzable --&gt;|inherits| Wrapping;
    Analyzable --&gt;|inherits| StatsBuilderMixin;
    Analyzable --&gt;|inherits| PlotsBuilderMixin;
    GenericAccessor --&gt;|inherits| BaseAccessor;
    GenericAccessor --&gt;|inherits| Analyzable;</code></pre> <p>The <a href=https://vectorbt.pro/pvt_41531c19/api/generic/ >generic</a> subpackage serves as the computational core of VBT. It includes modules for processing and plotting time series and numeric data in a broader sense. Most importantly, it provides an <a href=https://vectorbt.pro/pvt_41531c19/api/generic/nb/ >arsenal</a> of Numba-compiled functions to accelerate and extend Pandas! These functions power many features of VBT, from indicators to portfolio analysis. For now, let's focus on classes that could enhance our <code>CorrStats</code> class.</p> <h3 id=builder-mixins>Builder mixins<a class=headerlink href=#builder-mixins title="Permanent link">&para;</a></h3> <p>Builder <a href=https://en.wikipedia.org/wiki/Mixin>mixins</a> are classes that, when subclassed by another class, enable building specific functionality from that class's attributes. Two main examples are <a href=https://vectorbt.pro/pvt_41531c19/api/generic/stats_builder/#vectorbtpro.generic.stats_builder.StatsBuilderMixin>StatsBuilderMixin</a> and <a href=https://vectorbt.pro/pvt_41531c19/api/generic/plots_builder/#vectorbtpro.generic.plots_builder.PlotsBuilderMixin>PlotsBuilderMixin</a>. The first provides the method <a href=https://vectorbt.pro/pvt_41531c19/api/generic/stats_builder/#vectorbtpro.generic.stats_builder.StatsBuilderMixin.stats>StatsBuilderMixin.stats</a> to compute various metrics. The second provides the method <a href=https://vectorbt.pro/pvt_41531c19/api/generic/plots_builder/#vectorbtpro.generic.plots_builder.PlotsBuilderMixin.plots>PlotsBuilderMixin.plots</a> to display different subplots. Nearly every class that can analyze data subclasses both.</p> <h3 id=analyzing>Analyzing<a class=headerlink href=#analyzing title="Permanent link">&para;</a></h3> <p>The <a href=https://vectorbt.pro/pvt_41531c19/api/generic/analyzable/#vectorbtpro.generic.analyzable.Analyzable>Analyzable</a> class combines <a href=https://vectorbt.pro/pvt_41531c19/api/base/wrapping/#vectorbtpro.base.wrapping.Wrapping>Wrapping</a> and the <a href=#builder-mixins>Builder mixins</a>. It brings together everything mentioned above to build a solid foundation for seamless data analysis. This is why it is subclassed by many high-level classes, such as <a href=https://vectorbt.pro/pvt_41531c19/api/portfolio/base/#vectorbtpro.portfolio.base.Portfolio>Portfolio</a> and <a href=https://vectorbt.pro/pvt_41531c19/api/records/base/#vectorbtpro.records.base.Records>Records</a>.</p> <p>So what are we waiting for? Let's adapt our <code>CorrStats</code> class to be analyzable!</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>class</span><span class=w> </span><span class=nc>CorrStats</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>Analyzable</span><span class=p>):</span>  <span class=c1># (1)!</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=gp>... </span>    <span class=n>_expected_keys</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Analyzable</span><span class=o>.</span><span class=n>_expected_keys</span> <span class=o>|</span> <span class=p>{</span><span class=s2>&quot;obj1&quot;</span><span class=p>,</span> <span class=s2>&quot;obj2&quot;</span><span class=p>}</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=gp>...</span>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=gp>... </span>    <span class=nd>@classmethod</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=gp>... </span>    <span class=k>def</span><span class=w> </span><span class=nf>from_objs</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>obj1</span><span class=p>,</span> <span class=n>obj2</span><span class=p>):</span>
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=gp>... </span>        <span class=p>(</span><span class=n>obj1</span><span class=p>,</span> <span class=n>obj2</span><span class=p>),</span> <span class=n>wrapper</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>broadcast</span><span class=p>(</span>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=gp>... </span>            <span class=n>obj1</span><span class=p>,</span> <span class=n>obj2</span><span class=p>,</span> 
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=gp>... </span>            <span class=n>to_pd</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span><span id=__span-24-9><a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=gp>... </span>            <span class=n>return_wrapper</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-24-10><a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a><span class=gp>... </span>        <span class=p>)</span>
</span><span id=__span-24-11><a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a><span class=gp>... </span>        <span class=k>return</span> <span class=bp>cls</span><span class=p>(</span><span class=n>wrapper</span><span class=p>,</span> <span class=n>obj1</span><span class=p>,</span> <span class=n>obj2</span><span class=p>)</span>
</span><span id=__span-24-12><a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a><span class=gp>...</span>
</span><span id=__span-24-13><a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a><span class=gp>... </span>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>wrapper</span><span class=p>,</span> <span class=n>obj1</span><span class=p>,</span> <span class=n>obj2</span><span class=p>):</span>
</span><span id=__span-24-14><a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a><span class=gp>... </span>        <span class=n>vbt</span><span class=o>.</span><span class=n>Analyzable</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>wrapper</span><span class=p>,</span> <span class=n>obj1</span><span class=o>=</span><span class=n>obj1</span><span class=p>,</span> <span class=n>obj2</span><span class=o>=</span><span class=n>obj2</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-24-15><a id=__codelineno-24-15 name=__codelineno-24-15 href=#__codelineno-24-15></a><span class=gp>...</span>
</span><span id=__span-24-16><a id=__codelineno-24-16 name=__codelineno-24-16 href=#__codelineno-24-16></a><span class=gp>... </span>        <span class=bp>self</span><span class=o>.</span><span class=n>_obj1</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>to_2d_array</span><span class=p>(</span><span class=n>obj1</span><span class=p>)</span>
</span><span id=__span-24-17><a id=__codelineno-24-17 name=__codelineno-24-17 href=#__codelineno-24-17></a><span class=gp>... </span>        <span class=bp>self</span><span class=o>.</span><span class=n>_obj2</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>to_2d_array</span><span class=p>(</span><span class=n>obj2</span><span class=p>)</span>
</span><span id=__span-24-18><a id=__codelineno-24-18 name=__codelineno-24-18 href=#__codelineno-24-18></a><span class=gp>...</span>
</span><span id=__span-24-19><a id=__codelineno-24-19 name=__codelineno-24-19 href=#__codelineno-24-19></a><span class=gp>... </span>    <span class=k>def</span><span class=w> </span><span class=nf>indexing_func</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>pd_indexing_func</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span><span id=__span-24-20><a id=__codelineno-24-20 name=__codelineno-24-20 href=#__codelineno-24-20></a><span class=gp>... </span>        <span class=n>wrapper_meta</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>wrapper</span><span class=o>.</span><span class=n>indexing_func_meta</span><span class=p>(</span><span class=n>pd_indexing_func</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span><span id=__span-24-21><a id=__codelineno-24-21 name=__codelineno-24-21 href=#__codelineno-24-21></a><span class=gp>... </span>        <span class=n>new_wrapper</span> <span class=o>=</span> <span class=n>wrapper_meta</span><span class=p>[</span><span class=s2>&quot;new_wrapper&quot;</span><span class=p>]</span>
</span><span id=__span-24-22><a id=__codelineno-24-22 name=__codelineno-24-22 href=#__codelineno-24-22></a><span class=gp>... </span>        <span class=n>row_idxs</span> <span class=o>=</span> <span class=n>wrapper_meta</span><span class=p>[</span><span class=s2>&quot;row_idxs&quot;</span><span class=p>]</span>
</span><span id=__span-24-23><a id=__codelineno-24-23 name=__codelineno-24-23 href=#__codelineno-24-23></a><span class=gp>... </span>        <span class=n>col_idxs</span> <span class=o>=</span> <span class=n>wrapper_meta</span><span class=p>[</span><span class=s2>&quot;col_idxs&quot;</span><span class=p>]</span>
</span><span id=__span-24-24><a id=__codelineno-24-24 name=__codelineno-24-24 href=#__codelineno-24-24></a><span class=gp>... </span>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span>
</span><span id=__span-24-25><a id=__codelineno-24-25 name=__codelineno-24-25 href=#__codelineno-24-25></a><span class=gp>... </span>            <span class=n>wrapper</span><span class=o>=</span><span class=n>new_wrapper</span><span class=p>,</span>
</span><span id=__span-24-26><a id=__codelineno-24-26 name=__codelineno-24-26 href=#__codelineno-24-26></a><span class=gp>... </span>            <span class=n>obj1</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>obj1</span><span class=p>[</span><span class=n>row_idxs</span><span class=p>,</span> <span class=p>:][:,</span> <span class=n>col_idxs</span><span class=p>],</span>
</span><span id=__span-24-27><a id=__codelineno-24-27 name=__codelineno-24-27 href=#__codelineno-24-27></a><span class=gp>... </span>            <span class=n>obj2</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>obj2</span><span class=p>[</span><span class=n>row_idxs</span><span class=p>,</span> <span class=p>:][:,</span> <span class=n>col_idxs</span><span class=p>]</span>
</span><span id=__span-24-28><a id=__codelineno-24-28 name=__codelineno-24-28 href=#__codelineno-24-28></a><span class=gp>... </span>        <span class=p>)</span>
</span><span id=__span-24-29><a id=__codelineno-24-29 name=__codelineno-24-29 href=#__codelineno-24-29></a><span class=gp>...</span>
</span><span id=__span-24-30><a id=__codelineno-24-30 name=__codelineno-24-30 href=#__codelineno-24-30></a><span class=gp>... </span>    <span class=nd>@property</span>
</span><span id=__span-24-31><a id=__codelineno-24-31 name=__codelineno-24-31 href=#__codelineno-24-31></a><span class=gp>... </span>    <span class=k>def</span><span class=w> </span><span class=nf>obj1</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-24-32><a id=__codelineno-24-32 name=__codelineno-24-32 href=#__codelineno-24-32></a><span class=gp>... </span>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_obj1</span>
</span><span id=__span-24-33><a id=__codelineno-24-33 name=__codelineno-24-33 href=#__codelineno-24-33></a><span class=gp>...</span>
</span><span id=__span-24-34><a id=__codelineno-24-34 name=__codelineno-24-34 href=#__codelineno-24-34></a><span class=gp>... </span>    <span class=nd>@property</span>
</span><span id=__span-24-35><a id=__codelineno-24-35 name=__codelineno-24-35 href=#__codelineno-24-35></a><span class=gp>... </span>    <span class=k>def</span><span class=w> </span><span class=nf>obj2</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-24-36><a id=__codelineno-24-36 name=__codelineno-24-36 href=#__codelineno-24-36></a><span class=gp>... </span>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_obj2</span>
</span><span id=__span-24-37><a id=__codelineno-24-37 name=__codelineno-24-37 href=#__codelineno-24-37></a><span class=gp>...</span>
</span><span id=__span-24-38><a id=__codelineno-24-38 name=__codelineno-24-38 href=#__codelineno-24-38></a><span class=gp>... </span>    <span class=k>def</span><span class=w> </span><span class=nf>corr</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-24-39><a id=__codelineno-24-39 name=__codelineno-24-39 href=#__codelineno-24-39></a><span class=gp>... </span>        <span class=n>out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>nancorr_nb</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>obj1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>obj2</span><span class=p>)</span>
</span><span id=__span-24-40><a id=__codelineno-24-40 name=__codelineno-24-40 href=#__codelineno-24-40></a><span class=gp>... </span>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>wrapper</span><span class=o>.</span><span class=n>wrap_reduced</span><span class=p>(</span><span class=n>out</span><span class=p>)</span>
</span><span id=__span-24-41><a id=__codelineno-24-41 name=__codelineno-24-41 href=#__codelineno-24-41></a><span class=gp>...</span>
</span><span id=__span-24-42><a id=__codelineno-24-42 name=__codelineno-24-42 href=#__codelineno-24-42></a><span class=gp>... </span>    <span class=k>def</span><span class=w> </span><span class=nf>rolling_corr</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>window</span><span class=p>):</span>
</span><span id=__span-24-43><a id=__codelineno-24-43 name=__codelineno-24-43 href=#__codelineno-24-43></a><span class=gp>... </span>        <span class=n>out</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>rolling_corr_nb</span><span class=p>(</span>
</span><span id=__span-24-44><a id=__codelineno-24-44 name=__codelineno-24-44 href=#__codelineno-24-44></a><span class=gp>... </span>            <span class=bp>self</span><span class=o>.</span><span class=n>obj1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>obj2</span><span class=p>,</span> 
</span><span id=__span-24-45><a id=__codelineno-24-45 name=__codelineno-24-45 href=#__codelineno-24-45></a><span class=gp>... </span>            <span class=n>window</span><span class=p>,</span> <span class=n>minp</span><span class=o>=</span><span class=n>window</span><span class=p>)</span>
</span><span id=__span-24-46><a id=__codelineno-24-46 name=__codelineno-24-46 href=#__codelineno-24-46></a><span class=gp>... </span>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>wrapper</span><span class=o>.</span><span class=n>wrap</span><span class=p>(</span><span class=n>out</span><span class=p>)</span>
</span><span id=__span-24-47><a id=__codelineno-24-47 name=__codelineno-24-47 href=#__codelineno-24-47></a><span class=gp>...</span>
</span><span id=__span-24-48><a id=__codelineno-24-48 name=__codelineno-24-48 href=#__codelineno-24-48></a><span class=gp>... </span>    <span class=n>_metrics</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>HybridConfig</span><span class=p>(</span>  <span class=c1># (3)!</span>
</span><span id=__span-24-49><a id=__codelineno-24-49 name=__codelineno-24-49 href=#__codelineno-24-49></a><span class=gp>... </span>        <span class=n>corr</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-24-50><a id=__codelineno-24-50 name=__codelineno-24-50 href=#__codelineno-24-50></a><span class=gp>... </span>            <span class=n>title</span><span class=o>=</span><span class=s1>&#39;Corr. Coefficient&#39;</span><span class=p>,</span>
</span><span id=__span-24-51><a id=__codelineno-24-51 name=__codelineno-24-51 href=#__codelineno-24-51></a><span class=gp>... </span>            <span class=n>calc_func</span><span class=o>=</span><span class=s1>&#39;corr&#39;</span>
</span><span id=__span-24-52><a id=__codelineno-24-52 name=__codelineno-24-52 href=#__codelineno-24-52></a><span class=gp>... </span>        <span class=p>)</span>
</span><span id=__span-24-53><a id=__codelineno-24-53 name=__codelineno-24-53 href=#__codelineno-24-53></a><span class=gp>... </span>    <span class=p>)</span>
</span><span id=__span-24-54><a id=__codelineno-24-54 name=__codelineno-24-54 href=#__codelineno-24-54></a><span class=gp>...</span>
</span><span id=__span-24-55><a id=__codelineno-24-55 name=__codelineno-24-55 href=#__codelineno-24-55></a><span class=gp>... </span>    <span class=n>_subplots</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>HybridConfig</span><span class=p>(</span>  <span class=c1># (4)!</span>
</span><span id=__span-24-56><a id=__codelineno-24-56 name=__codelineno-24-56 href=#__codelineno-24-56></a><span class=gp>... </span>         <span class=n>rolling_corr</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-24-57><a id=__codelineno-24-57 name=__codelineno-24-57 href=#__codelineno-24-57></a><span class=gp>... </span>             <span class=n>title</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Sub</span><span class=p>(</span><span class=s2>&quot;Rolling Corr. Coefficient (window=$window)&quot;</span><span class=p>),</span>
</span><span id=__span-24-58><a id=__codelineno-24-58 name=__codelineno-24-58 href=#__codelineno-24-58></a><span class=gp>... </span>             <span class=n>plot_func</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Sub</span><span class=p>(</span><span class=s1>&#39;rolling_corr($window).vbt.plot&#39;</span><span class=p>),</span>  <span class=c1># (5)!</span>
</span><span id=__span-24-59><a id=__codelineno-24-59 name=__codelineno-24-59 href=#__codelineno-24-59></a><span class=gp>... </span>             <span class=n>pass_trace_names</span><span class=o>=</span><span class=kc>False</span>
</span><span id=__span-24-60><a id=__codelineno-24-60 name=__codelineno-24-60 href=#__codelineno-24-60></a><span class=gp>... </span>         <span class=p>)</span>
</span><span id=__span-24-61><a id=__codelineno-24-61 name=__codelineno-24-61 href=#__codelineno-24-61></a><span class=gp>... </span>    <span class=p>)</span>
</span></code></pre></div> <ol> <li>Replace <code>Wrapping</code> with <code>Analyzable</code>.</li> <li>Replace <code>Wrapping</code> with <code>Analyzable</code>.</li> <li>Define default metrics for <a href=https://vectorbt.pro/pvt_41531c19/api/generic/stats_builder/#vectorbtpro.generic.stats_builder.StatsBuilderMixin.stats>StatsBuilderMixin.stats</a>.</li> <li>Define default subplots for <a href=https://vectorbt.pro/pvt_41531c19/api/generic/stats_builder/#vectorbtpro.generic.plots_builder.PlotsBuilderMixin.plots>PlotsBuilderMixin.plots</a>.</li> <li>See <a href=#templating>Templating</a> and <a href=#attribute-resolution>Attribute resolution</a>.</li> </ol> <p>We made a few changes: we replaced <code>Wrapping</code> with <code>Analyzable</code> and added some metrics and subplots based on <code>CorrStats.corr</code> and <code>CorrStats.rolling_corr</code>. That's all! Now we can pass any array-like objects to <code>CorrStats.from_objs</code>, which will return an instance ready to analyze the correlation between the objects. In particular, you can use <code>CorrStats.stats</code> and <code>CorrStats.plots</code>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>corrstats</span> <span class=o>=</span> <span class=n>CorrStats</span><span class=o>.</span><span class=n>from_objs</span><span class=p>(</span><span class=n>df1</span><span class=p>,</span> <span class=n>df2</span><span class=p>)</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>corrstats</span><span class=o>.</span><span class=n>stats</span><span class=p>(</span><span class=n>column</span><span class=o>=</span><span class=s1>&#39;a&#39;</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=go>Corr. Coefficient    0.3</span>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=go>Name: a, dtype: object</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>corrstats</span><span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>stats</span><span class=p>()</span>  <span class=c1># (2)!</span>
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a><span class=go>Corr. Coefficient    0.3</span>
</span><span id=__span-25-8><a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=go>Name: a, dtype: object</span>
</span><span id=__span-25-9><a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a>
</span><span id=__span-25-10><a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>corrstats</span><span class=o>.</span><span class=n>plots</span><span class=p>(</span><span class=n>template_context</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>window</span><span class=o>=</span><span class=mi>3</span><span class=p>))</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>  <span class=c1># (3)!</span>
</span></code></pre></div> <ol> <li>Compute metrics for all columns and show only <code>a</code>.</li> <li>Compute and show metrics for only <code>a</code>.</li> <li>Set the rolling window to 3 and show subplots for all columns.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/documentation/bblocks/analyzing.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/documentation/bblocks/analyzing.dark.svg#only-dark></p> <p>There is nothing more satisfying than not having to write boilerplate code. Thanks to <a href=https://vectorbt.pro/pvt_41531c19/api/generic/analyzable/#vectorbtpro.generic.analyzable.Analyzable>Analyzable</a>, we can focus entirely on analysis while VBT takes care of everything else.</p> <h3 id=generic-accessor>Generic accessor<a class=headerlink href=#generic-accessor title="Permanent link">&para;</a></h3> <p>You do not have to look far to find a class that inherits from <a href=https://vectorbt.pro/pvt_41531c19/api/generic/analyzable/#vectorbtpro.generic.analyzable.Analyzable>Analyzable</a>: the <a href=https://vectorbt.pro/pvt_41531c19/api/generic/accessors/#vectorbtpro.generic.accessors.GenericAccessor>GenericAccessor</a> class extends <a href=https://vectorbt.pro/pvt_41531c19/api/base/accessors/#vectorbtpro.base.accessors.BaseAccessor>BaseAccessor</a> to provide statistics and plots for any numeric data. It is a one-size-fits-all class whose goal is to replicate, accelerate, and extend Pandas core functionality. It implements custom rolling, mapping, reducing, splitting, plotting, and many other methods, which can be used with any Series or DataFrame.</p> <p>In short, <a href=https://vectorbt.pro/pvt_41531c19/api/generic/accessors/#vectorbtpro.generic.accessors.GenericAccessor>GenericAccessor</a> offers the following:</p> <ul> <li>Wraps many Numba-compiled functions from the <a href=https://vectorbt.pro/pvt_41531c19/api/generic/nb/ >nb</a> module and provides them as methods that mimic some of Pandas' most popular functions. Some have meta versions (accepting UDFs that take metadata instead of arrays) or can be used on grouped data.</li> <li>Wraps many data transformation utilities from <a href=https://scikit-learn.org/stable/ >scikit-learn</a>.</li> <li>Displays a range of statistics similar to <a href=https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.describe.html>pandas.DataFrame.describe</a>.</li> <li>Wraps widgets from <a href=https://vectorbt.pro/pvt_41531c19/api/generic/plotting/ >plotting</a> and provides many custom plotting methods. Some methods even support interactive controls for analyzing groups of data.</li> <li>Extracts basic events as <a href=https://vectorbt.pro/pvt_41531c19/api/records/base/#vectorbtpro.records.base.Records>Records</a>, such as drawdowns.</li> </ul> <p>Just like the <a href=#base-accessor>Base accessor</a>, the generic accessor uses <a href=https://vectorbt.pro/pvt_41531c19/api/generic/decorators/ >class decorators</a> and <a href=https://vectorbt.pro/pvt_41531c19/api/generic/accessors/#vectorbtpro.generic.accessors.nb_config>configs</a> to attach many Numba-compiled and scikit-learn functions at once.</p> <p>Usage is similar to <code>CorrStats</code>, except you can use the generic accessor directly on Pandas objects, since it is directly subclassed by <a href=https://vectorbt.pro/pvt_41531c19/api/accessors/#vectorbtpro.accessors.Vbt_DFAccessor>Vbt_DFAccessor</a>!</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>df</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>stats</span><span class=p>(</span><span class=n>column</span><span class=o>=</span><span class=s1>&#39;a&#39;</span><span class=p>)</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=go>Start        2020-01-01 00:00:00</span>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=go>End          2020-01-05 00:00:00</span>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=go>Period           5 days 00:00:00</span>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=go>Count                          5</span>
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=go>Mean                         2.0</span>
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=go>Std                     1.581139</span>
</span><span id=__span-26-8><a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=go>Min                            0</span>
</span><span id=__span-26-9><a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a><span class=go>Median                       2.0</span>
</span><span id=__span-26-10><a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a><span class=go>Max                            4</span>
</span><span id=__span-26-11><a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a><span class=go>Min Index    2020-01-01 00:00:00</span>
</span><span id=__span-26-12><a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a><span class=go>Max Index    2020-01-05 00:00:00</span>
</span><span id=__span-26-13><a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a><span class=go>Name: a, dtype: object</span>
</span></code></pre></div> <h2 id=records>Records<a class=headerlink href=#records title="Permanent link">&para;</a></h2> <pre class=mermaid><code>flowchart TD;
    Records -.-&gt;|references| ColumnMapper;
    Records -.-&gt;|references| MappedArray;
    Records --&gt;|inherits| Analyzable;
    MappedArray -.-&gt;|references| ColumnMapper;
    MappedArray --&gt;|inherits| Analyzable;</code></pre> <p>Records are <a href=https://numpy.org/doc/stable/user/basics.rec.html>structured arrays</a>, which are NumPy arrays that can hold different data types, much like a Pandas DataFrame. Records have a major advantage over DataFrames: they are well supported by Numba, making it possible to generate and use them efficiently. So, what is the drawback? Records do not have (index) labels, and their API is very limited. As we <a href=https://vectorbt.pro/pvt_41531c19/documentation/fundamentals/ >discussed</a>, VBT does not favor heterogeneous data and instead prefers to work with multiple homogeneous arrays (such as splitting OHLC into O, H, L, and C). Even so, records play an important role in our ecosystem as containers for event data.</p> <p>Trading revolves around events: executing trades, combining them into positions, analyzing drawdowns, and more. Each event is a complex piece of data that needs a container optimized for fast writes and reads, especially inside Numba-compiled code (but do not use a list of dictionaries, as that is <strong>very inefficient</strong>). Structured arrays are the data structure we need! Each event is a record that holds all the necessary information, such as the column and row where it originally occurred.</p> <p>Because structured arrays can be difficult to analyze, there is a dedicated class for this purpose: <a href=https://vectorbt.pro/pvt_41531c19/api/records/base/#vectorbtpro.records.base.Records>Records</a>! By subclassing <a href=https://vectorbt.pro/pvt_41531c19/api/generic/analyzable/#vectorbtpro.generic.analyzable.Analyzable>Analyzable</a>, it wraps a structured NumPy array and provides useful tools for analysis. Every <a href=https://vectorbt.pro/pvt_41531c19/api/records/base/#vectorbtpro.records.base.Records>Records</a> instance can be indexed like a regular Pandas object and can compute various metrics and plot graphs.</p> <p>Let's generate <a href=https://vectorbt.pro/pvt_41531c19/api/generic/drawdowns/#vectorbtpro.generic.drawdowns.Drawdowns>Drawdowns</a> records for two columns of time series data:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>dd_df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=gp>... </span>    <span class=s1>&#39;a&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>10</span><span class=p>,</span> <span class=mi>11</span><span class=p>,</span> <span class=mi>12</span><span class=p>,</span> <span class=mi>11</span><span class=p>,</span> <span class=mi>12</span><span class=p>,</span> <span class=mi>13</span><span class=p>,</span> <span class=mi>12</span><span class=p>],</span>
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=gp>... </span>    <span class=s1>&#39;b&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>14</span><span class=p>,</span> <span class=mi>13</span><span class=p>,</span> <span class=mi>12</span><span class=p>,</span> <span class=mi>11</span><span class=p>,</span> <span class=mi>12</span><span class=p>,</span> <span class=mi>13</span><span class=p>,</span> <span class=mi>14</span><span class=p>]</span>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=gp>... </span><span class=p>},</span> <span class=n>index</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>date_range</span><span class=p>(</span><span class=s2>&quot;2020&quot;</span><span class=p>,</span> <span class=n>periods</span><span class=o>=</span><span class=mi>7</span><span class=p>))</span>
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>drawdowns</span> <span class=o>=</span> <span class=n>dd_df</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>drawdowns</span>
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>drawdowns</span><span class=o>.</span><span class=n>readable</span>
</span><span id=__span-27-7><a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a><span class=go>   Drawdown Id Column Start Index Valley Index  End Index  Start Value  \</span>
</span><span id=__span-27-8><a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a><span class=go>0            0      a  2020-01-03   2020-01-04 2020-01-05         12.0   </span>
</span><span id=__span-27-9><a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a><span class=go>1            1      a  2020-01-06   2020-01-07 2020-01-07         13.0   </span>
</span><span id=__span-27-10><a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a><span class=go>2            0      b  2020-01-01   2020-01-04 2020-01-07         14.0   </span>
</span><span id=__span-27-11><a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a>
</span><span id=__span-27-12><a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a><span class=go>   Valley Value  End Value     Status  </span>
</span><span id=__span-27-13><a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a><span class=go>0          11.0       12.0  Recovered  </span>
</span><span id=__span-27-14><a id=__codelineno-27-14 name=__codelineno-27-14 href=#__codelineno-27-14></a><span class=go>1          12.0       12.0     Active  </span>
</span><span id=__span-27-15><a id=__codelineno-27-15 name=__codelineno-27-15 href=#__codelineno-27-15></a><span class=go>2          11.0       14.0  Recovered  </span>
</span><span id=__span-27-16><a id=__codelineno-27-16 name=__codelineno-27-16 href=#__codelineno-27-16></a>
</span><span id=__span-27-17><a id=__codelineno-27-17 name=__codelineno-27-17 href=#__codelineno-27-17></a><span class=gp>&gt;&gt;&gt; </span><span class=n>drawdowns</span><span class=p>[</span><span class=s1>&#39;b&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>readable</span>  <span class=c1># (1)!</span>
</span><span id=__span-27-18><a id=__codelineno-27-18 name=__codelineno-27-18 href=#__codelineno-27-18></a><span class=go>   Drawdown Id Column Start Index Valley Index  End Index  Start Value  \</span>
</span><span id=__span-27-19><a id=__codelineno-27-19 name=__codelineno-27-19 href=#__codelineno-27-19></a><span class=go>0            0      b  2020-01-01   2020-01-04 2020-01-07         14.0   </span>
</span><span id=__span-27-20><a id=__codelineno-27-20 name=__codelineno-27-20 href=#__codelineno-27-20></a>
</span><span id=__span-27-21><a id=__codelineno-27-21 name=__codelineno-27-21 href=#__codelineno-27-21></a><span class=go>   Valley Value  End Value     Status  </span>
</span><span id=__span-27-22><a id=__codelineno-27-22 name=__codelineno-27-22 href=#__codelineno-27-22></a><span class=go>0          11.0       14.0  Recovered  </span>
</span></code></pre></div> <ol> <li>Select all records of column <code>b</code> and display them in a human-readable format.</li> </ol> <p>That's a lot of information! Each field is a standard NumPy array, so where does all this rich information come from? Surprisingly, the labels of the DataFrames above were automatically generated from the metadata that <a href=https://vectorbt.pro/pvt_41531c19/api/generic/drawdowns/#vectorbtpro.generic.drawdowns.Drawdowns>Drawdowns</a> contains. This metadata is called a "field config," which is a regular <a href=https://vectorbt.pro/pvt_41531c19/api/utils/config/#vectorbtpro.utils.config.Config>Config</a> describing each field (for example, <a href=https://vectorbt.pro/pvt_41531c19/api/generic/drawdowns/#vectorbtpro.generic.drawdowns.Drawdowns.field_config>Drawdowns.field_config</a>). This setup enables automating and enhancing the behavior of each field. The class <a href=https://vectorbt.pro/pvt_41531c19/api/records/base/#vectorbtpro.records.base.Records>Records</a>, which is the base for all record classes, includes many methods to read and interpret this config.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>drawdowns</span><span class=o>.</span><span class=n>status</span><span class=o>.</span><span class=n>values</span>  <span class=c1># (1)!</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=go>array([1, 0, 1])</span>
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a>
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>drawdowns</span><span class=o>.</span><span class=n>get_apply_mapping_arr</span><span class=p>(</span><span class=s1>&#39;status&#39;</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-28-5><a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a><span class=go>array([&#39;Recovered&#39;, &#39;Active&#39;, &#39;Recovered&#39;], dtype=object)</span>
</span></code></pre></div> <ol> <li>Raw data.</li> <li>Data enhanced using the field config.</li> </ol> <h3 id=column-mapper>Column mapper<a class=headerlink href=#column-mapper title="Permanent link">&para;</a></h3> <p>Records are one-dimensional structured NumPy arrays. Records from multiple columns are concatenated into a single array, so we need a way to group them by column or group. For example, we might want to aggregate values by column. This is not a trivial task because finding which records correspond to a specific column requires searching through all records, which can be slow if done repeatedly. The <a href=https://vectorbt.pro/pvt_41531c19/api/records/col_mapper/#vectorbtpro.records.col_mapper.ColumnMapper>ColumnMapper</a> class addresses this by indexing all columns just once and caching the results (see <a href=https://vectorbt.pro/pvt_41531c19/api/records/col_mapper/#vectorbtpro.records.col_mapper.ColumnMapper.col_map>ColumnMapper.col_map</a>). A column mapper provides at least two more advantages: it allows for grouping columns and enables efficient <a href=#indexing>Indexing</a>.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>drawdowns</span><span class=o>.</span><span class=n>col_mapper</span><span class=o>.</span><span class=n>col_map</span>  <span class=c1># (1)!</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=go>(array([0, 1, 2]), array([2, 1]))</span>
</span></code></pre></div> <ol> <li>An array containing the indices of records ordered by column, and an array with the number of records per column.</li> </ol> <p>The column map above tells us that column <code>a</code> has two records at indices 0 and 1, while column <code>b</code> has one record at index 2.</p> <h3 id=mapped-arrays>Mapped arrays<a class=headerlink href=#mapped-arrays title="Permanent link">&para;</a></h3> <p>If <a href=https://vectorbt.pro/pvt_41531c19/api/records/base/#vectorbtpro.records.base.Records>Records</a> is like our own DataFrame for events, then <a href=https://vectorbt.pro/pvt_41531c19/api/records/mapped_array/#vectorbtpro.records.mapped_array.MappedArray>MappedArray</a> is like our own Series! Each field in records can be mapped into a <em>mapped</em> array. In fact, most calculations happen on a mapped array. It is similar to <a href=https://vectorbt.pro/pvt_41531c19/api/generic/accessors/#vectorbtpro.generic.accessors.GenericAccessor>GenericAccessor</a>, but it represents data in a completely different way: one-dimensional and clustered, rather than two-dimensional and column-wise. We can even seemingly convert between both representations. Why not simply convert a mapped array into a standard Series and do all analyses there? There are several reasons:</p> <ol> <li>Event data is often sparse. If 1,000,000 data points yield only 50 events, it is much faster to analyze 50 values than to convert them back and manage 9,999,950 NaNs.</li> <li>Multiple events, such as orders, can happen within the same bar, which cannot be efficiently represented in Pandas.</li> </ol> <p>Let's analyze the drawdown values in <code>drawdowns</code>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>dd_ma</span> <span class=o>=</span> <span class=n>drawdowns</span><span class=o>.</span><span class=n>drawdown</span>
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>dd_ma</span>
</span><span id=__span-30-3><a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a><span class=go>&lt;vectorbtpro.records.mapped_array.MappedArray at 0x7ff6d8514f98&gt;</span>
</span><span id=__span-30-4><a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a>
</span><span id=__span-30-5><a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>dd_ma</span><span class=o>.</span><span class=n>values</span>  <span class=c1># (1)!</span>
</span><span id=__span-30-6><a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a><span class=go>array([-0.08333333, -0.07692308, -0.21428571])</span>
</span><span id=__span-30-7><a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a>
</span><span id=__span-30-8><a id=__codelineno-30-8 name=__codelineno-30-8 href=#__codelineno-30-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>dd_ma</span><span class=o>.</span><span class=n>stats</span><span class=p>(</span><span class=n>column</span><span class=o>=</span><span class=s1>&#39;a&#39;</span><span class=p>)</span>
</span><span id=__span-30-9><a id=__codelineno-30-9 name=__codelineno-30-9 href=#__codelineno-30-9></a><span class=go>Start        2020-01-01 00:00:00</span>
</span><span id=__span-30-10><a id=__codelineno-30-10 name=__codelineno-30-10 href=#__codelineno-30-10></a><span class=go>End          2020-01-07 00:00:00</span>
</span><span id=__span-30-11><a id=__codelineno-30-11 name=__codelineno-30-11 href=#__codelineno-30-11></a><span class=go>Period           7 days 00:00:00</span>
</span><span id=__span-30-12><a id=__codelineno-30-12 name=__codelineno-30-12 href=#__codelineno-30-12></a><span class=go>Count                          2</span>
</span><span id=__span-30-13><a id=__codelineno-30-13 name=__codelineno-30-13 href=#__codelineno-30-13></a><span class=go>Mean                   -0.080128</span>
</span><span id=__span-30-14><a id=__codelineno-30-14 name=__codelineno-30-14 href=#__codelineno-30-14></a><span class=go>Std                     0.004533</span>
</span><span id=__span-30-15><a id=__codelineno-30-15 name=__codelineno-30-15 href=#__codelineno-30-15></a><span class=go>Min                    -0.083333</span>
</span><span id=__span-30-16><a id=__codelineno-30-16 name=__codelineno-30-16 href=#__codelineno-30-16></a><span class=go>Median                 -0.080128</span>
</span><span id=__span-30-17><a id=__codelineno-30-17 name=__codelineno-30-17 href=#__codelineno-30-17></a><span class=go>Max                    -0.076923</span>
</span><span id=__span-30-18><a id=__codelineno-30-18 name=__codelineno-30-18 href=#__codelineno-30-18></a><span class=go>Min Index    2020-01-05 00:00:00</span>
</span><span id=__span-30-19><a id=__codelineno-30-19 name=__codelineno-30-19 href=#__codelineno-30-19></a><span class=go>Max Index    2020-01-07 00:00:00</span>
</span><span id=__span-30-20><a id=__codelineno-30-20 name=__codelineno-30-20 href=#__codelineno-30-20></a><span class=go>Name: a, dtype: object</span>
</span><span id=__span-30-21><a id=__codelineno-30-21 name=__codelineno-30-21 href=#__codelineno-30-21></a>
</span><span id=__span-30-22><a id=__codelineno-30-22 name=__codelineno-30-22 href=#__codelineno-30-22></a><span class=gp>&gt;&gt;&gt; </span><span class=n>dd_ma</span><span class=o>.</span><span class=n>to_pd</span><span class=p>()</span>  <span class=c1># (2)!</span>
</span><span id=__span-30-23><a id=__codelineno-30-23 name=__codelineno-30-23 href=#__codelineno-30-23></a><span class=go>                   a         b</span>
</span><span id=__span-30-24><a id=__codelineno-30-24 name=__codelineno-30-24 href=#__codelineno-30-24></a><span class=go>2020-01-01       NaN       NaN</span>
</span><span id=__span-30-25><a id=__codelineno-30-25 name=__codelineno-30-25 href=#__codelineno-30-25></a><span class=go>2020-01-02       NaN       NaN</span>
</span><span id=__span-30-26><a id=__codelineno-30-26 name=__codelineno-30-26 href=#__codelineno-30-26></a><span class=go>2020-01-03       NaN       NaN</span>
</span><span id=__span-30-27><a id=__codelineno-30-27 name=__codelineno-30-27 href=#__codelineno-30-27></a><span class=go>2020-01-04       NaN       NaN</span>
</span><span id=__span-30-28><a id=__codelineno-30-28 name=__codelineno-30-28 href=#__codelineno-30-28></a><span class=go>2020-01-05 -0.083333       NaN</span>
</span><span id=__span-30-29><a id=__codelineno-30-29 name=__codelineno-30-29 href=#__codelineno-30-29></a><span class=go>2020-01-06       NaN       NaN</span>
</span><span id=__span-30-30><a id=__codelineno-30-30 name=__codelineno-30-30 href=#__codelineno-30-30></a><span class=go>2020-01-07 -0.076923 -0.214286</span>
</span></code></pre></div> <ol> <li>Holds three values: two from <code>a</code> and one from <code>b</code>.</li> <li>Can be converted into Pandas, but at a cost.</li> </ol> <p>Thanks to <a href=https://vectorbt.pro/pvt_41531c19/api/records/col_mapper/#vectorbtpro.records.col_mapper.ColumnMapper>ColumnMapper</a> and <a href=https://vectorbt.pro/pvt_41531c19/api/generic/analyzable/#vectorbtpro.generic.analyzable.Analyzable>Analyzable</a>, we can select rows and columns from a mapped array just like from records or any regular Pandas object:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>dd_ma</span><span class=p>[</span><span class=s1>&#39;b&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>values</span>
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=go>array([-0.21428571])</span>
</span></code></pre></div> <h2 id=summary>Summary<a class=headerlink href=#summary title="Permanent link">&para;</a></h2> <p>Thank you for following along all the way down here! The classes we just discussed form a solid foundation for data analysis with VBT. They implement design patterns that you will encounter in many other places throughout the codebase, making them easy to recognize and extend. In fact, the most advanced class, <a href=https://vectorbt.pro/pvt_41531c19/api/portfolio/base/#vectorbtpro.portfolio.base.Portfolio>Portfolio</a>, is very similar to our <code>CorrStats</code>.</p> <p>You are now more than ready to use VBT, soldier <img alt=ðŸŒŸ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f31f.svg title=:star2:></p> <p><a class=md-button href=https://vectorbt.pro/pvt_41531c19/assets/jupytext/documentation/building-blocks.py.txt target=blank_><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19.14 7.5A2.86 2.86 0 0 1 22 10.36v3.78A2.86 2.86 0 0 1 19.14 17H12c0 .39.32.96.71.96H17v1.68a2.86 2.86 0 0 1-2.86 2.86H9.86A2.86 2.86 0 0 1 7 19.64v-3.75a2.85 2.85 0 0 1 2.86-2.85h5.25a2.85 2.85 0 0 0 2.85-2.86V7.5zm-4.28 11.79c-.4 0-.72.3-.72.89s.32.71.72.71a.71.71 0 0 0 .71-.71c0-.59-.32-.89-.71-.89m-10-1.79A2.86 2.86 0 0 1 2 14.64v-3.78A2.86 2.86 0 0 1 4.86 8H12c0-.39-.32-.96-.71-.96H7V5.36A2.86 2.86 0 0 1 9.86 2.5h4.28A2.86 2.86 0 0 1 17 5.36v3.75a2.85 2.85 0 0 1-2.86 2.85H8.89a2.85 2.85 0 0 0-2.85 2.86v2.68zM9.14 5.71c.4 0 .72-.3.72-.89s-.32-.71-.72-.71c-.39 0-.71.12-.71.71s.32.89.71.89"/></svg></span> Python code</a></p> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=https://vectorbt.pro/pvt_41531c19/documentation/fundamentals/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Fundamentals"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Fundamentals </div> </div> </a> <a href=https://vectorbt.pro/pvt_41531c19/documentation/data/ class="md-footer__link md-footer__link--next" aria-label="Next: Data"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Data </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2021-2025 Oleg Polakow. All rights reserved. </div> </div> <div class=md-social> <a href=https://www.linkedin.com/in/polakowo target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> <a href=https://github.com/polakowo target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">Accept</button> <label class=md-button for=__settings>Manage settings</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script> <script id=__config type=application/json>{"annotate": null, "base": "../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.instant", "navigation.instant.progress", "navigation.top", "navigation.prune", "navigation.path", "navigation.footer", "search.suggest", "search.share", "content.code.annotate", "content.code.copy", "content.code.select", "content.tooltips", "content.tabs.link", "toc.follow", "toc.integrate", "announce.dismiss"], "search": "../../assets/javascripts/workers/search.26099bd0.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=https://vectorbt.pro/pvt_41531c19/assets/javascripts/bundle.9d1edc04.min.js></script> <script src=https://vectorbt.pro/pvt_41531c19/assets/scripts/extra.js></script> <script src=https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js></script> </body> 
<!-- Mirrored from vectorbt.pro/pvt_41531c19/documentation/building-blocks/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 22 Nov 2025 03:46:38 GMT -->
</html>