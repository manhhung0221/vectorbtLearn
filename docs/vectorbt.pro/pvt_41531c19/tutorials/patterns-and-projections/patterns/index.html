<!doctype html><html lang=en class=no-js> 
<!-- Mirrored from vectorbt.pro/pvt_41531c19/tutorials/patterns-and-projections/patterns/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 22 Nov 2025 03:46:54 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Learn about identifying patterns using VectorBT PRO"><meta name=author content="Oleg Polakow"><link href=https://vectorbt.pro/tutorials/patterns-and-projections/patterns/ rel=canonical><link href=../../pairs-trading/index.html rel=prev><link href=../projections/index.html rel=next><link rel=icon href=../../../assets/logo/favicon.png><meta name=generator content="mkdocs-1.6.0, mkdocs-material-9.6.21+insiders-4.53.17"><title>Patterns - VectorBT® PRO</title><link rel=stylesheet href=../../../assets/stylesheets/main.010a373c.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=../../../../../fonts.gstatic.com/index.html crossorigin><link rel=stylesheet href="../../../../../fonts.googleapis.com/cssbe43.css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../assets/stylesheets/extra.css><link rel=stylesheet href=../../../assets/stylesheets/custom-light.css><link rel=stylesheet href=../../../assets/stylesheets/custom-dark.css><link rel=stylesheet href=../../../assets/stylesheets/pygments-light.css><link rel=stylesheet href=../../../assets/stylesheets/pygments-dark.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-0C5VNYCFHL"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-0C5VNYCFHL",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="../../../../../www.googletagmanager.com/gtag/jsc6c8?id=G-0C5VNYCFHL",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script><meta name=robots content="noindex, nofollow"><meta property=og:title content=Patterns><meta property=og:type content=website><meta content=https://vectorbt.pro/tutorials/patterns-and-projections/patterns/ property=og:url><meta property=og:image:url content=https://vectorbt.pro/pvt_41531c19/assets/logo/social-new.png><meta property=og:image:type content=image/png><meta property=og:description content="Learn about identifying patterns using VectorBT PRO"><meta property=og:locale content=en-GB><link rel=apple-touch-icon sizes=180x180 href=https://vectorbt.pro/pvt_41531c19/assets/logo/apple-touch-icon.png><link rel=icon type=image/svg+xml href=https://vectorbt.pro/pvt_41531c19/assets/logo/favicon.svg><link rel=icon type=image/png sizes=32x32 href=https://vectorbt.pro/pvt_41531c19/assets/logo/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://vectorbt.pro/pvt_41531c19/assets/logo/favicon-16x16.png><link rel=manifest href=https://vectorbt.pro/pvt_41531c19/assets/logo/site.webmanifest><link rel=mask-icon href=https://vectorbt.pro/pvt_41531c19/assets/logo/safari-pinned-tab.svg color=#1e1f22><link rel="shortcut icon" href=https://vectorbt.pro/pvt_41531c19/assets/logo/favicon.ico><meta name=msapplication-TileColor content=#1e1f22><meta name=msapplication-config content=https://vectorbt.pro/pvt_41531c19/assets/logo/browserconfig.xml><meta name=theme-color content=#1e1f22><link href=https://unpkg.com/aos@2.3.4/dist/aos.css rel=stylesheet><script src=https://unpkg.com/aos@2.3.4/dist/aos.js></script><link href=http://fonts.cdnfonts.com/css/uni-neue rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" crossorigin=anonymous referrerpolicy=no-referrer><script src=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/js/all.min.js integrity="sha512-8pHNiqTlsrRjVD4A/3va++W1sMbUHwWxxRPWNyVlql3T+Hgfd81Qc6FC5WMXDC+tSauxxzp1tgiAvSKFu1qIlA==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js integrity="sha512-q583ppKrCRc7N5O0n2nzUiJ+suUv7Et1JGels4bXOaMFQcamPk9HjdUknZuuFjBNs7tsMuadge5k9RzdmO+1GQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><link rel=preconnect href=https://fonts.googleapis.com/><link rel=preconnect href=https://fonts.gstatic.com/ crossorigin></head> <body dir=ltr data-md-color-scheme=custom-dark data-md-color-primary=custom-dark data-md-color-accent=custom-dark> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#patterns class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <button class="md-banner__button md-icon" aria-label="Don't show this again"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> <i>What's new</i>: New LLM providers, reasoning steps, function calling, YAML & TOML support, and <a href=https://vectorbt.pro/pvt_41531c19/getting-started/release-notes><strong>more</strong></a> <span class="twemoji announce-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="m153.6 29.9 16-21.3c4-5.4 10.4-8.6 17.1-8.6C198.4 0 208 9.6 208 21.3v22.1c0 13.1 5.4 25.7 14.9 34.7l84.7 80.9c48.8 46.6 76.4 111.2 76.4 178.7C384 434 306 512 209.7 512H192C86 512 0 426 0 320v-3.8c0-48.8 19.4-95.6 53.9-130.1l3.5-3.5c4.2-4.2 10-6.6 16-6.6 12.5 0 22.6 10.1 22.6 22.6V288c0 35.3 28.7 64 64 64s64-28.7 64-64v-3.9c0-18-7.2-35.3-19.9-48l-38.6-38.6c-24-24-37.5-56.7-37.5-90.7 0-27.7 9-54.8 25.6-76.9"/></svg></span> </div> <script>var el=document.querySelector("[data-md-component=announce]");if(el){var content=el.querySelector(".md-typeset");__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0)}</script> </aside> </div> <!-- Determine class according to configuration --> <!-- Header --> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=header.title> <!-- Link to home --> <a href=https://vectorbt.pro/pvt_41531c19/ title="VectorBT® PRO" class="md-header__button md-logo" aria-label="VectorBT® PRO" data-md-component=logo> <img src=https://vectorbt.pro/pvt_41531c19/assets/logo/logo.svg alt=logo class=logo> </a> <!-- Button to open drawer --> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <!-- Header title --> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> VectorBT® PRO <span class=md-version> v2025.10.15 </span> <span class=unlock-icon><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M192 32c-35.3 0-64 28.7-64 64v64h192c35.3 0 64 28.7 64 64v224c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V224c0-35.3 28.7-64 64-64V96c0-70.7 57.3-128 128-128 63.5 0 116.1 46.1 126.2 106.7 2.9 17.4-8.8 33.9-26.3 36.9S258 102.8 255 85.3C250 55.1 223.7 32 192 32m40 328c13.3 0 24-10.7 24-24s-10.7-24-24-24h-80c-13.3 0-24 10.7-24 24s10.7 24 24 24z"/></svg></span> </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Patterns </span> </div> </div> </div> <!-- Color palette --> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=custom-dark data-md-color-primary=custom-dark data-md-color-accent=custom-dark aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=custom-light data-md-color-primary=custom-light data-md-color-accent=custom-light aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <!-- Site language selector --> <!-- Button to open search modal --> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <!-- Search interface --> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <!-- Repository information --> <div class=md-header__source> <a href=https://github.com/polakowo/vectorbt.pro title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> vectorbt.pro </div> </a> </div> </nav> <!-- Navigation tabs (sticky) --> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/ class=md-tabs__link> Getting started </a> </li> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/features/overview/ class=md-tabs__link> Features </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/overview/ class=md-tabs__link> Tutorials </a> </li> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/documentation/overview/ class=md-tabs__link> Documentation </a> </li> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/cookbook/overview/ class=md-tabs__link> Cookbook </a> </li> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/api/ class=md-tabs__link> API </a> </li> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/terms/terms-of-use/ class=md-tabs__link> Terms </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://vectorbt.pro/pvt_41531c19/ title="VectorBT® PRO" class="md-nav__button md-logo" aria-label="VectorBT® PRO" data-md-component=logo> <img src=https://vectorbt.pro/pvt_41531c19/assets/logo/logo.svg alt=logo class=logo> </a> VectorBT® PRO </label> <div class=md-nav__source> <a href=https://github.com/polakowo/vectorbt.pro title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> vectorbt.pro </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/ class=md-nav__link> <span class=md-ellipsis> Getting started </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/features/overview/ class=md-nav__link> <span class=md-ellipsis> Features </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Tutorials </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/basic-rsi/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m3.5 18.5 6-6 4 4L22 6.92 20.59 5.5l-7.09 8-4-4L2 17z"/></svg> <span class=md-ellipsis> Basic RSI strategy </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/superfast-supertrend/ class=md-nav__link> <span class=md-ellipsis> SuperFast SuperTrend </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/signal-development/generation/ class=md-nav__link> <span class=md-ellipsis> Signal development </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/stop-signals/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 23h-2V1h2zm-4-4H5V5h4V3H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h4zM19 7v2h2V7zm0-2h2a2 2 0 0 0-2-2zm2 10h-2v2h2zm-2-4v2h2v-2zm-2-8h-2v2h2zm2 18c1.11 0 2-.89 2-2h-2zm-2-2h-2v2h2z"/></svg> <span class=md-ellipsis> Stop signals </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/mtf-analysis/ class=md-nav__link> <span class=md-ellipsis> MTF analysis </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/portfolio-optimization/ class=md-nav__link> <span class=md-ellipsis> Portfolio optimization </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/pairs-trading/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M22 6.92 20.59 5.5l-2.85 3.22C15.68 6.4 12.83 5 9.61 5 6.72 5 4.07 6.16 2 8l1.42 1.42C5.12 7.93 7.27 7 9.61 7c2.74 0 5.09 1.26 6.77 3.24L13.5 13.5l-4-4L2 17l1.5 1.5 6-6 4 4 4.05-4.57c.75 1.35 1.25 2.9 1.45 4.57h2c-.22-2.32-.95-4.41-2.04-6.16z"/></svg> <span class=md-ellipsis> Pairs trading </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_9 checked> <label class=md-nav__link for=__nav_3_9 id=__nav_3_9_label tabindex=0> <span class=md-ellipsis> Patterns and projections </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_9_label aria-expanded=true> <label class=md-nav__title for=__nav_3_9> <span class="md-nav__icon md-icon"></span> Patterns and projections </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m23 7.5-6.47-.54L14 1l-2.53 5.96L5 7.5l4.9 4.27-1.46 6.33L14 14.74l5.56 3.36-1.47-6.33zm-6.86 4.73.4 1.71-1.51-.91-1.03-.62-1.03.62-1.51.91.39-1.71.28-1.18-.91-.79L9.88 9.1l1.76-.15 1.2-.1.47-1.11.69-1.62.69 1.62.47 1.11 1.2.1 1.75.15-1.33 1.16-.92.79zM1.16 12c-.299-.5-.171-1.11.29-1.41l2.73-1.8 1.57 1.36-3.2 2.11c-.17.11-.36.17-.55.17-.32 0-.64-.16-.84-.43m.29 8.16 5.86-3.85L7 17.76l-.34 1.37-4.11 2.71c-.17.11-.36.16-.55.16-.32 0-.64-.16-.84-.45a1.013 1.013 0 0 1 .29-1.39m5.87-8.66.92.81-.27 1.19-5.42 3.55c-.17.11-.36.16-.55.16-.32 0-.64-.15-.84-.45a1 1 0 0 1 .29-1.38z"/></svg> <span class=md-ellipsis> Patterns </span> <span class="md-nav__icon md-icon"></span> </label> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/patterns-and-projections/patterns/ class="md-nav__link md-nav__link--active"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m23 7.5-6.47-.54L14 1l-2.53 5.96L5 7.5l4.9 4.27-1.46 6.33L14 14.74l5.56 3.36-1.47-6.33zm-6.86 4.73.4 1.71-1.51-.91-1.03-.62-1.03.62-1.51.91.39-1.71.28-1.18-.91-.79L9.88 9.1l1.76-.15 1.2-.1.47-1.11.69-1.62.69 1.62.47 1.11 1.2.1 1.75.15-1.33 1.16-.92.79zM1.16 12c-.299-.5-.171-1.11.29-1.41l2.73-1.8 1.57 1.36-3.2 2.11c-.17.11-.36.17-.55.17-.32 0-.64-.16-.84-.43m.29 8.16 5.86-3.85L7 17.76l-.34 1.37-4.11 2.71c-.17.11-.36.16-.55.16-.32 0-.64-.16-.84-.45a1.013 1.013 0 0 1 .29-1.39m5.87-8.66.92.81-.27 1.19-5.42 3.55c-.17.11-.36.16-.55.16-.32 0-.64-.15-.84-.45a1 1 0 0 1 .29-1.38z"/></svg> <span class=md-ellipsis> Patterns </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#interpolation class=md-nav__link> <span class=md-ellipsis> Interpolation </span> </a> <nav class=md-nav aria-label=Interpolation> <ul class=md-nav__list> <li class=md-nav__item> <a href=#linear class=md-nav__link> <span class=md-ellipsis> Linear </span> </a> </li> <li class=md-nav__item> <a href=#nearest class=md-nav__link> <span class=md-ellipsis> Nearest </span> </a> </li> <li class=md-nav__item> <a href=#discrete class=md-nav__link> <span class=md-ellipsis> Discrete </span> </a> </li> <li class=md-nav__item> <a href=#mixed class=md-nav__link> <span class=md-ellipsis> Mixed </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#rescaling class=md-nav__link> <span class=md-ellipsis> Rescaling </span> </a> <nav class=md-nav aria-label=Rescaling> <ul class=md-nav__list> <li class=md-nav__item> <a href=#rebasing class=md-nav__link> <span class=md-ellipsis> Rebasing </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#fitting class=md-nav__link> <span class=md-ellipsis> Fitting </span> </a> </li> <li class=md-nav__item> <a href=#similarity class=md-nav__link> <span class=md-ellipsis> Similarity </span> </a> <nav class=md-nav aria-label=Similarity> <ul class=md-nav__list> <li class=md-nav__item> <a href=#relative class=md-nav__link> <span class=md-ellipsis> Relative </span> </a> </li> <li class=md-nav__item> <a href=#inverse class=md-nav__link> <span class=md-ellipsis> Inverse </span> </a> </li> <li class=md-nav__item> <a href=#max-error class=md-nav__link> <span class=md-ellipsis> Max error </span> </a> <nav class=md-nav aria-label="Max error"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#interpolation_1 class=md-nav__link> <span class=md-ellipsis> Interpolation </span> </a> </li> <li class=md-nav__item> <a href=#max-distance class=md-nav__link> <span class=md-ellipsis> Max distance </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#further-filters class=md-nav__link> <span class=md-ellipsis> Further filters </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#rolling-similarity class=md-nav__link> <span class=md-ellipsis> Rolling similarity </span> </a> <nav class=md-nav aria-label="Rolling similarity"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#indicator class=md-nav__link> <span class=md-ellipsis> Indicator </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#search class=md-nav__link> <span class=md-ellipsis> Search </span> </a> <nav class=md-nav aria-label=Search> <ul class=md-nav__list> <li class=md-nav__item> <a href=#overlapping class=md-nav__link> <span class=md-ellipsis> Overlapping </span> </a> </li> <li class=md-nav__item> <a href=#random-selection class=md-nav__link> <span class=md-ellipsis> Random selection </span> </a> </li> <li class=md-nav__item> <a href=#params class=md-nav__link> <span class=md-ellipsis> Params </span> </a> </li> <li class=md-nav__item> <a href=#configs class=md-nav__link> <span class=md-ellipsis> Configs </span> </a> </li> <li class=md-nav__item> <a href=#mask class=md-nav__link> <span class=md-ellipsis> Mask </span> </a> </li> <li class=md-nav__item> <a href=#indicator_1 class=md-nav__link> <span class=md-ellipsis> Indicator </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#combination class=md-nav__link> <span class=md-ellipsis> Combination </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/patterns-and-projections/projections/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m23 7.5-6.47-.54L14 1l-2.53 5.96L5 7.5l4.9 4.27-1.46 6.33L14 14.74l5.56 3.36-1.47-6.33zm-6.86 4.73.4 1.71-1.51-.91-1.03-.62-1.03.62-1.51.91.39-1.71.28-1.18-.91-.79L9.88 9.1l1.76-.15 1.2-.1.47-1.11.69-1.62.69 1.62.47 1.11 1.2.1 1.75.15-1.33 1.16-.92.79zM1.16 12c-.299-.5-.171-1.11.29-1.41l2.73-1.8 1.57 1.36-3.2 2.11c-.17.11-.36.17-.55.17-.32 0-.64-.16-.84-.43m.29 8.16 5.86-3.85L7 17.76l-.34 1.37-4.11 2.71c-.17.11-.36.16-.55.16-.32 0-.64-.16-.84-.45a1.013 1.013 0 0 1 .29-1.39m5.87-8.66.92.81-.27 1.19-5.42 3.55c-.17.11-.36.16-.55.16-.32 0-.64-.15-.84-.45a1 1 0 0 1 .29-1.38z"/></svg> <span class=md-ellipsis> Projections </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/cross-validation/ class=md-nav__link> <span class=md-ellipsis> Cross-validation </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/more-tutorials/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10.6 13.4a1 1 0 0 1-1.4 1.4 4.8 4.8 0 0 1 0-7l3.5-3.6a5.1 5.1 0 0 1 7.1 0 5.1 5.1 0 0 1 0 7.1l-1.5 1.5a6.4 6.4 0 0 0-.4-2.4l.5-.5a3.2 3.2 0 0 0 0-4.3 3.2 3.2 0 0 0-4.3 0l-3.5 3.6a2.9 2.9 0 0 0 0 4.2M23 18v2h-3v3h-2v-3h-3v-2h3v-3h2v3m-3.8-4.3a4.8 4.8 0 0 0-1.4-4.5 1 1 0 0 0-1.4 1.4 2.9 2.9 0 0 1 0 4.2l-3.5 3.6a3.2 3.2 0 0 1-4.3 0 3.2 3.2 0 0 1 0-4.3l.5-.4a7.3 7.3 0 0 1-.4-2.5l-1.5 1.5a5.1 5.1 0 0 0 0 7.1 5.1 5.1 0 0 0 7.1 0l1.8-1.8a6 6 0 0 1 3.1-4.3"/></svg> <span class=md-ellipsis> More tutorials </span> </a> </li> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/to-be-continued/ class=md-nav__link> <span class=md-ellipsis> To be continued... </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/documentation/overview/ class=md-nav__link> <span class=md-ellipsis> Documentation </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/cookbook/overview/ class=md-nav__link> <span class=md-ellipsis> Cookbook </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/api/ class=md-nav__link> <span class=md-ellipsis> API </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/terms/terms-of-use/ class=md-nav__link> <span class=md-ellipsis> Terms </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <nav class=md-path aria-label=Navigation> <ol class=md-path__list> <li class=md-path__item> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/overview/ class=md-path__link> <span class=md-ellipsis> Tutorials </span> </a> </li> <li class=md-path__item> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/patterns-and-projections/patterns/ class=md-path__link> <span class=md-ellipsis> Patterns and projections </span> </a> </li> </ol> </nav> <article class="md-content__inner md-typeset"> <h1 id=patterns><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m23 7.5-6.47-.54L14 1l-2.53 5.96L5 7.5l4.9 4.27-1.46 6.33L14 14.74l5.56 3.36-1.47-6.33zm-6.86 4.73.4 1.71-1.51-.91-1.03-.62-1.03.62-1.51.91.39-1.71.28-1.18-.91-.79L9.88 9.1l1.76-.15 1.2-.1.47-1.11.69-1.62.69 1.62.47 1.11 1.2.1 1.75.15-1.33 1.16-.92.79zM1.16 12c-.299-.5-.171-1.11.29-1.41l2.73-1.8 1.57 1.36-3.2 2.11c-.17.11-.36.17-.55.17-.32 0-.64-.16-.84-.43m.29 8.16 5.86-3.85L7 17.76l-.34 1.37-4.11 2.71c-.17.11-.36.16-.55.16-.32 0-.64-.16-.84-.45a1.013 1.013 0 0 1 .29-1.39m5.87-8.66.92.81-.27 1.19-5.42 3.55c-.17.11-.36.16-.55.16-.32 0-.64-.15-.84-.45a1 1 0 0 1 .29-1.38z"/></svg></span> Patterns<a class=headerlink href=#patterns title="Permanent link">&para;</a></h1> <p>Patterns help bring order to what may seem like chaos. They appear throughout nature—such as circles in road signs or rectangles in windows and doors. Just as children gradually learn to navigate an entirely unknown environment by recognizing regularities, participants in financial markets must also learn to operate within their complex, ever-changing surroundings. Much like children who rely on parents, teachers, or even Google for guidance, we have a valuable tool to aid our understanding: quantitative analysis.</p> <p>In finance, patterns are distinctive formations formed by price movements on a chart and form the foundation of technical analysis. They can provide clues about what prices might do next, based on past behavior. For example, we can search for all previous occurrences of the same pattern we see today to analyze how events unfolded each time, enabling more nuanced trading decisions that consider multiple possibilities. Patterns are particularly valuable for identifying transition points between rising and falling trends, which is key to successful trade entries and exits. However, patterns do not guarantee future results, nor do they last forever. Unlike the real world, where structure and behavior tend to be consistent, financial markets are dominated by noise and <a href=https://en.wikipedia.org/wiki/False_positives_and_false_negatives>false positives</a> that arise from intense interactions among people, systems, and other entities. Discovering something that performs just slightly better than random in a specific market regime is already an accomplishment—an exciting game with probabilities.</p> <p>Let's walk through a simple use case where we want to identify the <a href=https://www.investopedia.com/terms/d/doubletop.asp>Double Top</a> pattern. We will start by pulling two years of daily <code>BTCUSDT</code> history as our baseline data:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span><span class=w> </span><span class=nn>vectorbtpro</span><span class=w> </span><span class=kn>import</span> <span class=o>*</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>BinanceData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=gp>... </span>    <span class=s2>&quot;BTCUSDT&quot;</span><span class=p>,</span> 
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=gp>... </span>    <span class=n>start</span><span class=o>=</span><span class=s2>&quot;2020-06-01 UTC&quot;</span><span class=p>,</span> 
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=gp>... </span>    <span class=n>end</span><span class=o>=</span><span class=s2>&quot;2022-06-01 UTC&quot;</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/data.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/data.dark.svg#only-dark></p> <p>A quick visual inspection suggests the most apparent occurrence of this pattern was between October and December 2021:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data_window</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=s2>&quot;2021-09-25&quot;</span><span class=p>:</span><span class=s2>&quot;2021-11-25&quot;</span><span class=p>]</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data_window</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>plot_volume</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/data_window.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/data_window.dark.svg#only-dark></p> <p>As humans, we can easily detect patterns visually in data. But how can we accomplish this programmatically, where everything is represented by numbers? It would be costly, unnecessary, and likely ineffective to train a <a href=https://en.wikipedia.org/wiki/Deep_learning>DNN</a> for such a simple task. Following the principle "the simpler the algorithm, the better" for noisy data, we should design an algorithm that tackles the problem using simple loops and basic math.</p> <p>Since each pattern is matched against a single feature of the data, we will use the <a href=https://en.wikipedia.org/wiki/Typical_price>typical price</a>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>price_window</span> <span class=o>=</span> <span class=n>data_window</span><span class=o>.</span><span class=n>hlc3</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>price_window</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/hlc3.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/hlc3.dark.svg#only-dark></p> <p>Next, let's design the pattern. Price patterns are identified using a series of lines or curves. For example, the "Double Top" pattern can be represented by the following array:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>])</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>pattern</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/double_top_pattern.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/double_top_pattern.dark.svg#only-dark></p> <p>It is important to note that the length and absolute values in the pattern definition do not matter. Whether the pattern scales from 1 to 3 or 1 to 60, it will be stretched horizontally and vertically to align with the corresponding price data. What matters for computation is the relative positioning of each point. For instance, the first point <code>2</code> comes exactly in the middle between <code>1</code> and <code>3</code>, meaning if the asset rises in price to match the second point, it should ideally make the same move to reach the first peak. Furthermore, since some values like <code>2</code> and <code>3</code> repeat, we do not expect the price at those points to deviate significantly, which helps define support and resistance levels.</p> <p>Another key rule relates to the horizontal structure of the pattern: regardless of the value at any given point, the location (timing) of a point is always relative to its neighboring points. For example, if the first point was matched on <code>2020-01-01</code> and the second on <code>2020-01-03</code>, the third point should be matched on <code>2020-01-06</code>. If any part of the pattern takes longer to form, changing the horizontal structure, a match becomes less likely.</p> <h2 id=interpolation>Interpolation<a class=headerlink href=#interpolation title="Permanent link">&para;</a></h2> <p>Once we have defined our pattern, we need to ensure that both the pattern and the price array are the same length. In image processing, increasing the size of an image involves reconstructing the image by <a href=https://en.wikipedia.org/wiki/Interpolation>interpolating</a> new pixels, while reducing the size involves <a href=https://en.wikipedia.org/wiki/Downsampling_(signal_processing)>downsampling</a> the existing pixels. In pattern processing, the approach is similar, but we work with one-dimensional arrays instead of two-dimensional ones. We also prefer interpolation (stretching) over downsampling (shrinking) to avoid losing information. This means that if the price array is shorter than the pattern, it should be stretched to match the pattern's length, rather than compressing the pattern to fit the price.</p> <p>There are four main interpolation modes in pattern processing: linear, nearest neighbor, discrete, and mixed. All of these are implemented using the Numba-compiled function <a href=https://vectorbt.pro/pvt_41531c19/api/generic/nb/patterns/#vectorbtpro.generic.nb.patterns.interp_resize_1d_nb>interp_resize_1d_nb</a>, which takes an array, a target size, and an interpolation mode of type <a href=https://vectorbt.pro/pvt_41531c19/api/generic/enums/#vectorbtpro.generic.enums.InterpMode>InterpMode</a>. The implementation is very efficient: it iterates through the array only once and does not require creating extra arrays except for the final output.</p> <h3 id=linear>Linear<a class=headerlink href=#linear title="Permanent link">&para;</a></h3> <p>The linear interpolation algorithm estimates new values by connecting two adjacent known values with a straight line (see <a href=https://scientific-python.readthedocs.io/en/latest/notebooks_rst/1_Interpolation/1D_interpolation.html#linear-interpolation>here</a> for an illustration).</p> <p>Let's stretch our pattern array to 10 points:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>resized_pattern</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>interp_resize_1d_nb</span><span class=p>(</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=gp>... </span>    <span class=n>pattern</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>InterpMode</span><span class=o>.</span><span class=n>Linear</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>resized_pattern</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=go>array([1.        , 1.55555556, 2.11111111, 2.66666667, 2.77777778,</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=go>       2.22222222, 2.33333333, 2.88888889, 2.55555556, 2.        ])</span>
</span></code></pre></div> <p>This mode works best when the target size is close to <code>2 * n - 1</code>, where <code>n</code> is the original array size. In this case, the characteristics of the resized array closely match those of the original. Otherwise, the relationship between points may be distorted, unless the target size is significantly larger than the original. This is best illustrated below, where we resize the array to lengths of 7, 11, and 30 points:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>plot_linear</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=gp>... </span>    <span class=n>resized_pattern</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>interp_resize_1d_nb</span><span class=p>(</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=gp>... </span>        <span class=n>pattern</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>InterpMode</span><span class=o>.</span><span class=n>Linear</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=gp>... </span>    <span class=p>)</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>resized_pattern</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span>
</span></code></pre></div> <div class="tabbed-set tabbed-alternate" data-tabs=1:3><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><input id=__tabbed_1_3 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>7 points</label><label for=__tabbed_1_2>11 points</label><label for=__tabbed_1_3>30 points</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>plot_linear</span><span class=p>(</span><span class=mi>7</span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/linear_7.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/linear_7.dark.svg#only-dark></p> </div> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>plot_linear</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/linear_11.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/linear_11.dark.svg#only-dark></p> </div> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>plot_linear</span><span class=p>(</span><span class=mi>30</span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/linear_30.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/linear_30.dark.svg#only-dark></p> </div> </div> </div> <p>Why does the first graph look so "ugly"? This happens because the algorithm maintains the same distance between each pair of points in the resized array. To stretch a 6-point array to 7 points, the algorithm splits the graph of the 6-point array into 7 parts and selects the value at the midpoint of each part, like this:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>resized_pattern</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>interp_resize_1d_nb</span><span class=p>(</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=gp>... </span>    <span class=n>pattern</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>InterpMode</span><span class=o>.</span><span class=n>Linear</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>ratio</span> <span class=o>=</span> <span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>pattern</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>/</span> <span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>resized_pattern</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>new_points</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>resized_pattern</span><span class=p>))</span> <span class=o>*</span> <span class=n>ratio</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>pattern</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>resized_pattern</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=n>new_points</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>scatterplot</span><span class=p>(</span><span class=n>fig</span><span class=o>=</span><span class=n>fig</span><span class=p>)</span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/linear_7_scatter.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/linear_7_scatter.dark.svg#only-dark></p> <p>As you can see, linear interpolation is about selecting a specific number of equidistant values from the original array. The more points there are, the better the result. The main issue is that when the target size is suboptimal, the scale of the resized array changes. In the example above, the pattern is distorted and the original link between points with a value of <code>2</code> is lost. However, other interpolation algorithms may perform better in these cases.</p> <h3 id=nearest>Nearest<a class=headerlink href=#nearest title="Permanent link">&para;</a></h3> <p>The nearest neighbor algorithm selects the value of the closest point and does not consider other values at all (see <a href=https://scientific-python.readthedocs.io/en/latest/notebooks_rst/1_Interpolation/1D_interpolation.html#nearest-aka-piecewise-interpolation>here</a> for an illustration). With this approach, the resized array consists only of values from the original array, so there are no intermediate floating-point values:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>resized_pattern</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>interp_resize_1d_nb</span><span class=p>(</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=gp>... </span>    <span class=n>pattern</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>InterpMode</span><span class=o>.</span><span class=n>Nearest</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>resized_pattern</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=go>array([1., 2., 2., 3., 3., 2., 2., 3., 3., 2.])</span>
</span></code></pre></div> <div class="admonition info"> <p class=admonition-title>Info</p> <p>For consistency, the resized array is always floating-point.</p> </div> <p>Below are resized arrays for different target sizes:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>plot_nearest</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=gp>... </span>    <span class=n>resized_pattern</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>interp_resize_1d_nb</span><span class=p>(</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=gp>... </span>        <span class=n>pattern</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>InterpMode</span><span class=o>.</span><span class=n>Nearest</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=gp>... </span>    <span class=p>)</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>resized_pattern</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span>
</span></code></pre></div> <div class="tabbed-set tabbed-alternate" data-tabs=2:3><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><input id=__tabbed_2_2 name=__tabbed_2 type=radio><input id=__tabbed_2_3 name=__tabbed_2 type=radio><div class=tabbed-labels><label for=__tabbed_2_1>7 points</label><label for=__tabbed_2_2>11 points</label><label for=__tabbed_2_3>30 points</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>plot_nearest</span><span class=p>(</span><span class=mi>7</span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/nearest_7.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/nearest_7.dark.svg#only-dark></p> </div> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>plot_nearest</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/nearest_11.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/nearest_11.dark.svg#only-dark></p> </div> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>plot_nearest</span><span class=p>(</span><span class=mi>30</span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/nearest_30.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/nearest_30.dark.svg#only-dark></p> </div> </div> </div> <p>As you can see, each graph is a step curve with horizontal and vertical lines. Because of this, it can be challenging to use when we expect the price to change smoothly rather than jump abruptly. This interpolation mode should only be used if the original array is granular enough to smooth out the transitions between local extrema.</p> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>The <code>2 * n - 1</code> guideline does not apply to this mode.</p> </div> <h3 id=discrete>Discrete<a class=headerlink href=#discrete title="Permanent link">&para;</a></h3> <p>The discrete interpolation algorithm selects a value if it is closer to the target position than the other values; if not, it assigns a value of NaN. This mode ensures that each value from the original array appears only once in the output, but it may still change their temporal distribution. It is best used in scenarios where transitions between points are not important.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>resized_pattern</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>interp_resize_1d_nb</span><span class=p>(</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=gp>... </span>    <span class=n>pattern</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>InterpMode</span><span class=o>.</span><span class=n>Discrete</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>resized_pattern</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=go>array([ 1., nan,  2., nan,  3.,  2., nan,  3., nan,  2.])</span>
</span></code></pre></div> <p>Here is a comparison of arrays resized to different target sizes:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>plot_discrete</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=gp>... </span>    <span class=n>resized_pattern</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>interp_resize_1d_nb</span><span class=p>(</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=gp>... </span>        <span class=n>pattern</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>InterpMode</span><span class=o>.</span><span class=n>Discrete</span>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=gp>... </span>    <span class=p>)</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>resized_pattern</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=gp>... </span>        <span class=n>trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=gp>... </span>            <span class=n>line</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>dash</span><span class=o>=</span><span class=s2>&quot;dot&quot;</span><span class=p>),</span>
</span><span id=__span-16-8><a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=gp>... </span>            <span class=n>connectgaps</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-16-9><a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a><span class=gp>... </span>        <span class=p>)</span>
</span><span id=__span-16-10><a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a><span class=gp>... </span>    <span class=p>)</span>
</span></code></pre></div> <div class="tabbed-set tabbed-alternate" data-tabs=3:3><input checked=checked id=__tabbed_3_1 name=__tabbed_3 type=radio><input id=__tabbed_3_2 name=__tabbed_3 type=radio><input id=__tabbed_3_3 name=__tabbed_3 type=radio><div class=tabbed-labels><label for=__tabbed_3_1>7 points</label><label for=__tabbed_3_2>11 points</label><label for=__tabbed_3_3>30 points</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>plot_discrete</span><span class=p>(</span><span class=mi>7</span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/discrete_7.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/discrete_7.dark.svg#only-dark></p> </div> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>plot_discrete</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/discrete_11.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/discrete_11.dark.svg#only-dark></p> </div> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>plot_discrete</span><span class=p>(</span><span class=mi>30</span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/discrete_30.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/discrete_30.dark.svg#only-dark></p> </div> </div> </div> <p>Each graph contains exactly 6 points that have been mapped to a new interval by aiming to keep the distance between them as equal as possible. Similar to linear interpolation, this mode also gives the best results when the target size is <code>2 * n - 1</code>, while other sizes distort the temporal distribution of the points. However, unlike linear interpolation, this mode preserves the absolute values of the original array, so the point <code>2</code> is always guaranteed to be midway between points <code>1</code> and <code>3</code>.</p> <h3 id=mixed>Mixed<a class=headerlink href=#mixed title="Permanent link">&para;</a></h3> <p>The mixed interpolation algorithm combines the linear and discrete interpolation algorithms. First, it applies the discrete interpolator, and if the value is NaN, it then applies the linear interpolator. This approach ensures that each value from the original array is included at least once to preserve the original scale, while intermediate values are filled using linear interpolation—giving us the best of both worlds.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>resized_pattern</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>interp_resize_1d_nb</span><span class=p>(</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=gp>... </span>    <span class=n>pattern</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>InterpMode</span><span class=o>.</span><span class=n>Mixed</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>resized_pattern</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=go>array([1.        , 1.55555556, 2.        , 2.66666667, 3.        ,</span>
</span><span id=__span-20-6><a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=go>       2.        , 2.33333333, 3.        , 2.55555556, 2.        ])</span>
</span></code></pre></div> <p>Let's show how the mixed approach "fixes" the scale issue of the linear approach:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>plot_mixed</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=gp>... </span>    <span class=n>lin_resized_pattern</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>interp_resize_1d_nb</span><span class=p>(</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=gp>... </span>        <span class=n>pattern</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>InterpMode</span><span class=o>.</span><span class=n>Linear</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=gp>... </span>    <span class=p>)</span>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=gp>... </span>    <span class=n>mix_resized_pattern</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>interp_resize_1d_nb</span><span class=p>(</span>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a><span class=gp>... </span>        <span class=n>pattern</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>InterpMode</span><span class=o>.</span><span class=n>Mixed</span>
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a><span class=gp>... </span>    <span class=p>)</span>
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a><span class=gp>... </span>    <span class=n>fig</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>lin_resized_pattern</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;Linear&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span>
</span><span id=__span-21-9><a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a><span class=gp>... </span>    <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>mix_resized_pattern</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;Mixed&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>fig</span><span class=o>=</span><span class=n>fig</span><span class=p>)</span>
</span><span id=__span-21-10><a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>fig</span>
</span></code></pre></div> <div class="tabbed-set tabbed-alternate" data-tabs=4:3><input checked=checked id=__tabbed_4_1 name=__tabbed_4 type=radio><input id=__tabbed_4_2 name=__tabbed_4 type=radio><input id=__tabbed_4_3 name=__tabbed_4 type=radio><div class=tabbed-labels><label for=__tabbed_4_1>7 points</label><label for=__tabbed_4_2>11 points</label><label for=__tabbed_4_3>30 points</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>plot_mixed</span><span class=p>(</span><span class=mi>7</span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/mixed_7.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/mixed_7.dark.svg#only-dark></p> </div> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>plot_mixed</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/mixed_11.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/mixed_11.dark.svg#only-dark></p> </div> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>plot_mixed</span><span class=p>(</span><span class=mi>30</span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/mixed_30.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/mixed_30.dark.svg#only-dark></p> </div> </div> </div> <div class="admonition info"> <p class=admonition-title>Info</p> <p>As you may have noticed, the last pattern line on the graph is not completely straight. This is because mixed interpolation uses both linear and discrete approaches to retain the original scale. Producing a perfectly straight line would require passing through the data multiple times, and for performance reasons, we chose efficiency over complete visual smoothness.</p> </div> <p>We have restored the original connections between the various points, so this algorithm should be (and is) the default choice for interpolation without gaps.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>resized_pattern</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>interp_resize_1d_nb</span><span class=p>(</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=gp>... </span>    <span class=n>pattern</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>price_window</span><span class=p>),</span> <span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>InterpMode</span><span class=o>.</span><span class=n>Mixed</span>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>resized_pattern</span><span class=o>.</span><span class=n>shape</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=go>(62,)</span>
</span></code></pre></div> <h2 id=rescaling>Rescaling<a class=headerlink href=#rescaling title="Permanent link">&para;</a></h2> <p>After bringing the pattern and the price to the same length, we also need to match their scales to make them comparable. To do this, we compute the minimum and maximum of both the pattern and the price, then rescale the pattern to match the scale of the price. We can use the Numba-compiled function <a href=https://vectorbt.pro/pvt_41531c19/api/utils/array_/#vectorbtpro.utils.array_.rescale_nb>rescale_nb</a>, which takes an array, the scale of the array, and the target scale:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_scale</span> <span class=o>=</span> <span class=p>(</span><span class=n>resized_pattern</span><span class=o>.</span><span class=n>min</span><span class=p>(),</span> <span class=n>resized_pattern</span><span class=o>.</span><span class=n>max</span><span class=p>())</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>price_window_scale</span> <span class=o>=</span> <span class=p>(</span><span class=n>price_window</span><span class=o>.</span><span class=n>min</span><span class=p>(),</span> <span class=n>price_window</span><span class=o>.</span><span class=n>max</span><span class=p>())</span>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>rescaled_pattern</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>utils</span><span class=o>.</span><span class=n>array_</span><span class=o>.</span><span class=n>rescale_nb</span><span class=p>(</span>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=gp>... </span>    <span class=n>resized_pattern</span><span class=p>,</span> <span class=n>pattern_scale</span><span class=p>,</span> <span class=n>price_window_scale</span>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>rescaled_pattern</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>rescaled_pattern</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=n>price_window</span><span class=o>.</span><span class=n>index</span><span class=p>)</span>
</span></code></pre></div> <p>Now we can finally overlay the pattern on top of the price:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span> <span class=o>=</span> <span class=n>price_window</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>rescaled_pattern</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span>
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=gp>... </span>    <span class=n>trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=gp>... </span>        <span class=n>fill</span><span class=o>=</span><span class=s2>&quot;tonexty&quot;</span><span class=p>,</span> 
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a><span class=gp>... </span>        <span class=n>fillcolor</span><span class=o>=</span><span class=s2>&quot;rgba(255, 0, 0, 0.25)&quot;</span>
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a><span class=gp>... </span>    <span class=p>),</span> 
</span><span id=__span-27-7><a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a><span class=gp>... </span>    <span class=n>fig</span><span class=o>=</span><span class=n>fig</span>
</span><span id=__span-27-8><a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-27-9><a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/rescaled_pattern.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/rescaled_pattern.dark.svg#only-dark></p> <h3 id=rebasing>Rebasing<a class=headerlink href=#rebasing title="Permanent link">&para;</a></h3> <p>Another way to match the scales of both arrays is rebasing. When rebasing, the first value of both arrays is made equal, and all other values are rescaled based on their relative distance from the starting point. This is useful if your pattern should enforce a specific percentage change from the starting value. For example, let's ensure a relative distance of 60% between the peak and the starting point:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pct_pattern</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mf>1.3</span><span class=p>,</span> <span class=mf>1.6</span><span class=p>,</span> <span class=mf>1.3</span><span class=p>,</span> <span class=mf>1.6</span><span class=p>,</span> <span class=mf>1.3</span><span class=p>])</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>resized_pct_pattern</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>interp_resize_1d_nb</span><span class=p>(</span>
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=gp>... </span>    <span class=n>pct_pattern</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>price_window</span><span class=p>),</span> <span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>InterpMode</span><span class=o>.</span><span class=n>Mixed</span>
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-28-5><a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>rebased_pattern</span> <span class=o>=</span> <span class=n>resized_pct_pattern</span> <span class=o>/</span> <span class=n>resized_pct_pattern</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-28-6><a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>rebased_pattern</span> <span class=o>*=</span> <span class=n>price_window</span><span class=o>.</span><span class=n>values</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-28-7><a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>rebased_pattern</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>(</span><span class=n>rebased_pattern</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=n>price_window</span><span class=o>.</span><span class=n>index</span><span class=p>)</span>
</span><span id=__span-28-8><a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span> <span class=o>=</span> <span class=n>price_window</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span>
</span><span id=__span-28-9><a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>rebased_pattern</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span>
</span><span id=__span-28-10><a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a><span class=gp>... </span>    <span class=n>trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-28-11><a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a><span class=gp>... </span>        <span class=n>fill</span><span class=o>=</span><span class=s2>&quot;tonexty&quot;</span><span class=p>,</span> 
</span><span id=__span-28-12><a id=__codelineno-28-12 name=__codelineno-28-12 href=#__codelineno-28-12></a><span class=gp>... </span>        <span class=n>fillcolor</span><span class=o>=</span><span class=s2>&quot;rgba(255, 0, 0, 0.25)&quot;</span>
</span><span id=__span-28-13><a id=__codelineno-28-13 name=__codelineno-28-13 href=#__codelineno-28-13></a><span class=gp>... </span>    <span class=p>),</span> 
</span><span id=__span-28-14><a id=__codelineno-28-14 name=__codelineno-28-14 href=#__codelineno-28-14></a><span class=gp>... </span>    <span class=n>fig</span><span class=o>=</span><span class=n>fig</span>
</span><span id=__span-28-15><a id=__codelineno-28-15 name=__codelineno-28-15 href=#__codelineno-28-15></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-28-16><a id=__codelineno-28-16 name=__codelineno-28-16 href=#__codelineno-28-16></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/rebased_pattern.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/rebased_pattern.dark.svg#only-dark></p> <h2 id=fitting>Fitting<a class=headerlink href=#fitting title="Permanent link">&para;</a></h2> <p>Interpolation and rescaling are required to bring both the pattern and the price to the same length and scale so they can be compared and combined as regular NumPy arrays. Rather than performing the above steps manually, let's use a special function that does the entire job for us: <a href=https://vectorbt.pro/pvt_41531c19/api/generic/nb/patterns/#vectorbtpro.generic.nb.patterns.fit_pattern_nb>fit_pattern_nb</a>.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>new_pattern</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>fit_pattern_nb</span><span class=p>(</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=gp>... </span>    <span class=n>price_window</span><span class=o>.</span><span class=n>values</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=gp>... </span>    <span class=n>pct_pattern</span><span class=p>,</span>  <span class=c1># (2)!</span>
</span><span id=__span-29-4><a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=gp>... </span>    <span class=n>interp_mode</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>InterpMode</span><span class=o>.</span><span class=n>Mixed</span><span class=p>,</span>
</span><span id=__span-29-5><a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=gp>... </span>    <span class=n>rescale_mode</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>RescaleMode</span><span class=o>.</span><span class=n>Rebase</span>  <span class=c1># (3)!</span>
</span><span id=__span-29-6><a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a><span class=gp>... </span><span class=p>)</span>
</span></code></pre></div> <ol> <li>The first argument is a price array. Since Numba does not recognize Pandas objects, extract the NumPy array from your Series.</li> <li>The second argument is a pattern array. You can pass this as-is, since it is already in NumPy format.</li> <li>See <a href=https://vectorbt.pro/pvt_41531c19/api/generic/enums/#vectorbtpro.generic.enums.RescaleMode>RescaleMode</a>.</li> </ol> <p>What does <code>_</code> mean? The function actually returns two arrays: one for the pattern and one for the maximum error (see <a href=#max-error>Max error</a>). Since we do not need the maximum error array, we ignore it by using <code>_</code> instead of a variable name. Let's check that the automatically generated array matches the manually generated one:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>np</span><span class=o>.</span><span class=n>testing</span><span class=o>.</span><span class=n>assert_array_equal</span><span class=p>(</span><span class=n>new_pattern</span><span class=p>,</span> <span class=n>rebased_pattern</span><span class=p>)</span>
</span></code></pre></div> <p>No errors are raised—both arrays are identical!</p> <h2 id=similarity>Similarity<a class=headerlink href=#similarity title="Permanent link">&para;</a></h2> <p>Now that our arrays are perfectly comparable, how do we calculate their similarity? The algorithm is simple: compute the absolute, element-wise differences between the two arrays and add them up (also known as <a href=https://en.wikipedia.org/wiki/Mean_absolute_error>Mean Absolute Error</a> or MAE). At the same time, compute the maximum possible absolute, element-wise differences and add those up. The maximum distance is calculated relative to the global minimum and maximum value. Finally, divide both totals and subtract from 1 to get the similarity score, which ranges between 0 and 1:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>abs_distances</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>abs</span><span class=p>(</span><span class=n>rescaled_pattern</span> <span class=o>-</span> <span class=n>price_window</span><span class=o>.</span><span class=n>values</span><span class=p>)</span>
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mae</span> <span class=o>=</span> <span class=n>abs_distances</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-31-3><a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>max_abs_distances</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>column_stack</span><span class=p>((</span>
</span><span id=__span-31-4><a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a><span class=gp>... </span>    <span class=p>(</span><span class=n>price_window</span><span class=o>.</span><span class=n>max</span><span class=p>()</span> <span class=o>-</span> <span class=n>rescaled_pattern</span><span class=p>),</span> 
</span><span id=__span-31-5><a id=__codelineno-31-5 name=__codelineno-31-5 href=#__codelineno-31-5></a><span class=gp>... </span>    <span class=p>(</span><span class=n>rescaled_pattern</span> <span class=o>-</span> <span class=n>price_window</span><span class=o>.</span><span class=n>min</span><span class=p>())</span>
</span><span id=__span-31-6><a id=__codelineno-31-6 name=__codelineno-31-6 href=#__codelineno-31-6></a><span class=gp>... </span><span class=p>))</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span><span id=__span-31-7><a id=__codelineno-31-7 name=__codelineno-31-7 href=#__codelineno-31-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>max_mae</span> <span class=o>=</span> <span class=n>max_abs_distances</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-31-8><a id=__codelineno-31-8 name=__codelineno-31-8 href=#__codelineno-31-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>similarity</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>-</span> <span class=n>mae</span> <span class=o>/</span> <span class=n>max_mae</span>
</span><span id=__span-31-9><a id=__codelineno-31-9 name=__codelineno-31-9 href=#__codelineno-31-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>similarity</span>
</span><span id=__span-31-10><a id=__codelineno-31-10 name=__codelineno-31-10 href=#__codelineno-31-10></a><span class=go>0.8726845123416802</span>
</span></code></pre></div> <p>To penalize large distances and make pattern detection more "strict," you can switch the distance measure to the root of the sum of squared differences (also called <a href=https://en.wikipedia.org/wiki/Root-mean-square_deviation>Root Mean Squared Error</a> or RMSE):</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>quad_distances</span> <span class=o>=</span> <span class=p>(</span><span class=n>rescaled_pattern</span> <span class=o>-</span> <span class=n>price_window</span><span class=o>.</span><span class=n>values</span><span class=p>)</span> <span class=o>**</span> <span class=mi>2</span>
</span><span id=__span-32-2><a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>rmse</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>quad_distances</span><span class=o>.</span><span class=n>sum</span><span class=p>())</span>
</span><span id=__span-32-3><a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>max_quad_distances</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>column_stack</span><span class=p>((</span>
</span><span id=__span-32-4><a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a><span class=gp>... </span>    <span class=p>(</span><span class=n>price_window</span><span class=o>.</span><span class=n>max</span><span class=p>()</span> <span class=o>-</span> <span class=n>rescaled_pattern</span><span class=p>),</span> 
</span><span id=__span-32-5><a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a><span class=gp>... </span>    <span class=p>(</span><span class=n>rescaled_pattern</span> <span class=o>-</span> <span class=n>price_window</span><span class=o>.</span><span class=n>min</span><span class=p>())</span>
</span><span id=__span-32-6><a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a><span class=gp>... </span><span class=p>))</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span> <span class=o>**</span> <span class=mi>2</span>
</span><span id=__span-32-7><a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>max_rmse</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>max_quad_distances</span><span class=o>.</span><span class=n>sum</span><span class=p>())</span>
</span><span id=__span-32-8><a id=__codelineno-32-8 name=__codelineno-32-8 href=#__codelineno-32-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>similarity</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>-</span> <span class=n>rmse</span> <span class=o>/</span> <span class=n>max_rmse</span>
</span><span id=__span-32-9><a id=__codelineno-32-9 name=__codelineno-32-9 href=#__codelineno-32-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>similarity</span>
</span><span id=__span-32-10><a id=__codelineno-32-10 name=__codelineno-32-10 href=#__codelineno-32-10></a><span class=go>0.8484851233108504</span>
</span></code></pre></div> <p>As another option, you could also remove the root from the equation above and calculate just the sum of squared differences (also known as <a href=https://en.wikipedia.org/wiki/Mean_squared_error>Mean Squared Error</a> or MSE):</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>quad_distances</span> <span class=o>=</span> <span class=p>(</span><span class=n>rescaled_pattern</span> <span class=o>-</span> <span class=n>price_window</span><span class=o>.</span><span class=n>values</span><span class=p>)</span> <span class=o>**</span> <span class=mi>2</span>
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mse</span> <span class=o>=</span> <span class=n>quad_distances</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>max_quad_distances</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>column_stack</span><span class=p>((</span>
</span><span id=__span-33-4><a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a><span class=gp>... </span>    <span class=p>(</span><span class=n>price_window</span><span class=o>.</span><span class=n>max</span><span class=p>()</span> <span class=o>-</span> <span class=n>rescaled_pattern</span><span class=p>),</span> 
</span><span id=__span-33-5><a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a><span class=gp>... </span>    <span class=p>(</span><span class=n>rescaled_pattern</span> <span class=o>-</span> <span class=n>price_window</span><span class=o>.</span><span class=n>min</span><span class=p>())</span>
</span><span id=__span-33-6><a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a><span class=gp>... </span><span class=p>))</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span> <span class=o>**</span> <span class=mi>2</span>
</span><span id=__span-33-7><a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>max_mse</span> <span class=o>=</span> <span class=n>max_quad_distances</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-33-8><a id=__codelineno-33-8 name=__codelineno-33-8 href=#__codelineno-33-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>similarity</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>-</span> <span class=n>mse</span> <span class=o>/</span> <span class=n>max_mse</span>
</span><span id=__span-33-9><a id=__codelineno-33-9 name=__codelineno-33-9 href=#__codelineno-33-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>similarity</span>
</span><span id=__span-33-10><a id=__codelineno-33-10 name=__codelineno-33-10 href=#__codelineno-33-10></a><span class=go>0.9770432421418718</span>
</span></code></pre></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Since the maximum distance is now the absolute maximum distance squared, the similarity will often exceed 90%. Do not forget to adjust your thresholds accordingly.</p> </div> <p>If you are not excited about writing the code above each time you need to measure similarity between two arrays, do not worry! As with everything, there is a convenient Numba-compiled function <a href=https://vectorbt.pro/pvt_41531c19/api/generic/nb/patterns/#vectorbtpro.generic.nb.patterns.pattern_similarity_nb>pattern_similarity_nb</a>, which combines all the steps above to produce a single score. This function accepts many options for interpolation, rescaling, and distance measurement, and runs in <a href=https://en.wikipedia.org/wiki/Time_complexity>O(n)</a> time without creating any new arrays. Due to its exceptional efficiency and Numba compilation, you can run this function millions of times in a fraction of a second <img alt=🔥 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f525.svg title=:fire:> The only difference from our approach above is that it rescales the price array to the pattern scale, not the other way around (which we did for plotting purposes).</p> <p>Let's see the power of this function by replicating our pipeline above:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>pattern_similarity_nb</span><span class=p>(</span><span class=n>price_window</span><span class=o>.</span><span class=n>values</span><span class=p>,</span> <span class=n>pattern</span><span class=p>)</span>
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a><span class=go>0.8726845123416802</span>
</span></code></pre></div> <p>This produces the same score as our manual calculation <img alt=👀 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f440.svg title=:eyes:></p> <p>Now, let's calculate the similarity score for <code>pct_pattern</code> with rebasing:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-35-1><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>pattern_similarity_nb</span><span class=p>(</span>
</span><span id=__span-35-2><a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a><span class=gp>... </span>    <span class=n>price_window</span><span class=o>.</span><span class=n>values</span><span class=p>,</span> 
</span><span id=__span-35-3><a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a><span class=gp>... </span>    <span class=n>pct_pattern</span><span class=p>,</span> 
</span><span id=__span-35-4><a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a><span class=gp>... </span>    <span class=n>rescale_mode</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>RescaleMode</span><span class=o>.</span><span class=n>Rebase</span>  <span class=c1># (1)!</span>
</span><span id=__span-35-5><a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-35-6><a id=__codelineno-35-6 name=__codelineno-35-6 href=#__codelineno-35-6></a><span class=go>0.8647140967291362</span>
</span></code></pre></div> <ol> <li>See <a href=https://vectorbt.pro/pvt_41531c19/api/generic/enums/#vectorbtpro.generic.enums.RescaleMode>RescaleMode</a></li> </ol> <p>Let's get the similarity score by interpolating the pattern using nearest-neighbor interpolation, rebasing, and RMSE:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-36-1><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>pattern_similarity_nb</span><span class=p>(</span>
</span><span id=__span-36-2><a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a><span class=gp>... </span>    <span class=n>price_window</span><span class=o>.</span><span class=n>values</span><span class=p>,</span> 
</span><span id=__span-36-3><a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a><span class=gp>... </span>    <span class=n>pct_pattern</span><span class=p>,</span> 
</span><span id=__span-36-4><a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a><span class=gp>... </span>    <span class=n>interp_mode</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>InterpMode</span><span class=o>.</span><span class=n>Nearest</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-36-5><a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a><span class=gp>... </span>    <span class=n>rescale_mode</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>RescaleMode</span><span class=o>.</span><span class=n>Rebase</span><span class=p>,</span>
</span><span id=__span-36-6><a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a><span class=gp>... </span>    <span class=n>distance_measure</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>DistanceMeasure</span><span class=o>.</span><span class=n>RMSE</span>  <span class=c1># (2)!</span>
</span><span id=__span-36-7><a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-36-8><a id=__codelineno-36-8 name=__codelineno-36-8 href=#__codelineno-36-8></a><span class=go>0.76151009787845</span>
</span></code></pre></div> <ol> <li>See <a href=https://vectorbt.pro/pvt_41531c19/api/generic/enums/#vectorbtpro.generic.enums.InterpMode>InterpMode</a>.</li> <li>See <a href=https://vectorbt.pro/pvt_41531c19/api/generic/enums/#vectorbtpro.generic.enums.DistanceMeasure>DistanceMeasure</a>.</li> </ol> <p>Often, we are not only interested in getting the similarity measure but also in visualizing and debugging the pattern. In this case, we can call the accessor method <a href=https://vectorbt.pro/pvt_41531c19/api/generic/accessors/#vectorbtpro.generic.accessors.GenericSRAccessor.plot_pattern>GenericSRAccessor.plot_pattern</a>, which reconstructs the similarity calculation and visually displays various artifacts. To produce an accurate plot, provide the same arguments as you did to the similarity calculation function. Our last example produced a similarity of 75%. Let's visualize the fit:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-37-1><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>price_window</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot_pattern</span><span class=p>(</span>
</span><span id=__span-37-2><a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class=gp>... </span>    <span class=n>pct_pattern</span><span class=p>,</span> 
</span><span id=__span-37-3><a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a><span class=gp>... </span>    <span class=n>interp_mode</span><span class=o>=</span><span class=s2>&quot;nearest&quot;</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-37-4><a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a><span class=gp>... </span>    <span class=n>rescale_mode</span><span class=o>=</span><span class=s2>&quot;rebase&quot;</span><span class=p>,</span>
</span><span id=__span-37-5><a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a><span class=gp>... </span>    <span class=n>fill_distance</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-37-6><a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Here, you can provide each option as a string.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/plot_pattern.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/plot_pattern.dark.svg#only-dark></p> <p>We can see that the largest discrepancy appears at the valley in the middle. The interpolated pattern expects the price to dip deeper than it actually does. Let's add 15% to that point to increase the similarity:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-38-1><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>adj_pct_pattern</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mf>1.3</span><span class=p>,</span> <span class=mf>1.6</span><span class=p>,</span> <span class=mf>1.45</span><span class=p>,</span> <span class=mf>1.6</span><span class=p>,</span> <span class=mf>1.3</span><span class=p>])</span>
</span><span id=__span-38-2><a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>pattern_similarity_nb</span><span class=p>(</span>
</span><span id=__span-38-3><a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a><span class=gp>... </span>    <span class=n>price_window</span><span class=o>.</span><span class=n>values</span><span class=p>,</span> 
</span><span id=__span-38-4><a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a><span class=gp>... </span>    <span class=n>adj_pct_pattern</span><span class=p>,</span> 
</span><span id=__span-38-5><a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a><span class=gp>... </span>    <span class=n>interp_mode</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>InterpMode</span><span class=o>.</span><span class=n>Nearest</span><span class=p>,</span>
</span><span id=__span-38-6><a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a><span class=gp>... </span>    <span class=n>rescale_mode</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>RescaleMode</span><span class=o>.</span><span class=n>Rebase</span><span class=p>,</span>
</span><span id=__span-38-7><a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a><span class=gp>... </span>    <span class=n>distance_measure</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>DistanceMeasure</span><span class=o>.</span><span class=n>RMSE</span>
</span><span id=__span-38-8><a id=__codelineno-38-8 name=__codelineno-38-8 href=#__codelineno-38-8></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-38-9><a id=__codelineno-38-9 name=__codelineno-38-9 href=#__codelineno-38-9></a><span class=go>0.8086016654243109</span>
</span></code></pre></div> <p>Here is how the discrete interpolation applied to the new pattern looks:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-39-1><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>price_window</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot_pattern</span><span class=p>(</span>
</span><span id=__span-39-2><a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a><span class=gp>... </span>    <span class=n>adj_pct_pattern</span><span class=p>,</span> 
</span><span id=__span-39-3><a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a><span class=gp>... </span>    <span class=n>interp_mode</span><span class=o>=</span><span class=s2>&quot;discrete&quot;</span><span class=p>,</span>
</span><span id=__span-39-4><a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a><span class=gp>... </span>    <span class=n>rescale_mode</span><span class=o>=</span><span class=s2>&quot;rebase&quot;</span><span class=p>,</span>
</span><span id=__span-39-5><a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/plot_pattern_discrete.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/plot_pattern_discrete.dark.svg#only-dark></p> <p>The pattern trace appears as a scatter plot rather than a line plot because the similarity score is calculated only at those points, and the grayed out points are ignored. If we calculate the similarity score again, we see a higher value than before because the pattern at those points matches the price more closely:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-40-1><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>pattern_similarity_nb</span><span class=p>(</span>
</span><span id=__span-40-2><a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a><span class=gp>... </span>    <span class=n>price_window</span><span class=o>.</span><span class=n>values</span><span class=p>,</span> 
</span><span id=__span-40-3><a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a><span class=gp>... </span>    <span class=n>adj_pct_pattern</span><span class=p>,</span> 
</span><span id=__span-40-4><a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a><span class=gp>... </span>    <span class=n>interp_mode</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>InterpMode</span><span class=o>.</span><span class=n>Discrete</span><span class=p>,</span>
</span><span id=__span-40-5><a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a><span class=gp>... </span>    <span class=n>rescale_mode</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>RescaleMode</span><span class=o>.</span><span class=n>Rebase</span><span class=p>,</span>
</span><span id=__span-40-6><a id=__codelineno-40-6 name=__codelineno-40-6 href=#__codelineno-40-6></a><span class=gp>... </span>    <span class=n>distance_measure</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>DistanceMeasure</span><span class=o>.</span><span class=n>RMSE</span>
</span><span id=__span-40-7><a id=__codelineno-40-7 name=__codelineno-40-7 href=#__codelineno-40-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-40-8><a id=__codelineno-40-8 name=__codelineno-40-8 href=#__codelineno-40-8></a><span class=go>0.8719692914480557</span>
</span></code></pre></div> <h3 id=relative>Relative<a class=headerlink href=#relative title="Permanent link">&para;</a></h3> <p>Since the price is not static and may change significantly during the period of comparison, it is better to calculate the relative distance (error) instead of the absolute distance. For example, if the first price point is <code>10</code> and the last price point is <code>1000</code>, the distance to the latter would have a much greater impact on the similarity score than the distance to the former. Let's re-calculate the score manually and automatically using relative distances:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-41-1><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>abs_pct_distances</span> <span class=o>=</span> <span class=n>abs_distances</span> <span class=o>/</span> <span class=n>rescaled_pattern</span>
</span><span id=__span-41-2><a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pct_mae</span> <span class=o>=</span> <span class=n>abs_pct_distances</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-41-3><a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>max_abs_pct_distances</span> <span class=o>=</span> <span class=n>max_abs_distances</span> <span class=o>/</span> <span class=n>rescaled_pattern</span>
</span><span id=__span-41-4><a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>max_pct_mae</span> <span class=o>=</span> <span class=n>max_abs_pct_distances</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-41-5><a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>similarity</span> <span class=o>=</span> <span class=mi>1</span> <span class=o>-</span> <span class=n>pct_mae</span> <span class=o>/</span> <span class=n>max_pct_mae</span>
</span><span id=__span-41-6><a id=__codelineno-41-6 name=__codelineno-41-6 href=#__codelineno-41-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>similarity</span>
</span><span id=__span-41-7><a id=__codelineno-41-7 name=__codelineno-41-7 href=#__codelineno-41-7></a><span class=go>0.8732697724295595</span>
</span><span id=__span-41-8><a id=__codelineno-41-8 name=__codelineno-41-8 href=#__codelineno-41-8></a>
</span><span id=__span-41-9><a id=__codelineno-41-9 name=__codelineno-41-9 href=#__codelineno-41-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>pattern_similarity_nb</span><span class=p>(</span>
</span><span id=__span-41-10><a id=__codelineno-41-10 name=__codelineno-41-10 href=#__codelineno-41-10></a><span class=gp>... </span>    <span class=n>price_window</span><span class=o>.</span><span class=n>values</span><span class=p>,</span> 
</span><span id=__span-41-11><a id=__codelineno-41-11 name=__codelineno-41-11 href=#__codelineno-41-11></a><span class=gp>... </span>    <span class=n>pct_pattern</span><span class=p>,</span> 
</span><span id=__span-41-12><a id=__codelineno-41-12 name=__codelineno-41-12 href=#__codelineno-41-12></a><span class=gp>... </span>    <span class=n>error_type</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>ErrorType</span><span class=o>.</span><span class=n>Relative</span>  <span class=c1># (1)!</span>
</span><span id=__span-41-13><a id=__codelineno-41-13 name=__codelineno-41-13 href=#__codelineno-41-13></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-41-14><a id=__codelineno-41-14 name=__codelineno-41-14 href=#__codelineno-41-14></a><span class=go>0.8732697724295594</span>
</span></code></pre></div> <ol> <li>See <a href=https://vectorbt.pro/pvt_41531c19/api/generic/enums/#vectorbtpro.generic.enums.ErrorType>ErrorType</a>.</li> </ol> <p>The difference is not very large in this scenario, but here is what happens when the price moves sharply:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-42-1><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>pattern_similarity_nb</span><span class=p>(</span>
</span><span id=__span-42-2><a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a><span class=gp>... </span>    <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>10</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>100</span><span class=p>]),</span>
</span><span id=__span-42-3><a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a><span class=gp>... </span>    <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>]),</span>
</span><span id=__span-42-4><a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a><span class=gp>... </span>    <span class=n>error_type</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>ErrorType</span><span class=o>.</span><span class=n>Absolute</span>
</span><span id=__span-42-5><a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-42-6><a id=__codelineno-42-6 name=__codelineno-42-6 href=#__codelineno-42-6></a><span class=go>0.8888888888888888</span>
</span><span id=__span-42-7><a id=__codelineno-42-7 name=__codelineno-42-7 href=#__codelineno-42-7></a>
</span><span id=__span-42-8><a id=__codelineno-42-8 name=__codelineno-42-8 href=#__codelineno-42-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>pattern_similarity_nb</span><span class=p>(</span>
</span><span id=__span-42-9><a id=__codelineno-42-9 name=__codelineno-42-9 href=#__codelineno-42-9></a><span class=gp>... </span>    <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>10</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>100</span><span class=p>]),</span>
</span><span id=__span-42-10><a id=__codelineno-42-10 name=__codelineno-42-10 href=#__codelineno-42-10></a><span class=gp>... </span>    <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>]),</span>
</span><span id=__span-42-11><a id=__codelineno-42-11 name=__codelineno-42-11 href=#__codelineno-42-11></a><span class=gp>... </span>    <span class=n>error_type</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>ErrorType</span><span class=o>.</span><span class=n>Relative</span>
</span><span id=__span-42-12><a id=__codelineno-42-12 name=__codelineno-42-12 href=#__codelineno-42-12></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-42-13><a id=__codelineno-42-13 name=__codelineno-42-13 href=#__codelineno-42-13></a><span class=go>0.9575911789652247</span>
</span></code></pre></div> <p>In both examples, the pattern has been rescaled to <code>[10, 55, 100]</code> using the min-max rescaler (which is the default). In the first example, the normalized error is <code>abs(30 - 55) / (100 - 30) = 0.36</code>, while in the second example, the normalized error is <code>(abs(30 - 55) / 55) / ((100 - 30) / 30) = 0.19</code>, which also takes into account the volatility of the price.</p> <h3 id=inverse>Inverse<a class=headerlink href=#inverse title="Permanent link">&para;</a></h3> <p>You can also invert the pattern internally:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-43-1><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>pattern_similarity_nb</span><span class=p>(</span><span class=n>price_window</span><span class=o>.</span><span class=n>values</span><span class=p>,</span> <span class=n>pattern</span><span class=p>,</span> <span class=n>invert</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-43-2><a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a><span class=go>0.32064009029620244</span>
</span><span id=__span-43-3><a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a>
</span><span id=__span-43-4><a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>price_window</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot_pattern</span><span class=p>(</span><span class=n>pattern</span><span class=p>,</span> <span class=n>invert</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/inverted_pattern.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/inverted_pattern.dark.svg#only-dark></p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>This is not the same as simply inverting the score.</p> </div> <p>To produce the inverted pattern manually:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-44-1><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern</span><span class=o>.</span><span class=n>max</span><span class=p>()</span> <span class=o>+</span> <span class=n>pattern</span><span class=o>.</span><span class=n>min</span><span class=p>()</span> <span class=o>-</span> <span class=n>pattern</span>
</span><span id=__span-44-2><a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a><span class=go>array([3, 2, 1, 2, 1, 2])</span>
</span></code></pre></div> <h3 id=max-error>Max error<a class=headerlink href=#max-error title="Permanent link">&para;</a></h3> <p>Sometimes, you may want to define patterns as "corridors" within which the price should move. If any of the corridor points are violated, you can either set the distance at that point to the maximum distance (<code>max_error_strict=False</code>), or set the entire similarity to NaN (<code>max_error_strict=True</code>). Such a corridor is referred to as "maximum error". This error can be provided through the array-like argument <code>max_error</code>, which should be defined in the same way as the pattern. It mostly needs to have the same length and scale as the pattern.</p> <p>For example, if you choose min-max rescaling and the pattern is defined from <code>1</code> to <code>6</code>, a maximum error of <code>0.5</code> would be <code>0.5 / (6 - 1) = 0.1</code>, that is, 10% of the pattern's scale. Let's check the similarity of our original pattern without and with a corridor of <code>0.5</code>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-45-1><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>pattern_similarity_nb</span><span class=p>(</span>
</span><span id=__span-45-2><a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a><span class=gp>... </span>    <span class=n>price_window</span><span class=o>.</span><span class=n>values</span><span class=p>,</span> 
</span><span id=__span-45-3><a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a><span class=gp>... </span>    <span class=n>pattern</span><span class=p>,</span>
</span><span id=__span-45-4><a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-45-5><a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a><span class=go>0.8726845123416802</span>
</span><span id=__span-45-6><a id=__codelineno-45-6 name=__codelineno-45-6 href=#__codelineno-45-6></a>
</span><span id=__span-45-7><a id=__codelineno-45-7 name=__codelineno-45-7 href=#__codelineno-45-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>pattern_similarity_nb</span><span class=p>(</span>
</span><span id=__span-45-8><a id=__codelineno-45-8 name=__codelineno-45-8 href=#__codelineno-45-8></a><span class=gp>... </span>    <span class=n>price_window</span><span class=o>.</span><span class=n>values</span><span class=p>,</span> 
</span><span id=__span-45-9><a id=__codelineno-45-9 name=__codelineno-45-9 href=#__codelineno-45-9></a><span class=gp>... </span>    <span class=n>pattern</span><span class=p>,</span> 
</span><span id=__span-45-10><a id=__codelineno-45-10 name=__codelineno-45-10 href=#__codelineno-45-10></a><span class=gp>... </span>    <span class=n>max_error</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mf>0.5</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>]),</span>
</span><span id=__span-45-11><a id=__codelineno-45-11 name=__codelineno-45-11 href=#__codelineno-45-11></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-45-12><a id=__codelineno-45-12 name=__codelineno-45-12 href=#__codelineno-45-12></a><span class=go>0.8611332262389184</span>
</span></code></pre></div> <p>Since <code>max_error</code> is a flexible argument, you can also provide it as a zero-dimensional or one-dimensional array with one value, which will be applied to each point in the pattern:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-46-1><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>pattern_similarity_nb</span><span class=p>(</span>
</span><span id=__span-46-2><a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a><span class=gp>... </span>    <span class=n>price_window</span><span class=o>.</span><span class=n>values</span><span class=p>,</span> 
</span><span id=__span-46-3><a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a><span class=gp>... </span>    <span class=n>pattern</span><span class=p>,</span> 
</span><span id=__span-46-4><a id=__codelineno-46-4 name=__codelineno-46-4 href=#__codelineno-46-4></a><span class=gp>... </span>    <span class=n>max_error</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mf>0.5</span><span class=p>]),</span>  <span class=c1># (1)!</span>
</span><span id=__span-46-5><a id=__codelineno-46-5 name=__codelineno-46-5 href=#__codelineno-46-5></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-46-6><a id=__codelineno-46-6 name=__codelineno-46-6 href=#__codelineno-46-6></a><span class=go>0.8611332262389184</span>
</span></code></pre></div> <ol> <li>The argument cannot be provided as a constant (<code>0.5</code>). It must always be an array.</li> </ol> <p>The similarity score has decreased, meaning some corridor points were violated. Let's visualize the whole thing to see the exact points:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-47-1><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>price_window</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot_pattern</span><span class=p>(</span>
</span><span id=__span-47-2><a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a><span class=gp>... </span>    <span class=n>pattern</span><span class=p>,</span> 
</span><span id=__span-47-3><a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a><span class=gp>... </span>    <span class=n>max_error</span><span class=o>=</span><span class=mf>0.5</span>  <span class=c1># (1)!</span>
</span><span id=__span-47-4><a id=__codelineno-47-4 name=__codelineno-47-4 href=#__codelineno-47-4></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>You can provide constants here.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/max_error.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/max_error.dark.svg#only-dark></p> <p>We see two points that were violated, so their distance to the price was set to the maximum possible distance, which lowered the similarity. If we enable strict mode, the similarity becomes NaN to let the user know that it did not pass the test:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-48-1><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>pattern_similarity_nb</span><span class=p>(</span>
</span><span id=__span-48-2><a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a><span class=gp>... </span>    <span class=n>price_window</span><span class=o>.</span><span class=n>values</span><span class=p>,</span> 
</span><span id=__span-48-3><a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a><span class=gp>... </span>    <span class=n>pattern</span><span class=p>,</span> 
</span><span id=__span-48-4><a id=__codelineno-48-4 name=__codelineno-48-4 href=#__codelineno-48-4></a><span class=gp>... </span>    <span class=n>max_error</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mf>0.5</span><span class=p>]),</span>
</span><span id=__span-48-5><a id=__codelineno-48-5 name=__codelineno-48-5 href=#__codelineno-48-5></a><span class=gp>... </span>    <span class=n>max_error_strict</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-48-6><a id=__codelineno-48-6 name=__codelineno-48-6 href=#__codelineno-48-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-48-7><a id=__codelineno-48-7 name=__codelineno-48-7 href=#__codelineno-48-7></a><span class=go>nan</span>
</span></code></pre></div> <p>If you are interested in relative distances using <code>ErrorType.Relative</code>, the maximum error should be provided as a percentage change:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-49-1><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>pattern_similarity_nb</span><span class=p>(</span>
</span><span id=__span-49-2><a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a><span class=gp>... </span>    <span class=n>price_window</span><span class=o>.</span><span class=n>values</span><span class=p>,</span> 
</span><span id=__span-49-3><a id=__codelineno-49-3 name=__codelineno-49-3 href=#__codelineno-49-3></a><span class=gp>... </span>    <span class=n>pattern</span><span class=p>,</span> 
</span><span id=__span-49-4><a id=__codelineno-49-4 name=__codelineno-49-4 href=#__codelineno-49-4></a><span class=gp>... </span>    <span class=n>max_error</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mf>0.1</span><span class=p>]),</span>  <span class=c1># (1)!</span>
</span><span id=__span-49-5><a id=__codelineno-49-5 name=__codelineno-49-5 href=#__codelineno-49-5></a><span class=gp>... </span>    <span class=n>error_type</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>ErrorType</span><span class=o>.</span><span class=n>Relative</span>
</span><span id=__span-49-6><a id=__codelineno-49-6 name=__codelineno-49-6 href=#__codelineno-49-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-49-7><a id=__codelineno-49-7 name=__codelineno-49-7 href=#__codelineno-49-7></a><span class=go>0.8548520433078988</span>
</span><span id=__span-49-8><a id=__codelineno-49-8 name=__codelineno-49-8 href=#__codelineno-49-8></a>
</span><span id=__span-49-9><a id=__codelineno-49-9 name=__codelineno-49-9 href=#__codelineno-49-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>price_window</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot_pattern</span><span class=p>(</span>
</span><span id=__span-49-10><a id=__codelineno-49-10 name=__codelineno-49-10 href=#__codelineno-49-10></a><span class=gp>... </span>    <span class=n>pattern</span><span class=p>,</span> 
</span><span id=__span-49-11><a id=__codelineno-49-11 name=__codelineno-49-11 href=#__codelineno-49-11></a><span class=gp>... </span>    <span class=n>max_error</span><span class=o>=</span><span class=mf>0.1</span><span class=p>,</span>
</span><span id=__span-49-12><a id=__codelineno-49-12 name=__codelineno-49-12 href=#__codelineno-49-12></a><span class=gp>... </span>    <span class=n>error_type</span><span class=o>=</span><span class=s2>&quot;relative&quot;</span>
</span><span id=__span-49-13><a id=__codelineno-49-13 name=__codelineno-49-13 href=#__codelineno-49-13></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Corridor of 10% at any point.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/max_error_relative.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/max_error_relative.dark.svg#only-dark></p> <p>The same applies for rescaling using rebasing mode, where each error, regardless of error type, should be given as a percentage change. For example, if the current pattern value has been mapped to a price of <code>12000</code> and the maximum error is <code>0.1</code>, the corridor will cover all values from <code>12000 * 0.9 = 10800</code> to <code>12000 * 1.1 = 13200</code>. Let's allow deviations for the adjusted percentage pattern of no more than 20% at the first level, 10% at the second level, and 5% at the third level:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-50-1><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>pattern_similarity_nb</span><span class=p>(</span>
</span><span id=__span-50-2><a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a><span class=gp>... </span>    <span class=n>price_window</span><span class=o>.</span><span class=n>values</span><span class=p>,</span> 
</span><span id=__span-50-3><a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a><span class=gp>... </span>    <span class=n>adj_pct_pattern</span><span class=p>,</span> 
</span><span id=__span-50-4><a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a><span class=gp>... </span>    <span class=n>rescale_mode</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>RescaleMode</span><span class=o>.</span><span class=n>Rebase</span><span class=p>,</span>
</span><span id=__span-50-5><a id=__codelineno-50-5 name=__codelineno-50-5 href=#__codelineno-50-5></a><span class=gp>... </span>    <span class=n>max_error</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mf>0.2</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.05</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.05</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>]),</span>
</span><span id=__span-50-6><a id=__codelineno-50-6 name=__codelineno-50-6 href=#__codelineno-50-6></a><span class=gp>... </span>    <span class=n>max_error_strict</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-50-7><a id=__codelineno-50-7 name=__codelineno-50-7 href=#__codelineno-50-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-50-8><a id=__codelineno-50-8 name=__codelineno-50-8 href=#__codelineno-50-8></a><span class=go>nan</span>
</span><span id=__span-50-9><a id=__codelineno-50-9 name=__codelineno-50-9 href=#__codelineno-50-9></a>
</span><span id=__span-50-10><a id=__codelineno-50-10 name=__codelineno-50-10 href=#__codelineno-50-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>price_window</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot_pattern</span><span class=p>(</span>
</span><span id=__span-50-11><a id=__codelineno-50-11 name=__codelineno-50-11 href=#__codelineno-50-11></a><span class=gp>... </span>    <span class=n>adj_pct_pattern</span><span class=p>,</span> 
</span><span id=__span-50-12><a id=__codelineno-50-12 name=__codelineno-50-12 href=#__codelineno-50-12></a><span class=gp>... </span>    <span class=n>rescale_mode</span><span class=o>=</span><span class=s2>&quot;rebase&quot;</span><span class=p>,</span>
</span><span id=__span-50-13><a id=__codelineno-50-13 name=__codelineno-50-13 href=#__codelineno-50-13></a><span class=gp>... </span>    <span class=n>max_error</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mf>0.2</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.05</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.05</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>])</span>
</span><span id=__span-50-14><a id=__codelineno-50-14 name=__codelineno-50-14 href=#__codelineno-50-14></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/max_error_rebase.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/max_error_rebase.dark.svg#only-dark></p> <p>As shown, some points fall outside the corridor. If we add an additional 5% to all points, the pattern passes the test easily:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-51-1><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>pattern_similarity_nb</span><span class=p>(</span>
</span><span id=__span-51-2><a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a><span class=gp>... </span>    <span class=n>price_window</span><span class=o>.</span><span class=n>values</span><span class=p>,</span> 
</span><span id=__span-51-3><a id=__codelineno-51-3 name=__codelineno-51-3 href=#__codelineno-51-3></a><span class=gp>... </span>    <span class=n>adj_pct_pattern</span><span class=p>,</span> 
</span><span id=__span-51-4><a id=__codelineno-51-4 name=__codelineno-51-4 href=#__codelineno-51-4></a><span class=gp>... </span>    <span class=n>rescale_mode</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>RescaleMode</span><span class=o>.</span><span class=n>Rebase</span><span class=p>,</span>
</span><span id=__span-51-5><a id=__codelineno-51-5 name=__codelineno-51-5 href=#__codelineno-51-5></a><span class=gp>... </span>    <span class=n>max_error</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mf>0.2</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.05</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.05</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>])</span> <span class=o>+</span> <span class=mf>0.05</span><span class=p>,</span>
</span><span id=__span-51-6><a id=__codelineno-51-6 name=__codelineno-51-6 href=#__codelineno-51-6></a><span class=gp>... </span>    <span class=n>max_error_strict</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-51-7><a id=__codelineno-51-7 name=__codelineno-51-7 href=#__codelineno-51-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-51-8><a id=__codelineno-51-8 name=__codelineno-51-8 href=#__codelineno-51-8></a><span class=go>0.8789689066239321</span>
</span></code></pre></div> <h4 id=interpolation_1>Interpolation<a class=headerlink href=#interpolation_1 title="Permanent link">&para;</a></h4> <p>Is there a way to provide the maximum error discretely? In other words, can we force the function to adhere to the corridor only at certain points, rather than gradually at all points? By default, the maximum error is interpolated in the same way as the pattern (linearly in our case). To make the maximum error array interpolate differently, provide a different mode as <code>max_error_interp_mode</code>. For example, let's require only the peak points to be within the corridor of 10%. For this, use the discrete interpolation mode and set all intermediate points to NaN:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-52-1><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>pattern_similarity_nb</span><span class=p>(</span>
</span><span id=__span-52-2><a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a><span class=gp>... </span>    <span class=n>price_window</span><span class=o>.</span><span class=n>values</span><span class=p>,</span> 
</span><span id=__span-52-3><a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a><span class=gp>... </span>    <span class=n>adj_pct_pattern</span><span class=p>,</span> 
</span><span id=__span-52-4><a id=__codelineno-52-4 name=__codelineno-52-4 href=#__codelineno-52-4></a><span class=gp>... </span>    <span class=n>rescale_mode</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>RescaleMode</span><span class=o>.</span><span class=n>Rebase</span><span class=p>,</span>
</span><span id=__span-52-5><a id=__codelineno-52-5 name=__codelineno-52-5 href=#__codelineno-52-5></a><span class=gp>... </span>    <span class=n>max_error</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>]),</span>
</span><span id=__span-52-6><a id=__codelineno-52-6 name=__codelineno-52-6 href=#__codelineno-52-6></a><span class=gp>... </span>    <span class=n>max_error_interp_mode</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>InterpMode</span><span class=o>.</span><span class=n>Discrete</span><span class=p>,</span>
</span><span id=__span-52-7><a id=__codelineno-52-7 name=__codelineno-52-7 href=#__codelineno-52-7></a><span class=gp>... </span>    <span class=n>max_error_strict</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-52-8><a id=__codelineno-52-8 name=__codelineno-52-8 href=#__codelineno-52-8></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-52-9><a id=__codelineno-52-9 name=__codelineno-52-9 href=#__codelineno-52-9></a><span class=go>0.8789689066239321</span>
</span><span id=__span-52-10><a id=__codelineno-52-10 name=__codelineno-52-10 href=#__codelineno-52-10></a>
</span><span id=__span-52-11><a id=__codelineno-52-11 name=__codelineno-52-11 href=#__codelineno-52-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>price_window</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot_pattern</span><span class=p>(</span>
</span><span id=__span-52-12><a id=__codelineno-52-12 name=__codelineno-52-12 href=#__codelineno-52-12></a><span class=gp>... </span>    <span class=n>adj_pct_pattern</span><span class=p>,</span> 
</span><span id=__span-52-13><a id=__codelineno-52-13 name=__codelineno-52-13 href=#__codelineno-52-13></a><span class=gp>... </span>    <span class=n>rescale_mode</span><span class=o>=</span><span class=s2>&quot;rebase&quot;</span><span class=p>,</span>
</span><span id=__span-52-14><a id=__codelineno-52-14 name=__codelineno-52-14 href=#__codelineno-52-14></a><span class=gp>... </span>    <span class=n>max_error</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>]),</span>
</span><span id=__span-52-15><a id=__codelineno-52-15 name=__codelineno-52-15 href=#__codelineno-52-15></a><span class=gp>... </span>    <span class=n>max_error_interp_mode</span><span class=o>=</span><span class=s2>&quot;discrete&quot;</span>
</span><span id=__span-52-16><a id=__codelineno-52-16 name=__codelineno-52-16 href=#__codelineno-52-16></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/max_error_discrete.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/max_error_discrete.dark.svg#only-dark></p> <p>Even though the scatter points of the maximum error are connected by a greyed-out line, the price is only required to be between each pair of purple points, not between those lines.</p> <h4 id=max-distance>Max distance<a class=headerlink href=#max-distance title="Permanent link">&para;</a></h4> <p>Final question: is there a way to adjust the maximum distance? Yes! You can use the maximum error as the maximum distance by enabling <code>max_error_as_maxdist</code>. This has the following effect: the smaller the maximum distance at any point, the more the price volatility at that point affects the similarity. Let's compare our original pattern without and with a maximum distance cap of <code>0.5</code> (10% of the scale):</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-53-1><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>pattern_similarity_nb</span><span class=p>(</span><span class=n>price_window</span><span class=o>.</span><span class=n>values</span><span class=p>,</span> <span class=n>pattern</span><span class=p>)</span>
</span><span id=__span-53-2><a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a><span class=go>0.8726845123416802</span>
</span><span id=__span-53-3><a id=__codelineno-53-3 name=__codelineno-53-3 href=#__codelineno-53-3></a>
</span><span id=__span-53-4><a id=__codelineno-53-4 name=__codelineno-53-4 href=#__codelineno-53-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>pattern_similarity_nb</span><span class=p>(</span>
</span><span id=__span-53-5><a id=__codelineno-53-5 name=__codelineno-53-5 href=#__codelineno-53-5></a><span class=gp>... </span>    <span class=n>price_window</span><span class=o>.</span><span class=n>values</span><span class=p>,</span> 
</span><span id=__span-53-6><a id=__codelineno-53-6 name=__codelineno-53-6 href=#__codelineno-53-6></a><span class=gp>... </span>    <span class=n>pattern</span><span class=p>,</span> 
</span><span id=__span-53-7><a id=__codelineno-53-7 name=__codelineno-53-7 href=#__codelineno-53-7></a><span class=gp>... </span>    <span class=n>max_error</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mf>0.5</span><span class=p>]),</span>
</span><span id=__span-53-8><a id=__codelineno-53-8 name=__codelineno-53-8 href=#__codelineno-53-8></a><span class=gp>... </span>    <span class=n>max_error_as_maxdist</span><span class=o>=</span><span class=kc>True</span>
</span><span id=__span-53-9><a id=__codelineno-53-9 name=__codelineno-53-9 href=#__codelineno-53-9></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-53-10><a id=__codelineno-53-10 name=__codelineno-53-10 href=#__codelineno-53-10></a><span class=go>0.6193594883412921</span>
</span></code></pre></div> <p>This method introduces a penalty for increased price volatility.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>You can also set a different maximum distance at different points in the pattern. Keep in mind that points with a larger maximum distance will have more weight in the similarity calculation than points with a smaller maximum distance. For example, if there are two points with maximum distances of <code>100</code> and <code>1</code> respectively, even with a perfect match at the second point, the similarity would be determined mostly by the distance at the first point.</p> </div> <h3 id=further-filters>Further filters<a class=headerlink href=#further-filters title="Permanent link">&para;</a></h3> <p>When matching a large number of price windows against a pattern, we may want to skip windows where the volatility is either too low or too high. You can do this by setting the arguments <code>min_pct_change</code> and <code>max_pct_change</code>, respectively:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-54-1><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>pattern_similarity_nb</span><span class=p>(</span>
</span><span id=__span-54-2><a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a><span class=gp>... </span>    <span class=n>price_window</span><span class=o>.</span><span class=n>values</span><span class=p>,</span> <span class=n>pattern</span><span class=p>,</span> <span class=n>max_pct_change</span><span class=o>=</span><span class=mf>0.3</span>
</span><span id=__span-54-3><a id=__codelineno-54-3 name=__codelineno-54-3 href=#__codelineno-54-3></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-54-4><a id=__codelineno-54-4 name=__codelineno-54-4 href=#__codelineno-54-4></a><span class=go>nan</span>
</span></code></pre></div> <p>An added benefit is improved performance: if the test fails, the price window is only traversed once to get the minimum and maximum value.</p> <p>We can also filter out similarity scores that fall below a predefined threshold. For example, to set the minimum similarity to 90%:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-55-1><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>pattern_similarity_nb</span><span class=p>(</span>
</span><span id=__span-55-2><a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a><span class=gp>... </span>    <span class=n>price_window</span><span class=o>.</span><span class=n>values</span><span class=p>,</span> <span class=n>pattern</span><span class=p>,</span> <span class=n>min_similarity</span><span class=o>=</span><span class=mf>0.9</span>
</span><span id=__span-55-3><a id=__codelineno-55-3 name=__codelineno-55-3 href=#__codelineno-55-3></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-55-4><a id=__codelineno-55-4 name=__codelineno-55-4 href=#__codelineno-55-4></a><span class=go>nan</span>
</span></code></pre></div> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>Do not worry about NaNs, they simply mean "didn't pass some tests, should be ignored during analysis".</p> </div> <p>Setting a similarity threshold also improves performance: if the algorithm detects that the threshold can no longer be reached, even if the remaining points matched perfectly, it will stop and set the final score to NaN. Depending on the threshold, this can make the computation about 30% faster on average.</p> <h2 id=rolling-similarity>Rolling similarity<a class=headerlink href=#rolling-similarity title="Permanent link">&para;</a></h2> <p>Now that we have learned the theory behind pattern recognition, it is time to put it into practice. To search for a pattern within a price space, we need to roll a window across that space. This can be done using the accessor method <a href=https://vectorbt.pro/pvt_41531c19/api/generic/accessors/#vectorbtpro.generic.accessors.GenericAccessor.rolling_pattern_similarity>GenericAccessor.rolling_pattern_similarity</a>, which accepts the same arguments as before, plus the window length to roll. If you set the window length to <code>None</code>, it will default to the length of the pattern array.</p> <p>Let's roll a window of 30 data points over the entire typical price, and match it against a pattern that uses a discrete soft corridor of 5%:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-56-1><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>price</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>hlc3</span>
</span><span id=__span-56-2><a id=__codelineno-56-2 name=__codelineno-56-2 href=#__codelineno-56-2></a>
</span><span id=__span-56-3><a id=__codelineno-56-3 name=__codelineno-56-3 href=#__codelineno-56-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>similarity</span> <span class=o>=</span> <span class=n>price</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>rolling_pattern_similarity</span><span class=p>(</span>
</span><span id=__span-56-4><a id=__codelineno-56-4 name=__codelineno-56-4 href=#__codelineno-56-4></a><span class=gp>... </span>    <span class=n>pattern</span><span class=p>,</span> 
</span><span id=__span-56-5><a id=__codelineno-56-5 name=__codelineno-56-5 href=#__codelineno-56-5></a><span class=gp>... </span>    <span class=n>window</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span>
</span><span id=__span-56-6><a id=__codelineno-56-6 name=__codelineno-56-6 href=#__codelineno-56-6></a><span class=gp>... </span>    <span class=n>error_type</span><span class=o>=</span><span class=s2>&quot;relative&quot;</span><span class=p>,</span>
</span><span id=__span-56-7><a id=__codelineno-56-7 name=__codelineno-56-7 href=#__codelineno-56-7></a><span class=gp>... </span>    <span class=n>max_error</span><span class=o>=</span><span class=mf>0.05</span><span class=p>,</span>
</span><span id=__span-56-8><a id=__codelineno-56-8 name=__codelineno-56-8 href=#__codelineno-56-8></a><span class=gp>... </span>    <span class=n>max_error_interp_mode</span><span class=o>=</span><span class=s2>&quot;discrete&quot;</span>
</span><span id=__span-56-9><a id=__codelineno-56-9 name=__codelineno-56-9 href=#__codelineno-56-9></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-56-10><a id=__codelineno-56-10 name=__codelineno-56-10 href=#__codelineno-56-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>similarity</span><span class=o>.</span><span class=n>describe</span><span class=p>()</span>
</span><span id=__span-56-11><a id=__codelineno-56-11 name=__codelineno-56-11 href=#__codelineno-56-11></a><span class=go>count    701.000000</span>
</span><span id=__span-56-12><a id=__codelineno-56-12 name=__codelineno-56-12 href=#__codelineno-56-12></a><span class=go>mean       0.499321</span>
</span><span id=__span-56-13><a id=__codelineno-56-13 name=__codelineno-56-13 href=#__codelineno-56-13></a><span class=go>std        0.144088</span>
</span><span id=__span-56-14><a id=__codelineno-56-14 name=__codelineno-56-14 href=#__codelineno-56-14></a><span class=go>min        0.148387</span>
</span><span id=__span-56-15><a id=__codelineno-56-15 name=__codelineno-56-15 href=#__codelineno-56-15></a><span class=go>25%        0.394584</span>
</span><span id=__span-56-16><a id=__codelineno-56-16 name=__codelineno-56-16 href=#__codelineno-56-16></a><span class=go>50%        0.502231</span>
</span><span id=__span-56-17><a id=__codelineno-56-17 name=__codelineno-56-17 href=#__codelineno-56-17></a><span class=go>75%        0.607962</span>
</span><span id=__span-56-18><a id=__codelineno-56-18 name=__codelineno-56-18 href=#__codelineno-56-18></a><span class=go>max        0.838393</span>
</span><span id=__span-56-19><a id=__codelineno-56-19 name=__codelineno-56-19 href=#__codelineno-56-19></a><span class=go>dtype: float64</span>
</span></code></pre></div> <p>We can see that among 701 comparisons, roughly half have a score below 50%. The highest score is around 84%. Let's visualize the best match:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-57-1><a id=__codelineno-57-1 name=__codelineno-57-1 href=#__codelineno-57-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>end_row</span> <span class=o>=</span> <span class=n>similarity</span><span class=o>.</span><span class=n>argmax</span><span class=p>()</span> <span class=o>+</span> <span class=mi>1</span>  <span class=c1># (1)!</span>
</span><span id=__span-57-2><a id=__codelineno-57-2 name=__codelineno-57-2 href=#__codelineno-57-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>start_row</span> <span class=o>=</span> <span class=n>end_row</span> <span class=o>-</span> <span class=mi>30</span>
</span><span id=__span-57-3><a id=__codelineno-57-3 name=__codelineno-57-3 href=#__codelineno-57-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>start_row</span><span class=p>:</span><span class=n>end_row</span><span class=p>]</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>plot_volume</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-57-4><a id=__codelineno-57-4 name=__codelineno-57-4 href=#__codelineno-57-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>price</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>start_row</span><span class=p>:</span><span class=n>end_row</span><span class=p>]</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot_pattern</span><span class=p>(</span>
</span><span id=__span-57-5><a id=__codelineno-57-5 name=__codelineno-57-5 href=#__codelineno-57-5></a><span class=gp>... </span>    <span class=n>pattern</span><span class=p>,</span> 
</span><span id=__span-57-6><a id=__codelineno-57-6 name=__codelineno-57-6 href=#__codelineno-57-6></a><span class=gp>... </span>    <span class=n>error_type</span><span class=o>=</span><span class=s2>&quot;relative&quot;</span><span class=p>,</span>  <span class=c1># (2)!</span>
</span><span id=__span-57-7><a id=__codelineno-57-7 name=__codelineno-57-7 href=#__codelineno-57-7></a><span class=gp>... </span>    <span class=n>max_error</span><span class=o>=</span><span class=mf>0.05</span><span class=p>,</span>
</span><span id=__span-57-8><a id=__codelineno-57-8 name=__codelineno-57-8 href=#__codelineno-57-8></a><span class=gp>... </span>    <span class=n>max_error_interp_mode</span><span class=o>=</span><span class=s2>&quot;discrete&quot;</span><span class=p>,</span>
</span><span id=__span-57-9><a id=__codelineno-57-9 name=__codelineno-57-9 href=#__codelineno-57-9></a><span class=gp>... </span>    <span class=n>plot_obj</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> 
</span><span id=__span-57-10><a id=__codelineno-57-10 name=__codelineno-57-10 href=#__codelineno-57-10></a><span class=gp>... </span>    <span class=n>fig</span><span class=o>=</span><span class=n>fig</span>
</span><span id=__span-57-11><a id=__codelineno-57-11 name=__codelineno-57-11 href=#__codelineno-57-11></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-57-12><a id=__codelineno-57-12 name=__codelineno-57-12 href=#__codelineno-57-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Get the start (inclusive) and end (exclusive) row of the window with the highest similarity.</li> <li>Be sure to use the same parameters that were used to calculate the similarity.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/max_rolling_similarity.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/max_rolling_similarity.dark.svg#only-dark></p> <p>Pretty accurate, right? And this window matches even better than the one we examined previously. But what about the lowest similarity? Is it the same as inverting the pattern? No!</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-58-1><a id=__codelineno-58-1 name=__codelineno-58-1 href=#__codelineno-58-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>end_row</span> <span class=o>=</span> <span class=n>similarity</span><span class=o>.</span><span class=n>argmin</span><span class=p>()</span> <span class=o>+</span> <span class=mi>1</span>
</span><span id=__span-58-2><a id=__codelineno-58-2 name=__codelineno-58-2 href=#__codelineno-58-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>start_row</span> <span class=o>=</span> <span class=n>end_row</span> <span class=o>-</span> <span class=mi>30</span>
</span><span id=__span-58-3><a id=__codelineno-58-3 name=__codelineno-58-3 href=#__codelineno-58-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>start_row</span><span class=p>:</span><span class=n>end_row</span><span class=p>]</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>plot_volume</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-58-4><a id=__codelineno-58-4 name=__codelineno-58-4 href=#__codelineno-58-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>price</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>start_row</span><span class=p>:</span><span class=n>end_row</span><span class=p>]</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot_pattern</span><span class=p>(</span>
</span><span id=__span-58-5><a id=__codelineno-58-5 name=__codelineno-58-5 href=#__codelineno-58-5></a><span class=gp>... </span>    <span class=n>pattern</span><span class=p>,</span> 
</span><span id=__span-58-6><a id=__codelineno-58-6 name=__codelineno-58-6 href=#__codelineno-58-6></a><span class=gp>... </span>    <span class=n>invert</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-58-7><a id=__codelineno-58-7 name=__codelineno-58-7 href=#__codelineno-58-7></a><span class=gp>... </span>    <span class=n>error_type</span><span class=o>=</span><span class=s2>&quot;relative&quot;</span><span class=p>,</span>
</span><span id=__span-58-8><a id=__codelineno-58-8 name=__codelineno-58-8 href=#__codelineno-58-8></a><span class=gp>... </span>    <span class=n>max_error</span><span class=o>=</span><span class=mf>0.05</span><span class=p>,</span>
</span><span id=__span-58-9><a id=__codelineno-58-9 name=__codelineno-58-9 href=#__codelineno-58-9></a><span class=gp>... </span>    <span class=n>max_error_interp_mode</span><span class=o>=</span><span class=s2>&quot;discrete&quot;</span><span class=p>,</span>
</span><span id=__span-58-10><a id=__codelineno-58-10 name=__codelineno-58-10 href=#__codelineno-58-10></a><span class=gp>... </span>    <span class=n>plot_obj</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> 
</span><span id=__span-58-11><a id=__codelineno-58-11 name=__codelineno-58-11 href=#__codelineno-58-11></a><span class=gp>... </span>    <span class=n>fig</span><span class=o>=</span><span class=n>fig</span>
</span><span id=__span-58-12><a id=__codelineno-58-12 name=__codelineno-58-12 href=#__codelineno-58-12></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-58-13><a id=__codelineno-58-13 name=__codelineno-58-13 href=#__codelineno-58-13></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/min_rolling_similarity.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/min_rolling_similarity.dark.svg#only-dark></p> <p>Inverting the score will invalidate all the requirements set initially, so you should always start a new pattern search with the <code>invert</code> flag enabled:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-59-1><a id=__codelineno-59-1 name=__codelineno-59-1 href=#__codelineno-59-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>inv_similarity</span> <span class=o>=</span> <span class=n>price</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>rolling_pattern_similarity</span><span class=p>(</span>
</span><span id=__span-59-2><a id=__codelineno-59-2 name=__codelineno-59-2 href=#__codelineno-59-2></a><span class=gp>... </span>    <span class=n>pattern</span><span class=p>,</span> 
</span><span id=__span-59-3><a id=__codelineno-59-3 name=__codelineno-59-3 href=#__codelineno-59-3></a><span class=gp>... </span>    <span class=n>window</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span>
</span><span id=__span-59-4><a id=__codelineno-59-4 name=__codelineno-59-4 href=#__codelineno-59-4></a><span class=gp>... </span>    <span class=n>invert</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-59-5><a id=__codelineno-59-5 name=__codelineno-59-5 href=#__codelineno-59-5></a><span class=gp>... </span>    <span class=n>error_type</span><span class=o>=</span><span class=s2>&quot;relative&quot;</span><span class=p>,</span>
</span><span id=__span-59-6><a id=__codelineno-59-6 name=__codelineno-59-6 href=#__codelineno-59-6></a><span class=gp>... </span>    <span class=n>max_error</span><span class=o>=</span><span class=mf>0.05</span><span class=p>,</span>
</span><span id=__span-59-7><a id=__codelineno-59-7 name=__codelineno-59-7 href=#__codelineno-59-7></a><span class=gp>... </span>    <span class=n>max_error_interp_mode</span><span class=o>=</span><span class=s2>&quot;discrete&quot;</span>
</span><span id=__span-59-8><a id=__codelineno-59-8 name=__codelineno-59-8 href=#__codelineno-59-8></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-59-9><a id=__codelineno-59-9 name=__codelineno-59-9 href=#__codelineno-59-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>end_row</span> <span class=o>=</span> <span class=n>inv_similarity</span><span class=o>.</span><span class=n>argmax</span><span class=p>()</span> <span class=o>+</span> <span class=mi>1</span>  <span class=c1># (2)!</span>
</span><span id=__span-59-10><a id=__codelineno-59-10 name=__codelineno-59-10 href=#__codelineno-59-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>start_row</span> <span class=o>=</span> <span class=n>end_row</span> <span class=o>-</span> <span class=mi>30</span>
</span><span id=__span-59-11><a id=__codelineno-59-11 name=__codelineno-59-11 href=#__codelineno-59-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>start_row</span><span class=p>:</span><span class=n>end_row</span><span class=p>]</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>plot_volume</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-59-12><a id=__codelineno-59-12 name=__codelineno-59-12 href=#__codelineno-59-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>price</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>start_row</span><span class=p>:</span><span class=n>end_row</span><span class=p>]</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot_pattern</span><span class=p>(</span>
</span><span id=__span-59-13><a id=__codelineno-59-13 name=__codelineno-59-13 href=#__codelineno-59-13></a><span class=gp>... </span>    <span class=n>pattern</span><span class=p>,</span> 
</span><span id=__span-59-14><a id=__codelineno-59-14 name=__codelineno-59-14 href=#__codelineno-59-14></a><span class=gp>... </span>    <span class=n>invert</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-59-15><a id=__codelineno-59-15 name=__codelineno-59-15 href=#__codelineno-59-15></a><span class=gp>... </span>    <span class=n>error_type</span><span class=o>=</span><span class=s2>&quot;relative&quot;</span><span class=p>,</span>
</span><span id=__span-59-16><a id=__codelineno-59-16 name=__codelineno-59-16 href=#__codelineno-59-16></a><span class=gp>... </span>    <span class=n>max_error</span><span class=o>=</span><span class=mf>0.05</span><span class=p>,</span>
</span><span id=__span-59-17><a id=__codelineno-59-17 name=__codelineno-59-17 href=#__codelineno-59-17></a><span class=gp>... </span>    <span class=n>max_error_interp_mode</span><span class=o>=</span><span class=s2>&quot;discrete&quot;</span><span class=p>,</span>
</span><span id=__span-59-18><a id=__codelineno-59-18 name=__codelineno-59-18 href=#__codelineno-59-18></a><span class=gp>... </span>    <span class=n>plot_obj</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> 
</span><span id=__span-59-19><a id=__codelineno-59-19 name=__codelineno-59-19 href=#__codelineno-59-19></a><span class=gp>... </span>    <span class=n>fig</span><span class=o>=</span><span class=n>fig</span>
</span><span id=__span-59-20><a id=__codelineno-59-20 name=__codelineno-59-20 href=#__codelineno-59-20></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-59-21><a id=__codelineno-59-21 name=__codelineno-59-21 href=#__codelineno-59-21></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Here.</li> <li>We are looking for the highest similarity.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/inv_rolling_similarity.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/inv_rolling_similarity.dark.svg#only-dark></p> <p>The best match is not a perfect fit, but it is still much better than the previous one.</p> <h3 id=indicator>Indicator<a class=headerlink href=#indicator title="Permanent link">&para;</a></h3> <p>Once you have finalized the optimal pattern parameters through exploration and debugging, you should consider integrating the pattern detection component into your backtesting stack. This can be achieved by running the process inside an indicator. Since indicators must return output arrays of the same shape as their input arrays, you can safely use the rolling pattern similarity as the output. For this, you can use the <a href=https://vectorbt.pro/pvt_41531c19/api/indicators/custom/patsim/#vectorbtpro.indicators.custom.patsim.PATSIM>PATSIM</a> indicator, which takes a price array as its only input and accepts all arguments related to calculating pattern similarity as parameters, including the pattern array itself. Another benefit of this indicator is its ability to automatically convert arguments provided as a string (such as <code>interp_mode</code>) into a Numba-compatible format. Finally, indicators are excellent for testing multiple window sizes, since the accuracy of pattern detection heavily depends on the choice of window length.</p> <p>Let's test several window combinations using the same setup as above:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-60-1><a id=__codelineno-60-1 name=__codelineno-60-1 href=#__codelineno-60-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>patsim</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PATSIM</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-60-2><a id=__codelineno-60-2 name=__codelineno-60-2 href=#__codelineno-60-2></a><span class=gp>... </span>    <span class=n>price</span><span class=p>,</span> 
</span><span id=__span-60-3><a id=__codelineno-60-3 name=__codelineno-60-3 href=#__codelineno-60-3></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=n>pattern</span><span class=p>),</span>  <span class=c1># (1)!</span>
</span><span id=__span-60-4><a id=__codelineno-60-4 name=__codelineno-60-4 href=#__codelineno-60-4></a><span class=gp>... </span>    <span class=n>error_type</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=s2>&quot;relative&quot;</span><span class=p>),</span>
</span><span id=__span-60-5><a id=__codelineno-60-5 name=__codelineno-60-5 href=#__codelineno-60-5></a><span class=gp>... </span>    <span class=n>max_error</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=mf>0.05</span><span class=p>),</span>
</span><span id=__span-60-6><a id=__codelineno-60-6 name=__codelineno-60-6 href=#__codelineno-60-6></a><span class=gp>... </span>    <span class=n>max_error_interp_mode</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=s2>&quot;discrete&quot;</span><span class=p>),</span>
</span><span id=__span-60-7><a id=__codelineno-60-7 name=__codelineno-60-7 href=#__codelineno-60-7></a><span class=gp>... </span>    <span class=n>window</span><span class=o>=</span><span class=p>[</span><span class=mi>30</span><span class=p>,</span> <span class=mi>45</span><span class=p>,</span> <span class=mi>60</span><span class=p>,</span> <span class=mi>75</span><span class=p>,</span> <span class=mi>90</span><span class=p>]</span>
</span><span id=__span-60-8><a id=__codelineno-60-8 name=__codelineno-60-8 href=#__codelineno-60-8></a><span class=gp>... </span><span class=p>)</span>
</span></code></pre></div> <ol> <li>Wrap with <a href=https://vectorbt.pro/pvt_41531c19/api/base/reshaping/#vectorbtpro.base.reshaping.Default>Default</a> to hide the parameter from columns.</li> </ol> <p>You can plot how the similarity develops using <a href=https://vectorbt.pro/pvt_41531c19/api/indicators/custom/patsim/#vectorbtpro.indicators.custom.patsim.PATSIM.plot>PATSIM.plot</a>. Like any other plotting method, it allows only one column to be plotted, so you need to specify the column name beforehand using the <code>column</code> argument:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-61-1><a id=__codelineno-61-1 name=__codelineno-61-1 href=#__codelineno-61-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>patsim</span><span class=o>.</span><span class=n>wrapper</span><span class=o>.</span><span class=n>columns</span>  <span class=c1># (1)!</span>
</span><span id=__span-61-2><a id=__codelineno-61-2 name=__codelineno-61-2 href=#__codelineno-61-2></a><span class=go>Int64Index([30, 45, 60, 75, 90], dtype=&#39;int64&#39;, name=&#39;patsim_window&#39;)</span>
</span><span id=__span-61-3><a id=__codelineno-61-3 name=__codelineno-61-3 href=#__codelineno-61-3></a>
</span><span id=__span-61-4><a id=__codelineno-61-4 name=__codelineno-61-4 href=#__codelineno-61-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>patsim</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>column</span><span class=o>=</span><span class=mi>60</span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Review the column names generated by this indicator. If there are multiple column levels, you need to provide the column name as a tuple.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/patsim.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/patsim.dark.svg#only-dark></p> <p>The generated similarity series is as fascinating as the price series itself, and can be used for all kinds of technical analysis on its own <img alt=📐 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f4d0.svg title=:triangular_ruler:></p> <p>An even more informative plot can be produced by <a href=https://vectorbt.pro/pvt_41531c19/api/indicators/custom/patsim/#vectorbtpro.indicators.custom.patsim.PATSIM.overlay_with_heatmap>PATSIM.overlay_with_heatmap</a>, which overlays a price line with a similarity heatmap:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-62-1><a id=__codelineno-62-1 name=__codelineno-62-1 href=#__codelineno-62-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>patsim</span><span class=o>.</span><span class=n>overlay_with_heatmap</span><span class=p>(</span><span class=n>column</span><span class=o>=</span><span class=mi>60</span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/patsim_heatmap.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/patsim_heatmap.dark.svg#only-dark></p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Bright vertical lines on the graph are located at the very end of their windows, marking where the pattern is considered completed. This makes the similarity score safe to use in backtesting.</p> </div> <p>So, how do we use this indicator to generate signals? We can compare the resulting similarity score to a threshold to generate signals. In the example above, let's set a threshold of 80% to build the exit signals:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-63-1><a id=__codelineno-63-1 name=__codelineno-63-1 href=#__codelineno-63-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exits</span> <span class=o>=</span> <span class=n>patsim</span><span class=o>.</span><span class=n>similarity</span> <span class=o>&gt;=</span> <span class=mf>0.8</span>
</span><span id=__span-63-2><a id=__codelineno-63-2 name=__codelineno-63-2 href=#__codelineno-63-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exits</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-63-3><a id=__codelineno-63-3 name=__codelineno-63-3 href=#__codelineno-63-3></a><span class=go>patsim_window</span>
</span><span id=__span-63-4><a id=__codelineno-63-4 name=__codelineno-63-4 href=#__codelineno-63-4></a><span class=go>30     6</span>
</span><span id=__span-63-5><a id=__codelineno-63-5 name=__codelineno-63-5 href=#__codelineno-63-5></a><span class=go>45     8</span>
</span><span id=__span-63-6><a id=__codelineno-63-6 name=__codelineno-63-6 href=#__codelineno-63-6></a><span class=go>60    14</span>
</span><span id=__span-63-7><a id=__codelineno-63-7 name=__codelineno-63-7 href=#__codelineno-63-7></a><span class=go>75     0</span>
</span><span id=__span-63-8><a id=__codelineno-63-8 name=__codelineno-63-8 href=#__codelineno-63-8></a><span class=go>90     5</span>
</span><span id=__span-63-9><a id=__codelineno-63-9 name=__codelineno-63-9 href=#__codelineno-63-9></a><span class=go>dtype: int64</span>
</span></code></pre></div> <p>If you want to test multiple thresholds, you can use the parameter <code>min_similarity</code>, which sets all scores below it to NaN and also makes pattern recognition faster on average. Deriving the signals is then as simple as checking whether each element is NaN. Let's also test the inverted pattern:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-64-1><a id=__codelineno-64-1 name=__codelineno-64-1 href=#__codelineno-64-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>patsim</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PATSIM</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-64-2><a id=__codelineno-64-2 name=__codelineno-64-2 href=#__codelineno-64-2></a><span class=gp>... </span>    <span class=n>price</span><span class=p>,</span> 
</span><span id=__span-64-3><a id=__codelineno-64-3 name=__codelineno-64-3 href=#__codelineno-64-3></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=n>pattern</span><span class=p>),</span>
</span><span id=__span-64-4><a id=__codelineno-64-4 name=__codelineno-64-4 href=#__codelineno-64-4></a><span class=gp>... </span>    <span class=n>error_type</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=s2>&quot;relative&quot;</span><span class=p>),</span>
</span><span id=__span-64-5><a id=__codelineno-64-5 name=__codelineno-64-5 href=#__codelineno-64-5></a><span class=gp>... </span>    <span class=n>max_error</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=mf>0.05</span><span class=p>),</span>
</span><span id=__span-64-6><a id=__codelineno-64-6 name=__codelineno-64-6 href=#__codelineno-64-6></a><span class=gp>... </span>    <span class=n>max_error_interp_mode</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=s2>&quot;discrete&quot;</span><span class=p>),</span>
</span><span id=__span-64-7><a id=__codelineno-64-7 name=__codelineno-64-7 href=#__codelineno-64-7></a><span class=gp>... </span>    <span class=n>window</span><span class=o>=</span><span class=p>[</span><span class=mi>30</span><span class=p>,</span> <span class=mi>45</span><span class=p>,</span> <span class=mi>60</span><span class=p>,</span> <span class=mi>75</span><span class=p>,</span> <span class=mi>90</span><span class=p>],</span>
</span><span id=__span-64-8><a id=__codelineno-64-8 name=__codelineno-64-8 href=#__codelineno-64-8></a><span class=gp>... </span>    <span class=n>invert</span><span class=o>=</span><span class=p>[</span><span class=kc>False</span><span class=p>,</span> <span class=kc>True</span><span class=p>],</span>
</span><span id=__span-64-9><a id=__codelineno-64-9 name=__codelineno-64-9 href=#__codelineno-64-9></a><span class=gp>... </span>    <span class=n>min_similarity</span><span class=o>=</span><span class=p>[</span><span class=mf>0.7</span><span class=p>,</span> <span class=mf>0.8</span><span class=p>],</span>
</span><span id=__span-64-10><a id=__codelineno-64-10 name=__codelineno-64-10 href=#__codelineno-64-10></a><span class=gp>... </span>    <span class=n>param_product</span><span class=o>=</span><span class=kc>True</span>  <span class=c1># (1)!</span>
</span><span id=__span-64-11><a id=__codelineno-64-11 name=__codelineno-64-11 href=#__codelineno-64-11></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-64-12><a id=__codelineno-64-12 name=__codelineno-64-12 href=#__codelineno-64-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exits</span> <span class=o>=</span> <span class=o>~</span><span class=n>patsim</span><span class=o>.</span><span class=n>similarity</span><span class=o>.</span><span class=n>isnull</span><span class=p>()</span>  <span class=c1># (2)!</span>
</span><span id=__span-64-13><a id=__codelineno-64-13 name=__codelineno-64-13 href=#__codelineno-64-13></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exits</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-64-14><a id=__codelineno-64-14 name=__codelineno-64-14 href=#__codelineno-64-14></a><span class=go>patsim_window  patsim_invert  patsim_min_similarity</span>
</span><span id=__span-64-15><a id=__codelineno-64-15 name=__codelineno-64-15 href=#__codelineno-64-15></a><span class=go>30             False          0.7                      68</span>
</span><span id=__span-64-16><a id=__codelineno-64-16 name=__codelineno-64-16 href=#__codelineno-64-16></a><span class=go>                              0.8                       6</span>
</span><span id=__span-64-17><a id=__codelineno-64-17 name=__codelineno-64-17 href=#__codelineno-64-17></a><span class=go>               True           0.7                      64</span>
</span><span id=__span-64-18><a id=__codelineno-64-18 name=__codelineno-64-18 href=#__codelineno-64-18></a><span class=go>                              0.8                       2</span>
</span><span id=__span-64-19><a id=__codelineno-64-19 name=__codelineno-64-19 href=#__codelineno-64-19></a><span class=go>...            ...            ...                     ...</span>
</span><span id=__span-64-20><a id=__codelineno-64-20 name=__codelineno-64-20 href=#__codelineno-64-20></a><span class=go>90             False          0.7                      61</span>
</span><span id=__span-64-21><a id=__codelineno-64-21 name=__codelineno-64-21 href=#__codelineno-64-21></a><span class=go>                              0.8                       5</span>
</span><span id=__span-64-22><a id=__codelineno-64-22 name=__codelineno-64-22 href=#__codelineno-64-22></a><span class=go>               True           0.7                      70</span>
</span><span id=__span-64-23><a id=__codelineno-64-23 name=__codelineno-64-23 href=#__codelineno-64-23></a><span class=go>                              0.8                       8</span>
</span><span id=__span-64-24><a id=__codelineno-64-24 name=__codelineno-64-24 href=#__codelineno-64-24></a><span class=go>dtype: int64</span>
</span></code></pre></div> <ol> <li>Build the Cartesian product of all parameters with more than one element. Keep in mind that the number of parameter combinations can grow quickly: testing three parameters with 10 elements each results in 1,000 combinations.</li> <li>Any element that is not NaN is a potential signal.</li> </ol> <p>If you are not interested in having the window as a backtestable parameter, but instead want to create a signal as soon as any of the windows at that row crosses the similarity threshold, you can react immediately once a pattern of any length is detected. This is easily achieved using Pandas:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-65-1><a id=__codelineno-65-1 name=__codelineno-65-1 href=#__codelineno-65-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>groupby</span> <span class=o>=</span> <span class=p>[</span>  <span class=c1># (1)!</span>
</span><span id=__span-65-2><a id=__codelineno-65-2 name=__codelineno-65-2 href=#__codelineno-65-2></a><span class=gp>... </span>    <span class=n>name</span> <span class=k>for</span> <span class=n>name</span> <span class=ow>in</span> <span class=n>patsim</span><span class=o>.</span><span class=n>wrapper</span><span class=o>.</span><span class=n>columns</span><span class=o>.</span><span class=n>names</span> 
</span><span id=__span-65-3><a id=__codelineno-65-3 name=__codelineno-65-3 href=#__codelineno-65-3></a><span class=gp>... </span>    <span class=k>if</span> <span class=n>name</span> <span class=o>!=</span> <span class=s2>&quot;patsim_window&quot;</span>
</span><span id=__span-65-4><a id=__codelineno-65-4 name=__codelineno-65-4 href=#__codelineno-65-4></a><span class=gp>... </span><span class=p>]</span>
</span><span id=__span-65-5><a id=__codelineno-65-5 name=__codelineno-65-5 href=#__codelineno-65-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>max_sim</span> <span class=o>=</span> <span class=n>patsim</span><span class=o>.</span><span class=n>similarity</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=n>groupby</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=o>.</span><span class=n>max</span><span class=p>()</span>  <span class=c1># (2)!</span>
</span><span id=__span-65-6><a id=__codelineno-65-6 name=__codelineno-65-6 href=#__codelineno-65-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entries</span> <span class=o>=</span> <span class=o>~</span><span class=n>max_sim</span><span class=o>.</span><span class=n>xs</span><span class=p>(</span><span class=kc>True</span><span class=p>,</span> <span class=n>level</span><span class=o>=</span><span class=s2>&quot;patsim_invert&quot;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=o>.</span><span class=n>isnull</span><span class=p>()</span>  <span class=c1># (3)!</span>
</span><span id=__span-65-7><a id=__codelineno-65-7 name=__codelineno-65-7 href=#__codelineno-65-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exits</span> <span class=o>=</span> <span class=o>~</span><span class=n>max_sim</span><span class=o>.</span><span class=n>xs</span><span class=p>(</span><span class=kc>False</span><span class=p>,</span> <span class=n>level</span><span class=o>=</span><span class=s2>&quot;patsim_invert&quot;</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=o>.</span><span class=n>isnull</span><span class=p>()</span>  <span class=c1># (4)!</span>
</span></code></pre></div> <ol> <li>Group by each column level except <code>patsim_window</code>.</li> <li>Select the highest score among all windows.</li> <li>Select non-NaN scores among columns where <code>patsim_invert</code> is <code>True</code> to build entries.</li> <li>Select non-NaN scores among columns where <code>patsim_invert</code> is <code>False</code> to build exits.</li> </ol> <p>Now, let's plot the entry and exit signals corresponding to the threshold of 80%:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-66-1><a id=__codelineno-66-1 name=__codelineno-66-1 href=#__codelineno-66-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>ohlc_trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>opacity</span><span class=o>=</span><span class=mf>0.5</span><span class=p>))</span>
</span><span id=__span-66-2><a id=__codelineno-66-2 name=__codelineno-66-2 href=#__codelineno-66-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entries</span><span class=p>[</span><span class=mf>0.8</span><span class=p>]</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>plot_as_entries</span><span class=p>(</span><span class=n>price</span><span class=p>,</span> <span class=n>fig</span><span class=o>=</span><span class=n>fig</span><span class=p>)</span>
</span><span id=__span-66-3><a id=__codelineno-66-3 name=__codelineno-66-3 href=#__codelineno-66-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exits</span><span class=p>[</span><span class=mf>0.8</span><span class=p>]</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>plot_as_exits</span><span class=p>(</span><span class=n>price</span><span class=p>,</span> <span class=n>fig</span><span class=o>=</span><span class=n>fig</span><span class=p>)</span>
</span><span id=__span-66-4><a id=__codelineno-66-4 name=__codelineno-66-4 href=#__codelineno-66-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/patsim_signals.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/patsim_signals.dark.svg#only-dark></p> <p>Apart from a few missed regular and inverted double top patterns, the indicator works well. By further tweaking the pattern similarity parameters and choosing a stricter pattern configuration, you could easily filter out most failed patterns.</p> <h2 id=search>Search<a class=headerlink href=#search title="Permanent link">&para;</a></h2> <p>Searching for patterns of variable length using indicators with a parameterizable window is expensive. Each window requires allocating an array at least the same size as the entire price array. We need a more compact representation of pattern search results. Fortunately, VBT's native support for record arrays makes this possible!</p> <p>The procedural logic is implemented by the Numba-compiled function <a href=https://vectorbt.pro/pvt_41531c19/api/generic/nb/records/#vectorbtpro.generic.nb.records.find_pattern_1d_nb>find_pattern_1d_nb</a> and its two-dimensional version <a href=https://vectorbt.pro/pvt_41531c19/api/generic/nb/records/#vectorbtpro.generic.nb.records.find_pattern_nb>find_pattern_nb</a>. Here is the idea: iterate over the rows of a price array, and at each row, iterate over a range of windows going forward or backward. For each window, run the <a href=https://vectorbt.pro/pvt_41531c19/api/generic/nb/patterns/#vectorbtpro.generic.nb.patterns.pattern_similarity_nb>pattern_similarity_nb</a> function to get the similarity score. If the score meets all requirements and is not NaN, create a NumPy record of the type <a href=https://vectorbt.pro/pvt_41531c19/api/generic/enums/#vectorbtpro.generic.enums.pattern_range_dt>pattern_range_dt</a>, which stores the start index (inclusive), the end index (exclusive, or inclusive if it's the last index), and the similarity score. This record is appended to a record array and returned to the user. The function supports selecting rows and windows randomly with a specified probability to reduce the number of candidates and can handle overlapping pattern ranges. It is also extremely time and memory efficient <img alt=⚡ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/26a1.svg title=:zap:></p> <p>Let's search for the pattern we defined above by rolling a window with sizes ranging from 30 to 90 and require the similarity score to be at least 85%:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-67-1><a id=__codelineno-67-1 name=__codelineno-67-1 href=#__codelineno-67-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_range_records</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>nb</span><span class=o>.</span><span class=n>find_pattern_1d_nb</span><span class=p>(</span>
</span><span id=__span-67-2><a id=__codelineno-67-2 name=__codelineno-67-2 href=#__codelineno-67-2></a><span class=gp>... </span>    <span class=n>price</span><span class=o>.</span><span class=n>values</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-67-3><a id=__codelineno-67-3 name=__codelineno-67-3 href=#__codelineno-67-3></a><span class=gp>... </span>    <span class=n>pattern</span><span class=p>,</span>
</span><span id=__span-67-4><a id=__codelineno-67-4 name=__codelineno-67-4 href=#__codelineno-67-4></a><span class=gp>... </span>    <span class=n>window</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span>  <span class=c1># (2)!</span>
</span><span id=__span-67-5><a id=__codelineno-67-5 name=__codelineno-67-5 href=#__codelineno-67-5></a><span class=gp>... </span>    <span class=n>max_window</span><span class=o>=</span><span class=mi>90</span><span class=p>,</span>
</span><span id=__span-67-6><a id=__codelineno-67-6 name=__codelineno-67-6 href=#__codelineno-67-6></a><span class=gp>... </span>    <span class=n>error_type</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>ErrorType</span><span class=o>.</span><span class=n>Relative</span><span class=p>,</span>
</span><span id=__span-67-7><a id=__codelineno-67-7 name=__codelineno-67-7 href=#__codelineno-67-7></a><span class=gp>... </span>    <span class=n>max_error</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mf>0.05</span><span class=p>]),</span>  <span class=c1># (3)!</span>
</span><span id=__span-67-8><a id=__codelineno-67-8 name=__codelineno-67-8 href=#__codelineno-67-8></a><span class=gp>... </span>    <span class=n>max_error_interp_mode</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>enums</span><span class=o>.</span><span class=n>InterpMode</span><span class=o>.</span><span class=n>Discrete</span><span class=p>,</span>
</span><span id=__span-67-9><a id=__codelineno-67-9 name=__codelineno-67-9 href=#__codelineno-67-9></a><span class=gp>... </span>    <span class=n>min_similarity</span><span class=o>=</span><span class=mf>0.85</span>
</span><span id=__span-67-10><a id=__codelineno-67-10 name=__codelineno-67-10 href=#__codelineno-67-10></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-67-11><a id=__codelineno-67-11 name=__codelineno-67-11 href=#__codelineno-67-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_range_records</span>
</span><span id=__span-67-12><a id=__codelineno-67-12 name=__codelineno-67-12 href=#__codelineno-67-12></a><span class=go>array([(0, 0, 270, 314, 1, 0.86226468), (1, 0, 484, 540, 1, 0.89078042)])</span>
</span></code></pre></div> <ol> <li>Our price contains only one asset, so we use the one-dimensional version of this function.</li> <li>If <code>max_window</code> is provided, the <code>window</code> argument becomes the minimum window.</li> <li>Always wrap any array-like argument with NumPy when working with Numba-compiled functions.</li> </ol> <p>The call returned two records, with 86% and 89% (!) similarity, respectively. The first window is <code>314 - 270 = 44</code> data points long, and the second is <code>540 - 484 = 56</code>. Let's plot the second fit, including the 30 bars that follow the pattern:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-68-1><a id=__codelineno-68-1 name=__codelineno-68-1 href=#__codelineno-68-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>start_row</span> <span class=o>=</span> <span class=n>pattern_range_records</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=s2>&quot;start_idx&quot;</span><span class=p>]</span>
</span><span id=__span-68-2><a id=__codelineno-68-2 name=__codelineno-68-2 href=#__codelineno-68-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>end_row</span> <span class=o>=</span> <span class=n>pattern_range_records</span><span class=p>[</span><span class=mi>1</span><span class=p>][</span><span class=s2>&quot;end_idx&quot;</span><span class=p>]</span>
</span><span id=__span-68-3><a id=__codelineno-68-3 name=__codelineno-68-3 href=#__codelineno-68-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>start_row</span><span class=p>:</span><span class=n>end_row</span> <span class=o>+</span> <span class=mi>30</span><span class=p>]</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>plot_volume</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-68-4><a id=__codelineno-68-4 name=__codelineno-68-4 href=#__codelineno-68-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>price</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>start_row</span><span class=p>:</span><span class=n>end_row</span><span class=p>]</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot_pattern</span><span class=p>(</span>
</span><span id=__span-68-5><a id=__codelineno-68-5 name=__codelineno-68-5 href=#__codelineno-68-5></a><span class=gp>... </span>    <span class=n>pattern</span><span class=p>,</span> 
</span><span id=__span-68-6><a id=__codelineno-68-6 name=__codelineno-68-6 href=#__codelineno-68-6></a><span class=gp>... </span>    <span class=n>error_type</span><span class=o>=</span><span class=s2>&quot;relative&quot;</span><span class=p>,</span>
</span><span id=__span-68-7><a id=__codelineno-68-7 name=__codelineno-68-7 href=#__codelineno-68-7></a><span class=gp>... </span>    <span class=n>max_error</span><span class=o>=</span><span class=mf>0.05</span><span class=p>,</span>
</span><span id=__span-68-8><a id=__codelineno-68-8 name=__codelineno-68-8 href=#__codelineno-68-8></a><span class=gp>... </span>    <span class=n>max_error_interp_mode</span><span class=o>=</span><span class=s2>&quot;discrete&quot;</span><span class=p>,</span>
</span><span id=__span-68-9><a id=__codelineno-68-9 name=__codelineno-68-9 href=#__codelineno-68-9></a><span class=gp>... </span>    <span class=n>plot_obj</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> 
</span><span id=__span-68-10><a id=__codelineno-68-10 name=__codelineno-68-10 href=#__codelineno-68-10></a><span class=gp>... </span>    <span class=n>fig</span><span class=o>=</span><span class=n>fig</span>
</span><span id=__span-68-11><a id=__codelineno-68-11 name=__codelineno-68-11 href=#__codelineno-68-11></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-68-12><a id=__codelineno-68-12 name=__codelineno-68-12 href=#__codelineno-68-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/find_pattern.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/find_pattern.dark.svg#only-dark></p> <p>Voilà, this is the same pattern we examined at the beginning of this tutorial! This example shows how important it is to test a dense grid of windows to find optimal matches. Unlike the <a href=https://vectorbt.pro/pvt_41531c19/api/indicators/custom/patsim/#vectorbtpro.indicators.custom.patsim.PATSIM>PATSIM</a> indicator, this approach uses almost no memory and includes several tricks to speed up calculation, such as pre-calculating the price's expanding minimum and maximum values.</p> <p>As is often the case, using the raw Numba-compiled function is all fun and games until you come across a more convenient method that wraps it: <a href=https://vectorbt.pro/pvt_41531c19/api/generic/ranges/#vectorbtpro.generic.ranges.PatternRanges.from_pattern_search>PatternRanges.from_pattern_search</a>. This class method takes all parameters accepted by <a href=https://vectorbt.pro/pvt_41531c19/api/generic/nb/records/#vectorbtpro.generic.nb.records.find_pattern_1d_nb>find_pattern_1d_nb</a>, builds a grid of parameter combinations, splits the price array into one-dimensional column arrays, and executes each parameter combination on each column array using the <a href=https://vectorbt.pro/pvt_41531c19/api/utils/execution/#vectorbtpro.utils.execution.execute>execute</a> function, which supports both sequential and parallel processing. After processing all input combinations, the method concatenates the resulting record arrays and wraps them with the class <a href=https://vectorbt.pro/pvt_41531c19/api/generic/ranges/#vectorbtpro.generic.ranges.PatternRanges>PatternRanges</a>. This class extends the base class <a href=https://vectorbt.pro/pvt_41531c19/api/generic/ranges/#vectorbtpro.generic.ranges.Ranges>Ranges</a> by adding the similarity field and various pattern analysis and plotting methods. Enough theory; let's do the same as above using this method:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-69-1><a id=__codelineno-69-1 name=__codelineno-69-1 href=#__codelineno-69-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PatternRanges</span><span class=o>.</span><span class=n>from_pattern_search</span><span class=p>(</span>
</span><span id=__span-69-2><a id=__codelineno-69-2 name=__codelineno-69-2 href=#__codelineno-69-2></a><span class=gp>... </span>    <span class=n>price</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-69-3><a id=__codelineno-69-3 name=__codelineno-69-3 href=#__codelineno-69-3></a><span class=gp>... </span>    <span class=n>pattern</span><span class=p>,</span>
</span><span id=__span-69-4><a id=__codelineno-69-4 name=__codelineno-69-4 href=#__codelineno-69-4></a><span class=gp>... </span>    <span class=n>window</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span>
</span><span id=__span-69-5><a id=__codelineno-69-5 name=__codelineno-69-5 href=#__codelineno-69-5></a><span class=gp>... </span>    <span class=n>max_window</span><span class=o>=</span><span class=mi>90</span><span class=p>,</span>
</span><span id=__span-69-6><a id=__codelineno-69-6 name=__codelineno-69-6 href=#__codelineno-69-6></a><span class=gp>... </span>    <span class=n>error_type</span><span class=o>=</span><span class=s2>&quot;relative&quot;</span><span class=p>,</span>  <span class=c1># (2)!</span>
</span><span id=__span-69-7><a id=__codelineno-69-7 name=__codelineno-69-7 href=#__codelineno-69-7></a><span class=gp>... </span>    <span class=n>max_error</span><span class=o>=</span><span class=mf>0.05</span><span class=p>,</span>  <span class=c1># (3)!</span>
</span><span id=__span-69-8><a id=__codelineno-69-8 name=__codelineno-69-8 href=#__codelineno-69-8></a><span class=gp>... </span>    <span class=n>max_error_interp_mode</span><span class=o>=</span><span class=s2>&quot;discrete&quot;</span><span class=p>,</span>
</span><span id=__span-69-9><a id=__codelineno-69-9 name=__codelineno-69-9 href=#__codelineno-69-9></a><span class=gp>... </span>    <span class=n>min_similarity</span><span class=o>=</span><span class=mf>0.85</span>
</span><span id=__span-69-10><a id=__codelineno-69-10 name=__codelineno-69-10 href=#__codelineno-69-10></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-69-11><a id=__codelineno-69-11 name=__codelineno-69-11 href=#__codelineno-69-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span>
</span><span id=__span-69-12><a id=__codelineno-69-12 name=__codelineno-69-12 href=#__codelineno-69-12></a><span class=go>&lt;vectorbtpro.generic.ranges.PatternRanges at 0x7f8bdab039d0&gt;</span>
</span></code></pre></div> <ol> <li>Accepts Pandas objects.</li> <li>Accepts strings.</li> <li>Accepts constants.</li> </ol> <p>If the price is a Pandas object, there is also an accessor method <a href=https://vectorbt.pro/pvt_41531c19/api/generic/accessors/#vectorbtpro.generic.accessors.GenericAccessor.find_pattern>GenericAccessor.find_pattern</a> that calls the class method above and can save you a few lines:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-70-1><a id=__codelineno-70-1 name=__codelineno-70-1 href=#__codelineno-70-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span> <span class=o>=</span> <span class=n>price</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>find_pattern</span><span class=p>(</span>
</span><span id=__span-70-2><a id=__codelineno-70-2 name=__codelineno-70-2 href=#__codelineno-70-2></a><span class=gp>... </span>    <span class=n>pattern</span><span class=p>,</span>
</span><span id=__span-70-3><a id=__codelineno-70-3 name=__codelineno-70-3 href=#__codelineno-70-3></a><span class=gp>... </span>    <span class=n>window</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span>
</span><span id=__span-70-4><a id=__codelineno-70-4 name=__codelineno-70-4 href=#__codelineno-70-4></a><span class=gp>... </span>    <span class=n>max_window</span><span class=o>=</span><span class=mi>90</span><span class=p>,</span>
</span><span id=__span-70-5><a id=__codelineno-70-5 name=__codelineno-70-5 href=#__codelineno-70-5></a><span class=gp>... </span>    <span class=n>error_type</span><span class=o>=</span><span class=s2>&quot;relative&quot;</span><span class=p>,</span>
</span><span id=__span-70-6><a id=__codelineno-70-6 name=__codelineno-70-6 href=#__codelineno-70-6></a><span class=gp>... </span>    <span class=n>max_error</span><span class=o>=</span><span class=mf>0.05</span><span class=p>,</span>
</span><span id=__span-70-7><a id=__codelineno-70-7 name=__codelineno-70-7 href=#__codelineno-70-7></a><span class=gp>... </span>    <span class=n>max_error_interp_mode</span><span class=o>=</span><span class=s2>&quot;discrete&quot;</span><span class=p>,</span>
</span><span id=__span-70-8><a id=__codelineno-70-8 name=__codelineno-70-8 href=#__codelineno-70-8></a><span class=gp>... </span>    <span class=n>min_similarity</span><span class=o>=</span><span class=mf>0.85</span>
</span><span id=__span-70-9><a id=__codelineno-70-9 name=__codelineno-70-9 href=#__codelineno-70-9></a><span class=gp>... </span><span class=p>)</span>
</span></code></pre></div> <p>Let's view the records in a human-readable format:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-71-1><a id=__codelineno-71-1 name=__codelineno-71-1 href=#__codelineno-71-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span><span class=o>.</span><span class=n>records_readable</span>
</span><span id=__span-71-2><a id=__codelineno-71-2 name=__codelineno-71-2 href=#__codelineno-71-2></a><span class=go>   Pattern Range Id  Column               Start Index  \</span>
</span><span id=__span-71-3><a id=__codelineno-71-3 name=__codelineno-71-3 href=#__codelineno-71-3></a><span class=go>0                 0       0 2021-02-26 00:00:00+00:00   </span>
</span><span id=__span-71-4><a id=__codelineno-71-4 name=__codelineno-71-4 href=#__codelineno-71-4></a><span class=go>1                 1       0 2021-09-28 00:00:00+00:00   </span>
</span><span id=__span-71-5><a id=__codelineno-71-5 name=__codelineno-71-5 href=#__codelineno-71-5></a>
</span><span id=__span-71-6><a id=__codelineno-71-6 name=__codelineno-71-6 href=#__codelineno-71-6></a><span class=go>                  End Index  Status  Similarity  </span>
</span><span id=__span-71-7><a id=__codelineno-71-7 name=__codelineno-71-7 href=#__codelineno-71-7></a><span class=go>0 2021-04-11 00:00:00+00:00  Closed    0.862265  </span>
</span><span id=__span-71-8><a id=__codelineno-71-8 name=__codelineno-71-8 href=#__codelineno-71-8></a><span class=go>1 2021-11-23 00:00:00+00:00  Closed    0.890780 </span>
</span></code></pre></div> <p>Additionally, the returned <a href=https://vectorbt.pro/pvt_41531c19/api/generic/ranges/#vectorbtpro.generic.ranges.PatternRanges>PatternRanges</a> instance stores the search configuration used to generate those records for each column. The property <a href=https://vectorbt.pro/pvt_41531c19/api/generic/ranges/#vectorbtpro.generic.ranges.PatternRanges.search_configs>PatternRanges.search_configs</a> returns a list of these configurations, with each one being an instance of the data class <a href=https://vectorbt.pro/pvt_41531c19/api/generic/ranges/#vectorbtpro.generic.ranges.PSC>PSC</a> (short for "Pattern Search Config"). There is one search configuration for each column.</p> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>Please refer to the <a href=https://vectorbt.pro/pvt_41531c19/api/generic/ranges/#vectorbtpro.generic.ranges.PSC>documentation of PSC</a> for detailed descriptions of each parameter used in pattern search.</p> </div> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-72-1><a id=__codelineno-72-1 name=__codelineno-72-1 href=#__codelineno-72-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span><span class=o>.</span><span class=n>wrapper</span><span class=o>.</span><span class=n>columns</span>
</span><span id=__span-72-2><a id=__codelineno-72-2 name=__codelineno-72-2 href=#__codelineno-72-2></a><span class=go>Int64Index([0], dtype=&#39;int64&#39;)</span>
</span><span id=__span-72-3><a id=__codelineno-72-3 name=__codelineno-72-3 href=#__codelineno-72-3></a>
</span><span id=__span-72-4><a id=__codelineno-72-4 name=__codelineno-72-4 href=#__codelineno-72-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span><span class=o>.</span><span class=n>search_configs</span>
</span><span id=__span-72-5><a id=__codelineno-72-5 name=__codelineno-72-5 href=#__codelineno-72-5></a><span class=go>[PSC(</span>
</span><span id=__span-72-6><a id=__codelineno-72-6 name=__codelineno-72-6 href=#__codelineno-72-6></a><span class=go>    pattern=array([1, 2, 3, 2, 3, 2]), </span>
</span><span id=__span-72-7><a id=__codelineno-72-7 name=__codelineno-72-7 href=#__codelineno-72-7></a><span class=go>    window=30, </span>
</span><span id=__span-72-8><a id=__codelineno-72-8 name=__codelineno-72-8 href=#__codelineno-72-8></a><span class=go>    max_window=120, </span>
</span><span id=__span-72-9><a id=__codelineno-72-9 name=__codelineno-72-9 href=#__codelineno-72-9></a><span class=go>    row_select_prob=1.0, </span>
</span><span id=__span-72-10><a id=__codelineno-72-10 name=__codelineno-72-10 href=#__codelineno-72-10></a><span class=go>    window_select_prob=1.0, </span>
</span><span id=__span-72-11><a id=__codelineno-72-11 name=__codelineno-72-11 href=#__codelineno-72-11></a><span class=go>    roll_forward=False,</span>
</span><span id=__span-72-12><a id=__codelineno-72-12 name=__codelineno-72-12 href=#__codelineno-72-12></a><span class=go>    interp_mode=3, </span>
</span><span id=__span-72-13><a id=__codelineno-72-13 name=__codelineno-72-13 href=#__codelineno-72-13></a><span class=go>    rescale_mode=0, </span>
</span><span id=__span-72-14><a id=__codelineno-72-14 name=__codelineno-72-14 href=#__codelineno-72-14></a><span class=go>    vmin=nan, </span>
</span><span id=__span-72-15><a id=__codelineno-72-15 name=__codelineno-72-15 href=#__codelineno-72-15></a><span class=go>    vmax=nan, </span>
</span><span id=__span-72-16><a id=__codelineno-72-16 name=__codelineno-72-16 href=#__codelineno-72-16></a><span class=go>    pmin=nan, </span>
</span><span id=__span-72-17><a id=__codelineno-72-17 name=__codelineno-72-17 href=#__codelineno-72-17></a><span class=go>    pmax=nan, </span>
</span><span id=__span-72-18><a id=__codelineno-72-18 name=__codelineno-72-18 href=#__codelineno-72-18></a><span class=go>    invert=False, </span>
</span><span id=__span-72-19><a id=__codelineno-72-19 name=__codelineno-72-19 href=#__codelineno-72-19></a><span class=go>    error_type=1, </span>
</span><span id=__span-72-20><a id=__codelineno-72-20 name=__codelineno-72-20 href=#__codelineno-72-20></a><span class=go>    distance_measure=0, </span>
</span><span id=__span-72-21><a id=__codelineno-72-21 name=__codelineno-72-21 href=#__codelineno-72-21></a><span class=go>    max_error=array([0.05]), </span>
</span><span id=__span-72-22><a id=__codelineno-72-22 name=__codelineno-72-22 href=#__codelineno-72-22></a><span class=go>    max_error_interp_mode=2, </span>
</span><span id=__span-72-23><a id=__codelineno-72-23 name=__codelineno-72-23 href=#__codelineno-72-23></a><span class=go>    max_error_as_maxdist=False, </span>
</span><span id=__span-72-24><a id=__codelineno-72-24 name=__codelineno-72-24 href=#__codelineno-72-24></a><span class=go>    max_error_strict=False, </span>
</span><span id=__span-72-25><a id=__codelineno-72-25 name=__codelineno-72-25 href=#__codelineno-72-25></a><span class=go>    min_pct_change=nan, </span>
</span><span id=__span-72-26><a id=__codelineno-72-26 name=__codelineno-72-26 href=#__codelineno-72-26></a><span class=go>    max_pct_change=nan, </span>
</span><span id=__span-72-27><a id=__codelineno-72-27 name=__codelineno-72-27 href=#__codelineno-72-27></a><span class=go>    min_similarity=0.85, </span>
</span><span id=__span-72-28><a id=__codelineno-72-28 name=__codelineno-72-28 href=#__codelineno-72-28></a><span class=go>    max_one_per_row=True,</span>
</span><span id=__span-72-29><a id=__codelineno-72-29 name=__codelineno-72-29 href=#__codelineno-72-29></a><span class=go>    max_overlap=0, </span>
</span><span id=__span-72-30><a id=__codelineno-72-30 name=__codelineno-72-30 href=#__codelineno-72-30></a><span class=go>    max_records=None, </span>
</span><span id=__span-72-31><a id=__codelineno-72-31 name=__codelineno-72-31 href=#__codelineno-72-31></a><span class=go>    name=None</span>
</span><span id=__span-72-32><a id=__codelineno-72-32 name=__codelineno-72-32 href=#__codelineno-72-32></a><span class=go>)]</span>
</span></code></pre></div> <p>This configuration instance contains all the argument names and values passed to <a href=https://vectorbt.pro/pvt_41531c19/api/generic/nb/records/#vectorbtpro.generic.nb.records.find_pattern_1d_nb>find_pattern_1d_nb</a>. Why do we need to keep it? For plotting! Remember how inconvenient it was to provide the exact same arguments to a plotting method that were used in the similarity calculation. To make things more streamlined, each pattern range instance keeps track of the search configuration for each column to be plotted. Plotting itself is handled by the method <a href=https://vectorbt.pro/pvt_41531c19/api/generic/ranges/#vectorbtpro.generic.ranges.PatternRanges.plot>PatternRanges.plot</a>, which uses the <a href=https://vectorbt.pro/pvt_41531c19/api/generic/ranges/#vectorbtpro.generic.ranges.Ranges.plot>Ranges.plot</a> method to plot the data and ranges, and the <a href=https://vectorbt.pro/pvt_41531c19/api/generic/accessors/#vectorbtpro.generic.accessors.GenericSRAccessor.plot_pattern>GenericSRAccessor.plot_pattern</a> method to plot the patterns:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-73-1><a id=__codelineno-73-1 name=__codelineno-73-1 href=#__codelineno-73-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/pattern_ranges.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/pattern_ranges.dark.svg#only-dark></p> <p>By default, it fills the distance between the price and the pattern (set <code>fill_distance=False</code> to hide this), and does not display the corridor (set <code>plot_max_error=True</code> to show it). As with any other subclass of <a href=https://vectorbt.pro/pvt_41531c19/api/generic/analyzable/#vectorbtpro.generic.analyzable.Analyzable>Analyzable</a>, an instance of <a href=https://vectorbt.pro/pvt_41531c19/api/generic/ranges/#vectorbtpro.generic.ranges.PatternRanges>PatternRanges</a> behaves in many ways like a regular Pandas object. For example, you can filter a date range using the regular <code>loc</code> and <code>iloc</code> operations to zoom in on any pattern programmatically.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>When selecting a date range, the indexing operation will filter out all range records that do not <em>completely</em> fall within the new date range. That is, if a pattern range starts on <code>2020-01-01</code> and lasts until <code>2021-01-01</code>, it will be included in the new pattern range instance if the new date range fully contains that period, for example <code>2019-01-01</code> to <code>2021-01-01</code>, but not <code>2019-01-01</code> to <code>2020-12-31</code>.</p> </div> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-74-1><a id=__codelineno-74-1 name=__codelineno-74-1 href=#__codelineno-74-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=s2>&quot;2021-09-01&quot;</span><span class=p>:</span><span class=s2>&quot;2022-01-01&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/pattern_ranges_zoomed.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/pattern_ranges_zoomed.dark.svg#only-dark></p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>You might have noticed that the bright area is larger than the window by one bar, and the green marker is located a bit farther from the last window point. This is because the field <code>end_idx</code> represents the exclusive end of the range: the first point after the last window point. This approach is needed to properly calculate the duration of any range. The only exception is when the last window point is the last point in the entire price array; in such cases, the marker will be placed at that point and the range will be marked as open. Open ranges do not mean that the pattern is not completed, though.</p> </div> <p>Since all information is now represented using records, we can query various useful metrics to describe the results:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-75-1><a id=__codelineno-75-1 name=__codelineno-75-1 href=#__codelineno-75-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span><span class=o>.</span><span class=n>stats</span><span class=p>()</span>
</span><span id=__span-75-2><a id=__codelineno-75-2 name=__codelineno-75-2 href=#__codelineno-75-2></a><span class=go>Start                 2020-06-01 00:00:00+00:00</span>
</span><span id=__span-75-3><a id=__codelineno-75-3 name=__codelineno-75-3 href=#__codelineno-75-3></a><span class=go>End                   2022-05-31 00:00:00+00:00</span>
</span><span id=__span-75-4><a id=__codelineno-75-4 name=__codelineno-75-4 href=#__codelineno-75-4></a><span class=go>Period                        730 days 00:00:00</span>
</span><span id=__span-75-5><a id=__codelineno-75-5 name=__codelineno-75-5 href=#__codelineno-75-5></a><span class=go>Total Records                                 2</span>
</span><span id=__span-75-6><a id=__codelineno-75-6 name=__codelineno-75-6 href=#__codelineno-75-6></a><span class=go>Coverage                               0.136986</span>
</span><span id=__span-75-7><a id=__codelineno-75-7 name=__codelineno-75-7 href=#__codelineno-75-7></a><span class=go>Overlap Coverage                            0.0</span>
</span><span id=__span-75-8><a id=__codelineno-75-8 name=__codelineno-75-8 href=#__codelineno-75-8></a><span class=go>Duration: Min                  44 days 00:00:00</span>
</span><span id=__span-75-9><a id=__codelineno-75-9 name=__codelineno-75-9 href=#__codelineno-75-9></a><span class=go>Duration: Median               50 days 00:00:00</span>
</span><span id=__span-75-10><a id=__codelineno-75-10 name=__codelineno-75-10 href=#__codelineno-75-10></a><span class=go>Duration: Max                  56 days 00:00:00</span>
</span><span id=__span-75-11><a id=__codelineno-75-11 name=__codelineno-75-11 href=#__codelineno-75-11></a><span class=go>Similarity: Min                        0.862265</span>
</span><span id=__span-75-12><a id=__codelineno-75-12 name=__codelineno-75-12 href=#__codelineno-75-12></a><span class=go>Similarity: Median                     0.876523</span>
</span><span id=__span-75-13><a id=__codelineno-75-13 name=__codelineno-75-13 href=#__codelineno-75-13></a><span class=go>Similarity: Max                         0.89078</span>
</span><span id=__span-75-14><a id=__codelineno-75-14 name=__codelineno-75-14 href=#__codelineno-75-14></a><span class=go>dtype: object</span>
</span></code></pre></div> <p>Here, for example, we see that there are two non-overlapping patterns covering 13.7% of the entire period. We also see various duration and similarity quantiles.</p> <h3 id=overlapping>Overlapping<a class=headerlink href=#overlapping title="Permanent link">&para;</a></h3> <p>In the example above, we searched a total of <code>90 - 30 + 1 = 61</code> windows at each row. Why did we not get any overlapping ranges? By default, overlapping is not allowed. There are two optional mechanisms in place. First, when multiple windows start at the same row, the algorithm selects the one with the highest similarity. This ensures that the number of filled records is always equal to or less than the number of rows in the price array. Second, when there are multiple consecutive records that overlap in ranges (regardless of whether they start at the same row), the algorithm also selects the one with the highest similarity.</p> <p>However, sometimes you may want to allow overlapping ranges. For example, one pattern might start right before another ends, or a large pattern might cover a range that includes smaller patterns. These cases can be addressed by adjusting the <code>overlap_mode</code> argument, which is of type <a href=https://vectorbt.pro/pvt_41531c19/api/generic/enums/#vectorbtpro.generic.enums.OverlapMode>OverlapMode</a>. Setting it to <code>AllowAll</code> disables both mechanisms and appends every single record. Setting it to <code>Allow</code> disables the second mechanism and only filters out ranges starting at the same row. Setting it to <code>Disallow</code> enables both mechanisms (default), while setting it to any other positive integer specifies the maximum number of rows that any two neighboring ranges are allowed to overlap.</p> <div class="admonition important"> <p class=admonition-title>Important</p> <p>Setting the argument to <code>AllowAll</code> may produce a record array larger than the price array. In this case, you need to manually increase the number of records allocated by setting <code>max_records</code>, for example, <code>max_records=len(price) * 2</code>.</p> </div> <p>Let's allow overlapping ranges as long as they do not start at the same row:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-76-1><a id=__codelineno-76-1 name=__codelineno-76-1 href=#__codelineno-76-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span> <span class=o>=</span> <span class=n>price</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>find_pattern</span><span class=p>(</span>
</span><span id=__span-76-2><a id=__codelineno-76-2 name=__codelineno-76-2 href=#__codelineno-76-2></a><span class=gp>... </span>    <span class=n>pattern</span><span class=p>,</span>
</span><span id=__span-76-3><a id=__codelineno-76-3 name=__codelineno-76-3 href=#__codelineno-76-3></a><span class=gp>... </span>    <span class=n>window</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span>
</span><span id=__span-76-4><a id=__codelineno-76-4 name=__codelineno-76-4 href=#__codelineno-76-4></a><span class=gp>... </span>    <span class=n>max_window</span><span class=o>=</span><span class=mi>120</span><span class=p>,</span>
</span><span id=__span-76-5><a id=__codelineno-76-5 name=__codelineno-76-5 href=#__codelineno-76-5></a><span class=gp>... </span>    <span class=n>error_type</span><span class=o>=</span><span class=s2>&quot;relative&quot;</span><span class=p>,</span>
</span><span id=__span-76-6><a id=__codelineno-76-6 name=__codelineno-76-6 href=#__codelineno-76-6></a><span class=gp>... </span>    <span class=n>max_error</span><span class=o>=</span><span class=mf>0.05</span><span class=p>,</span>
</span><span id=__span-76-7><a id=__codelineno-76-7 name=__codelineno-76-7 href=#__codelineno-76-7></a><span class=gp>... </span>    <span class=n>max_error_interp_mode</span><span class=o>=</span><span class=s2>&quot;discrete&quot;</span><span class=p>,</span>
</span><span id=__span-76-8><a id=__codelineno-76-8 name=__codelineno-76-8 href=#__codelineno-76-8></a><span class=gp>... </span>    <span class=n>min_similarity</span><span class=o>=</span><span class=mf>0.85</span><span class=p>,</span>
</span><span id=__span-76-9><a id=__codelineno-76-9 name=__codelineno-76-9 href=#__codelineno-76-9></a><span class=gp>... </span>    <span class=n>overlap_mode</span><span class=o>=</span><span class=s2>&quot;allow&quot;</span>  <span class=c1># (1)!</span>
</span><span id=__span-76-10><a id=__codelineno-76-10 name=__codelineno-76-10 href=#__codelineno-76-10></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-76-11><a id=__codelineno-76-11 name=__codelineno-76-11 href=#__codelineno-76-11></a>
</span><span id=__span-76-12><a id=__codelineno-76-12 name=__codelineno-76-12 href=#__codelineno-76-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span><span class=o>.</span><span class=n>count</span><span class=p>()</span>
</span><span id=__span-76-13><a id=__codelineno-76-13 name=__codelineno-76-13 href=#__codelineno-76-13></a><span class=go>16</span>
</span><span id=__span-76-14><a id=__codelineno-76-14 name=__codelineno-76-14 href=#__codelineno-76-14></a>
</span><span id=__span-76-15><a id=__codelineno-76-15 name=__codelineno-76-15 href=#__codelineno-76-15></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span><span class=o>.</span><span class=n>overlap_coverage</span>
</span><span id=__span-76-16><a id=__codelineno-76-16 name=__codelineno-76-16 href=#__codelineno-76-16></a><span class=go>0.9642857142857143</span>
</span></code></pre></div> <ol> <li>Here</li> </ol> <p>Now we see that instead of 2, there are 16 detected ranges. Also, ranges overlap by 96%, which means that almost all ranges share rows with other ranges. Let's visualize the result:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-77-1><a id=__codelineno-77-1 name=__codelineno-77-1 href=#__codelineno-77-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>plot_zones</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>plot_patterns</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/pattern_ranges_overlap.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/pattern_ranges_overlap.dark.svg#only-dark></p> <p>As shown in the graph, there are only two global matches, each confirmed by windows of different lengths. If we set <code>overlap_mode="disallow"</code>, only the most similar windows in each region would remain.</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>There is an argument controlling the direction in which windows are rolled: <code>roll_forward</code>. If this argument is <code>False</code> (default), ranges are sorted by the end index and may have multiple records pointing to the same start index. Otherwise, ranges are sorted by the start index and may have multiple records pointing to the same end index.</p> </div> <h3 id=random-selection>Random selection<a class=headerlink href=#random-selection title="Permanent link">&para;</a></h3> <p>Sometimes, not every row and window combination is worth searching. If the input data is too large, or if there are too many parameter combinations, the search could take a long time in VBT terms (although it would still be incredibly fast!). To make searchable regions more sparse, we can introduce a probability of picking a specific row or window. For example, if the probability is <code>0.5</code>, the algorithm would search every second row or window on average. Let's set a probability of 50% for rows and 25% for windows, and benchmark the execution to see if the process would be about 8 times faster on average:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-78-1><a id=__codelineno-78-1 name=__codelineno-78-1 href=#__codelineno-78-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>run_prob_search</span><span class=p>(</span><span class=n>row_select_prob</span><span class=p>,</span> <span class=n>window_select_prob</span><span class=p>):</span>
</span><span id=__span-78-2><a id=__codelineno-78-2 name=__codelineno-78-2 href=#__codelineno-78-2></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>price</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>find_pattern</span><span class=p>(</span>
</span><span id=__span-78-3><a id=__codelineno-78-3 name=__codelineno-78-3 href=#__codelineno-78-3></a><span class=gp>... </span>        <span class=n>pattern</span><span class=p>,</span>
</span><span id=__span-78-4><a id=__codelineno-78-4 name=__codelineno-78-4 href=#__codelineno-78-4></a><span class=gp>... </span>        <span class=n>window</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span>
</span><span id=__span-78-5><a id=__codelineno-78-5 name=__codelineno-78-5 href=#__codelineno-78-5></a><span class=gp>... </span>        <span class=n>max_window</span><span class=o>=</span><span class=mi>120</span><span class=p>,</span>
</span><span id=__span-78-6><a id=__codelineno-78-6 name=__codelineno-78-6 href=#__codelineno-78-6></a><span class=gp>... </span>        <span class=n>row_select_prob</span><span class=o>=</span><span class=n>row_select_prob</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-78-7><a id=__codelineno-78-7 name=__codelineno-78-7 href=#__codelineno-78-7></a><span class=gp>... </span>        <span class=n>window_select_prob</span><span class=o>=</span><span class=n>window_select_prob</span><span class=p>,</span>
</span><span id=__span-78-8><a id=__codelineno-78-8 name=__codelineno-78-8 href=#__codelineno-78-8></a><span class=gp>... </span>        <span class=n>error_type</span><span class=o>=</span><span class=s2>&quot;relative&quot;</span><span class=p>,</span>
</span><span id=__span-78-9><a id=__codelineno-78-9 name=__codelineno-78-9 href=#__codelineno-78-9></a><span class=gp>... </span>        <span class=n>max_error</span><span class=o>=</span><span class=mf>0.05</span><span class=p>,</span>
</span><span id=__span-78-10><a id=__codelineno-78-10 name=__codelineno-78-10 href=#__codelineno-78-10></a><span class=gp>... </span>        <span class=n>max_error_interp_mode</span><span class=o>=</span><span class=s2>&quot;discrete&quot;</span><span class=p>,</span>
</span><span id=__span-78-11><a id=__codelineno-78-11 name=__codelineno-78-11 href=#__codelineno-78-11></a><span class=gp>... </span>        <span class=n>min_similarity</span><span class=o>=</span><span class=mf>0.8</span><span class=p>,</span>  <span class=c1># (2)!</span>
</span><span id=__span-78-12><a id=__codelineno-78-12 name=__codelineno-78-12 href=#__codelineno-78-12></a><span class=gp>... </span>    <span class=p>)</span>
</span><span id=__span-78-13><a id=__codelineno-78-13 name=__codelineno-78-13 href=#__codelineno-78-13></a>
</span><span id=__span-78-14><a id=__codelineno-78-14 name=__codelineno-78-14 href=#__codelineno-78-14></a><span class=gp>&gt;&gt;&gt; </span><span class=o>%</span><span class=n>timeit</span> <span class=n>run_prob_search</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>)</span>
</span><span id=__span-78-15><a id=__codelineno-78-15 name=__codelineno-78-15 href=#__codelineno-78-15></a><span class=go>111 ms ± 247 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)</span>
</span><span id=__span-78-16><a id=__codelineno-78-16 name=__codelineno-78-16 href=#__codelineno-78-16></a>
</span><span id=__span-78-17><a id=__codelineno-78-17 name=__codelineno-78-17 href=#__codelineno-78-17></a><span class=gp>&gt;&gt;&gt; </span><span class=o>%</span><span class=n>timeit</span> <span class=n>run_prob_search</span><span class=p>(</span><span class=mf>0.5</span><span class=p>,</span> <span class=mf>0.25</span><span class=p>)</span>
</span><span id=__span-78-18><a id=__codelineno-78-18 name=__codelineno-78-18 href=#__codelineno-78-18></a><span class=go>15 ms ± 183 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)</span>
</span></code></pre></div> <ol> <li>Both arguments must be between 0 and 1.</li> <li>Lower the similarity threshold to capture more ranges.</li> </ol> <p>Just note that unless you set a random seed (<code>seed</code> argument), detected pattern ranges may vary greatly with each method call. Let's run <code>run_prob_search</code> 100 times and plot the number of filled records:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-79-1><a id=__codelineno-79-1 name=__codelineno-79-1 href=#__codelineno-79-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>run_prob_search</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>)</span><span class=o>.</span><span class=n>count</span><span class=p>()</span>  <span class=c1># (1)!</span>
</span><span id=__span-79-2><a id=__codelineno-79-2 name=__codelineno-79-2 href=#__codelineno-79-2></a><span class=go>6</span>
</span><span id=__span-79-3><a id=__codelineno-79-3 name=__codelineno-79-3 href=#__codelineno-79-3></a>
</span><span id=__span-79-4><a id=__codelineno-79-4 name=__codelineno-79-4 href=#__codelineno-79-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pd</span><span class=o>.</span><span class=n>Series</span><span class=p>([</span>
</span><span id=__span-79-5><a id=__codelineno-79-5 name=__codelineno-79-5 href=#__codelineno-79-5></a><span class=gp>... </span>    <span class=n>run_prob_search</span><span class=p>(</span><span class=mf>0.5</span><span class=p>,</span> <span class=mf>0.25</span><span class=p>)</span><span class=o>.</span><span class=n>count</span><span class=p>()</span> 
</span><span id=__span-79-6><a id=__codelineno-79-6 name=__codelineno-79-6 href=#__codelineno-79-6></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
</span><span id=__span-79-7><a id=__codelineno-79-7 name=__codelineno-79-7 href=#__codelineno-79-7></a><span class=gp>... </span><span class=p>])</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Get the maximum possible number of detected patterns.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/random_selection.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/random_selection.dark.svg#only-dark></p> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>The lower the selection probabilities, the less likely you are to detect all patterns in a single call. Always make sure to run the same search multiple times to assess the stability of the detection accuracy.</p> </div> <h3 id=params>Params<a class=headerlink href=#params title="Permanent link">&para;</a></h3> <p>The advantage of the class method <a href=https://vectorbt.pro/pvt_41531c19/api/generic/ranges/#vectorbtpro.generic.ranges.PatternRanges.from_pattern_search>PatternRanges.from_pattern_search</a> is its ability to act like a full-blown indicator. It uses the same broadcasting and parameter combining mechanism as VBT's broadcaster; both rely on the function <a href=https://vectorbt.pro/pvt_41531c19/api/utils/params/#vectorbtpro.utils.params.combine_params>combine_params</a>. To mark any argument as a parameter, wrap it with <a href=https://vectorbt.pro/pvt_41531c19/api/utils/params/#vectorbtpro.utils.params.Param>Param</a>. This enables the parameter to be broadcast and combined with others, and it will appear as its own level in the final column hierarchy.</p> <p>Let's test four patterns: "V-Top", "V-Bottom", a rising market, and a falling market pattern.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-80-1><a id=__codelineno-80-1 name=__codelineno-80-1 href=#__codelineno-80-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span> <span class=o>=</span> <span class=n>price</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>find_pattern</span><span class=p>(</span>
</span><span id=__span-80-2><a id=__codelineno-80-2 name=__codelineno-80-2 href=#__codelineno-80-2></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span>
</span><span id=__span-80-3><a id=__codelineno-80-3 name=__codelineno-80-3 href=#__codelineno-80-3></a><span class=gp>... </span>        <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>],</span>
</span><span id=__span-80-4><a id=__codelineno-80-4 name=__codelineno-80-4 href=#__codelineno-80-4></a><span class=gp>... </span>        <span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>],</span>
</span><span id=__span-80-5><a id=__codelineno-80-5 name=__codelineno-80-5 href=#__codelineno-80-5></a><span class=gp>... </span>        <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span>
</span><span id=__span-80-6><a id=__codelineno-80-6 name=__codelineno-80-6 href=#__codelineno-80-6></a><span class=gp>... </span>        <span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>]</span>
</span><span id=__span-80-7><a id=__codelineno-80-7 name=__codelineno-80-7 href=#__codelineno-80-7></a><span class=gp>... </span>    <span class=p>]),</span>
</span><span id=__span-80-8><a id=__codelineno-80-8 name=__codelineno-80-8 href=#__codelineno-80-8></a><span class=gp>... </span>    <span class=n>window</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span>
</span><span id=__span-80-9><a id=__codelineno-80-9 name=__codelineno-80-9 href=#__codelineno-80-9></a><span class=gp>... </span>    <span class=n>max_window</span><span class=o>=</span><span class=mi>120</span><span class=p>,</span>
</span><span id=__span-80-10><a id=__codelineno-80-10 name=__codelineno-80-10 href=#__codelineno-80-10></a><span class=gp>... </span><span class=p>)</span>
</span></code></pre></div> <p> <div class="progress progress-100plus candystripe candystripe-animate"> <div class=progress-bar style=width:100.00%> <p class=progress-label>Param 4/4</p> </div> </div> </p> <p>Since we provided more than one parameter combination, the executor displayed a progress bar. Let's count the number of found patterns:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-81-1><a id=__codelineno-81-1 name=__codelineno-81-1 href=#__codelineno-81-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span><span class=o>.</span><span class=n>count</span><span class=p>()</span>
</span><span id=__span-81-2><a id=__codelineno-81-2 name=__codelineno-81-2 href=#__codelineno-81-2></a><span class=go>pattern</span>
</span><span id=__span-81-3><a id=__codelineno-81-3 name=__codelineno-81-3 href=#__codelineno-81-3></a><span class=go>list_0    3</span>
</span><span id=__span-81-4><a id=__codelineno-81-4 name=__codelineno-81-4 href=#__codelineno-81-4></a><span class=go>list_1    0</span>
</span><span id=__span-81-5><a id=__codelineno-81-5 name=__codelineno-81-5 href=#__codelineno-81-5></a><span class=go>list_2    7</span>
</span><span id=__span-81-6><a id=__codelineno-81-6 name=__codelineno-81-6 href=#__codelineno-81-6></a><span class=go>list_3    3</span>
</span><span id=__span-81-7><a id=__codelineno-81-7 name=__codelineno-81-7 href=#__codelineno-81-7></a><span class=go>Name: count, dtype: int64</span>
</span></code></pre></div> <p>We see that the <code>pattern</code> argument received four lists. Let's make it more readable by providing an index that assigns each list a name:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-82-1><a id=__codelineno-82-1 name=__codelineno-82-1 href=#__codelineno-82-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span> <span class=o>=</span> <span class=n>price</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>find_pattern</span><span class=p>(</span>
</span><span id=__span-82-2><a id=__codelineno-82-2 name=__codelineno-82-2 href=#__codelineno-82-2></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span>
</span><span id=__span-82-3><a id=__codelineno-82-3 name=__codelineno-82-3 href=#__codelineno-82-3></a><span class=gp>... </span>        <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>],</span>
</span><span id=__span-82-4><a id=__codelineno-82-4 name=__codelineno-82-4 href=#__codelineno-82-4></a><span class=gp>... </span>        <span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>],</span>
</span><span id=__span-82-5><a id=__codelineno-82-5 name=__codelineno-82-5 href=#__codelineno-82-5></a><span class=gp>... </span>        <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span>
</span><span id=__span-82-6><a id=__codelineno-82-6 name=__codelineno-82-6 href=#__codelineno-82-6></a><span class=gp>... </span>        <span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>]</span>
</span><span id=__span-82-7><a id=__codelineno-82-7 name=__codelineno-82-7 href=#__codelineno-82-7></a><span class=gp>... </span>    <span class=p>],</span> <span class=n>keys</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;v-top&quot;</span><span class=p>,</span> <span class=s2>&quot;v-bottom&quot;</span><span class=p>,</span> <span class=s2>&quot;rising&quot;</span><span class=p>,</span> <span class=s2>&quot;falling&quot;</span><span class=p>]),</span>
</span><span id=__span-82-8><a id=__codelineno-82-8 name=__codelineno-82-8 href=#__codelineno-82-8></a><span class=gp>... </span>    <span class=n>window</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span>
</span><span id=__span-82-9><a id=__codelineno-82-9 name=__codelineno-82-9 href=#__codelineno-82-9></a><span class=gp>... </span>    <span class=n>max_window</span><span class=o>=</span><span class=mi>120</span><span class=p>,</span>
</span><span id=__span-82-10><a id=__codelineno-82-10 name=__codelineno-82-10 href=#__codelineno-82-10></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-82-11><a id=__codelineno-82-11 name=__codelineno-82-11 href=#__codelineno-82-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span><span class=o>.</span><span class=n>count</span><span class=p>()</span>
</span><span id=__span-82-12><a id=__codelineno-82-12 name=__codelineno-82-12 href=#__codelineno-82-12></a><span class=go>pattern</span>
</span><span id=__span-82-13><a id=__codelineno-82-13 name=__codelineno-82-13 href=#__codelineno-82-13></a><span class=go>v-top       3</span>
</span><span id=__span-82-14><a id=__codelineno-82-14 name=__codelineno-82-14 href=#__codelineno-82-14></a><span class=go>v-bottom    0</span>
</span><span id=__span-82-15><a id=__codelineno-82-15 name=__codelineno-82-15 href=#__codelineno-82-15></a><span class=go>rising      7</span>
</span><span id=__span-82-16><a id=__codelineno-82-16 name=__codelineno-82-16 href=#__codelineno-82-16></a><span class=go>falling     3</span>
</span><span id=__span-82-17><a id=__codelineno-82-17 name=__codelineno-82-17 href=#__codelineno-82-17></a><span class=go>Name: count, dtype: int64</span>
</span></code></pre></div> <p>Let's display the three detected falling patterns:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-83-1><a id=__codelineno-83-1 name=__codelineno-83-1 href=#__codelineno-83-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>column</span><span class=o>=</span><span class=s2>&quot;falling&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/params_falling.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/params_falling.dark.svg#only-dark></p> <p>But there are many more falling patterns on the chart. Why were they not recognized? There are three reasons: 1) the algorithm searched only regions that are at least 30 bars long, 2) the default minimum similarity threshold is 85%, so the algorithm chose only regions most similar to a straight line, and 3) the algorithm removed any overlapping regions.</p> <p>Now, let's pass multiple parameters. In this case, their values will be combined to form a Cartesian product of all parameter combinations. Let's also test multiple similarity thresholds:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-84-1><a id=__codelineno-84-1 name=__codelineno-84-1 href=#__codelineno-84-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span> <span class=o>=</span> <span class=n>price</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>find_pattern</span><span class=p>(</span>
</span><span id=__span-84-2><a id=__codelineno-84-2 name=__codelineno-84-2 href=#__codelineno-84-2></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span>
</span><span id=__span-84-3><a id=__codelineno-84-3 name=__codelineno-84-3 href=#__codelineno-84-3></a><span class=gp>... </span>        <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>],</span>
</span><span id=__span-84-4><a id=__codelineno-84-4 name=__codelineno-84-4 href=#__codelineno-84-4></a><span class=gp>... </span>        <span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>],</span>
</span><span id=__span-84-5><a id=__codelineno-84-5 name=__codelineno-84-5 href=#__codelineno-84-5></a><span class=gp>... </span>        <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span>
</span><span id=__span-84-6><a id=__codelineno-84-6 name=__codelineno-84-6 href=#__codelineno-84-6></a><span class=gp>... </span>        <span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>]</span>
</span><span id=__span-84-7><a id=__codelineno-84-7 name=__codelineno-84-7 href=#__codelineno-84-7></a><span class=gp>... </span>    <span class=p>],</span> <span class=n>keys</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;v-top&quot;</span><span class=p>,</span> <span class=s2>&quot;v-bottom&quot;</span><span class=p>,</span> <span class=s2>&quot;rising&quot;</span><span class=p>,</span> <span class=s2>&quot;falling&quot;</span><span class=p>]),</span>
</span><span id=__span-84-8><a id=__codelineno-84-8 name=__codelineno-84-8 href=#__codelineno-84-8></a><span class=gp>... </span>    <span class=n>window</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span>
</span><span id=__span-84-9><a id=__codelineno-84-9 name=__codelineno-84-9 href=#__codelineno-84-9></a><span class=gp>... </span>    <span class=n>max_window</span><span class=o>=</span><span class=mi>120</span><span class=p>,</span>
</span><span id=__span-84-10><a id=__codelineno-84-10 name=__codelineno-84-10 href=#__codelineno-84-10></a><span class=gp>... </span>    <span class=n>min_similarity</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span><span class=mf>0.8</span><span class=p>,</span> <span class=mf>0.85</span><span class=p>])</span>
</span><span id=__span-84-11><a id=__codelineno-84-11 name=__codelineno-84-11 href=#__codelineno-84-11></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-84-12><a id=__codelineno-84-12 name=__codelineno-84-12 href=#__codelineno-84-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span><span class=o>.</span><span class=n>count</span><span class=p>()</span>
</span><span id=__span-84-13><a id=__codelineno-84-13 name=__codelineno-84-13 href=#__codelineno-84-13></a><span class=go>pattern   min_similarity</span>
</span><span id=__span-84-14><a id=__codelineno-84-14 name=__codelineno-84-14 href=#__codelineno-84-14></a><span class=go>v-top     0.80              6</span>
</span><span id=__span-84-15><a id=__codelineno-84-15 name=__codelineno-84-15 href=#__codelineno-84-15></a><span class=go>          0.85              3</span>
</span><span id=__span-84-16><a id=__codelineno-84-16 name=__codelineno-84-16 href=#__codelineno-84-16></a><span class=go>v-bottom  0.80              3</span>
</span><span id=__span-84-17><a id=__codelineno-84-17 name=__codelineno-84-17 href=#__codelineno-84-17></a><span class=go>          0.85              0</span>
</span><span id=__span-84-18><a id=__codelineno-84-18 name=__codelineno-84-18 href=#__codelineno-84-18></a><span class=go>rising    0.80              8</span>
</span><span id=__span-84-19><a id=__codelineno-84-19 name=__codelineno-84-19 href=#__codelineno-84-19></a><span class=go>          0.85              7</span>
</span><span id=__span-84-20><a id=__codelineno-84-20 name=__codelineno-84-20 href=#__codelineno-84-20></a><span class=go>falling   0.80              6</span>
</span><span id=__span-84-21><a id=__codelineno-84-21 name=__codelineno-84-21 href=#__codelineno-84-21></a><span class=go>          0.85              3</span>
</span><span id=__span-84-22><a id=__codelineno-84-22 name=__codelineno-84-22 href=#__codelineno-84-22></a><span class=go>Name: count, dtype: int64</span>
</span></code></pre></div> <p>We can now see some detected "V-Bottom" ranges:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-85-1><a id=__codelineno-85-1 name=__codelineno-85-1 href=#__codelineno-85-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>column</span><span class=o>=</span><span class=p>(</span><span class=s2>&quot;v-bottom&quot;</span><span class=p>,</span> <span class=mf>0.8</span><span class=p>))</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/params_v_bottom.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/params_v_bottom.dark.svg#only-dark></p> <p>What if we do not want to build a product of some parameters? For example, if we want to use different window lengths for different patterns, this can be achieved by providing a level. Parameters set to the same level are not combined, but instead are simply broadcast together.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-86-1><a id=__codelineno-86-1 name=__codelineno-86-1 href=#__codelineno-86-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span> <span class=o>=</span> <span class=n>price</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>find_pattern</span><span class=p>(</span>
</span><span id=__span-86-2><a id=__codelineno-86-2 name=__codelineno-86-2 href=#__codelineno-86-2></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span>
</span><span id=__span-86-3><a id=__codelineno-86-3 name=__codelineno-86-3 href=#__codelineno-86-3></a><span class=gp>... </span>        <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>],</span>
</span><span id=__span-86-4><a id=__codelineno-86-4 name=__codelineno-86-4 href=#__codelineno-86-4></a><span class=gp>... </span>        <span class=p>[</span><span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>],</span>
</span><span id=__span-86-5><a id=__codelineno-86-5 name=__codelineno-86-5 href=#__codelineno-86-5></a><span class=gp>... </span>        <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span>
</span><span id=__span-86-6><a id=__codelineno-86-6 name=__codelineno-86-6 href=#__codelineno-86-6></a><span class=gp>... </span>        <span class=p>[</span><span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>]</span>
</span><span id=__span-86-7><a id=__codelineno-86-7 name=__codelineno-86-7 href=#__codelineno-86-7></a><span class=gp>... </span>    <span class=p>],</span> <span class=n>keys</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;v-top&quot;</span><span class=p>,</span> <span class=s2>&quot;v-bottom&quot;</span><span class=p>,</span> <span class=s2>&quot;rising&quot;</span><span class=p>,</span> <span class=s2>&quot;falling&quot;</span><span class=p>],</span> <span class=n>level</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span>
</span><span id=__span-86-8><a id=__codelineno-86-8 name=__codelineno-86-8 href=#__codelineno-86-8></a><span class=gp>... </span>    <span class=n>window</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span><span class=mi>30</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>7</span><span class=p>],</span> <span class=n>level</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span>  <span class=c1># (1)!</span>
</span><span id=__span-86-9><a id=__codelineno-86-9 name=__codelineno-86-9 href=#__codelineno-86-9></a><span class=gp>... </span>    <span class=n>max_window</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span><span class=mi>120</span><span class=p>,</span> <span class=mi>120</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>30</span><span class=p>],</span> <span class=n>level</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span>
</span><span id=__span-86-10><a id=__codelineno-86-10 name=__codelineno-86-10 href=#__codelineno-86-10></a><span class=gp>... </span>    <span class=n>min_similarity</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span><span class=mf>0.8</span><span class=p>,</span> <span class=mf>0.85</span><span class=p>],</span> <span class=n>level</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-86-11><a id=__codelineno-86-11 name=__codelineno-86-11 href=#__codelineno-86-11></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-86-12><a id=__codelineno-86-12 name=__codelineno-86-12 href=#__codelineno-86-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span><span class=o>.</span><span class=n>count</span><span class=p>()</span>
</span><span id=__span-86-13><a id=__codelineno-86-13 name=__codelineno-86-13 href=#__codelineno-86-13></a><span class=go>pattern   window  max_window  min_similarity</span>
</span><span id=__span-86-14><a id=__codelineno-86-14 name=__codelineno-86-14 href=#__codelineno-86-14></a><span class=go>v-top     30      120         0.80               6</span>
</span><span id=__span-86-15><a id=__codelineno-86-15 name=__codelineno-86-15 href=#__codelineno-86-15></a><span class=go>                              0.85               3</span>
</span><span id=__span-86-16><a id=__codelineno-86-16 name=__codelineno-86-16 href=#__codelineno-86-16></a><span class=go>v-bottom  30      120         0.80               3</span>
</span><span id=__span-86-17><a id=__codelineno-86-17 name=__codelineno-86-17 href=#__codelineno-86-17></a><span class=go>                              0.85               0</span>
</span><span id=__span-86-18><a id=__codelineno-86-18 name=__codelineno-86-18 href=#__codelineno-86-18></a><span class=go>rising    7       30          0.80              27</span>
</span><span id=__span-86-19><a id=__codelineno-86-19 name=__codelineno-86-19 href=#__codelineno-86-19></a><span class=go>                              0.85              23</span>
</span><span id=__span-86-20><a id=__codelineno-86-20 name=__codelineno-86-20 href=#__codelineno-86-20></a><span class=go>falling   7       30          0.80              25</span>
</span><span id=__span-86-21><a id=__codelineno-86-21 name=__codelineno-86-21 href=#__codelineno-86-21></a><span class=go>                              0.85              15</span>
</span><span id=__span-86-22><a id=__codelineno-86-22 name=__codelineno-86-22 href=#__codelineno-86-22></a><span class=go>Name: count, dtype: int64</span>
</span></code></pre></div> <ol> <li>Must have the same length as other parameters on the same level.</li> <li>Will be combined with blocks of parameters that share the same level.</li> </ol> <div class="admonition note"> <p class=admonition-title>Note</p> <p>If you use levels, you must provide a level for all parameters. You can also reorder some parameters in the column hierarchy by assigning them a lower or higher level.</p> </div> <h3 id=configs>Configs<a class=headerlink href=#configs title="Permanent link">&para;</a></h3> <p>It is important to note that when using multiple assets, each parameter will be applied over the entire price array. But what if you want to search for different patterns in the prices of different assets? Remember how each instance of <a href=https://vectorbt.pro/pvt_41531c19/api/generic/ranges/#vectorbtpro.generic.ranges.PatternRanges>PatternRanges</a> keeps track of the search configuration for each column in <a href=https://vectorbt.pro/pvt_41531c19/api/generic/ranges/#vectorbtpro.generic.ranges.PatternRanges.search_configs>PatternRanges.search_configs</a>? Similarly, you can manually provide search configurations using the <code>search_configs</code> argument, which must be a list of <a href=https://vectorbt.pro/pvt_41531c19/api/generic/ranges/#vectorbtpro.generic.ranges.PSC>PSC</a> instances (for the entire price array) or a list of lists of <a href=https://vectorbt.pro/pvt_41531c19/api/generic/ranges/#vectorbtpro.generic.ranges.PSC>PSC</a> instances (for each column). This way, you can define custom parameter combinations.</p> <p>To demonstrate this, let's fetch the prices for the <code>BTCUSDT</code> and <code>ETHUSDT</code> symbols, and search for the "Double Top" pattern in both assets, as well as for any occurrence of the latest 30 bars in each asset individually:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-87-1><a id=__codelineno-87-1 name=__codelineno-87-1 href=#__codelineno-87-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mult_data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>BinanceData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span>
</span><span id=__span-87-2><a id=__codelineno-87-2 name=__codelineno-87-2 href=#__codelineno-87-2></a><span class=gp>... </span>    <span class=p>[</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>,</span> <span class=s2>&quot;ETHUSDT&quot;</span><span class=p>],</span> 
</span><span id=__span-87-3><a id=__codelineno-87-3 name=__codelineno-87-3 href=#__codelineno-87-3></a><span class=gp>... </span>    <span class=n>start</span><span class=o>=</span><span class=s2>&quot;2020-06-01 UTC&quot;</span><span class=p>,</span> 
</span><span id=__span-87-4><a id=__codelineno-87-4 name=__codelineno-87-4 href=#__codelineno-87-4></a><span class=gp>... </span>    <span class=n>end</span><span class=o>=</span><span class=s2>&quot;2022-06-01 UTC&quot;</span>
</span><span id=__span-87-5><a id=__codelineno-87-5 name=__codelineno-87-5 href=#__codelineno-87-5></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-87-6><a id=__codelineno-87-6 name=__codelineno-87-6 href=#__codelineno-87-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mult_price</span> <span class=o>=</span> <span class=n>mult_data</span><span class=o>.</span><span class=n>hlc3</span>
</span><span id=__span-87-7><a id=__codelineno-87-7 name=__codelineno-87-7 href=#__codelineno-87-7></a>
</span><span id=__span-87-8><a id=__codelineno-87-8 name=__codelineno-87-8 href=#__codelineno-87-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span> <span class=o>=</span> <span class=n>mult_price</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>find_pattern</span><span class=p>(</span>
</span><span id=__span-87-9><a id=__codelineno-87-9 name=__codelineno-87-9 href=#__codelineno-87-9></a><span class=gp>... </span>    <span class=n>search_configs</span><span class=o>=</span><span class=p>[</span>
</span><span id=__span-87-10><a id=__codelineno-87-10 name=__codelineno-87-10 href=#__codelineno-87-10></a><span class=gp>... </span>        <span class=n>vbt</span><span class=o>.</span><span class=n>PSC</span><span class=p>(</span><span class=n>pattern</span><span class=o>=</span><span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>],</span> <span class=n>window</span><span class=o>=</span><span class=mi>30</span><span class=p>),</span>  <span class=c1># (1)!</span>
</span><span id=__span-87-11><a id=__codelineno-87-11 name=__codelineno-87-11 href=#__codelineno-87-11></a><span class=gp>... </span>        <span class=p>[</span>
</span><span id=__span-87-12><a id=__codelineno-87-12 name=__codelineno-87-12 href=#__codelineno-87-12></a><span class=gp>... </span>            <span class=n>vbt</span><span class=o>.</span><span class=n>PSC</span><span class=p>(</span><span class=n>pattern</span><span class=o>=</span><span class=n>mult_price</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>30</span><span class=p>:,</span> <span class=mi>0</span><span class=p>]),</span>  <span class=c1># (2)!</span>
</span><span id=__span-87-13><a id=__codelineno-87-13 name=__codelineno-87-13 href=#__codelineno-87-13></a><span class=gp>... </span>            <span class=n>vbt</span><span class=o>.</span><span class=n>PSC</span><span class=p>(</span><span class=n>pattern</span><span class=o>=</span><span class=n>mult_price</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>30</span><span class=p>:,</span> <span class=mi>1</span><span class=p>]),</span>
</span><span id=__span-87-14><a id=__codelineno-87-14 name=__codelineno-87-14 href=#__codelineno-87-14></a><span class=gp>... </span>        <span class=p>]</span>
</span><span id=__span-87-15><a id=__codelineno-87-15 name=__codelineno-87-15 href=#__codelineno-87-15></a><span class=gp>... </span>    <span class=p>],</span>
</span><span id=__span-87-16><a id=__codelineno-87-16 name=__codelineno-87-16 href=#__codelineno-87-16></a><span class=gp>... </span>    <span class=n>min_similarity</span><span class=o>=</span><span class=mf>0.8</span>  <span class=c1># (3)!</span>
</span><span id=__span-87-17><a id=__codelineno-87-17 name=__codelineno-87-17 href=#__codelineno-87-17></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-87-18><a id=__codelineno-87-18 name=__codelineno-87-18 href=#__codelineno-87-18></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span><span class=o>.</span><span class=n>count</span><span class=p>()</span>
</span><span id=__span-87-19><a id=__codelineno-87-19 name=__codelineno-87-19 href=#__codelineno-87-19></a><span class=go>search_config  symbol </span>
</span><span id=__span-87-20><a id=__codelineno-87-20 name=__codelineno-87-20 href=#__codelineno-87-20></a><span class=go>0              BTCUSDT    6</span>
</span><span id=__span-87-21><a id=__codelineno-87-21 name=__codelineno-87-21 href=#__codelineno-87-21></a><span class=go>1              ETHUSDT    4</span>
</span><span id=__span-87-22><a id=__codelineno-87-22 name=__codelineno-87-22 href=#__codelineno-87-22></a><span class=go>2              BTCUSDT    5</span>
</span><span id=__span-87-23><a id=__codelineno-87-23 name=__codelineno-87-23 href=#__codelineno-87-23></a><span class=go>3              ETHUSDT    8</span>
</span><span id=__span-87-24><a id=__codelineno-87-24 name=__codelineno-87-24 href=#__codelineno-87-24></a><span class=go>Name: count, dtype: int64</span>
</span></code></pre></div> <ol> <li>Each <code>PSC</code> instance in the outer list is applied to the entire array.</li> <li>Each <code>PSC</code> instance in the inner list is applied per column.</li> <li>If an argument should apply to all columns, provide it as a regular argument.</li> </ol> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>You can provide arguments to <a href=https://vectorbt.pro/pvt_41531c19/api/generic/ranges/#vectorbtpro.generic.ranges.PSC>PSC</a> in a human-readable format. Each config will be automatically prepared for use in Numba.</p> </div> <p>We see the column hierarchy now contains two levels: the search config identifier and the column name. Let's make it more descriptive by choosing a name for each config:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-88-1><a id=__codelineno-88-1 name=__codelineno-88-1 href=#__codelineno-88-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span> <span class=o>=</span> <span class=n>mult_price</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>find_pattern</span><span class=p>(</span>
</span><span id=__span-88-2><a id=__codelineno-88-2 name=__codelineno-88-2 href=#__codelineno-88-2></a><span class=gp>... </span>    <span class=n>search_configs</span><span class=o>=</span><span class=p>[</span>
</span><span id=__span-88-3><a id=__codelineno-88-3 name=__codelineno-88-3 href=#__codelineno-88-3></a><span class=gp>... </span>        <span class=n>vbt</span><span class=o>.</span><span class=n>PSC</span><span class=p>(</span><span class=n>pattern</span><span class=o>=</span><span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>],</span> <span class=n>window</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;double_top&quot;</span><span class=p>),</span>
</span><span id=__span-88-4><a id=__codelineno-88-4 name=__codelineno-88-4 href=#__codelineno-88-4></a><span class=gp>... </span>        <span class=p>[</span>
</span><span id=__span-88-5><a id=__codelineno-88-5 name=__codelineno-88-5 href=#__codelineno-88-5></a><span class=gp>... </span>            <span class=n>vbt</span><span class=o>.</span><span class=n>PSC</span><span class=p>(</span><span class=n>pattern</span><span class=o>=</span><span class=n>mult_price</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>30</span><span class=p>:,</span> <span class=mi>0</span><span class=p>],</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;last&quot;</span><span class=p>),</span>
</span><span id=__span-88-6><a id=__codelineno-88-6 name=__codelineno-88-6 href=#__codelineno-88-6></a><span class=gp>... </span>            <span class=n>vbt</span><span class=o>.</span><span class=n>PSC</span><span class=p>(</span><span class=n>pattern</span><span class=o>=</span><span class=n>mult_price</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>30</span><span class=p>:,</span> <span class=mi>1</span><span class=p>],</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;last&quot;</span><span class=p>),</span>
</span><span id=__span-88-7><a id=__codelineno-88-7 name=__codelineno-88-7 href=#__codelineno-88-7></a><span class=gp>... </span>        <span class=p>]</span>
</span><span id=__span-88-8><a id=__codelineno-88-8 name=__codelineno-88-8 href=#__codelineno-88-8></a><span class=gp>... </span>    <span class=p>],</span>
</span><span id=__span-88-9><a id=__codelineno-88-9 name=__codelineno-88-9 href=#__codelineno-88-9></a><span class=gp>... </span>    <span class=n>min_similarity</span><span class=o>=</span><span class=mf>0.8</span>
</span><span id=__span-88-10><a id=__codelineno-88-10 name=__codelineno-88-10 href=#__codelineno-88-10></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-88-11><a id=__codelineno-88-11 name=__codelineno-88-11 href=#__codelineno-88-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span><span class=o>.</span><span class=n>count</span><span class=p>()</span>
</span><span id=__span-88-12><a id=__codelineno-88-12 name=__codelineno-88-12 href=#__codelineno-88-12></a><span class=go>search_config  symbol </span>
</span><span id=__span-88-13><a id=__codelineno-88-13 name=__codelineno-88-13 href=#__codelineno-88-13></a><span class=go>double_top     BTCUSDT    6</span>
</span><span id=__span-88-14><a id=__codelineno-88-14 name=__codelineno-88-14 href=#__codelineno-88-14></a><span class=go>               ETHUSDT    4</span>
</span><span id=__span-88-15><a id=__codelineno-88-15 name=__codelineno-88-15 href=#__codelineno-88-15></a><span class=go>last           BTCUSDT    5</span>
</span><span id=__span-88-16><a id=__codelineno-88-16 name=__codelineno-88-16 href=#__codelineno-88-16></a><span class=go>               ETHUSDT    8</span>
</span><span id=__span-88-17><a id=__codelineno-88-17 name=__codelineno-88-17 href=#__codelineno-88-17></a><span class=go>Name: count, dtype: int64</span>
</span></code></pre></div> <p>You can also combine search configurations and parameters. In this case, the method will clone the provided search configurations for each parameter combination, and override the parameters of each search configuration with the current parameter combination. Let's test various rescaling modes:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-89-1><a id=__codelineno-89-1 name=__codelineno-89-1 href=#__codelineno-89-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span> <span class=o>=</span> <span class=n>mult_price</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>find_pattern</span><span class=p>(</span>
</span><span id=__span-89-2><a id=__codelineno-89-2 name=__codelineno-89-2 href=#__codelineno-89-2></a><span class=gp>... </span>    <span class=n>search_configs</span><span class=o>=</span><span class=p>[</span>
</span><span id=__span-89-3><a id=__codelineno-89-3 name=__codelineno-89-3 href=#__codelineno-89-3></a><span class=gp>... </span>        <span class=n>vbt</span><span class=o>.</span><span class=n>PSC</span><span class=p>(</span><span class=n>pattern</span><span class=o>=</span><span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>],</span> <span class=n>window</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;double_top&quot;</span><span class=p>),</span>
</span><span id=__span-89-4><a id=__codelineno-89-4 name=__codelineno-89-4 href=#__codelineno-89-4></a><span class=gp>... </span>        <span class=p>[</span>
</span><span id=__span-89-5><a id=__codelineno-89-5 name=__codelineno-89-5 href=#__codelineno-89-5></a><span class=gp>... </span>            <span class=n>vbt</span><span class=o>.</span><span class=n>PSC</span><span class=p>(</span><span class=n>pattern</span><span class=o>=</span><span class=n>mult_price</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>30</span><span class=p>:,</span> <span class=mi>0</span><span class=p>],</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;last&quot;</span><span class=p>),</span>
</span><span id=__span-89-6><a id=__codelineno-89-6 name=__codelineno-89-6 href=#__codelineno-89-6></a><span class=gp>... </span>            <span class=n>vbt</span><span class=o>.</span><span class=n>PSC</span><span class=p>(</span><span class=n>pattern</span><span class=o>=</span><span class=n>mult_price</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>30</span><span class=p>:,</span> <span class=mi>1</span><span class=p>],</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;last&quot;</span><span class=p>),</span>
</span><span id=__span-89-7><a id=__codelineno-89-7 name=__codelineno-89-7 href=#__codelineno-89-7></a><span class=gp>... </span>        <span class=p>]</span>
</span><span id=__span-89-8><a id=__codelineno-89-8 name=__codelineno-89-8 href=#__codelineno-89-8></a><span class=gp>... </span>    <span class=p>],</span>
</span><span id=__span-89-9><a id=__codelineno-89-9 name=__codelineno-89-9 href=#__codelineno-89-9></a><span class=gp>... </span>    <span class=n>rescale_mode</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span><span class=s2>&quot;minmax&quot;</span><span class=p>,</span> <span class=s2>&quot;rebase&quot;</span><span class=p>]),</span>
</span><span id=__span-89-10><a id=__codelineno-89-10 name=__codelineno-89-10 href=#__codelineno-89-10></a><span class=gp>... </span>    <span class=n>min_similarity</span><span class=o>=</span><span class=mf>0.8</span><span class=p>,</span>
</span><span id=__span-89-11><a id=__codelineno-89-11 name=__codelineno-89-11 href=#__codelineno-89-11></a><span class=gp>... </span>    <span class=nb>open</span><span class=o>=</span><span class=n>mult_data</span><span class=o>.</span><span class=n>open</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-89-12><a id=__codelineno-89-12 name=__codelineno-89-12 href=#__codelineno-89-12></a><span class=gp>... </span>    <span class=n>high</span><span class=o>=</span><span class=n>mult_data</span><span class=o>.</span><span class=n>high</span><span class=p>,</span>
</span><span id=__span-89-13><a id=__codelineno-89-13 name=__codelineno-89-13 href=#__codelineno-89-13></a><span class=gp>... </span>    <span class=n>low</span><span class=o>=</span><span class=n>mult_data</span><span class=o>.</span><span class=n>low</span><span class=p>,</span>
</span><span id=__span-89-14><a id=__codelineno-89-14 name=__codelineno-89-14 href=#__codelineno-89-14></a><span class=gp>... </span>    <span class=n>close</span><span class=o>=</span><span class=n>mult_data</span><span class=o>.</span><span class=n>close</span><span class=p>,</span>
</span><span id=__span-89-15><a id=__codelineno-89-15 name=__codelineno-89-15 href=#__codelineno-89-15></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-89-16><a id=__codelineno-89-16 name=__codelineno-89-16 href=#__codelineno-89-16></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span><span class=o>.</span><span class=n>count</span><span class=p>()</span>
</span><span id=__span-89-17><a id=__codelineno-89-17 name=__codelineno-89-17 href=#__codelineno-89-17></a><span class=go>rescale_mode  search_config  symbol </span>
</span><span id=__span-89-18><a id=__codelineno-89-18 name=__codelineno-89-18 href=#__codelineno-89-18></a><span class=go>minmax        double_top     BTCUSDT    6</span>
</span><span id=__span-89-19><a id=__codelineno-89-19 name=__codelineno-89-19 href=#__codelineno-89-19></a><span class=go>                             ETHUSDT    4</span>
</span><span id=__span-89-20><a id=__codelineno-89-20 name=__codelineno-89-20 href=#__codelineno-89-20></a><span class=go>              last           BTCUSDT    5</span>
</span><span id=__span-89-21><a id=__codelineno-89-21 name=__codelineno-89-21 href=#__codelineno-89-21></a><span class=go>                             ETHUSDT    8</span>
</span><span id=__span-89-22><a id=__codelineno-89-22 name=__codelineno-89-22 href=#__codelineno-89-22></a><span class=go>rebase        double_top     BTCUSDT    0</span>
</span><span id=__span-89-23><a id=__codelineno-89-23 name=__codelineno-89-23 href=#__codelineno-89-23></a><span class=go>                             ETHUSDT    0</span>
</span><span id=__span-89-24><a id=__codelineno-89-24 name=__codelineno-89-24 href=#__codelineno-89-24></a><span class=go>              last           BTCUSDT    2</span>
</span><span id=__span-89-25><a id=__codelineno-89-25 name=__codelineno-89-25 href=#__codelineno-89-25></a><span class=go>                             ETHUSDT    2</span>
</span><span id=__span-89-26><a id=__codelineno-89-26 name=__codelineno-89-26 href=#__codelineno-89-26></a><span class=go>Name: count, dtype: int64</span>
</span></code></pre></div> <ol> <li>Provide OHLC for plotting.</li> </ol> <p>For example, our search for a pattern based on the last 30 bars in <code>ETHUSDT</code> found 8 occurrences that are similar by shape (using min-max rescaling) and only 2 occurrences that are similar by both shape and percentage change (using rebasing):</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-90-1><a id=__codelineno-90-1 name=__codelineno-90-1 href=#__codelineno-90-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>column</span><span class=o>=</span><span class=p>(</span><span class=s2>&quot;rebase&quot;</span><span class=p>,</span> <span class=s2>&quot;last&quot;</span><span class=p>,</span> <span class=s2>&quot;ETHUSDT&quot;</span><span class=p>))</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/configs_and_params.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/configs_and_params.dark.svg#only-dark></p> <p>The first range has a similarity of 85%, while the second range is still open and has a similarity of 100%. This makes sense because it was used as the pattern.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Again, an open range does not mean that it has not finished developing. It only means that the last point in the range is also the last point in the price array, so the duration can be calculated correctly.</p> </div> <h3 id=mask>Mask<a class=headerlink href=#mask title="Permanent link">&para;</a></h3> <p>How do we use a pattern range instance to generate signals? Since such an instance usually stores only ranges that meet a certain similarity threshold, we only need to determine whether there is any range that closes at a specific row and column. This mask can be generated by calling the property <a href=https://vectorbt.pro/pvt_41531c19/api/generic/ranges/#vectorbtpro.generic.ranges.PatternRanges.last_pd_mask>PatternRanges.last_pd_mask</a>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-91-1><a id=__codelineno-91-1 name=__codelineno-91-1 href=#__codelineno-91-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>pattern_ranges</span><span class=o>.</span><span class=n>last_pd_mask</span>
</span><span id=__span-91-2><a id=__codelineno-91-2 name=__codelineno-91-2 href=#__codelineno-91-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>  <span class=c1># (1)!</span>
</span><span id=__span-91-3><a id=__codelineno-91-3 name=__codelineno-91-3 href=#__codelineno-91-3></a><span class=go>rescale_mode  search_config  symbol </span>
</span><span id=__span-91-4><a id=__codelineno-91-4 name=__codelineno-91-4 href=#__codelineno-91-4></a><span class=go>minmax        touble_top     BTCUSDT    6</span>
</span><span id=__span-91-5><a id=__codelineno-91-5 name=__codelineno-91-5 href=#__codelineno-91-5></a><span class=go>                             ETHUSDT    4</span>
</span><span id=__span-91-6><a id=__codelineno-91-6 name=__codelineno-91-6 href=#__codelineno-91-6></a><span class=go>              last           BTCUSDT    5</span>
</span><span id=__span-91-7><a id=__codelineno-91-7 name=__codelineno-91-7 href=#__codelineno-91-7></a><span class=go>                             ETHUSDT    8</span>
</span><span id=__span-91-8><a id=__codelineno-91-8 name=__codelineno-91-8 href=#__codelineno-91-8></a><span class=go>rebase        touble_top     BTCUSDT    0</span>
</span><span id=__span-91-9><a id=__codelineno-91-9 name=__codelineno-91-9 href=#__codelineno-91-9></a><span class=go>                             ETHUSDT    0</span>
</span><span id=__span-91-10><a id=__codelineno-91-10 name=__codelineno-91-10 href=#__codelineno-91-10></a><span class=go>              last           BTCUSDT    2</span>
</span><span id=__span-91-11><a id=__codelineno-91-11 name=__codelineno-91-11 href=#__codelineno-91-11></a><span class=go>                             ETHUSDT    2</span>
</span><span id=__span-91-12><a id=__codelineno-91-12 name=__codelineno-91-12 href=#__codelineno-91-12></a><span class=go>dtype: int64</span>
</span></code></pre></div> <ol> <li>Count of <code>True</code> values in the mask.</li> </ol> <p>We can then use this mask, for example, in <a href=https://vectorbt.pro/pvt_41531c19/api/portfolio/base/#vectorbtpro.portfolio.base.Portfolio.from_signals>Portfolio.from_signals</a>.</p> <h3 id=indicator_1>Indicator<a class=headerlink href=#indicator_1 title="Permanent link">&para;</a></h3> <p>If you do not need to plot or analyze pattern ranges, you can use the same <a href=https://vectorbt.pro/pvt_41531c19/api/indicators/custom/patsim/#vectorbtpro.indicators.custom.patsim.PATSIM>PATSIM</a> indicator used previously to generate a Series or DataFrame of similarity scores. What was not discussed earlier is that this indicator also accepts the arguments <code>max_window</code>, <code>row_select_prob</code>, and <code>window_select_prob</code>. Let's confirm that the indicator produces the same similarity scores as pattern ranges:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-92-1><a id=__codelineno-92-1 name=__codelineno-92-1 href=#__codelineno-92-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pattern_ranges</span> <span class=o>=</span> <span class=n>price</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>find_pattern</span><span class=p>(</span>
</span><span id=__span-92-2><a id=__codelineno-92-2 name=__codelineno-92-2 href=#__codelineno-92-2></a><span class=gp>... </span>    <span class=n>pattern</span><span class=p>,</span>
</span><span id=__span-92-3><a id=__codelineno-92-3 name=__codelineno-92-3 href=#__codelineno-92-3></a><span class=gp>... </span>    <span class=n>window</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span>
</span><span id=__span-92-4><a id=__codelineno-92-4 name=__codelineno-92-4 href=#__codelineno-92-4></a><span class=gp>... </span>    <span class=n>max_window</span><span class=o>=</span><span class=mi>120</span><span class=p>,</span>
</span><span id=__span-92-5><a id=__codelineno-92-5 name=__codelineno-92-5 href=#__codelineno-92-5></a><span class=gp>... </span>    <span class=n>row_select_prob</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span>
</span><span id=__span-92-6><a id=__codelineno-92-6 name=__codelineno-92-6 href=#__codelineno-92-6></a><span class=gp>... </span>    <span class=n>window_select_prob</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span>
</span><span id=__span-92-7><a id=__codelineno-92-7 name=__codelineno-92-7 href=#__codelineno-92-7></a><span class=gp>... </span>    <span class=n>overlap_mode</span><span class=o>=</span><span class=s2>&quot;allow&quot;</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-92-8><a id=__codelineno-92-8 name=__codelineno-92-8 href=#__codelineno-92-8></a><span class=gp>... </span>    <span class=n>seed</span><span class=o>=</span><span class=mi>42</span>
</span><span id=__span-92-9><a id=__codelineno-92-9 name=__codelineno-92-9 href=#__codelineno-92-9></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-92-10><a id=__codelineno-92-10 name=__codelineno-92-10 href=#__codelineno-92-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pr_mask</span> <span class=o>=</span> <span class=n>pattern_ranges</span><span class=o>.</span><span class=n>map_field</span><span class=p>(</span>
</span><span id=__span-92-11><a id=__codelineno-92-11 name=__codelineno-92-11 href=#__codelineno-92-11></a><span class=gp>... </span>    <span class=s2>&quot;similarity&quot;</span><span class=p>,</span> 
</span><span id=__span-92-12><a id=__codelineno-92-12 name=__codelineno-92-12 href=#__codelineno-92-12></a><span class=gp>... </span>    <span class=n>idx_arr</span><span class=o>=</span><span class=n>pattern_ranges</span><span class=o>.</span><span class=n>last_idx</span><span class=o>.</span><span class=n>values</span>
</span><span id=__span-92-13><a id=__codelineno-92-13 name=__codelineno-92-13 href=#__codelineno-92-13></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>to_pd</span><span class=p>()</span>
</span><span id=__span-92-14><a id=__codelineno-92-14 name=__codelineno-92-14 href=#__codelineno-92-14></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pr_mask</span><span class=p>[</span><span class=o>~</span><span class=n>pr_mask</span><span class=o>.</span><span class=n>isnull</span><span class=p>()]</span>
</span><span id=__span-92-15><a id=__codelineno-92-15 name=__codelineno-92-15 href=#__codelineno-92-15></a><span class=go>Open time</span>
</span><span id=__span-92-16><a id=__codelineno-92-16 name=__codelineno-92-16 href=#__codelineno-92-16></a><span class=go>2021-03-23 00:00:00+00:00    0.854189</span>
</span><span id=__span-92-17><a id=__codelineno-92-17 name=__codelineno-92-17 href=#__codelineno-92-17></a><span class=go>2021-03-26 00:00:00+00:00    0.853817</span>
</span><span id=__span-92-18><a id=__codelineno-92-18 name=__codelineno-92-18 href=#__codelineno-92-18></a><span class=go>2021-04-10 00:00:00+00:00    0.866913</span>
</span><span id=__span-92-19><a id=__codelineno-92-19 name=__codelineno-92-19 href=#__codelineno-92-19></a><span class=go>2021-04-11 00:00:00+00:00    0.866106</span>
</span><span id=__span-92-20><a id=__codelineno-92-20 name=__codelineno-92-20 href=#__codelineno-92-20></a><span class=go>2021-11-17 00:00:00+00:00    0.868276</span>
</span><span id=__span-92-21><a id=__codelineno-92-21 name=__codelineno-92-21 href=#__codelineno-92-21></a><span class=go>2021-11-18 00:00:00+00:00    0.873757</span>
</span><span id=__span-92-22><a id=__codelineno-92-22 name=__codelineno-92-22 href=#__codelineno-92-22></a><span class=go>2021-11-21 00:00:00+00:00    0.890225</span>
</span><span id=__span-92-23><a id=__codelineno-92-23 name=__codelineno-92-23 href=#__codelineno-92-23></a><span class=go>2021-11-23 00:00:00+00:00    0.892541</span>
</span><span id=__span-92-24><a id=__codelineno-92-24 name=__codelineno-92-24 href=#__codelineno-92-24></a><span class=go>2021-11-24 00:00:00+00:00    0.879475</span>
</span><span id=__span-92-25><a id=__codelineno-92-25 name=__codelineno-92-25 href=#__codelineno-92-25></a><span class=go>2021-11-26 00:00:00+00:00    0.877245</span>
</span><span id=__span-92-26><a id=__codelineno-92-26 name=__codelineno-92-26 href=#__codelineno-92-26></a><span class=go>2021-11-27 00:00:00+00:00    0.872172</span>
</span><span id=__span-92-27><a id=__codelineno-92-27 name=__codelineno-92-27 href=#__codelineno-92-27></a><span class=go>dtype: float64</span>
</span><span id=__span-92-28><a id=__codelineno-92-28 name=__codelineno-92-28 href=#__codelineno-92-28></a>
</span><span id=__span-92-29><a id=__codelineno-92-29 name=__codelineno-92-29 href=#__codelineno-92-29></a><span class=gp>&gt;&gt;&gt; </span><span class=n>patsim</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PATSIM</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-92-30><a id=__codelineno-92-30 name=__codelineno-92-30 href=#__codelineno-92-30></a><span class=gp>... </span>    <span class=n>price</span><span class=p>,</span>
</span><span id=__span-92-31><a id=__codelineno-92-31 name=__codelineno-92-31 href=#__codelineno-92-31></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=n>pattern</span><span class=p>),</span>  <span class=c1># (2)!</span>
</span><span id=__span-92-32><a id=__codelineno-92-32 name=__codelineno-92-32 href=#__codelineno-92-32></a><span class=gp>... </span>    <span class=n>window</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=mi>30</span><span class=p>),</span>
</span><span id=__span-92-33><a id=__codelineno-92-33 name=__codelineno-92-33 href=#__codelineno-92-33></a><span class=gp>... </span>    <span class=n>max_window</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=mi>120</span><span class=p>),</span>
</span><span id=__span-92-34><a id=__codelineno-92-34 name=__codelineno-92-34 href=#__codelineno-92-34></a><span class=gp>... </span>    <span class=n>row_select_prob</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=mf>0.5</span><span class=p>),</span>
</span><span id=__span-92-35><a id=__codelineno-92-35 name=__codelineno-92-35 href=#__codelineno-92-35></a><span class=gp>... </span>    <span class=n>window_select_prob</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=mf>0.5</span><span class=p>),</span>
</span><span id=__span-92-36><a id=__codelineno-92-36 name=__codelineno-92-36 href=#__codelineno-92-36></a><span class=gp>... </span>    <span class=n>min_similarity</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=mf>0.85</span><span class=p>),</span>  <span class=c1># (3)!</span>
</span><span id=__span-92-37><a id=__codelineno-92-37 name=__codelineno-92-37 href=#__codelineno-92-37></a><span class=gp>... </span>    <span class=n>seed</span><span class=o>=</span><span class=mi>42</span>
</span><span id=__span-92-38><a id=__codelineno-92-38 name=__codelineno-92-38 href=#__codelineno-92-38></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-92-39><a id=__codelineno-92-39 name=__codelineno-92-39 href=#__codelineno-92-39></a><span class=gp>&gt;&gt;&gt; </span><span class=n>ind_mask</span> <span class=o>=</span> <span class=n>patsim</span><span class=o>.</span><span class=n>similarity</span>
</span><span id=__span-92-40><a id=__codelineno-92-40 name=__codelineno-92-40 href=#__codelineno-92-40></a><span class=gp>&gt;&gt;&gt; </span><span class=n>ind_mask</span><span class=p>[</span><span class=o>~</span><span class=n>ind_mask</span><span class=o>.</span><span class=n>isnull</span><span class=p>()]</span>
</span><span id=__span-92-41><a id=__codelineno-92-41 name=__codelineno-92-41 href=#__codelineno-92-41></a><span class=go>Open time</span>
</span><span id=__span-92-42><a id=__codelineno-92-42 name=__codelineno-92-42 href=#__codelineno-92-42></a><span class=go>2021-03-23 00:00:00+00:00    0.854189</span>
</span><span id=__span-92-43><a id=__codelineno-92-43 name=__codelineno-92-43 href=#__codelineno-92-43></a><span class=go>2021-03-26 00:00:00+00:00    0.853817</span>
</span><span id=__span-92-44><a id=__codelineno-92-44 name=__codelineno-92-44 href=#__codelineno-92-44></a><span class=go>2021-04-10 00:00:00+00:00    0.866913</span>
</span><span id=__span-92-45><a id=__codelineno-92-45 name=__codelineno-92-45 href=#__codelineno-92-45></a><span class=go>2021-04-11 00:00:00+00:00    0.866106</span>
</span><span id=__span-92-46><a id=__codelineno-92-46 name=__codelineno-92-46 href=#__codelineno-92-46></a><span class=go>2021-11-17 00:00:00+00:00    0.868276</span>
</span><span id=__span-92-47><a id=__codelineno-92-47 name=__codelineno-92-47 href=#__codelineno-92-47></a><span class=go>2021-11-18 00:00:00+00:00    0.873757</span>
</span><span id=__span-92-48><a id=__codelineno-92-48 name=__codelineno-92-48 href=#__codelineno-92-48></a><span class=go>2021-11-21 00:00:00+00:00    0.890225</span>
</span><span id=__span-92-49><a id=__codelineno-92-49 name=__codelineno-92-49 href=#__codelineno-92-49></a><span class=go>2021-11-23 00:00:00+00:00    0.892541</span>
</span><span id=__span-92-50><a id=__codelineno-92-50 name=__codelineno-92-50 href=#__codelineno-92-50></a><span class=go>2021-11-24 00:00:00+00:00    0.879475</span>
</span><span id=__span-92-51><a id=__codelineno-92-51 name=__codelineno-92-51 href=#__codelineno-92-51></a><span class=go>2021-11-26 00:00:00+00:00    0.877245</span>
</span><span id=__span-92-52><a id=__codelineno-92-52 name=__codelineno-92-52 href=#__codelineno-92-52></a><span class=go>2021-11-27 00:00:00+00:00    0.872172</span>
</span><span id=__span-92-53><a id=__codelineno-92-53 name=__codelineno-92-53 href=#__codelineno-92-53></a><span class=go>dtype: float64</span>
</span></code></pre></div> <ol> <li>This is the only mode supported in <a href=https://vectorbt.pro/pvt_41531c19/api/indicators/custom/patsim/#vectorbtpro.indicators.custom.patsim.PATSIM>PATSIM</a>.</li> <li>Use <code>Default</code> for each argument to hide it from columns.</li> <li>This is the default threshold in <a href=https://vectorbt.pro/pvt_41531c19/api/generic/ranges/#vectorbtpro.generic.ranges.PatternRanges.from_pattern_search>PatternRanges.from_pattern_search</a>.</li> </ol> <h2 id=combination>Combination<a class=headerlink href=#combination title="Permanent link">&para;</a></h2> <p>We have learned how to generate signals from a single pattern found in one array, but what about scenarios where signals should only be triggered when a combination of patterns is found across different arrays? For example, how can we quantify convergence and divergence? To combine multiple patterns conditionally, we need to combine their similarity scores. In the example below, we search for a bearish divergence between the high price and MACD:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-93-1><a id=__codelineno-93-1 name=__codelineno-93-1 href=#__codelineno-93-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>price_highs</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PATSIM</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-93-2><a id=__codelineno-93-2 name=__codelineno-93-2 href=#__codelineno-93-2></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>high</span><span class=p>,</span> 
</span><span id=__span-93-3><a id=__codelineno-93-3 name=__codelineno-93-3 href=#__codelineno-93-3></a><span class=gp>... </span>    <span class=n>pattern</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>4</span><span class=p>]),</span>  <span class=c1># (1)!</span>
</span><span id=__span-93-4><a id=__codelineno-93-4 name=__codelineno-93-4 href=#__codelineno-93-4></a><span class=gp>... </span>    <span class=n>window</span><span class=o>=</span><span class=mi>40</span><span class=p>,</span>
</span><span id=__span-93-5><a id=__codelineno-93-5 name=__codelineno-93-5 href=#__codelineno-93-5></a><span class=gp>... </span>    <span class=n>max_window</span><span class=o>=</span><span class=mi>50</span>
</span><span id=__span-93-6><a id=__codelineno-93-6 name=__codelineno-93-6 href=#__codelineno-93-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-93-7><a id=__codelineno-93-7 name=__codelineno-93-7 href=#__codelineno-93-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>macd</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;talib_macd&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>macd</span>  <span class=c1># (2)!</span>
</span><span id=__span-93-8><a id=__codelineno-93-8 name=__codelineno-93-8 href=#__codelineno-93-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>macd_lows</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PATSIM</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
</span><span id=__span-93-9><a id=__codelineno-93-9 name=__codelineno-93-9 href=#__codelineno-93-9></a><span class=gp>... </span>    <span class=n>macd</span><span class=p>,</span> 
</span><span id=__span-93-10><a id=__codelineno-93-10 name=__codelineno-93-10 href=#__codelineno-93-10></a><span class=gp>... </span>    <span class=n>pattern</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>4</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>1</span><span class=p>]),</span>  <span class=c1># (3)!</span>
</span><span id=__span-93-11><a id=__codelineno-93-11 name=__codelineno-93-11 href=#__codelineno-93-11></a><span class=gp>... </span>    <span class=n>window</span><span class=o>=</span><span class=mi>40</span><span class=p>,</span>
</span><span id=__span-93-12><a id=__codelineno-93-12 name=__codelineno-93-12 href=#__codelineno-93-12></a><span class=gp>... </span>    <span class=n>max_window</span><span class=o>=</span><span class=mi>50</span>
</span><span id=__span-93-13><a id=__codelineno-93-13 name=__codelineno-93-13 href=#__codelineno-93-13></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-93-14><a id=__codelineno-93-14 name=__codelineno-93-14 href=#__codelineno-93-14></a>
</span><span id=__span-93-15><a id=__codelineno-93-15 name=__codelineno-93-15 href=#__codelineno-93-15></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>make_subplots</span><span class=p>(</span>
</span><span id=__span-93-16><a id=__codelineno-93-16 name=__codelineno-93-16 href=#__codelineno-93-16></a><span class=gp>... </span>    <span class=n>rows</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>cols</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>shared_xaxes</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>vertical_spacing</span><span class=o>=</span><span class=mf>0.02</span>
</span><span id=__span-93-17><a id=__codelineno-93-17 name=__codelineno-93-17 href=#__codelineno-93-17></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-93-18><a id=__codelineno-93-18 name=__codelineno-93-18 href=#__codelineno-93-18></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span><span class=o>.</span><span class=n>update_layout</span><span class=p>(</span><span class=n>height</span><span class=o>=</span><span class=mi>500</span><span class=p>)</span>
</span><span id=__span-93-19><a id=__codelineno-93-19 name=__codelineno-93-19 href=#__codelineno-93-19></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span><span class=o>.</span><span class=n>high</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=s2>&quot;Price&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span>
</span><span id=__span-93-20><a id=__codelineno-93-20 name=__codelineno-93-20 href=#__codelineno-93-20></a><span class=gp>... </span>    <span class=n>add_trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>row</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>col</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span> <span class=n>fig</span><span class=o>=</span><span class=n>fig</span>
</span><span id=__span-93-21><a id=__codelineno-93-21 name=__codelineno-93-21 href=#__codelineno-93-21></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-93-22><a id=__codelineno-93-22 name=__codelineno-93-22 href=#__codelineno-93-22></a><span class=gp>&gt;&gt;&gt; </span><span class=n>macd</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=s2>&quot;MACD&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span>
</span><span id=__span-93-23><a id=__codelineno-93-23 name=__codelineno-93-23 href=#__codelineno-93-23></a><span class=gp>... </span>    <span class=n>add_trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>row</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>col</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span> <span class=n>fig</span><span class=o>=</span><span class=n>fig</span>
</span><span id=__span-93-24><a id=__codelineno-93-24 name=__codelineno-93-24 href=#__codelineno-93-24></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-93-25><a id=__codelineno-93-25 name=__codelineno-93-25 href=#__codelineno-93-25></a><span class=gp>&gt;&gt;&gt; </span><span class=n>price_highs</span><span class=o>.</span><span class=n>similarity</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=s2>&quot;Price Sim&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span>
</span><span id=__span-93-26><a id=__codelineno-93-26 name=__codelineno-93-26 href=#__codelineno-93-26></a><span class=gp>... </span>    <span class=n>add_trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>row</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>col</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span> <span class=n>fig</span><span class=o>=</span><span class=n>fig</span>
</span><span id=__span-93-27><a id=__codelineno-93-27 name=__codelineno-93-27 href=#__codelineno-93-27></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-93-28><a id=__codelineno-93-28 name=__codelineno-93-28 href=#__codelineno-93-28></a><span class=gp>&gt;&gt;&gt; </span><span class=n>macd_lows</span><span class=o>.</span><span class=n>similarity</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=s2>&quot;MACD Sim&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span>
</span><span id=__span-93-29><a id=__codelineno-93-29 name=__codelineno-93-29 href=#__codelineno-93-29></a><span class=gp>... </span>    <span class=n>add_trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>row</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> <span class=n>col</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span> <span class=n>fig</span><span class=o>=</span><span class=n>fig</span>
</span><span id=__span-93-30><a id=__codelineno-93-30 name=__codelineno-93-30 href=#__codelineno-93-30></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-93-31><a id=__codelineno-93-31 name=__codelineno-93-31 href=#__codelineno-93-31></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Two rising highs.</li> <li>Use <a href=https://vectorbt.pro/pvt_41531c19/api/data/base/#vectorbtpro.data.base.Data.run>Data.run</a> to quickly run indicators.</li> <li>Two falling highs.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/macd_divergence.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/macd_divergence.dark.svg#only-dark></p> <p>By reviewing the chart, we can see that the chosen parameters accurately represent the events we are seeking. The regions where the price and MACD are rising and falling, respectively, also lead to rising similarity scores. We can also find the optimal similarity threshold that yields a reasonable number of crossovers, such as 80%. Additionally, the points where the price similarity line crosses the threshold often occur slightly before those of the MACD, so it is not sufficient to simply test whether both crossovers happen at the same time. We need to introduce a waiting period using the rolling "any" operation. For example, below we generate an exit signal if both similarities have crossed the threshold during the last 10 bars, not necessarily at the same time:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-94-1><a id=__codelineno-94-1 name=__codelineno-94-1 href=#__codelineno-94-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond1</span> <span class=o>=</span> <span class=p>(</span><span class=n>price_highs</span><span class=o>.</span><span class=n>similarity</span> <span class=o>&gt;=</span> <span class=mf>0.8</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>rolling_any</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</span><span id=__span-94-2><a id=__codelineno-94-2 name=__codelineno-94-2 href=#__codelineno-94-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cond2</span> <span class=o>=</span> <span class=p>(</span><span class=n>macd_lows</span><span class=o>.</span><span class=n>similarity</span> <span class=o>&gt;=</span> <span class=mf>0.8</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>rolling_any</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</span><span id=__span-94-3><a id=__codelineno-94-3 name=__codelineno-94-3 href=#__codelineno-94-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exits</span> <span class=o>=</span> <span class=n>cond1</span> <span class=o>&amp;</span> <span class=n>cond2</span>
</span><span id=__span-94-4><a id=__codelineno-94-4 name=__codelineno-94-4 href=#__codelineno-94-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>ohlc_trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>opacity</span><span class=o>=</span><span class=mf>0.5</span><span class=p>))</span>
</span><span id=__span-94-5><a id=__codelineno-94-5 name=__codelineno-94-5 href=#__codelineno-94-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>exits</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>plot_as_exits</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>,</span> <span class=n>fig</span><span class=o>=</span><span class=n>fig</span><span class=p>)</span>
</span><span id=__span-94-6><a id=__codelineno-94-6 name=__codelineno-94-6 href=#__codelineno-94-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/macd_divergence_exits.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/patterns/macd_divergence_exits.dark.svg#only-dark></p> <p>For more ideas, see <a href=https://vectorbt.pro/pvt_41531c19/tutorials/signal-development>Signal Development</a>.</p> <p><a class=md-button href=https://vectorbt.pro/pvt_41531c19/assets/jupytext/tutorials/patterns-and-projections/patterns.py.txt target=blank_><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19.14 7.5A2.86 2.86 0 0 1 22 10.36v3.78A2.86 2.86 0 0 1 19.14 17H12c0 .39.32.96.71.96H17v1.68a2.86 2.86 0 0 1-2.86 2.86H9.86A2.86 2.86 0 0 1 7 19.64v-3.75a2.85 2.85 0 0 1 2.86-2.85h5.25a2.85 2.85 0 0 0 2.85-2.86V7.5zm-4.28 11.79c-.4 0-.72.3-.72.89s.32.71.72.71a.71.71 0 0 0 .71-.71c0-.59-.32-.89-.71-.89m-10-1.79A2.86 2.86 0 0 1 2 14.64v-3.78A2.86 2.86 0 0 1 4.86 8H12c0-.39-.32-.96-.71-.96H7V5.36A2.86 2.86 0 0 1 9.86 2.5h4.28A2.86 2.86 0 0 1 17 5.36v3.75a2.85 2.85 0 0 1-2.86 2.85H8.89a2.85 2.85 0 0 0-2.85 2.86v2.68zM9.14 5.71c.4 0 .72-.3.72-.89s-.32-.71-.72-.71c-.39 0-.71.12-.71.71s.32.89.71.89"/></svg></span> Python code</a> <a class=md-button href=https://github.com/polakowo/vectorbt.pro/blob/notebooks/PatternsProjections.ipynb target=blank_><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 4v6l-2-2-2 2V4H9v16h10V4zM3 7V5h2V4a2 2 0 0 1 2-2h12c1.05 0 2 .95 2 2v16c0 1.05-.95 2-2 2H7c-1.05 0-2-.95-2-2v-1H3v-2h2v-4H3v-2h2V7zm2-2v2h2V5zm0 14h2v-2H5zm0-6h2v-2H5z"/></svg></span> Notebook</a></p> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/pairs-trading/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Pairs trading"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Pairs trading </div> </div> </a> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/patterns-and-projections/projections/ class="md-footer__link md-footer__link--next" aria-label="Next: Projections"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Projections </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2021-2025 Oleg Polakow. All rights reserved. </div> </div> <div class=md-social> <a href=https://www.linkedin.com/in/polakowo target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> <a href=https://github.com/polakowo target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">Accept</button> <label class=md-button for=__settings>Manage settings</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script> <script id=__config type=application/json>{"annotate": null, "base": "../../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.instant", "navigation.instant.progress", "navigation.top", "navigation.prune", "navigation.path", "navigation.footer", "search.suggest", "search.share", "content.code.annotate", "content.code.copy", "content.code.select", "content.tooltips", "content.tabs.link", "toc.follow", "toc.integrate", "announce.dismiss"], "search": "../../../assets/javascripts/workers/search.26099bd0.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=https://vectorbt.pro/pvt_41531c19/assets/javascripts/bundle.9d1edc04.min.js></script> <script src=https://vectorbt.pro/pvt_41531c19/assets/scripts/extra.js></script> <script src=https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js></script> </body> 
<!-- Mirrored from vectorbt.pro/pvt_41531c19/tutorials/patterns-and-projections/patterns/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 22 Nov 2025 03:46:55 GMT -->
</html>