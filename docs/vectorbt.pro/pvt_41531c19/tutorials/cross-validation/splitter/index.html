<!doctype html><html lang=en class=no-js> 
<!-- Mirrored from vectorbt.pro/pvt_41531c19/tutorials/cross-validation/splitter/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 22 Nov 2025 03:46:47 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Learn how to build a splitter for cross-validation in VectorBT PRO"><meta name=author content="Oleg Polakow"><link href=https://vectorbt.pro/tutorials/cross-validation/splitter/ rel=canonical><link href=../index.html rel=prev><link href=../applications/index.html rel=next><link rel=icon href=../../../assets/logo/favicon.png><meta name=generator content="mkdocs-1.6.0, mkdocs-material-9.6.21+insiders-4.53.17"><title>Splitter - VectorBTÂ® PRO</title><link rel=stylesheet href=../../../assets/stylesheets/main.010a373c.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=../../../../../fonts.gstatic.com/index.html crossorigin><link rel=stylesheet href="../../../../../fonts.googleapis.com/cssbe43.css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../assets/stylesheets/extra.css><link rel=stylesheet href=../../../assets/stylesheets/custom-light.css><link rel=stylesheet href=../../../assets/stylesheets/custom-dark.css><link rel=stylesheet href=../../../assets/stylesheets/pygments-light.css><link rel=stylesheet href=../../../assets/stylesheets/pygments-dark.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-0C5VNYCFHL"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-0C5VNYCFHL",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="../../../../../www.googletagmanager.com/gtag/jsc6c8?id=G-0C5VNYCFHL",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script><meta name=robots content="noindex, nofollow"><meta property=og:title content=Splitter><meta property=og:type content=website><meta content=https://vectorbt.pro/tutorials/cross-validation/splitter/ property=og:url><meta property=og:image:url content=https://vectorbt.pro/pvt_41531c19/assets/logo/social-new.png><meta property=og:image:type content=image/png><meta property=og:description content="Learn how to build a splitter for cross-validation in VectorBT PRO"><meta property=og:locale content=en-GB><link rel=apple-touch-icon sizes=180x180 href=https://vectorbt.pro/pvt_41531c19/assets/logo/apple-touch-icon.png><link rel=icon type=image/svg+xml href=https://vectorbt.pro/pvt_41531c19/assets/logo/favicon.svg><link rel=icon type=image/png sizes=32x32 href=https://vectorbt.pro/pvt_41531c19/assets/logo/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://vectorbt.pro/pvt_41531c19/assets/logo/favicon-16x16.png><link rel=manifest href=https://vectorbt.pro/pvt_41531c19/assets/logo/site.webmanifest><link rel=mask-icon href=https://vectorbt.pro/pvt_41531c19/assets/logo/safari-pinned-tab.svg color=#1e1f22><link rel="shortcut icon" href=https://vectorbt.pro/pvt_41531c19/assets/logo/favicon.ico><meta name=msapplication-TileColor content=#1e1f22><meta name=msapplication-config content=https://vectorbt.pro/pvt_41531c19/assets/logo/browserconfig.xml><meta name=theme-color content=#1e1f22><link href=https://unpkg.com/aos@2.3.4/dist/aos.css rel=stylesheet><script src=https://unpkg.com/aos@2.3.4/dist/aos.js></script><link href=http://fonts.cdnfonts.com/css/uni-neue rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" crossorigin=anonymous referrerpolicy=no-referrer><script src=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/js/all.min.js integrity="sha512-8pHNiqTlsrRjVD4A/3va++W1sMbUHwWxxRPWNyVlql3T+Hgfd81Qc6FC5WMXDC+tSauxxzp1tgiAvSKFu1qIlA==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js integrity="sha512-q583ppKrCRc7N5O0n2nzUiJ+suUv7Et1JGels4bXOaMFQcamPk9HjdUknZuuFjBNs7tsMuadge5k9RzdmO+1GQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><link rel=preconnect href=https://fonts.googleapis.com/><link rel=preconnect href=https://fonts.gstatic.com/ crossorigin></head> <body dir=ltr data-md-color-scheme=custom-dark data-md-color-primary=custom-dark data-md-color-accent=custom-dark> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#splitter class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <button class="md-banner__button md-icon" aria-label="Don't show this again"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> <i>What's new</i>: New LLM providers, reasoning steps, function calling, YAML & TOML support, and <a href=https://vectorbt.pro/pvt_41531c19/getting-started/release-notes><strong>more</strong></a> <span class="twemoji announce-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="m153.6 29.9 16-21.3c4-5.4 10.4-8.6 17.1-8.6C198.4 0 208 9.6 208 21.3v22.1c0 13.1 5.4 25.7 14.9 34.7l84.7 80.9c48.8 46.6 76.4 111.2 76.4 178.7C384 434 306 512 209.7 512H192C86 512 0 426 0 320v-3.8c0-48.8 19.4-95.6 53.9-130.1l3.5-3.5c4.2-4.2 10-6.6 16-6.6 12.5 0 22.6 10.1 22.6 22.6V288c0 35.3 28.7 64 64 64s64-28.7 64-64v-3.9c0-18-7.2-35.3-19.9-48l-38.6-38.6c-24-24-37.5-56.7-37.5-90.7 0-27.7 9-54.8 25.6-76.9"/></svg></span> </div> <script>var el=document.querySelector("[data-md-component=announce]");if(el){var content=el.querySelector(".md-typeset");__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0)}</script> </aside> </div> <!-- Determine class according to configuration --> <!-- Header --> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=header.title> <!-- Link to home --> <a href=https://vectorbt.pro/pvt_41531c19/ title="VectorBTÂ® PRO" class="md-header__button md-logo" aria-label="VectorBTÂ® PRO" data-md-component=logo> <img src=https://vectorbt.pro/pvt_41531c19/assets/logo/logo.svg alt=logo class=logo> </a> <!-- Button to open drawer --> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <!-- Header title --> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> VectorBTÂ® PRO <span class=md-version> v2025.10.15 </span> <span class=unlock-icon><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M192 32c-35.3 0-64 28.7-64 64v64h192c35.3 0 64 28.7 64 64v224c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V224c0-35.3 28.7-64 64-64V96c0-70.7 57.3-128 128-128 63.5 0 116.1 46.1 126.2 106.7 2.9 17.4-8.8 33.9-26.3 36.9S258 102.8 255 85.3C250 55.1 223.7 32 192 32m40 328c13.3 0 24-10.7 24-24s-10.7-24-24-24h-80c-13.3 0-24 10.7-24 24s10.7 24 24 24z"/></svg></span> </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Splitter </span> </div> </div> </div> <!-- Color palette --> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=custom-dark data-md-color-primary=custom-dark data-md-color-accent=custom-dark aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=custom-light data-md-color-primary=custom-light data-md-color-accent=custom-light aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <!-- Site language selector --> <!-- Button to open search modal --> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <!-- Search interface --> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <!-- Repository information --> <div class=md-header__source> <a href=https://github.com/polakowo/vectorbt.pro title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> vectorbt.pro </div> </a> </div> </nav> <!-- Navigation tabs (sticky) --> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/ class=md-tabs__link> Getting started </a> </li> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/features/overview/ class=md-tabs__link> Features </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/overview/ class=md-tabs__link> Tutorials </a> </li> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/documentation/overview/ class=md-tabs__link> Documentation </a> </li> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/cookbook/overview/ class=md-tabs__link> Cookbook </a> </li> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/api/ class=md-tabs__link> API </a> </li> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/terms/terms-of-use/ class=md-tabs__link> Terms </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://vectorbt.pro/pvt_41531c19/ title="VectorBTÂ® PRO" class="md-nav__button md-logo" aria-label="VectorBTÂ® PRO" data-md-component=logo> <img src=https://vectorbt.pro/pvt_41531c19/assets/logo/logo.svg alt=logo class=logo> </a> VectorBTÂ® PRO </label> <div class=md-nav__source> <a href=https://github.com/polakowo/vectorbt.pro title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> vectorbt.pro </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/ class=md-nav__link> <span class=md-ellipsis> Getting started </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/features/overview/ class=md-nav__link> <span class=md-ellipsis> Features </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Tutorials </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/basic-rsi/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m3.5 18.5 6-6 4 4L22 6.92 20.59 5.5l-7.09 8-4-4L2 17z"/></svg> <span class=md-ellipsis> Basic RSI strategy </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/superfast-supertrend/ class=md-nav__link> <span class=md-ellipsis> SuperFast SuperTrend </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/signal-development/generation/ class=md-nav__link> <span class=md-ellipsis> Signal development </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/stop-signals/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 23h-2V1h2zm-4-4H5V5h4V3H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h4zM19 7v2h2V7zm0-2h2a2 2 0 0 0-2-2zm2 10h-2v2h2zm-2-4v2h2v-2zm-2-8h-2v2h2zm2 18c1.11 0 2-.89 2-2h-2zm-2-2h-2v2h2z"/></svg> <span class=md-ellipsis> Stop signals </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/mtf-analysis/ class=md-nav__link> <span class=md-ellipsis> MTF analysis </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/portfolio-optimization/ class=md-nav__link> <span class=md-ellipsis> Portfolio optimization </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/pairs-trading/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M22 6.92 20.59 5.5l-2.85 3.22C15.68 6.4 12.83 5 9.61 5 6.72 5 4.07 6.16 2 8l1.42 1.42C5.12 7.93 7.27 7 9.61 7c2.74 0 5.09 1.26 6.77 3.24L13.5 13.5l-4-4L2 17l1.5 1.5 6-6 4 4 4.05-4.57c.75 1.35 1.25 2.9 1.45 4.57h2c-.22-2.32-.95-4.41-2.04-6.16z"/></svg> <span class=md-ellipsis> Pairs trading </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/patterns-and-projections/patterns/ class=md-nav__link> <span class=md-ellipsis> Patterns and projections </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_10 checked> <label class=md-nav__link for=__nav_3_10 id=__nav_3_10_label tabindex=0> <span class=md-ellipsis> Cross-validation </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_10_label aria-expanded=true> <label class=md-nav__title for=__nav_3_10> <span class="md-nav__icon md-icon"></span> Cross-validation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/cross-validation/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M.41 13.41 6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17 7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42-6.35 6.35 1.42 1.41z"/></svg> <span class=md-ellipsis> Cross-validation </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M.41 13.41 6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17 7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42-6.35 6.35 1.42 1.41z"/></svg> <span class=md-ellipsis> Splitter </span> <span class="md-nav__icon md-icon"></span> </label> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/cross-validation/splitter/ class="md-nav__link md-nav__link--active"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M.41 13.41 6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17 7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42-6.35 6.35 1.42 1.41z"/></svg> <span class=md-ellipsis> Splitter </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#schema class=md-nav__link> <span class=md-ellipsis> Schema </span> </a> <nav class=md-nav aria-label=Schema> <ul class=md-nav__list> <li class=md-nav__item> <a href=#range-format class=md-nav__link> <span class=md-ellipsis> Range format </span> </a> <nav class=md-nav aria-label="Range format"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#relative class=md-nav__link> <span class=md-ellipsis> Relative </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#array-format class=md-nav__link> <span class=md-ellipsis> Array format </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#preparation class=md-nav__link> <span class=md-ellipsis> Preparation </span> </a> <nav class=md-nav aria-label=Preparation> <ul class=md-nav__list> <li class=md-nav__item> <a href=#splits class=md-nav__link> <span class=md-ellipsis> Splits </span> </a> </li> <li class=md-nav__item> <a href=#method class=md-nav__link> <span class=md-ellipsis> Method </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#generation class=md-nav__link> <span class=md-ellipsis> Generation </span> </a> <nav class=md-nav aria-label=Generation> <ul class=md-nav__list> <li class=md-nav__item> <a href=#rolling class=md-nav__link> <span class=md-ellipsis> Rolling </span> </a> </li> <li class=md-nav__item> <a href=#anchored class=md-nav__link> <span class=md-ellipsis> Anchored </span> </a> </li> <li class=md-nav__item> <a href=#random class=md-nav__link> <span class=md-ellipsis> Random </span> </a> </li> <li class=md-nav__item> <a href=#scikit-learn class=md-nav__link> <span class=md-ellipsis> Scikit-learn </span> </a> </li> <li class=md-nav__item> <a href=#dynamic class=md-nav__link> <span class=md-ellipsis> Dynamic </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#validation class=md-nav__link> <span class=md-ellipsis> Validation </span> </a> <nav class=md-nav aria-label=Validation> <ul class=md-nav__list> <li class=md-nav__item> <a href=#bounds class=md-nav__link> <span class=md-ellipsis> Bounds </span> </a> </li> <li class=md-nav__item> <a href=#masks class=md-nav__link> <span class=md-ellipsis> Masks </span> </a> </li> <li class=md-nav__item> <a href=#coverage class=md-nav__link> <span class=md-ellipsis> Coverage </span> </a> </li> <li class=md-nav__item> <a href=#grouping class=md-nav__link> <span class=md-ellipsis> Grouping </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#manipulation class=md-nav__link> <span class=md-ellipsis> Manipulation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/cross-validation/applications/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M.41 13.41 6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17 7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42-6.35 6.35 1.42 1.41z"/></svg> <span class=md-ellipsis> Applications </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/more-tutorials/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10.6 13.4a1 1 0 0 1-1.4 1.4 4.8 4.8 0 0 1 0-7l3.5-3.6a5.1 5.1 0 0 1 7.1 0 5.1 5.1 0 0 1 0 7.1l-1.5 1.5a6.4 6.4 0 0 0-.4-2.4l.5-.5a3.2 3.2 0 0 0 0-4.3 3.2 3.2 0 0 0-4.3 0l-3.5 3.6a2.9 2.9 0 0 0 0 4.2M23 18v2h-3v3h-2v-3h-3v-2h3v-3h2v3m-3.8-4.3a4.8 4.8 0 0 0-1.4-4.5 1 1 0 0 0-1.4 1.4 2.9 2.9 0 0 1 0 4.2l-3.5 3.6a3.2 3.2 0 0 1-4.3 0 3.2 3.2 0 0 1 0-4.3l.5-.4a7.3 7.3 0 0 1-.4-2.5l-1.5 1.5a5.1 5.1 0 0 0 0 7.1 5.1 5.1 0 0 0 7.1 0l1.8-1.8a6 6 0 0 1 3.1-4.3"/></svg> <span class=md-ellipsis> More tutorials </span> </a> </li> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/to-be-continued/ class=md-nav__link> <span class=md-ellipsis> To be continued... </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/documentation/overview/ class=md-nav__link> <span class=md-ellipsis> Documentation </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/cookbook/overview/ class=md-nav__link> <span class=md-ellipsis> Cookbook </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/api/ class=md-nav__link> <span class=md-ellipsis> API </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/terms/terms-of-use/ class=md-nav__link> <span class=md-ellipsis> Terms </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <nav class=md-path aria-label=Navigation> <ol class=md-path__list> <li class=md-path__item> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/overview/ class=md-path__link> <span class=md-ellipsis> Tutorials </span> </a> </li> <li class=md-path__item> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/cross-validation/ class=md-path__link> <span class=md-ellipsis> Cross-validation </span> </a> </li> </ol> </nav> <article class="md-content__inner md-typeset"> <h1 id=splitter><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M.41 13.41 6 19l1.41-1.42L1.83 12m20.41-6.42L11.66 16.17 7.5 12l-1.43 1.41L11.66 19l12-12M18 7l-1.41-1.42-6.35 6.35 1.42 1.41z"/></svg></span> Splitter<a class=headerlink href=#splitter title="Permanent link">&para;</a></h1> <p>The manual approach we used earlier can be divided into three distinct steps: splitting the entire period into sub-periods, applying a UDF to each sub-period and merging its outputs, and analyzing the merged outputs with data science tools. The first two steps are easy to automate. For example, <a href=https://scikit-learn.org/stable/ >scikit-learn</a> provides several <a href=https://scikit-learn.org/stable/modules/cross_validation.html>classes for cross-validation</a>, each designed to take an array and operate on chunks of it. However, that otherwise excellent Python package lacks robust cross-validation schemes for time series data, tools for charting and analyzing split distributions, and an easy-to-extend interface for custom use cases. It is also focused on machine learning (ML) models trained on one dataset and validated on another by making predictions (as the name scikit-learn suggests), while rule-based algorithms that do not predict, but instead produce a set of scores (one per test rather than per data point), receive less attention.</p> <p>That's why VBT takes a different approach and offers functionality designed for the needs of quantitative analysts rather than ML practitioners. The core of this functionality is the class <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter>Splitter</a>, whose main purpose is to create arbitrary splits and perform operations on them. The workings of this class are straightforward: you call one of the class methods with the <code>from_</code> prefix (which should feel familiar) to generate splits. In response, a splitter instance is returned, with splits and their labels stored in a memory-efficient array format. This instance can be used to analyze split distribution, chunk array-like objects, and run UDFs. Get readyâ€”this class alone contains twice as many lines of code as the entire <a href=https://github.com/kernc/backtesting.py>backtesting.py</a> library <img alt=ðŸ˜ˆ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f608.svg title=:smiling_imp:></p> <p>Let's create a splitter for the schema from our first example:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_rolling</span><span class=p>(</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span> 
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=gp>... </span>    <span class=n>length</span><span class=o>=</span><span class=mi>360</span><span class=p>,</span> 
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=gp>... </span>    <span class=n>split</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=gp>... </span>    <span class=n>set_labels</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;IS&quot;</span><span class=p>,</span> <span class=s2>&quot;OOS&quot;</span><span class=p>]</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/splitter.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/splitter.dark.svg#only-dark></p> <p>That's it! We now have a splitter that can manipulate the periods (blue and orange boxes on the plot) and the data within them any way we like, with no more while-loops necessary. Before we dive into the many built-in generation and analysis techniques, let's look under the hood and get familiar with some basic concepts first.</p> <h2 id=schema>Schema<a class=headerlink href=#schema title="Permanent link">&para;</a></h2> <p>The smallest unit of a splitter is a <em>range</em>, which is a period of time that can be mapped onto the data. In the plot above, you can count a total of 18 ranges: 9 blue and 9 orange. Multiple ranges placed side by side and representing a single test are called a <em>split</em>. There are 9 splits shown in the chart, so we expect one pipeline to be tested on 9 different data ranges. Different range types within each split are called <em>sets</em>. Usually, there is either one set; two setsâ€”such as "training" and "test" (commonly used in backtesting); or three setsâ€”"training," "validation," and "test" (commonly used in ML). The number of sets stays the same across all splits.</p> <p>This schema fits perfectly into the philosophy of VBT, as we can represent everything in an array format where rows are splits, columns are sets, and the elements are ranges:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>splits</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=go>set                         IS                      OOS</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=go>split                                                  </span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=go>0          slice(0, 180, None)    slice(180, 360, None)</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=go>1        slice(180, 360, None)    slice(360, 540, None)</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=go>2        slice(360, 540, None)    slice(540, 720, None)</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=go>3        slice(540, 720, None)    slice(720, 900, None)</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=go>4        slice(720, 900, None)   slice(900, 1080, None)</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=go>5       slice(900, 1080, None)  slice(1080, 1260, None)</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=go>6      slice(1080, 1260, None)  slice(1260, 1440, None)</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=go>7      slice(1260, 1440, None)  slice(1440, 1620, None)</span>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=go>8      slice(1440, 1620, None)  slice(1620, 1800, None)</span>
</span></code></pre></div> <p>Notice that the index contains split labels and the columns contain set labels. Unlike other classes in VBT, the wrapper for this class does not represent time and assets, but splits and sets. Time is tracked separately as <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.index>Splitter.index</a>, while assets are not tracked at all, since they have no effect on splitting.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>index</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=go>DatetimeIndex([&#39;2017-08-17 00:00:00+00:00&#39;, &#39;2017-08-18 00:00:00+00:00&#39;,</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=go>               &#39;2017-08-19 00:00:00+00:00&#39;, &#39;2017-08-20 00:00:00+00:00&#39;,</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=go>               ...</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=go>               &#39;2022-10-28 00:00:00+00:00&#39;, &#39;2022-10-29 00:00:00+00:00&#39;,</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=go>               &#39;2022-10-30 00:00:00+00:00&#39;, &#39;2022-10-31 00:00:00+00:00&#39;],</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=go>    dtype=&#39;datetime64[ns, UTC]&#39;, name=&#39;Open time&#39;, length=1902, freq=&#39;D&#39;)</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>wrapper</span><span class=o>.</span><span class=n>index</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=go>RangeIndex(start=0, stop=9, step=1, name=&#39;split&#39;)</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>wrapper</span><span class=o>.</span><span class=n>columns</span>
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a><span class=go>Index([&#39;IS&#39;, &#39;OOS&#39;], dtype=&#39;object&#39;, name=&#39;set&#39;)</span>
</span></code></pre></div> <p>This design has a useful property: you can apply indexing directly to a splitter instance to select specific splits and sets. Let's select the OOS set:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>oos_splitter</span> <span class=o>=</span> <span class=n>splitter</span><span class=p>[</span><span class=s2>&quot;OOS&quot;</span><span class=p>]</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>oos_splitter</span><span class=o>.</span><span class=n>splits</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=go>split</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=go>0      slice(180, 360, None)</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=go>1      slice(360, 540, None)</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=go>2      slice(540, 720, None)</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=go>3      slice(720, 900, None)</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=go>4     slice(900, 1080, None)</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class=go>5    slice(1080, 1260, None)</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=go>6    slice(1260, 1440, None)</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=go>7    slice(1440, 1620, None)</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a><span class=go>8    slice(1620, 1800, None)</span>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a><span class=go>Name: OOS, dtype: object</span>
</span></code></pre></div> <p>This operation creates a completely new splitter for OOS ranges <img alt=ðŸ˜® class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f62e.svg title=:open_mouth:></p> <p>Why is this useful? Because you can select one set and apply a UDF to it, then select another set and apply a completely different UDF to that one. Sounds like a prerequisite for CV, right?</p> <h3 id=range-format>Range format<a class=headerlink href=#range-format title="Permanent link">&para;</a></h3> <p>So, what do ranges look like? In the first example of this tutorial, we used a start and end date to slice the data with <code>loc</code>. However, as we learned, the end date in a <code>loc</code> operation should be inclusive, which makes it a bit tricky to ensure that neighboring ranges do not overlap. Also, dates cannot be used to slice NumPy arrays unless you first convert them into positions. That's why the splitter uses integer-location based indexing and accepts the following range formats. These can be used to slice both Pandas objects (using <a href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.iloc.html>pandas.DataFrame.iloc</a>) and NumPy arrays:</p> <ul> <li>A list or array of integers, for example <code>[4, 3, 0]</code>.</li> <li>A slice object with ints, for example <code>slice(1, 7)</code>.</li> <li>A boolean array.</li> <li>A callable function that takes one argument (the calling Series or DataFrame) and returns a valid output for indexing (one of the above formats).</li> </ul> <p>For example, the slice <code>slice(1, 7)</code> covers the indices <code>[0, 1, 2, 3, 4, 5, 6]</code>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>index</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>date_range</span><span class=p>(</span><span class=s2>&quot;2020&quot;</span><span class=p>,</span> <span class=n>periods</span><span class=o>=</span><span class=mi>14</span><span class=p>)</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>index</span><span class=p>[</span><span class=nb>slice</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>7</span><span class=p>)]</span>  <span class=c1># (1)!</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=go>DatetimeIndex([&#39;2020-01-02&#39;, &#39;2020-01-03&#39;, &#39;2020-01-04&#39;, &#39;2020-01-05&#39;,</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=go>               &#39;2020-01-06&#39;, &#39;2020-01-07&#39;],</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=go>              dtype=&#39;datetime64[ns]&#39;, freq=&#39;D&#39;)</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>index</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>index</span><span class=p>[</span><span class=mi>6</span><span class=p>]</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=go>(Timestamp(&#39;2020-01-02 00:00:00&#39;, freq=&#39;D&#39;),</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=go> Timestamp(&#39;2020-01-07 00:00:00&#39;, freq=&#39;D&#39;))</span>
</span></code></pre></div> <ol> <li>This is the same as <code>index[1:7]</code>.</li> </ol> <p>Separating the index and integer-location based ranges makes it much easier to design non-overlapping, bug-free ranges.</p> <h4 id=relative>Relative<a class=headerlink href=#relative title="Permanent link">&para;</a></h4> <p>The range format introduced above is called "fixed" because ranges do not depend on each other. However, there is another range format called "relative," which makes one range depend on the previous range. For example, instead of defining a range between fixed index positions <code>110</code> and <code>150</code>, you can define a range that starts <code>10</code> points after the end of the previous range and has a length of <code>40</code>. Such an instruction can be created using <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.RelRange>RelRange</a>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>rel_range</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>RelRange</span><span class=p>(</span><span class=n>offset</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span> <span class=n>length</span><span class=o>=</span><span class=mi>40</span><span class=p>)</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>rel_range</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=go>RelRange(</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=go>    offset=10, </span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=go>    offset_anchor=&#39;prev_end&#39;, </span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=go>    offset_space=&#39;free&#39;, </span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=go>    length=40, </span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=go>    length_space=&#39;free&#39;, </span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=go>    out_of_bounds=&#39;warn&#39;,</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=go>    is_gap=False</span>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=go>)</span>
</span></code></pre></div> <p>This instruction will be evaluated later by calling <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.RelRange.to_slice>RelRange.to_slice</a>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>rel_range</span><span class=o>.</span><span class=n>to_slice</span><span class=p>(</span><span class=n>total_len</span><span class=o>=</span><span class=nb>len</span><span class=p>(</span><span class=n>splitter</span><span class=o>.</span><span class=n>index</span><span class=p>),</span> <span class=n>prev_end</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=go>slice(110, 150, None)</span>
</span></code></pre></div> <ol> <li><code>prev_end</code> is the end of the previous range.</li> </ol> <p>Relative ranges are typically converted into fixed ones before building a splitter instance, but splitter instances can also hold relative ranges if the user wants this behavior.</p> <h3 id=array-format>Array format<a class=headerlink href=#array-format title="Permanent link">&para;</a></h3> <p>How do we efficiently store such range formats? The most flexible formats are index arrays and masks because they allow gaps and enable classical <a href=https://scikit-learn.org/stable/modules/cross_validation.html>k-fold cross-validation</a>, but they may use a lot of memory even for simple cases. For example, consider a range covering one year of 1-minute data. This requires about 4MB of RAM as an integer array, or 0.5MB as a mask:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>index</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>date_range</span><span class=p>(</span><span class=s2>&quot;2020&quot;</span><span class=p>,</span> <span class=s2>&quot;2021&quot;</span><span class=p>,</span> <span class=n>freq</span><span class=o>=</span><span class=s2>&quot;1min&quot;</span><span class=p>)</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>range_</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>index</span><span class=p>))</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>range_</span><span class=o>.</span><span class=n>nbytes</span> <span class=o>/</span> <span class=mi>1024</span> <span class=o>/</span> <span class=mi>1024</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=go>4.02099609375</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>range_</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>full</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>index</span><span class=p>),</span> <span class=kc>True</span><span class=p>)</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>range_</span><span class=o>.</span><span class=n>nbytes</span> <span class=o>/</span> <span class=mi>1024</span> <span class=o>/</span> <span class=mi>1024</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=go>0.50262451171875</span>
</span></code></pre></div> <p>This means that just 100 splits and 2 sets would use 800MB and 100MB of RAM, respectively. This is just for holding the splitter metadata in memory. Most "ranges" do not need to be that complex: they usually only need predefined start and end points (which use at most 18 bytes of memory), while still being able to pull the exact period of data as their integer or boolean array equivalents. That's why the <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter>Splitter</a> class tries to convert any array into a slice whenever possible.</p> <p>To make sure users can work with lightweight ranges, complex arrays, and relative ranges using the same API, the array that stores ranges has an object data type:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>splits_arr</span><span class=o>.</span><span class=n>dtype</span>  <span class=c1># (1)!</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=go>dtype(&#39;O&#39;)</span>
</span></code></pre></div> <ol> <li><a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.splits_arr>Splitter.splits_arr</a> is the NumPy (raw) version of <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.splits>Splitter.splits</a>.</li> </ol> <div class="admonition info"> <p class=admonition-title>Info</p> <p>If an element of an array is a complex object, the array does not store the whole objectâ€” it only stores a <a href=https://realpython.com/lessons/object-value-vs-object-identity/ >reference</a> to the object.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nb>id</span><span class=p>(</span><span class=nb>slice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>180</span><span class=p>,</span> <span class=kc>None</span><span class=p>))</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=go>140627839366784</span>
</span></code></pre></div> </div> <p>The object data type is totally valid. It only becomes an issue if you try to pass it to Numba, but the splitting functionality is entirely in Python because the number of ranges (splits x sets) is usually quite low. The main bottleneck is in running UDFs, not iterating over ranges (and don't worry, UDFs can still be run in Numba <img alt=ðŸ˜Œ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f60c.svg title=:relieved:>). Another drawback is that the array can no longer be processed numerically with NumPy or Pandas. That's why we use the <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter>Splitter</a> class, which can extract the meaning out of such an array.</p> <p>This array format provides even more flexibility: you can use different range formats across different splits, store index arrays of different lengths, and since the <code>splits</code> array only stores references, you do not need to duplicate an array if two range values point to the same object. For example, let's build a splitter where ranges of different sizes are stored as integer-location based arrays:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>range_00</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>range_01</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>15</span><span class=p>)</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>range_10</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>15</span><span class=p>,</span> <span class=mi>30</span><span class=p>)</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>range_11</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>30</span><span class=p>,</span> <span class=mi>50</span><span class=p>)</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>ind_splitter</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_splits</span><span class=p>(</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=gp>... </span>    <span class=p>[[</span><span class=n>range_00</span><span class=p>,</span> <span class=n>range_01</span><span class=p>],</span> <span class=p>[</span><span class=n>range_10</span><span class=p>,</span> <span class=n>range_11</span><span class=p>]],</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=gp>... </span>    <span class=n>fix_ranges</span><span class=o>=</span><span class=kc>False</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>ind_splitter</span><span class=o>.</span><span class=n>splits</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=go>set                                                set_0  \</span>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a><span class=go>split                                                      </span>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=go>0                FixRange(range_=array([0, 1, 2, 3, 4]))   </span>
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a><span class=go>1      FixRange(range_=array([15, 16, 17, 18, 19, 20,...   </span>
</span><span id=__span-10-16><a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a>
</span><span id=__span-10-17><a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a><span class=go>set                                                set_1  </span>
</span><span id=__span-10-18><a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a><span class=go>split                                                     </span>
</span><span id=__span-10-19><a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a><span class=go>0      FixRange(range_=array([ 5,  6,  7,  8,  9, 10,...  </span>
</span><span id=__span-10-20><a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a><span class=go>1      FixRange(range_=array([30, 31, 32, 33, 34, 35,... </span>
</span><span id=__span-10-21><a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a>
</span><span id=__span-10-22><a id=__codelineno-10-22 name=__codelineno-10-22 href=#__codelineno-10-22></a><span class=gp>&gt;&gt;&gt; </span><span class=n>ind_splitter</span><span class=o>.</span><span class=n>splits</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=s2>&quot;set_1&quot;</span><span class=p>]</span>  <span class=c1># (1)!</span>
</span><span id=__span-10-23><a id=__codelineno-10-23 name=__codelineno-10-23 href=#__codelineno-10-23></a><span class=go>FixRange(range_=array([20, 21, 22, 23, 24, 25, 26, 27, 28, 29]))</span>
</span><span id=__span-10-24><a id=__codelineno-10-24 name=__codelineno-10-24 href=#__codelineno-10-24></a>
</span><span id=__span-10-25><a id=__codelineno-10-25 name=__codelineno-10-25 href=#__codelineno-10-25></a><span class=gp>&gt;&gt;&gt; </span><span class=n>ind_splitter</span><span class=o>.</span><span class=n>splits</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=s2>&quot;set_1&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>range_</span>  <span class=c1># (2)!</span>
</span><span id=__span-10-26><a id=__codelineno-10-26 name=__codelineno-10-26 href=#__codelineno-10-26></a><span class=go>array([20, 21, 22, 23, 24, 25, 26, 27, 28, 29])</span>
</span></code></pre></div> <ol> <li>Get the fixed range for <code>range_01</code>.</li> <li>Get the actual array.</li> </ol> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>Why is the value of <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.FixRange>FixRange</a> called <code>range_</code> and not <code>range</code>? Because <code>range</code> is a reserved keyword in Python.</p> </div> <p>As we can see, each element of the splits array is a NumPy array wrapped with <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.FixRange>FixRange</a>, which works perfectly fine. Why are arrays wrapped while slices are not? If sub-arrays were not wrapped, the entire array would expand to three dimensions, which is not well-supported by Pandas.</p> <h2 id=preparation>Preparation<a class=headerlink href=#preparation title="Permanent link">&para;</a></h2> <p>In short, a splitter instance manages three objects:</p> <ol> <li><code>wrapper</code> - The wrapper that includes split and set labels (<a href=https://vectorbt.pro/pvt_41531c19/api/base/wrapping/#vectorbtpro.base.wrapping.ArrayWrapper>ArrayWrapper</a>).</li> <li><code>index</code> - The data index, usually a <a href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DatetimeIndex.html>pandas.DatetimeIndex</a>.</li> <li><code>splits</code> - A two-dimensional NumPy array containing range objects.</li> </ol> <p>While you can prepare these objects manually, convenient methods are available to automate this process. The main class method, which serves as the foundation for most other class methods, is <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.from_splits>Splitter.from_splits</a>. This method accepts a sequence of splits, optionally performs some pre-processing on each split, and converts the sequence into an appropriate array format. It also generates the labels and the wrapper. However, let's first focus on preparing the splits.</p> <h3 id=splits>Splits<a class=headerlink href=#splits title="Permanent link">&para;</a></h3> <p>Splitting involves dividing a larger range into smaller subranges. This is accomplished using the <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.split_range>Splitter.split_range</a> method. This method requires a fixed range <code>range_</code> and a split specification <code>new_split</code>, and returns a tuple of new fixed ranges. The returned ranges are always fixed, meaning this method is also used to convert relative ranges into fixed ones. Its main function is to ensure that the provided specification is valid and does not exceed any bounds. For example, you can generate two ranges: one occupying 75% of the space and the other taking up the remaining 25%.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>split_range</span><span class=p>(</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=gp>... </span>    <span class=nb>slice</span><span class=p>(</span><span class=kc>None</span><span class=p>),</span>  <span class=c1># (1)!</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=gp>... </span>    <span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>RelRange</span><span class=p>(</span><span class=n>length</span><span class=o>=</span><span class=mf>0.75</span><span class=p>),</span> <span class=n>vbt</span><span class=o>.</span><span class=n>RelRange</span><span class=p>()),</span>  <span class=c1># (2)!</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=gp>... </span>    <span class=n>index</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>index</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=go>(slice(0, 1426, None), slice(1426, 1902, None))</span>
</span></code></pre></div> <ol> <li>Use the entire range for splitting. This is equivalent to <code>index[None:None]</code> or simply <code>index[:]</code>. See <a href=https://stackoverflow.com/a/509295>this explanation</a>.</li> <li>If the length is not specified, the range uses 100% of the remaining space.</li> </ol> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>This method is a hybrid: it can be called as either a class method or an instance method. If you call it on an instance, you do not need to provide the index, since it is already stored:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>split_range</span><span class=p>(</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=gp>... </span>    <span class=nb>slice</span><span class=p>(</span><span class=kc>None</span><span class=p>),</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=gp>... </span>    <span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>RelRange</span><span class=p>(</span><span class=n>length</span><span class=o>=</span><span class=mf>0.75</span><span class=p>),</span> <span class=n>vbt</span><span class=o>.</span><span class=n>RelRange</span><span class=p>())</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=go>(slice(0, 1426, None), slice(1426, 1902, None))</span>
</span></code></pre></div> </div> <p>These slices can then be used to slice your data:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span><span class=p>[</span><span class=nb>slice</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1426</span><span class=p>,</span> <span class=kc>None</span><span class=p>)]</span>  <span class=c1># (1)!</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=go>&lt;vectorbtpro.data.custom.binance.BinanceData at 0x7fe12a7df310&gt;</span>
</span></code></pre></div> <ol> <li>This is the same as <code>data.iloc[:1426]</code>.</li> </ol> <p>The two relative ranges above can also be replaced with a single number, which represents the length reserved for the first range, with the remaining space assigned to the second range:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>split_range</span><span class=p>(</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=gp>... </span>    <span class=nb>slice</span><span class=p>(</span><span class=kc>None</span><span class=p>),</span> 
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=gp>... </span>    <span class=mf>0.75</span><span class=p>,</span> 
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=gp>... </span>    <span class=n>index</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>index</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=go>(slice(0, 1426, None), slice(1426, 1902, None))</span>
</span></code></pre></div> <p>In cross-validation, you often want to set a fixed length for the OOS period and assign the rest to the IS period. You can do this with a negative number, which reverses the processing order. For example, to make the OOS period 25% of the total:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>split_range</span><span class=p>(</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=gp>... </span>    <span class=nb>slice</span><span class=p>(</span><span class=kc>None</span><span class=p>),</span> 
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=gp>... </span>    <span class=o>-</span><span class=mf>0.25</span><span class=p>,</span>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=gp>... </span>    <span class=n>index</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>index</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=go>(slice(0, 1427, None), slice(1427, 1902, None))</span>
</span></code></pre></div> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>Why do the results differ? This is due to rounding:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nb>int</span><span class=p>(</span><span class=mf>0.75</span> <span class=o>*</span> <span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>))</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=go>1426</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=gp>&gt;&gt;&gt; </span><span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>)</span> <span class=o>-</span> <span class=nb>int</span><span class=p>(</span><span class=mf>0.25</span> <span class=o>*</span> <span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>))</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=go>1427</span>
</span></code></pre></div> </div> <p>You can also do this manually:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>split_range</span><span class=p>(</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=gp>... </span>    <span class=nb>slice</span><span class=p>(</span><span class=kc>None</span><span class=p>),</span> 
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=gp>... </span>    <span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>RelRange</span><span class=p>(),</span> <span class=n>vbt</span><span class=o>.</span><span class=n>RelRange</span><span class=p>(</span><span class=n>length</span><span class=o>=</span><span class=mf>0.25</span><span class=p>)),</span>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=gp>... </span>    <span class=n>backwards</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=gp>... </span>    <span class=n>index</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>index</span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=go>(slice(0, 1427, None), slice(1427, 1902, None))</span>
</span></code></pre></div> <p>Relative ranges defined only by length can be replaced with numbers for convenience. For instance, to make the OOS period 30 data points long:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>split_range</span><span class=p>(</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=gp>... </span>    <span class=nb>slice</span><span class=p>(</span><span class=kc>None</span><span class=p>),</span> 
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=gp>... </span>    <span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=mi>30</span><span class=p>),</span> 
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=gp>... </span>    <span class=n>backwards</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=gp>... </span>    <span class=n>index</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>index</span>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=go>(slice(0, 1872, None), slice(1872, 1902, None))</span>
</span></code></pre></div> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>How does the method decide if the length is relative or absolute? If the number is between 0 and 1, it is treated as a relative length; otherwise, it is treated as the number of data points.</p> </div> <p>When using relative lengths, you can specify the reference space for the length using <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.RelRange.length_space>RelRange.length_space</a>. By default, the length is relative to the remaining space (from the right-most bound of the previous range to the right-most bound of the whole period), but you can set it to be relative to the entire space instead. For example, here we define three ranges: 40%, 40%, and 20%:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>split_range</span><span class=p>(</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=gp>... </span>    <span class=nb>slice</span><span class=p>(</span><span class=kc>None</span><span class=p>),</span> 
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=gp>... </span>    <span class=p>(</span>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=gp>... </span>        <span class=n>vbt</span><span class=o>.</span><span class=n>RelRange</span><span class=p>(</span><span class=n>length</span><span class=o>=</span><span class=mf>0.4</span><span class=p>,</span> <span class=n>length_space</span><span class=o>=</span><span class=s2>&quot;all&quot;</span><span class=p>),</span> 
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=gp>... </span>        <span class=n>vbt</span><span class=o>.</span><span class=n>RelRange</span><span class=p>(</span><span class=n>length</span><span class=o>=</span><span class=mf>0.4</span><span class=p>,</span> <span class=n>length_space</span><span class=o>=</span><span class=s2>&quot;all&quot;</span><span class=p>),</span>
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=gp>... </span>        <span class=n>vbt</span><span class=o>.</span><span class=n>RelRange</span><span class=p>()</span>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=gp>... </span>    <span class=p>),</span>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=gp>... </span>    <span class=n>index</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>index</span>
</span><span id=__span-19-9><a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-19-10><a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a><span class=go>(slice(0, 760, None), slice(760, 1520, None), slice(1520, 1902, None))</span>
</span></code></pre></div> <p>To create a gap between two ranges, use an offset. Offsets, like lengths, can be relative or absolute. Each offset also has an anchor, which defaults to the right-most bound of the previous range (if one exists, otherwise 0). For example, to require a gap of 1 point between the two ranges:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>split_range</span><span class=p>(</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=gp>... </span>    <span class=nb>slice</span><span class=p>(</span><span class=kc>None</span><span class=p>),</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=gp>... </span>    <span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>RelRange</span><span class=p>(</span><span class=n>length</span><span class=o>=</span><span class=mf>0.75</span><span class=p>),</span> <span class=n>vbt</span><span class=o>.</span><span class=n>RelRange</span><span class=p>(</span><span class=n>offset</span><span class=o>=</span><span class=mi>1</span><span class=p>)),</span>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=gp>... </span>    <span class=n>index</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>index</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-20-6><a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=go>(slice(0, 1426, None), slice(1427, 1902, None))</span>
</span></code></pre></div> <p>You can achieve the same result by placing a relative range of 1 data point between the ranges and enabling <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.RelRange.is_gap>RelRange.is_gap</a>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>split_range</span><span class=p>(</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=gp>... </span>    <span class=nb>slice</span><span class=p>(</span><span class=kc>None</span><span class=p>),</span> 
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=gp>... </span>    <span class=p>(</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=gp>... </span>        <span class=n>vbt</span><span class=o>.</span><span class=n>RelRange</span><span class=p>(</span><span class=n>length</span><span class=o>=</span><span class=mf>0.75</span><span class=p>),</span> 
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=gp>... </span>        <span class=n>vbt</span><span class=o>.</span><span class=n>RelRange</span><span class=p>(</span><span class=n>length</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>is_gap</span><span class=o>=</span><span class=kc>True</span><span class=p>),</span>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a><span class=gp>... </span>        <span class=n>vbt</span><span class=o>.</span><span class=n>RelRange</span><span class=p>()</span>
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a><span class=gp>... </span>    <span class=p>),</span>
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a><span class=gp>... </span>    <span class=n>index</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>index</span>
</span><span id=__span-21-9><a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-21-10><a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a><span class=go>(slice(0, 1426, None), slice(1427, 1902, None))</span>
</span></code></pre></div> <p>This method is not only useful for converting relative ranges into fixed ones, but also for optimizing target ranges for better memory efficiency. For example, if you make the first range an array without gaps and the second range an array with gaps, you will see:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>split_range</span><span class=p>(</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=gp>... </span>    <span class=nb>slice</span><span class=p>(</span><span class=kc>None</span><span class=p>),</span> 
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=gp>... </span>    <span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>]),</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>6</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>10</span><span class=p>])),</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=gp>... </span>    <span class=n>index</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>index</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a><span class=go>(slice(3, 6, None), array([ 6,  8, 10]))</span>
</span></code></pre></div> <p>Here, the method optimized the first array into a slice, but not the second. If you do not want this conversion, you can disable it using the <code>range_format</code> argument:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>split_range</span><span class=p>(</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=gp>... </span>    <span class=nb>slice</span><span class=p>(</span><span class=kc>None</span><span class=p>),</span> 
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=gp>... </span>    <span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>]),</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mi>6</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>10</span><span class=p>])),</span>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=gp>... </span>    <span class=n>range_format</span><span class=o>=</span><span class=s2>&quot;indices&quot;</span><span class=p>,</span>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=gp>... </span>    <span class=n>index</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>index</span>
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=go>(array([3, 4, 5]), array([ 6,  8, 10]))</span>
</span></code></pre></div> <p>Since <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter>Splitter</a> uses integer-location and mask-based indexing internally, you cannot use dates and times directly to slice arrays. Fortunately, <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.split_range>Splitter.split_range</a> accepts slices and arrays as <code>pd.Timestamp</code>, <code>np.datetime64</code>, <code>datetime.datetime</code>, or even datetime-like strings, and automatically converts them to integers for you. It also manages timezones.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>split_range</span><span class=p>(</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=gp>... </span>    <span class=nb>slice</span><span class=p>(</span><span class=kc>None</span><span class=p>),</span> 
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=gp>... </span>    <span class=p>(</span><span class=nb>slice</span><span class=p>(</span><span class=s2>&quot;2020&quot;</span><span class=p>,</span> <span class=s2>&quot;2021&quot;</span><span class=p>),</span> <span class=nb>slice</span><span class=p>(</span><span class=s2>&quot;2021&quot;</span><span class=p>,</span> <span class=s2>&quot;2022&quot;</span><span class=p>)),</span>  <span class=c1># (1)!</span>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=gp>... </span>    <span class=n>index</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>index</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=go>(slice(867, 1233, None), slice(1233, 1598, None))</span>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a>
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>[</span><span class=mi>867</span><span class=p>:</span><span class=mi>1233</span><span class=p>]</span>
</span><span id=__span-24-9><a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=go>DatetimeIndex([&#39;2020-01-01 00:00:00+00:00&#39;, ..., &#39;2020-12-31 00:00:00+00:00&#39;],</span>
</span><span id=__span-24-10><a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a><span class=go>    dtype=&#39;datetime64[ns, UTC]&#39;, name=&#39;Open time&#39;, length=366, freq=&#39;D&#39;)</span>
</span><span id=__span-24-11><a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a>
</span><span id=__span-24-12><a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>[</span><span class=mi>1233</span><span class=p>:</span><span class=mi>1598</span><span class=p>]</span>
</span><span id=__span-24-13><a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a><span class=go>DatetimeIndex([&#39;2021-01-01 00:00:00+00:00&#39;, ..., &#39;2021-12-31 00:00:00+00:00&#39;],</span>
</span><span id=__span-24-14><a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a><span class=go>    dtype=&#39;datetime64[ns, UTC]&#39;, name=&#39;Open time&#39;, length=365, freq=&#39;D&#39;)</span>
</span></code></pre></div> <ol> <li>The stop date must be exclusive.</li> </ol> <p>The same applies to relative ranges, where the <code>offset</code> and <code>length</code> arguments can be provided as <code>pd.Timedelta</code>, <code>np.timedelta64</code>, <code>datetime.timedelta</code>, or timedelta-like strings:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>split_range</span><span class=p>(</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=gp>... </span>    <span class=nb>slice</span><span class=p>(</span><span class=kc>None</span><span class=p>),</span> 
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=gp>... </span>    <span class=p>(</span>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=gp>... </span>        <span class=n>vbt</span><span class=o>.</span><span class=n>RelRange</span><span class=p>(</span><span class=n>length</span><span class=o>=</span><span class=s2>&quot;180 days&quot;</span><span class=p>),</span> 
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=gp>... </span>        <span class=n>vbt</span><span class=o>.</span><span class=n>RelRange</span><span class=p>(</span><span class=n>offset</span><span class=o>=</span><span class=s2>&quot;1 day&quot;</span><span class=p>,</span> <span class=n>length</span><span class=o>=</span><span class=s2>&quot;90 days&quot;</span><span class=p>)</span>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=gp>... </span>    <span class=p>),</span>
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a><span class=gp>... </span>    <span class=n>index</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>index</span>
</span><span id=__span-25-8><a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-25-9><a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a><span class=go>(slice(0, 180, None), slice(181, 271, None))</span>
</span></code></pre></div> <h3 id=method>Method<a class=headerlink href=#method title="Permanent link">&para;</a></h3> <p>Returning to <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.from_splits>Splitter.from_splits</a>. As shown earlier, each split is created by converting a split specification into a sequence of ranges, one for each set. By passing multiple such specifications, you get a two-dimensional array, which is available under <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.splits>Splitter.splits</a>. Let's manually generate expanding splits, with the OOS set having a fixed length of 25%:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>manual_splitter</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_splits</span><span class=p>(</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=gp>... </span>    <span class=p>[</span>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=gp>... </span>        <span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>RelRange</span><span class=p>(),</span> <span class=n>vbt</span><span class=o>.</span><span class=n>RelRange</span><span class=p>(</span><span class=n>offset</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span> <span class=n>length</span><span class=o>=</span><span class=mf>0.25</span><span class=p>,</span> <span class=n>length_space</span><span class=o>=</span><span class=s2>&quot;all&quot;</span><span class=p>)),</span>  <span class=c1># (1)!</span>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=gp>... </span>        <span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>RelRange</span><span class=p>(),</span> <span class=n>vbt</span><span class=o>.</span><span class=n>RelRange</span><span class=p>(</span><span class=n>offset</span><span class=o>=</span><span class=mf>0.25</span><span class=p>,</span> <span class=n>length</span><span class=o>=</span><span class=mf>0.25</span><span class=p>,</span> <span class=n>length_space</span><span class=o>=</span><span class=s2>&quot;all&quot;</span><span class=p>)),</span>
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=gp>... </span>        <span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>RelRange</span><span class=p>(),</span> <span class=n>vbt</span><span class=o>.</span><span class=n>RelRange</span><span class=p>(</span><span class=n>offset</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>length</span><span class=o>=</span><span class=mf>0.25</span><span class=p>,</span> <span class=n>length_space</span><span class=o>=</span><span class=s2>&quot;all&quot;</span><span class=p>)),</span>
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=gp>... </span>    <span class=p>],</span>
</span><span id=__span-26-8><a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=gp>... </span>    <span class=n>split_range_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>backwards</span><span class=o>=</span><span class=kc>True</span><span class=p>),</span>  <span class=c1># (2)!</span>
</span><span id=__span-26-9><a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a><span class=gp>... </span>    <span class=n>set_labels</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;IS&quot;</span><span class=p>,</span> <span class=s2>&quot;OOS&quot;</span><span class=p>]</span>
</span><span id=__span-26-10><a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-26-11><a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>manual_splitter</span><span class=o>.</span><span class=n>splits</span>
</span><span id=__span-26-12><a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a><span class=go>set                      IS                      OOS</span>
</span><span id=__span-26-13><a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a><span class=go>split                                               </span>
</span><span id=__span-26-14><a id=__codelineno-26-14 name=__codelineno-26-14 href=#__codelineno-26-14></a><span class=go>0       slice(0, 476, None)    slice(476, 951, None)</span>
</span><span id=__span-26-15><a id=__codelineno-26-15 name=__codelineno-26-15 href=#__codelineno-26-15></a><span class=go>1       slice(0, 952, None)   slice(952, 1427, None)</span>
</span><span id=__span-26-16><a id=__codelineno-26-16 name=__codelineno-26-16 href=#__codelineno-26-16></a><span class=go>2      slice(0, 1427, None)  slice(1427, 1902, None)</span>
</span><span id=__span-26-17><a id=__codelineno-26-17 name=__codelineno-26-17 href=#__codelineno-26-17></a>
</span><span id=__span-26-18><a id=__codelineno-26-18 name=__codelineno-26-18 href=#__codelineno-26-18></a><span class=gp>&gt;&gt;&gt; </span><span class=n>manual_splitter</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Offset the range by 25% and reserve 25% of the entire period for it. Since we are moving backwards (see below), the operation starts at the end of the period and moves to the left.</li> <li>Reverses the range processing order and inverts the period anchors.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/manual_splitter.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/manual_splitter.dark.svg#only-dark></p> <h2 id=generation>Generation<a class=headerlink href=#generation title="Permanent link">&para;</a></h2> <p>We know how to build a splitter manually, but most CV schemes involve generating splits through iteration, similar to what we did with the while-loop in our first example. Additionally, the starting point of a split often depends on the previous split, which would require you to explicitly call <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.split_range>Splitter.split_range</a> on each split to determine its boundaries. To reduce the amount of boilerplate code needed for this workflow, <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter>Splitter</a> includes a collection of class methods, such as <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.from_rolling>Splitter.from_rolling</a>, that can generate a logically coherent schema from a simple user query.</p> <p>Most of these methods first divide the entire period into windows (either in advance or iteratively), and then split each sub-period using the <code>split</code> argument, which is passed directly to <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.split_range>Splitter.split_range</a> as <code>new_split</code>. In this way, the split specification becomes relative to the sub-period and not to the entire period as we did earlier.</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Internally, <code>slice(None)</code> (which we have used every time so far) is replaced by the window slice, so that <code>0.5</code> would split only the window in half, not the entire period.</p> </div> <h3 id=rolling>Rolling<a class=headerlink href=#rolling title="Permanent link">&para;</a></h3> <p>The most important method for CV is <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.from_rolling>Splitter.from_rolling</a>, which uses a simple while-loop to append splits until any split exceeds the right boundary of the index. If the last split is shorter than the requested length, it is discarded, so there is usually some unused space at the end of the backtesting period.</p> <p>But the most interesting question is: where should we place the next split? By default, if there is only one set, the next split is placed immediately after the previous one. If there are multiple sets, the next split is placed right after the first (IS) range in the previous split, so that IS ranges never overlap between splits. Of course, you can control the offset behavior using <code>offset_anchor_set</code> (which range in the previous split acts as an anchor?), <code>offset_anchor</code> (whether the left or right bound of that range acts as the anchor?), <code>offset</code> (the positive or negative distance from the anchor), and <code>offset_space</code> (see <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.RelRange>RelRange</a>).</p> <div class="tabbed-set tabbed-alternate" data-tabs=1:5><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><input id=__tabbed_1_3 name=__tabbed_1 type=radio><input id=__tabbed_1_4 name=__tabbed_1 type=radio><input id=__tabbed_1_5 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>One set</label><label for=__tabbed_1_2>One set with a gap</label><label for=__tabbed_1_3>One set with overlaps</label><label for=__tabbed_1_4>Two sets</label><label for=__tabbed_1_5>Two sets without overlaps</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_rolling</span><span class=p>(</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=gp>... </span>    <span class=n>length</span><span class=o>=</span><span class=mi>360</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Length can be a number of bars (int), a percentage (float, such as <code>0.1</code> for 10% of the entire period), or a duration (string such as <code>"360 days"</code> or any timedelta-like object).</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_rolling1.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_rolling1.dark.svg#only-dark></p> </div> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_rolling</span><span class=p>(</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=gp>... </span>    <span class=n>length</span><span class=o>=</span><span class=mi>360</span><span class=p>,</span>
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=gp>... </span>    <span class=n>offset</span><span class=o>=</span><span class=mi>90</span>  <span class=c1># (1)!</span>
</span><span id=__span-28-5><a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Like length, an offset can also be a percentage (but relative to <code>offset_space</code>) or a duration.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_rolling2.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_rolling2.dark.svg#only-dark></p> </div> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_rolling</span><span class=p>(</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=gp>... </span>    <span class=n>length</span><span class=o>=</span><span class=mi>360</span><span class=p>,</span>
</span><span id=__span-29-4><a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=gp>... </span>    <span class=n>offset</span><span class=o>=-</span><span class=mf>0.5</span>  <span class=c1># (1)!</span>
</span><span id=__span-29-5><a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Unlike length, the offset can also be negative (for example, as a duration: <code>"-180 days"</code>). Since <code>offset_space</code> defaults to the length of the previous split or anchor range, this moves the next window to the left by 50% of the previous window's length.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_rolling3.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_rolling3.dark.svg#only-dark></p> </div> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_rolling</span><span class=p>(</span>
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
</span><span id=__span-30-3><a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a><span class=gp>... </span>    <span class=n>length</span><span class=o>=</span><span class=mi>360</span><span class=p>,</span>
</span><span id=__span-30-4><a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a><span class=gp>... </span>    <span class=n>split</span><span class=o>=</span><span class=mf>0.5</span>  <span class=c1># (1)!</span>
</span><span id=__span-30-5><a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Split instruction passed to <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.split_range>Splitter.split_range</a> to split each window. Here, 50% is allocated to the first range and the remaining space to the second.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_rolling4.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_rolling4.dark.svg#only-dark></p> </div> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_rolling</span><span class=p>(</span>
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
</span><span id=__span-31-3><a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a><span class=gp>... </span>    <span class=n>length</span><span class=o>=</span><span class=mi>360</span><span class=p>,</span>
</span><span id=__span-31-4><a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a><span class=gp>... </span>    <span class=n>split</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span>
</span><span id=__span-31-5><a id=__codelineno-31-5 name=__codelineno-31-5 href=#__codelineno-31-5></a><span class=gp>... </span>    <span class=n>offset_anchor_set</span><span class=o>=</span><span class=kc>None</span>  <span class=c1># (1)!</span>
</span><span id=__span-31-6><a id=__codelineno-31-6 name=__codelineno-31-6 href=#__codelineno-31-6></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Use the entire previous split (<code>set_0 + set_1</code>) as the anchor. Otherwise, it would use only the first range in that split (<code>set_0</code>).</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_rolling5.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_rolling5.dark.svg#only-dark></p> </div> </div> </div> <p>Another common approach is to divide the entire period into <code>n</code> equally spaced, potentially overlapping windows, as implemented by <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.from_n_rolling>Splitter.from_n_rolling</a>. If the window length is <code>None</code> (that is, not provided), it simply calls <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.from_rolling>Splitter.from_rolling</a> with the length set to <code>len(index) // n</code>. Note that unlike the previous method, this one does not allow you to control the offset.</p> <div class="tabbed-set tabbed-alternate" data-tabs=2:3><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><input id=__tabbed_2_2 name=__tabbed_2 type=radio><input id=__tabbed_2_3 name=__tabbed_2 type=radio><div class=tabbed-labels><label for=__tabbed_2_1>Without length</label><label for=__tabbed_2_2>With length and without overlaps</label><label for=__tabbed_2_3>With length and with overlaps</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_n_rolling</span><span class=p>(</span>
</span><span id=__span-32-2><a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
</span><span id=__span-32-3><a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a><span class=gp>... </span>    <span class=n>n</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span>
</span><span id=__span-32-4><a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a><span class=gp>... </span>    <span class=n>split</span><span class=o>=</span><span class=mf>0.5</span>
</span><span id=__span-32-5><a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_n_rolling1.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_n_rolling1.dark.svg#only-dark></p> </div> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_n_rolling</span><span class=p>(</span>
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a><span class=gp>... </span>    <span class=n>n</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-33-4><a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a><span class=gp>... </span>    <span class=n>length</span><span class=o>=</span><span class=mi>360</span><span class=p>,</span>
</span><span id=__span-33-5><a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a><span class=gp>... </span>    <span class=n>split</span><span class=o>=</span><span class=mf>0.5</span>
</span><span id=__span-33-6><a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Splits are not overlapping when <code>n</code> is small enough.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_n_rolling2.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_n_rolling2.dark.svg#only-dark></p> </div> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_n_rolling</span><span class=p>(</span>
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
</span><span id=__span-34-3><a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a><span class=gp>... </span>    <span class=n>n</span><span class=o>=</span><span class=mi>7</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-34-4><a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a><span class=gp>... </span>    <span class=n>length</span><span class=o>=</span><span class=mi>360</span><span class=p>,</span>
</span><span id=__span-34-5><a id=__codelineno-34-5 name=__codelineno-34-5 href=#__codelineno-34-5></a><span class=gp>... </span>    <span class=n>split</span><span class=o>=</span><span class=mf>0.5</span>
</span><span id=__span-34-6><a id=__codelineno-34-6 name=__codelineno-34-6 href=#__codelineno-34-6></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Splits are overlapping when <code>n</code> is large enough.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_n_rolling3.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_n_rolling3.dark.svg#only-dark></p> </div> </div> </div> <p>The windows we generated above all have the same length, which makes it easier to conduct fair experiments in backtesting. However, sometimes, especially when training ML models, we need each training period to include all previous history. Such windows are called expanding and can be generated automatically with <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.from_expanding>Splitter.from_expanding</a>, which works similarly to its rolling counterpart, except that the offset controls the number of windows, the offset anchor is always the end of the previous split (window), and the <code>min_length</code> argument specifies a minimum window length. There is also a method <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.from_n_expanding>Splitter.from_n_expanding</a> that lets you generate a predefined number of expanding windows.</p> <div class="tabbed-set tabbed-alternate" data-tabs=3:2><input checked=checked id=__tabbed_3_1 name=__tabbed_3 type=radio><input id=__tabbed_3_2 name=__tabbed_3 type=radio><div class=tabbed-labels><label for=__tabbed_3_1>Using offset</label><label for=__tabbed_3_2>Using number of windows</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-35-1><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_expanding</span><span class=p>(</span>
</span><span id=__span-35-2><a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
</span><span id=__span-35-3><a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a><span class=gp>... </span>    <span class=n>min_length</span><span class=o>=</span><span class=mi>360</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-35-4><a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a><span class=gp>... </span>    <span class=n>offset</span><span class=o>=</span><span class=mi>180</span><span class=p>,</span>  <span class=c1># (2)!</span>
</span><span id=__span-35-5><a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a><span class=gp>... </span>    <span class=n>split</span><span class=o>=-</span><span class=mi>180</span>  <span class=c1># (3)!</span>
</span><span id=__span-35-6><a id=__codelineno-35-6 name=__codelineno-35-6 href=#__codelineno-35-6></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Same format as <code>length</code> in the rolling version.</li> <li>Same format as <code>offset</code> in the rolling version, but must always be positive.</li> <li>A minus sign means to set the resolution in reversed order: 180 bars for the second (OOS) range and everything else for the first (IS) set.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_expanding.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_expanding.dark.svg#only-dark></p> </div> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-36-1><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_n_expanding</span><span class=p>(</span>
</span><span id=__span-36-2><a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span> 
</span><span id=__span-36-3><a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a><span class=gp>... </span>    <span class=n>n</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span>
</span><span id=__span-36-4><a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a><span class=gp>... </span>    <span class=n>min_length</span><span class=o>=</span><span class=mi>360</span><span class=p>,</span>
</span><span id=__span-36-5><a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a><span class=gp>... </span>    <span class=n>split</span><span class=o>=-</span><span class=mi>180</span>
</span><span id=__span-36-6><a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_n_expanding.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_n_expanding.dark.svg#only-dark></p> </div> </div> </div> <h3 id=anchored>Anchored<a class=headerlink href=#anchored title="Permanent link">&para;</a></h3> <p>Consider a scenario where you want to generate a set of splits, each lasting one year. Using any of the approaches above, you would get splits that last for one year but would most likely start somewhere in the middle of the year. But what if you want each split to start exactly at the beginning of the year? Such time anchors are only possible by grouping or resampling. There are two class methods in <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter>Splitter</a> that enable this behavior: <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.from_ranges>Splitter.from_ranges</a> and <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.from_grouper>Splitter.from_grouper</a>.</p> <p>The first method uses <a href=https://vectorbt.pro/pvt_41531c19/api/base/indexing/#vectorbtpro.base.indexing.get_index_ranges>get_index_ranges</a> to translate a user query into a set of start and end indices. It allows you to provide custom start and end dates, resample using a lookback period, select a time range within each day, and moreâ€”just like resampling but with even more flexibility <img alt=ðŸ’Š class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f48a.svg title=:pill:></p> <div class="tabbed-set tabbed-alternate" data-tabs=4:4><input checked=checked id=__tabbed_4_1 name=__tabbed_4 type=radio><input id=__tabbed_4_2 name=__tabbed_4 type=radio><input id=__tabbed_4_3 name=__tabbed_4 type=radio><input id=__tabbed_4_4 name=__tabbed_4 type=radio><div class=tabbed-labels><label for=__tabbed_4_1>Yearly</label><label for=__tabbed_4_2>Quarterly from year start</label><label for=__tabbed_4_3>Last month for OOS</label><label for=__tabbed_4_4>Expanding with last quarter for OOS</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-37-1><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_ranges</span><span class=p>(</span>
</span><span id=__span-37-2><a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
</span><span id=__span-37-3><a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a><span class=gp>... </span>    <span class=n>every</span><span class=o>=</span><span class=s2>&quot;Y&quot;</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-37-4><a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a><span class=gp>... </span>    <span class=n>split</span><span class=o>=</span><span class=mf>0.5</span>
</span><span id=__span-37-5><a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Every year start. See <a href=https://pandas.pydata.org/docs/user_guide/timeseries.html#dateoffset-objects>DateOffset objects</a>.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_ranges1.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_ranges1.dark.svg#only-dark></p> </div> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-38-1><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_ranges</span><span class=p>(</span>
</span><span id=__span-38-2><a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
</span><span id=__span-38-3><a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a><span class=gp>... </span>    <span class=n>every</span><span class=o>=</span><span class=s2>&quot;Q&quot;</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-38-4><a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a><span class=gp>... </span>    <span class=n>lookback_period</span><span class=o>=</span><span class=s2>&quot;Y&quot;</span><span class=p>,</span>  <span class=c1># (2)!</span>
</span><span id=__span-38-5><a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a><span class=gp>... </span>    <span class=n>split</span><span class=o>=</span><span class=mf>0.5</span>
</span><span id=__span-38-6><a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Every quarter start.</li> <li>Look back all the way to the year start.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_ranges2.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_ranges2.dark.svg#only-dark></p> </div> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-39-1><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_ranges</span><span class=p>(</span>
</span><span id=__span-39-2><a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
</span><span id=__span-39-3><a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a><span class=gp>... </span>    <span class=n>every</span><span class=o>=</span><span class=s2>&quot;Q&quot;</span><span class=p>,</span>
</span><span id=__span-39-4><a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a><span class=gp>... </span>    <span class=n>lookback_period</span><span class=o>=</span><span class=s2>&quot;Y&quot;</span><span class=p>,</span>
</span><span id=__span-39-5><a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a><span class=gp>... </span>    <span class=n>split</span><span class=o>=</span><span class=p>(</span>  <span class=c1># (1)!</span>
</span><span id=__span-39-6><a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a><span class=gp>... </span>        <span class=n>vbt</span><span class=o>.</span><span class=n>RepEval</span><span class=p>(</span><span class=s2>&quot;index.month != index.month[-1]&quot;</span><span class=p>),</span>  <span class=c1># (2)!</span>
</span><span id=__span-39-7><a id=__codelineno-39-7 name=__codelineno-39-7 href=#__codelineno-39-7></a><span class=gp>... </span>        <span class=n>vbt</span><span class=o>.</span><span class=n>RepEval</span><span class=p>(</span><span class=s2>&quot;index.month == index.month[-1]&quot;</span><span class=p>)</span>
</span><span id=__span-39-8><a id=__codelineno-39-8 name=__codelineno-39-8 href=#__codelineno-39-8></a><span class=gp>... </span>    <span class=p>)</span>
</span><span id=__span-39-9><a id=__codelineno-39-9 name=__codelineno-39-9 href=#__codelineno-39-9></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Same as above, but reserve the last calendar month for the OOS set in each split.</li> <li>Template should return a range (here, a mask). The variable <code>index</code> in each template will be substituted by the index of the respective split.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_ranges3.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_ranges3.dark.svg#only-dark></p> </div> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-40-1><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>qyear</span><span class=p>(</span><span class=n>index</span><span class=p>):</span>  <span class=c1># (1)!</span>
</span><span id=__span-40-2><a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>index</span><span class=o>.</span><span class=n>to_period</span><span class=p>(</span><span class=s2>&quot;Q&quot;</span><span class=p>)</span>
</span><span id=__span-40-3><a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a>
</span><span id=__span-40-4><a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_ranges</span><span class=p>(</span>
</span><span id=__span-40-5><a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
</span><span id=__span-40-6><a id=__codelineno-40-6 name=__codelineno-40-6 href=#__codelineno-40-6></a><span class=gp>... </span>    <span class=n>start</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span><span id=__span-40-7><a id=__codelineno-40-7 name=__codelineno-40-7 href=#__codelineno-40-7></a><span class=gp>... </span>    <span class=n>fixed_start</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>  <span class=c1># (2)!</span>
</span><span id=__span-40-8><a id=__codelineno-40-8 name=__codelineno-40-8 href=#__codelineno-40-8></a><span class=gp>... </span>    <span class=n>every</span><span class=o>=</span><span class=s2>&quot;Q&quot;</span><span class=p>,</span>
</span><span id=__span-40-9><a id=__codelineno-40-9 name=__codelineno-40-9 href=#__codelineno-40-9></a><span class=gp>... </span>    <span class=n>split</span><span class=o>=</span><span class=p>(</span>
</span><span id=__span-40-10><a id=__codelineno-40-10 name=__codelineno-40-10 href=#__codelineno-40-10></a><span class=gp>... </span>        <span class=k>lambda</span> <span class=n>index</span><span class=p>:</span> <span class=n>qyear</span><span class=p>(</span><span class=n>index</span><span class=p>)</span> <span class=o>!=</span> <span class=n>qyear</span><span class=p>(</span><span class=n>index</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span>  <span class=c1># (3)!</span>
</span><span id=__span-40-11><a id=__codelineno-40-11 name=__codelineno-40-11 href=#__codelineno-40-11></a><span class=gp>... </span>        <span class=k>lambda</span> <span class=n>index</span><span class=p>:</span> <span class=n>qyear</span><span class=p>(</span><span class=n>index</span><span class=p>)</span> <span class=o>==</span> <span class=n>qyear</span><span class=p>(</span><span class=n>index</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>  <span class=c1># (4)!</span>
</span><span id=__span-40-12><a id=__codelineno-40-12 name=__codelineno-40-12 href=#__codelineno-40-12></a><span class=gp>... </span>    <span class=p>)</span>
</span><span id=__span-40-13><a id=__codelineno-40-13 name=__codelineno-40-13 href=#__codelineno-40-13></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Function to classify each date by quarter.</li> <li>Make each range start from the very first bar.</li> <li>Assign each quarter except the last one to the IS set.</li> <li>Assign the last quarter to the OOS set.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_ranges4.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_ranges4.dark.svg#only-dark></p> </div> </div> </div> <p>The second method takes a grouping or resampling instruction and converts each group into a split. It is based on the method <a href=https://vectorbt.pro/pvt_41531c19/api/base/accessors/#vectorbtpro.base.accessors.BaseIDXAccessor.get_grouper>BaseIDXAccessor.get_grouper</a> and accepts a variety of formats from both VBT and Pandas, including <a href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Grouper.html>pandas.Grouper</a> and <a href=https://pandas.pydata.org/docs/reference/resampling.html>pandas.Resampler</a>. The only issue you may encounter is incomplete splits, which can be filtered out using a template provided as <code>split_check_template</code> and forwarded down to <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.from_splits>Splitter.from_splits</a>.</p> <div class="tabbed-set tabbed-alternate" data-tabs=5:4><input checked=checked id=__tabbed_5_1 name=__tabbed_5 type=radio><input id=__tabbed_5_2 name=__tabbed_5 type=radio><input id=__tabbed_5_3 name=__tabbed_5 type=radio><input id=__tabbed_5_4 name=__tabbed_5 type=radio><div class=tabbed-labels><label for=__tabbed_5_1>Resampling annually</label><label for=__tabbed_5_2>Removing incomplete years</label><label for=__tabbed_5_3>Formatting labels</label><label for=__tabbed_5_4>Using grouping</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-41-1><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_grouper</span><span class=p>(</span>
</span><span id=__span-41-2><a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
</span><span id=__span-41-3><a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a><span class=gp>... </span>    <span class=n>by</span><span class=o>=</span><span class=s2>&quot;Y&quot;</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-41-4><a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a><span class=gp>... </span>    <span class=n>split</span><span class=o>=</span><span class=mf>0.5</span>
</span><span id=__span-41-5><a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Recognized as a resampling instruction.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_grouper1.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_grouper1.dark.svg#only-dark></p> </div> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-42-1><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>is_split_complete</span><span class=p>(</span><span class=n>index</span><span class=p>,</span> <span class=n>split</span><span class=p>):</span>  <span class=c1># (1)!</span>
</span><span id=__span-42-2><a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a><span class=gp>... </span>    <span class=n>first_range</span> <span class=o>=</span> <span class=n>split</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-42-3><a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a><span class=gp>... </span>    <span class=n>first_index</span> <span class=o>=</span> <span class=n>index</span><span class=p>[</span><span class=n>first_range</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-42-4><a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a><span class=gp>... </span>    <span class=n>last_range</span> <span class=o>=</span> <span class=n>split</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span><span id=__span-42-5><a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a><span class=gp>... </span>    <span class=n>last_index</span> <span class=o>=</span> <span class=n>index</span><span class=p>[</span><span class=n>last_range</span><span class=p>][</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span><span id=__span-42-6><a id=__codelineno-42-6 name=__codelineno-42-6 href=#__codelineno-42-6></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>first_index</span><span class=o>.</span><span class=n>is_year_start</span> <span class=ow>and</span> <span class=n>last_index</span><span class=o>.</span><span class=n>is_year_end</span>
</span><span id=__span-42-7><a id=__codelineno-42-7 name=__codelineno-42-7 href=#__codelineno-42-7></a>
</span><span id=__span-42-8><a id=__codelineno-42-8 name=__codelineno-42-8 href=#__codelineno-42-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_grouper</span><span class=p>(</span>
</span><span id=__span-42-9><a id=__codelineno-42-9 name=__codelineno-42-9 href=#__codelineno-42-9></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
</span><span id=__span-42-10><a id=__codelineno-42-10 name=__codelineno-42-10 href=#__codelineno-42-10></a><span class=gp>... </span>    <span class=n>by</span><span class=o>=</span><span class=s2>&quot;Y&quot;</span><span class=p>,</span>
</span><span id=__span-42-11><a id=__codelineno-42-11 name=__codelineno-42-11 href=#__codelineno-42-11></a><span class=gp>... </span>    <span class=n>split</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span>
</span><span id=__span-42-12><a id=__codelineno-42-12 name=__codelineno-42-12 href=#__codelineno-42-12></a><span class=gp>... </span>    <span class=n>split_check_template</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>RepFunc</span><span class=p>(</span><span class=n>is_split_complete</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-42-13><a id=__codelineno-42-13 name=__codelineno-42-13 href=#__codelineno-42-13></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Check whether the first day is the year's start and the last day is the year's end. This function will become a template, so VBT will substitute <code>index</code> for the full index and <code>split</code> for the current split. The function should return False if the split should be discarded.</li> <li>Wrap with <a href=https://vectorbt.pro/pvt_41531c19/api/utils/template/#vectorbtpro.utils.template.RepFunc>RepFunc</a> to make a template from <code>is_split_complete</code>.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_grouper2.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_grouper2.dark.svg#only-dark></p> </div> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-43-1><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>format_split_labels</span><span class=p>(</span><span class=n>index</span><span class=p>,</span> <span class=n>splits_arr</span><span class=p>):</span>  <span class=c1># (1)!</span>
</span><span id=__span-43-2><a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a><span class=gp>... </span>    <span class=n>years</span> <span class=o>=</span> <span class=nb>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>index</span><span class=p>[</span><span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>]][</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>year</span><span class=p>,</span> <span class=n>splits_arr</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-43-3><a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>pd</span><span class=o>.</span><span class=n>Index</span><span class=p>(</span><span class=n>years</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;split_year&quot;</span><span class=p>)</span>
</span><span id=__span-43-4><a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a>
</span><span id=__span-43-5><a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_grouper</span><span class=p>(</span>
</span><span id=__span-43-6><a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
</span><span id=__span-43-7><a id=__codelineno-43-7 name=__codelineno-43-7 href=#__codelineno-43-7></a><span class=gp>... </span>    <span class=n>by</span><span class=o>=</span><span class=s2>&quot;Y&quot;</span><span class=p>,</span>
</span><span id=__span-43-8><a id=__codelineno-43-8 name=__codelineno-43-8 href=#__codelineno-43-8></a><span class=gp>... </span>    <span class=n>split</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span>
</span><span id=__span-43-9><a id=__codelineno-43-9 name=__codelineno-43-9 href=#__codelineno-43-9></a><span class=gp>... </span>    <span class=n>split_check_template</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>RepFunc</span><span class=p>(</span><span class=n>is_split_complete</span><span class=p>),</span>
</span><span id=__span-43-10><a id=__codelineno-43-10 name=__codelineno-43-10 href=#__codelineno-43-10></a><span class=gp>... </span>    <span class=n>split_labels</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>RepFunc</span><span class=p>(</span><span class=n>format_split_labels</span><span class=p>)</span>  <span class=c1># (3)!</span>
</span><span id=__span-43-11><a id=__codelineno-43-11 name=__codelineno-43-11 href=#__codelineno-43-11></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Extract the year from each split. This function becomes a template, so VBT will substitute <code>index</code> for the full index and <code>splits_arr</code> for the splits array. It should return an index-like object.</li> <li>For each split, get the year of the first timestamp in the first range.</li> <li>Split labels can be an index-like object or a template.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_grouper3.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_grouper3.dark.svg#only-dark></p> </div> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-44-1><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_grouper</span><span class=p>(</span>
</span><span id=__span-44-2><a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
</span><span id=__span-44-3><a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a><span class=gp>... </span>    <span class=n>by</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>year</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-44-4><a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a><span class=gp>... </span>    <span class=n>split</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span>
</span><span id=__span-44-5><a id=__codelineno-44-5 name=__codelineno-44-5 href=#__codelineno-44-5></a><span class=gp>... </span>    <span class=n>split_check_template</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>RepFunc</span><span class=p>(</span><span class=n>is_split_complete</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-44-6><a id=__codelineno-44-6 name=__codelineno-44-6 href=#__codelineno-44-6></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Regular Pandas Index with years as values. Each unique value becomes a split label.</li> <li>You still need to check for split completeness, but at least labels are already formatted.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_grouper4.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_grouper4.dark.svg#only-dark></p> </div> </div> </div> <h3 id=random>Random<a class=headerlink href=#random title="Permanent link">&para;</a></h3> <p>So far, we have generated windows based on a predefined schema. However, randomness also plays an important role in CV, especially when it comes to <a href=https://en.wikipedia.org/wiki/Bootstrapping_(statistics)>bootstrapping</a> and <a href=https://en.wikipedia.org/wiki/Bootstrapping_(statistics)#Block_bootstrap>block bootstrap</a> in particular. The method <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.from_n_random>Splitter.from_n_random</a> draws a given number of windows of (optionally) variable length. At the core of this method are two callbacks: <code>length_choice_func</code> and <code>start_choice_func</code>, which select the next window's length and start point, respectively. By default, they use <a href=https://numpy.org/doc/stable/reference/random/generated/numpy.random.Generator.choice.html>numpy.random.Generator.choice</a>, which generates a random sample with replacement (meaning the same window can occur more than once). Two additional callbacks, <code>length_p_func</code> and <code>start_p_func</code>, control the probabilities of picking each entry (for example, to select more windows toward the end of the period).</p> <div class="tabbed-set tabbed-alternate" data-tabs=6:3><input checked=checked id=__tabbed_6_1 name=__tabbed_6 type=radio><input id=__tabbed_6_2 name=__tabbed_6 type=radio><input id=__tabbed_6_3 name=__tabbed_6 type=radio><div class=tabbed-labels><label for=__tabbed_6_1>Fixed length</label><label for=__tabbed_6_2>Variable length</label><label for=__tabbed_6_3>With probabilities</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-45-1><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_n_random</span><span class=p>(</span>
</span><span id=__span-45-2><a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
</span><span id=__span-45-3><a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a><span class=gp>... </span>    <span class=n>n</span><span class=o>=</span><span class=mi>50</span><span class=p>,</span>
</span><span id=__span-45-4><a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a><span class=gp>... </span>    <span class=n>min_length</span><span class=o>=</span><span class=mi>360</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-45-5><a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a><span class=gp>... </span>    <span class=n>seed</span><span class=o>=</span><span class=mi>42</span><span class=p>,</span>  <span class=c1># (2)!</span>
</span><span id=__span-45-6><a id=__codelineno-45-6 name=__codelineno-45-6 href=#__codelineno-45-6></a><span class=gp>... </span>    <span class=n>split</span><span class=o>=</span><span class=mf>0.5</span>
</span><span id=__span-45-7><a id=__codelineno-45-7 name=__codelineno-45-7 href=#__codelineno-45-7></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Without <code>max_length</code>, this becomes the fixed length.</li> <li>Set a seed to ensure the results are the same each run.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_n_random1.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_n_random1.dark.svg#only-dark></p> </div> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-46-1><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_n_random</span><span class=p>(</span>
</span><span id=__span-46-2><a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
</span><span id=__span-46-3><a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a><span class=gp>... </span>    <span class=n>n</span><span class=o>=</span><span class=mi>50</span><span class=p>,</span>
</span><span id=__span-46-4><a id=__codelineno-46-4 name=__codelineno-46-4 href=#__codelineno-46-4></a><span class=gp>... </span>    <span class=n>min_length</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span>
</span><span id=__span-46-5><a id=__codelineno-46-5 name=__codelineno-46-5 href=#__codelineno-46-5></a><span class=gp>... </span>    <span class=n>max_length</span><span class=o>=</span><span class=mi>300</span><span class=p>,</span>
</span><span id=__span-46-6><a id=__codelineno-46-6 name=__codelineno-46-6 href=#__codelineno-46-6></a><span class=gp>... </span>    <span class=n>seed</span><span class=o>=</span><span class=mi>42</span><span class=p>,</span>
</span><span id=__span-46-7><a id=__codelineno-46-7 name=__codelineno-46-7 href=#__codelineno-46-7></a><span class=gp>... </span>    <span class=n>split</span><span class=o>=</span><span class=mf>0.5</span>
</span><span id=__span-46-8><a id=__codelineno-46-8 name=__codelineno-46-8 href=#__codelineno-46-8></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_n_random2.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_n_random2.dark.svg#only-dark></p> </div> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-47-1><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>start_p_func</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>indices</span><span class=p>):</span>  <span class=c1># (1)!</span>
</span><span id=__span-47-2><a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>indices</span> <span class=o>/</span> <span class=n>indices</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span><span id=__span-47-3><a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a>
</span><span id=__span-47-4><a id=__codelineno-47-4 name=__codelineno-47-4 href=#__codelineno-47-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_n_random</span><span class=p>(</span>
</span><span id=__span-47-5><a id=__codelineno-47-5 name=__codelineno-47-5 href=#__codelineno-47-5></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
</span><span id=__span-47-6><a id=__codelineno-47-6 name=__codelineno-47-6 href=#__codelineno-47-6></a><span class=gp>... </span>    <span class=n>n</span><span class=o>=</span><span class=mi>50</span><span class=p>,</span>
</span><span id=__span-47-7><a id=__codelineno-47-7 name=__codelineno-47-7 href=#__codelineno-47-7></a><span class=gp>... </span>    <span class=n>min_length</span><span class=o>=</span><span class=mi>30</span><span class=p>,</span>
</span><span id=__span-47-8><a id=__codelineno-47-8 name=__codelineno-47-8 href=#__codelineno-47-8></a><span class=gp>... </span>    <span class=n>max_length</span><span class=o>=</span><span class=mi>300</span><span class=p>,</span>
</span><span id=__span-47-9><a id=__codelineno-47-9 name=__codelineno-47-9 href=#__codelineno-47-9></a><span class=gp>... </span>    <span class=n>seed</span><span class=o>=</span><span class=mi>42</span><span class=p>,</span>
</span><span id=__span-47-10><a id=__codelineno-47-10 name=__codelineno-47-10 href=#__codelineno-47-10></a><span class=gp>... </span>    <span class=n>start_p_func</span><span class=o>=</span><span class=n>start_p_func</span><span class=p>,</span>
</span><span id=__span-47-11><a id=__codelineno-47-11 name=__codelineno-47-11 href=#__codelineno-47-11></a><span class=gp>... </span>    <span class=n>split</span><span class=o>=</span><span class=mf>0.5</span>
</span><span id=__span-47-12><a id=__codelineno-47-12 name=__codelineno-47-12 href=#__codelineno-47-12></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Accepts the iteration number and a set of potential start points.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_n_random3.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_n_random3.dark.svg#only-dark></p> </div> </div> </div> <h3 id=scikit-learn>Scikit-learn<a class=headerlink href=#scikit-learn title="Permanent link">&para;</a></h3> <p>For k-fold and many other standard CV schemes where scikit-learn excels, there is a method <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.from_sklearn>Splitter.from_sklearn</a> that can parse almost any cross-validator that subclasses scikit-learn's <code>BaseCrossValidator</code> class.</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-48-1><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a><span class=gp>&gt;&gt;&gt; </span><span class=kn>from</span><span class=w> </span><span class=nn>sklearn.model_selection</span><span class=w> </span><span class=kn>import</span> <span class=n>KFold</span>
</span><span id=__span-48-2><a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a>
</span><span id=__span-48-3><a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_sklearn</span><span class=p>(</span>
</span><span id=__span-48-4><a id=__codelineno-48-4 name=__codelineno-48-4 href=#__codelineno-48-4></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span> 
</span><span id=__span-48-5><a id=__codelineno-48-5 name=__codelineno-48-5 href=#__codelineno-48-5></a><span class=gp>... </span>    <span class=n>KFold</span><span class=p>(</span><span class=n>n_splits</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
</span><span id=__span-48-6><a id=__codelineno-48-6 name=__codelineno-48-6 href=#__codelineno-48-6></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_sklearn.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_sklearn.dark.svg#only-dark></p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>There is a temporal dependency between observations: it makes no sense to use values from the future to forecast values in the past, so ensure that the test period always follows the training period.</p> </div> <h3 id=dynamic>Dynamic<a class=headerlink href=#dynamic title="Permanent link">&para;</a></h3> <p>The final and most flexible generation method involves calling a UDF that takes a context, including all previously generated splits, and returns a new split to append. This all happens in an infinite while loop; to break out of the loop, the UDF must return <code>None</code>. As with many other methods in VBT that take functions as arguments, this method also uses templates to substitute information from the context. The context itself includes the appended and resolved splits (<code>splits</code>) and the bounds of each range in each split (but only when <code>fix_ranges=True</code>), making the generation process a breeze.</p> <div class="tabbed-set tabbed-alternate" data-tabs=7:2><input checked=checked id=__tabbed_7_1 name=__tabbed_7 type=radio><input id=__tabbed_7_2 name=__tabbed_7 type=radio><div class=tabbed-labels><label for=__tabbed_7_1>Roll one-year window each month</label><label for=__tabbed_7_2>Train one business week, test next</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-49-1><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>split_func</span><span class=p>(</span><span class=n>index</span><span class=p>,</span> <span class=n>prev_start</span><span class=p>):</span>
</span><span id=__span-49-2><a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a><span class=gp>... </span>    <span class=k>if</span> <span class=n>prev_start</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>  <span class=c1># (1)!</span>
</span><span id=__span-49-3><a id=__codelineno-49-3 name=__codelineno-49-3 href=#__codelineno-49-3></a><span class=gp>... </span>        <span class=n>prev_start</span> <span class=o>=</span> <span class=n>index</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-49-4><a id=__codelineno-49-4 name=__codelineno-49-4 href=#__codelineno-49-4></a><span class=gp>... </span>    <span class=n>new_start</span> <span class=o>=</span> <span class=n>prev_start</span> <span class=o>+</span> <span class=n>pd</span><span class=o>.</span><span class=n>offsets</span><span class=o>.</span><span class=n>MonthBegin</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-49-5><a id=__codelineno-49-5 name=__codelineno-49-5 href=#__codelineno-49-5></a><span class=gp>... </span>    <span class=n>new_end</span> <span class=o>=</span> <span class=n>new_start</span> <span class=o>+</span> <span class=n>pd</span><span class=o>.</span><span class=n>DateOffset</span><span class=p>(</span><span class=n>years</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>  <span class=c1># (3)!</span>
</span><span id=__span-49-6><a id=__codelineno-49-6 name=__codelineno-49-6 href=#__codelineno-49-6></a><span class=gp>... </span>    <span class=k>if</span> <span class=n>new_end</span> <span class=o>&gt;</span> <span class=n>index</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=n>index</span><span class=o>.</span><span class=n>freq</span><span class=p>:</span>  <span class=c1># (4)!</span>
</span><span id=__span-49-7><a id=__codelineno-49-7 name=__codelineno-49-7 href=#__codelineno-49-7></a><span class=gp>... </span>        <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-49-8><a id=__codelineno-49-8 name=__codelineno-49-8 href=#__codelineno-49-8></a><span class=gp>... </span>    <span class=k>return</span> <span class=p>[</span>
</span><span id=__span-49-9><a id=__codelineno-49-9 name=__codelineno-49-9 href=#__codelineno-49-9></a><span class=gp>... </span>        <span class=nb>slice</span><span class=p>(</span><span class=n>new_start</span><span class=p>,</span> <span class=n>new_start</span> <span class=o>+</span> <span class=n>pd</span><span class=o>.</span><span class=n>offsets</span><span class=o>.</span><span class=n>MonthBegin</span><span class=p>(</span><span class=mi>9</span><span class=p>)),</span>  <span class=c1># (5)!</span>
</span><span id=__span-49-10><a id=__codelineno-49-10 name=__codelineno-49-10 href=#__codelineno-49-10></a><span class=gp>... </span>        <span class=nb>slice</span><span class=p>(</span><span class=n>new_start</span> <span class=o>+</span> <span class=n>pd</span><span class=o>.</span><span class=n>offsets</span><span class=o>.</span><span class=n>MonthBegin</span><span class=p>(</span><span class=mi>9</span><span class=p>),</span> <span class=n>new_end</span><span class=p>)</span>
</span><span id=__span-49-11><a id=__codelineno-49-11 name=__codelineno-49-11 href=#__codelineno-49-11></a><span class=gp>... </span>    <span class=p>]</span>
</span><span id=__span-49-12><a id=__codelineno-49-12 name=__codelineno-49-12 href=#__codelineno-49-12></a>
</span><span id=__span-49-13><a id=__codelineno-49-13 name=__codelineno-49-13 href=#__codelineno-49-13></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_split_func</span><span class=p>(</span>
</span><span id=__span-49-14><a id=__codelineno-49-14 name=__codelineno-49-14 href=#__codelineno-49-14></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
</span><span id=__span-49-15><a id=__codelineno-49-15 name=__codelineno-49-15 href=#__codelineno-49-15></a><span class=gp>... </span>    <span class=n>split_func</span><span class=o>=</span><span class=n>split_func</span><span class=p>,</span>
</span><span id=__span-49-16><a id=__codelineno-49-16 name=__codelineno-49-16 href=#__codelineno-49-16></a><span class=gp>... </span>    <span class=n>split_args</span><span class=o>=</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>Rep</span><span class=p>(</span><span class=s2>&quot;index&quot;</span><span class=p>),</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Rep</span><span class=p>(</span><span class=s2>&quot;prev_start&quot;</span><span class=p>)),</span>  <span class=c1># (6)!</span>
</span><span id=__span-49-17><a id=__codelineno-49-17 name=__codelineno-49-17 href=#__codelineno-49-17></a><span class=gp>... </span>    <span class=n>range_bounds_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>index_bounds</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>  <span class=c1># (7)!</span>
</span><span id=__span-49-18><a id=__codelineno-49-18 name=__codelineno-49-18 href=#__codelineno-49-18></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>If this is the first split, <code>prev_start</code> (the start index of the previous split) will be <code>None</code>.</li> <li>The start date of this window is the first day of the next month (inclusive).</li> <li>The end date of this window is the same date in the following year (exclusive).</li> <li>If the split is incomplete (the end date comes after the next allowable end date), abort.</li> <li>Allocate 9 months for the IS period and 3 months for the OOS period.</li> <li>Tell VBT to replace these strings with the appropriate context.</li> <li>Tell VBT to return the bounds of each range as timestamps, not as the number of bars. Otherwise, <code>prev_start</code> will be an integer.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_split_func1.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_split_func1.dark.svg#only-dark></p> </div> <div class=tabbed-block> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-50-1><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>get_next_monday</span><span class=p>(</span><span class=n>from_date</span><span class=p>):</span>
</span><span id=__span-50-2><a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a><span class=gp>... </span>    <span class=k>if</span> <span class=n>from_date</span><span class=o>.</span><span class=n>weekday</span> <span class=o>==</span> <span class=mi>0</span> <span class=ow>and</span> <span class=n>from_date</span><span class=o>.</span><span class=n>ceil</span><span class=p>(</span><span class=s2>&quot;H&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>hour</span> <span class=o>&lt;=</span> <span class=mi>9</span><span class=p>:</span>  <span class=c1># (1)!</span>
</span><span id=__span-50-3><a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a><span class=gp>... </span>        <span class=k>return</span> <span class=n>from_date</span><span class=o>.</span><span class=n>floor</span><span class=p>(</span><span class=s2>&quot;D&quot;</span><span class=p>)</span>
</span><span id=__span-50-4><a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>from_date</span><span class=o>.</span><span class=n>floor</span><span class=p>(</span><span class=s2>&quot;D&quot;</span><span class=p>)</span> <span class=o>+</span> <span class=n>pd</span><span class=o>.</span><span class=n>offsets</span><span class=o>.</span><span class=n>Week</span><span class=p>(</span><span class=n>n</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>weekday</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-50-5><a id=__codelineno-50-5 name=__codelineno-50-5 href=#__codelineno-50-5></a>
</span><span id=__span-50-6><a id=__codelineno-50-6 name=__codelineno-50-6 href=#__codelineno-50-6></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>get_next_business_range</span><span class=p>(</span><span class=n>from_date</span><span class=p>):</span>
</span><span id=__span-50-7><a id=__codelineno-50-7 name=__codelineno-50-7 href=#__codelineno-50-7></a><span class=gp>... </span>    <span class=n>monday_0000</span> <span class=o>=</span> <span class=n>get_next_monday</span><span class=p>(</span><span class=n>from_date</span><span class=p>)</span>
</span><span id=__span-50-8><a id=__codelineno-50-8 name=__codelineno-50-8 href=#__codelineno-50-8></a><span class=gp>... </span>    <span class=n>monday_0900</span> <span class=o>=</span> <span class=n>monday_0000</span> <span class=o>+</span> <span class=n>pd</span><span class=o>.</span><span class=n>DateOffset</span><span class=p>(</span><span class=n>hours</span><span class=o>=</span><span class=mi>9</span><span class=p>)</span>  <span class=c1># (3)!</span>
</span><span id=__span-50-9><a id=__codelineno-50-9 name=__codelineno-50-9 href=#__codelineno-50-9></a><span class=gp>... </span>    <span class=n>friday_1700</span> <span class=o>=</span> <span class=n>monday_0900</span> <span class=o>+</span> <span class=n>pd</span><span class=o>.</span><span class=n>DateOffset</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span> <span class=n>hours</span><span class=o>=</span><span class=mi>8</span><span class=p>)</span>  <span class=c1># (4)!</span>
</span><span id=__span-50-10><a id=__codelineno-50-10 name=__codelineno-50-10 href=#__codelineno-50-10></a><span class=gp>... </span>    <span class=k>return</span> <span class=nb>slice</span><span class=p>(</span><span class=n>monday_0900</span><span class=p>,</span> <span class=n>friday_1700</span><span class=p>)</span>
</span><span id=__span-50-11><a id=__codelineno-50-11 name=__codelineno-50-11 href=#__codelineno-50-11></a>
</span><span id=__span-50-12><a id=__codelineno-50-12 name=__codelineno-50-12 href=#__codelineno-50-12></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>split_func</span><span class=p>(</span><span class=n>index</span><span class=p>,</span> <span class=n>bounds</span><span class=p>):</span>
</span><span id=__span-50-13><a id=__codelineno-50-13 name=__codelineno-50-13 href=#__codelineno-50-13></a><span class=gp>... </span>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>bounds</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-50-14><a id=__codelineno-50-14 name=__codelineno-50-14 href=#__codelineno-50-14></a><span class=gp>... </span>        <span class=n>from_date</span> <span class=o>=</span> <span class=n>index</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>  <span class=c1># (5)!</span>
</span><span id=__span-50-15><a id=__codelineno-50-15 name=__codelineno-50-15 href=#__codelineno-50-15></a><span class=gp>... </span>    <span class=k>else</span><span class=p>:</span>
</span><span id=__span-50-16><a id=__codelineno-50-16 name=__codelineno-50-16 href=#__codelineno-50-16></a><span class=gp>... </span>        <span class=n>from_date</span> <span class=o>=</span> <span class=n>bounds</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>][</span><span class=mi>1</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>  <span class=c1># (6)!</span>
</span><span id=__span-50-17><a id=__codelineno-50-17 name=__codelineno-50-17 href=#__codelineno-50-17></a><span class=gp>... </span>    <span class=n>train_range</span> <span class=o>=</span> <span class=n>get_next_business_range</span><span class=p>(</span><span class=n>from_date</span><span class=p>)</span>
</span><span id=__span-50-18><a id=__codelineno-50-18 name=__codelineno-50-18 href=#__codelineno-50-18></a><span class=gp>... </span>    <span class=n>test_range</span> <span class=o>=</span> <span class=n>get_next_business_range</span><span class=p>(</span><span class=n>train_range</span><span class=o>.</span><span class=n>stop</span><span class=p>)</span>
</span><span id=__span-50-19><a id=__codelineno-50-19 name=__codelineno-50-19 href=#__codelineno-50-19></a><span class=gp>... </span>    <span class=k>if</span> <span class=n>test_range</span><span class=o>.</span><span class=n>stop</span> <span class=o>&gt;</span> <span class=n>index</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=n>index</span><span class=o>.</span><span class=n>freq</span><span class=p>:</span>
</span><span id=__span-50-20><a id=__codelineno-50-20 name=__codelineno-50-20 href=#__codelineno-50-20></a><span class=gp>... </span>        <span class=k>return</span> <span class=kc>None</span>
</span><span id=__span-50-21><a id=__codelineno-50-21 name=__codelineno-50-21 href=#__codelineno-50-21></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>train_range</span><span class=p>,</span> <span class=n>test_range</span>
</span><span id=__span-50-22><a id=__codelineno-50-22 name=__codelineno-50-22 href=#__codelineno-50-22></a>
</span><span id=__span-50-23><a id=__codelineno-50-23 name=__codelineno-50-23 href=#__codelineno-50-23></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_split_func</span><span class=p>(</span>
</span><span id=__span-50-24><a id=__codelineno-50-24 name=__codelineno-50-24 href=#__codelineno-50-24></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>date_range</span><span class=p>(</span><span class=s2>&quot;2020-01&quot;</span><span class=p>,</span> <span class=s2>&quot;2020-03&quot;</span><span class=p>,</span> <span class=n>freq</span><span class=o>=</span><span class=s2>&quot;15min&quot;</span><span class=p>),</span>  <span class=c1># (7)!</span>
</span><span id=__span-50-25><a id=__codelineno-50-25 name=__codelineno-50-25 href=#__codelineno-50-25></a><span class=gp>... </span>    <span class=n>split_func</span><span class=o>=</span><span class=n>split_func</span><span class=p>,</span>
</span><span id=__span-50-26><a id=__codelineno-50-26 name=__codelineno-50-26 href=#__codelineno-50-26></a><span class=gp>... </span>    <span class=n>split_args</span><span class=o>=</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>Rep</span><span class=p>(</span><span class=s2>&quot;index&quot;</span><span class=p>),</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Rep</span><span class=p>(</span><span class=s2>&quot;bounds&quot;</span><span class=p>)),</span>
</span><span id=__span-50-27><a id=__codelineno-50-27 name=__codelineno-50-27 href=#__codelineno-50-27></a><span class=gp>... </span>    <span class=n>range_bounds_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>index_bounds</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-50-28><a id=__codelineno-50-28 name=__codelineno-50-28 href=#__codelineno-50-28></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>If <code>from_date</code> is a Monday at 09:00 or earlier, normalize it to get Monday 00:00.</li> <li>Otherwise, normalize and find the next Monday 00:00.</li> <li>Add 9 hours to get Monday 09:00.</li> <li>Add 4 days and 9 hours to reach Friday 17:00.</li> <li>Start from the first date if this is the first split.</li> <li>Use the start date of the previous test set as the start date of the new train set.</li> <li>Generate a 15-minute index for this example.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_split_func2.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/from_split_func2.dark.svg#only-dark></p> </div> </div> </div> <h2 id=validation>Validation<a class=headerlink href=#validation title="Permanent link">&para;</a></h2> <p>Consider the following splitter that divides the entire period into years, creating one split per year:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-51-1><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_ranges</span><span class=p>(</span>
</span><span id=__span-51-2><a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span>
</span><span id=__span-51-3><a id=__codelineno-51-3 name=__codelineno-51-3 href=#__codelineno-51-3></a><span class=gp>... </span>    <span class=n>every</span><span class=o>=</span><span class=s2>&quot;Y&quot;</span><span class=p>,</span>
</span><span id=__span-51-4><a id=__codelineno-51-4 name=__codelineno-51-4 href=#__codelineno-51-4></a><span class=gp>... </span>    <span class=n>split</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span>
</span><span id=__span-51-5><a id=__codelineno-51-5 name=__codelineno-51-5 href=#__codelineno-51-5></a><span class=gp>... </span>    <span class=n>set_labels</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;IS&quot;</span><span class=p>,</span> <span class=s2>&quot;OOS&quot;</span><span class=p>]</span>
</span><span id=__span-51-6><a id=__codelineno-51-6 name=__codelineno-51-6 href=#__codelineno-51-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-51-7><a id=__codelineno-51-7 name=__codelineno-51-7 href=#__codelineno-51-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/flawed_splitter.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/flawed_splitter.dark.svg#only-dark></p> <p>By default, <code>closed_end</code> is set to <code>False</code> so that neighboring ranges do not overlap. In this example, however, we intentionally made a mistake by setting <code>closed_end</code> to <code>True</code>. This causes the splits to overlap by exactly one bar. How can we detect such a mistake after the fact? The <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter>Splitter</a> class provides several tools to help with this.</p> <h3 id=bounds>Bounds<a class=headerlink href=#bounds title="Permanent link">&para;</a></h3> <p>The first tool is calculating the bounds of each range. Bounds are represented by two numbers (<code>index_bounds=False</code>) or dates (<code>index_bounds=True</code>): the start (always inclusive) and the end (exclusive, unless you include it by using <code>right_inclusive=True</code>). Depending on your analysis needs, bounds can be returned in two different formats. The first format is a three-dimensional NumPy array, returned by <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.get_bounds_arr>Splitter.get_bounds_arr</a>. In this array, the first axis corresponds to splits, the second to sets, and the third to bounds:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-52-1><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>bounds_arr</span> <span class=o>=</span> <span class=n>splitter</span><span class=o>.</span><span class=n>get_bounds_arr</span><span class=p>()</span>  <span class=c1># (1)!</span>
</span><span id=__span-52-2><a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>bounds_arr</span><span class=o>.</span><span class=n>shape</span>
</span><span id=__span-52-3><a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a><span class=go>(4, 2, 2)</span>
</span><span id=__span-52-4><a id=__codelineno-52-4 name=__codelineno-52-4 href=#__codelineno-52-4></a>
</span><span id=__span-52-5><a id=__codelineno-52-5 name=__codelineno-52-5 href=#__codelineno-52-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>bounds_arr</span>
</span><span id=__span-52-6><a id=__codelineno-52-6 name=__codelineno-52-6 href=#__codelineno-52-6></a><span class=go>[[[ 137  320]</span>
</span><span id=__span-52-7><a id=__codelineno-52-7 name=__codelineno-52-7 href=#__codelineno-52-7></a><span class=go>  [ 320  503]]</span>
</span><span id=__span-52-8><a id=__codelineno-52-8 name=__codelineno-52-8 href=#__codelineno-52-8></a><span class=go> [[ 502  685]</span>
</span><span id=__span-52-9><a id=__codelineno-52-9 name=__codelineno-52-9 href=#__codelineno-52-9></a><span class=go>  [ 685  868]]</span>
</span><span id=__span-52-10><a id=__codelineno-52-10 name=__codelineno-52-10 href=#__codelineno-52-10></a><span class=go> [[ 867 1050]</span>
</span><span id=__span-52-11><a id=__codelineno-52-11 name=__codelineno-52-11 href=#__codelineno-52-11></a><span class=go>  [1050 1234]]</span>
</span><span id=__span-52-12><a id=__codelineno-52-12 name=__codelineno-52-12 href=#__codelineno-52-12></a><span class=go> [[1233 1416]</span>
</span><span id=__span-52-13><a id=__codelineno-52-13 name=__codelineno-52-13 href=#__codelineno-52-13></a><span class=go>  [1416 1599]]]</span>
</span></code></pre></div> <ol> <li>Also available via the property <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.bounds_arr>Splitter.bounds_arr</a>.</li> </ol> <p>Another, perhaps more user-friendly, format is a DataFrame returned by <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.get_bounds>Splitter.get_bounds</a>. In this DataFrame, each row represents a range and the columns represent the bounds:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-53-1><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>bounds</span> <span class=o>=</span> <span class=n>splitter</span><span class=o>.</span><span class=n>get_bounds</span><span class=p>(</span><span class=n>index_bounds</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-53-2><a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>bounds</span><span class=o>.</span><span class=n>shape</span>
</span><span id=__span-53-3><a id=__codelineno-53-3 name=__codelineno-53-3 href=#__codelineno-53-3></a><span class=go>(8, 2)</span>
</span><span id=__span-53-4><a id=__codelineno-53-4 name=__codelineno-53-4 href=#__codelineno-53-4></a>
</span><span id=__span-53-5><a id=__codelineno-53-5 name=__codelineno-53-5 href=#__codelineno-53-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>bounds</span>
</span><span id=__span-53-6><a id=__codelineno-53-6 name=__codelineno-53-6 href=#__codelineno-53-6></a><span class=go>bound                         start                       end</span>
</span><span id=__span-53-7><a id=__codelineno-53-7 name=__codelineno-53-7 href=#__codelineno-53-7></a><span class=go>split set                                                    </span>
</span><span id=__span-53-8><a id=__codelineno-53-8 name=__codelineno-53-8 href=#__codelineno-53-8></a><span class=go>0     IS  2018-01-01 00:00:00+00:00 2018-07-03 00:00:00+00:00</span>
</span><span id=__span-53-9><a id=__codelineno-53-9 name=__codelineno-53-9 href=#__codelineno-53-9></a><span class=go>      OOS 2018-07-03 00:00:00+00:00 2019-01-02 00:00:00+00:00</span>
</span><span id=__span-53-10><a id=__codelineno-53-10 name=__codelineno-53-10 href=#__codelineno-53-10></a><span class=go>1     IS  2019-01-01 00:00:00+00:00 2019-07-03 00:00:00+00:00</span>
</span><span id=__span-53-11><a id=__codelineno-53-11 name=__codelineno-53-11 href=#__codelineno-53-11></a><span class=go>      OOS 2019-07-03 00:00:00+00:00 2020-01-02 00:00:00+00:00</span>
</span><span id=__span-53-12><a id=__codelineno-53-12 name=__codelineno-53-12 href=#__codelineno-53-12></a><span class=go>2     IS  2020-01-01 00:00:00+00:00 2020-07-02 00:00:00+00:00</span>
</span><span id=__span-53-13><a id=__codelineno-53-13 name=__codelineno-53-13 href=#__codelineno-53-13></a><span class=go>      OOS 2020-07-02 00:00:00+00:00 2021-01-02 00:00:00+00:00</span>
</span><span id=__span-53-14><a id=__codelineno-53-14 name=__codelineno-53-14 href=#__codelineno-53-14></a><span class=go>3     IS  2021-01-01 00:00:00+00:00 2021-07-03 00:00:00+00:00</span>
</span><span id=__span-53-15><a id=__codelineno-53-15 name=__codelineno-53-15 href=#__codelineno-53-15></a><span class=go>      OOS 2021-07-03 00:00:00+00:00 2022-01-02 00:00:00+00:00</span>
</span></code></pre></div> <ol> <li>Also available as the properties <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.bounds>Splitter.bounds</a> and <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.index_bounds>Splitter.index_bounds</a>.</li> </ol> <p>With this, you can see that some IS ranges start before the preceding OOS range ends:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-54-1><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>bounds</span><span class=o>.</span><span class=n>loc</span><span class=p>[(</span><span class=mi>0</span><span class=p>,</span> <span class=s2>&quot;OOS&quot;</span><span class=p>),</span> <span class=s2>&quot;end&quot;</span><span class=p>]</span>
</span><span id=__span-54-2><a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a><span class=go>Timestamp(&#39;2019-01-02 00:00:00+0000&#39;, tz=&#39;UTC&#39;)</span>
</span><span id=__span-54-3><a id=__codelineno-54-3 name=__codelineno-54-3 href=#__codelineno-54-3></a>
</span><span id=__span-54-4><a id=__codelineno-54-4 name=__codelineno-54-4 href=#__codelineno-54-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>bounds</span><span class=o>.</span><span class=n>loc</span><span class=p>[(</span><span class=mi>1</span><span class=p>,</span> <span class=s2>&quot;IS&quot;</span><span class=p>),</span> <span class=s2>&quot;start&quot;</span><span class=p>]</span>
</span><span id=__span-54-5><a id=__codelineno-54-5 name=__codelineno-54-5 href=#__codelineno-54-5></a><span class=go>Timestamp(&#39;2019-01-01 00:00:00+0000&#39;, tz=&#39;UTC&#39;)</span>
</span></code></pre></div> <h3 id=masks>Masks<a class=headerlink href=#masks title="Permanent link">&para;</a></h3> <p>Another tool works with range masks. Since the index is shared by every range, we can convert a range into a mask with the same length as the index, and then stack all masks into a single array. Another benefit of masks is that you can combine them, use logical operators, reduce them, and check for <code>True</code> values. The main drawback is memory usage: as shown earlier, 100 splits and 2 sets of 1 year of 1-minute data would use up 100MB of RAM. Just like bounds, there are two methods available: one returns a three-dimensional NumPy array and the other a DataFrame: <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.get_mask_arr>Splitter.get_mask_arr</a> and <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.get_mask>Splitter.get_mask</a>. Let's retrieve the mask in DataFrame format:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-55-1><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span> <span class=o>=</span> <span class=n>splitter</span><span class=o>.</span><span class=n>get_mask</span><span class=p>()</span>  <span class=c1># (1)!</span>
</span><span id=__span-55-2><a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>shape</span>
</span><span id=__span-55-3><a id=__codelineno-55-3 name=__codelineno-55-3 href=#__codelineno-55-3></a><span class=go>(1902, 8)</span>
</span><span id=__span-55-4><a id=__codelineno-55-4 name=__codelineno-55-4 href=#__codelineno-55-4></a>
</span><span id=__span-55-5><a id=__codelineno-55-5 name=__codelineno-55-5 href=#__codelineno-55-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span>
</span><span id=__span-55-6><a id=__codelineno-55-6 name=__codelineno-55-6 href=#__codelineno-55-6></a><span class=go>split                          0             1             2             3  \</span>
</span><span id=__span-55-7><a id=__codelineno-55-7 name=__codelineno-55-7 href=#__codelineno-55-7></a><span class=go>set                           IS    OOS     IS    OOS     IS    OOS     IS   </span>
</span><span id=__span-55-8><a id=__codelineno-55-8 name=__codelineno-55-8 href=#__codelineno-55-8></a><span class=go>Open time                                                                    </span>
</span><span id=__span-55-9><a id=__codelineno-55-9 name=__codelineno-55-9 href=#__codelineno-55-9></a><span class=go>2017-08-17 00:00:00+00:00  False  False  False  False  False  False  False   </span>
</span><span id=__span-55-10><a id=__codelineno-55-10 name=__codelineno-55-10 href=#__codelineno-55-10></a><span class=go>2017-08-18 00:00:00+00:00  False  False  False  False  False  False  False   </span>
</span><span id=__span-55-11><a id=__codelineno-55-11 name=__codelineno-55-11 href=#__codelineno-55-11></a><span class=go>2017-08-19 00:00:00+00:00  False  False  False  False  False  False  False   </span>
</span><span id=__span-55-12><a id=__codelineno-55-12 name=__codelineno-55-12 href=#__codelineno-55-12></a><span class=go>...                          ...    ...    ...    ...    ...    ...    ...   </span>
</span><span id=__span-55-13><a id=__codelineno-55-13 name=__codelineno-55-13 href=#__codelineno-55-13></a><span class=go>2022-10-29 00:00:00+00:00  False  False  False  False  False  False  False   </span>
</span><span id=__span-55-14><a id=__codelineno-55-14 name=__codelineno-55-14 href=#__codelineno-55-14></a><span class=go>2022-10-30 00:00:00+00:00  False  False  False  False  False  False  False   </span>
</span><span id=__span-55-15><a id=__codelineno-55-15 name=__codelineno-55-15 href=#__codelineno-55-15></a><span class=go>2022-10-31 00:00:00+00:00  False  False  False  False  False  False  False   </span>
</span><span id=__span-55-16><a id=__codelineno-55-16 name=__codelineno-55-16 href=#__codelineno-55-16></a>
</span><span id=__span-55-17><a id=__codelineno-55-17 name=__codelineno-55-17 href=#__codelineno-55-17></a><span class=go>split                             </span>
</span><span id=__span-55-18><a id=__codelineno-55-18 name=__codelineno-55-18 href=#__codelineno-55-18></a><span class=go>set                          OOS  </span>
</span><span id=__span-55-19><a id=__codelineno-55-19 name=__codelineno-55-19 href=#__codelineno-55-19></a><span class=go>Open time                         </span>
</span><span id=__span-55-20><a id=__codelineno-55-20 name=__codelineno-55-20 href=#__codelineno-55-20></a><span class=go>2017-08-17 00:00:00+00:00  False  </span>
</span><span id=__span-55-21><a id=__codelineno-55-21 name=__codelineno-55-21 href=#__codelineno-55-21></a><span class=go>2017-08-18 00:00:00+00:00  False  </span>
</span><span id=__span-55-22><a id=__codelineno-55-22 name=__codelineno-55-22 href=#__codelineno-55-22></a><span class=go>2017-08-19 00:00:00+00:00  False  </span>
</span><span id=__span-55-23><a id=__codelineno-55-23 name=__codelineno-55-23 href=#__codelineno-55-23></a><span class=go>...                          ...  </span>
</span><span id=__span-55-24><a id=__codelineno-55-24 name=__codelineno-55-24 href=#__codelineno-55-24></a><span class=go>2022-10-29 00:00:00+00:00  False  </span>
</span><span id=__span-55-25><a id=__codelineno-55-25 name=__codelineno-55-25 href=#__codelineno-55-25></a><span class=go>2022-10-30 00:00:00+00:00  False  </span>
</span><span id=__span-55-26><a id=__codelineno-55-26 name=__codelineno-55-26 href=#__codelineno-55-26></a><span class=go>2022-10-31 00:00:00+00:00  False  </span>
</span><span id=__span-55-27><a id=__codelineno-55-27 name=__codelineno-55-27 href=#__codelineno-55-27></a>
</span><span id=__span-55-28><a id=__codelineno-55-28 name=__codelineno-55-28 href=#__codelineno-55-28></a><span class=go>[1902 rows x 8 columns]</span>
</span></code></pre></div> <ol> <li>Also available via the property <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.mask>Splitter.mask</a>.</li> </ol> <p>In contrast to bounds, the DataFrame lists split and set labels (range labels) in columns instead of rows. To illustrate how masks can be useful, let's answer this question: which ranges cover the year 2021?</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-56-1><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=p>[</span><span class=s2>&quot;2021&quot;</span><span class=p>:</span><span class=s2>&quot;2021&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>any</span><span class=p>()</span>
</span><span id=__span-56-2><a id=__codelineno-56-2 name=__codelineno-56-2 href=#__codelineno-56-2></a><span class=go>split  set</span>
</span><span id=__span-56-3><a id=__codelineno-56-3 name=__codelineno-56-3 href=#__codelineno-56-3></a><span class=go>0      IS     False</span>
</span><span id=__span-56-4><a id=__codelineno-56-4 name=__codelineno-56-4 href=#__codelineno-56-4></a><span class=go>       OOS    False</span>
</span><span id=__span-56-5><a id=__codelineno-56-5 name=__codelineno-56-5 href=#__codelineno-56-5></a><span class=go>1      IS     False</span>
</span><span id=__span-56-6><a id=__codelineno-56-6 name=__codelineno-56-6 href=#__codelineno-56-6></a><span class=go>       OOS    False</span>
</span><span id=__span-56-7><a id=__codelineno-56-7 name=__codelineno-56-7 href=#__codelineno-56-7></a><span class=go>2      IS     False</span>
</span><span id=__span-56-8><a id=__codelineno-56-8 name=__codelineno-56-8 href=#__codelineno-56-8></a><span class=go>       OOS     True</span>
</span><span id=__span-56-9><a id=__codelineno-56-9 name=__codelineno-56-9 href=#__codelineno-56-9></a><span class=go>3      IS      True</span>
</span><span id=__span-56-10><a id=__codelineno-56-10 name=__codelineno-56-10 href=#__codelineno-56-10></a><span class=go>       OOS     True</span>
</span><span id=__span-56-11><a id=__codelineno-56-11 name=__codelineno-56-11 href=#__codelineno-56-11></a><span class=go>dtype: bool</span>
</span></code></pre></div> <p>You will notice the mistake again: there is an OOS range that clearly extends into the next year. Here is another question: how many dates are covered by each set in each year?</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-57-1><a id=__codelineno-57-1 name=__codelineno-57-1 href=#__codelineno-57-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>mask</span><span class=o>.</span><span class=n>resample</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>offset</span><span class=p>(</span><span class=s2>&quot;Y&quot;</span><span class=p>))</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>  <span class=c1># (1)!</span>
</span><span id=__span-57-2><a id=__codelineno-57-2 name=__codelineno-57-2 href=#__codelineno-57-2></a><span class=go>split                        0         1         2         3     </span>
</span><span id=__span-57-3><a id=__codelineno-57-3 name=__codelineno-57-3 href=#__codelineno-57-3></a><span class=go>set                         IS  OOS   IS  OOS   IS  OOS   IS  OOS</span>
</span><span id=__span-57-4><a id=__codelineno-57-4 name=__codelineno-57-4 href=#__codelineno-57-4></a><span class=go>Open time                                                        </span>
</span><span id=__span-57-5><a id=__codelineno-57-5 name=__codelineno-57-5 href=#__codelineno-57-5></a><span class=go>2017-01-01 00:00:00+00:00    0    0    0    0    0    0    0    0</span>
</span><span id=__span-57-6><a id=__codelineno-57-6 name=__codelineno-57-6 href=#__codelineno-57-6></a><span class=go>2018-01-01 00:00:00+00:00  183  182    0    0    0    0    0    0</span>
</span><span id=__span-57-7><a id=__codelineno-57-7 name=__codelineno-57-7 href=#__codelineno-57-7></a><span class=go>2019-01-01 00:00:00+00:00    0    1  183  182    0    0    0    0</span>
</span><span id=__span-57-8><a id=__codelineno-57-8 name=__codelineno-57-8 href=#__codelineno-57-8></a><span class=go>2020-01-01 00:00:00+00:00    0    0    0    1  183  183    0    0</span>
</span><span id=__span-57-9><a id=__codelineno-57-9 name=__codelineno-57-9 href=#__codelineno-57-9></a><span class=go>2021-01-01 00:00:00+00:00    0    0    0    0    0    1  183  182</span>
</span><span id=__span-57-10><a id=__codelineno-57-10 name=__codelineno-57-10 href=#__codelineno-57-10></a><span class=go>2022-01-01 00:00:00+00:00    0    0    0    0    0    0    0    1</span>
</span></code></pre></div> <p>To address potential memory issues, there are special approaches that convert only a subset of ranges into a mask at a time. These approaches use two iteration schemes: by split and by set, implemented by <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.get_iter_split_masks>Splitter.get_iter_split_masks</a> and <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.get_iter_set_masks>Splitter.get_iter_set_masks</a>, respectively. Each method returns a <a href=https://realpython.com/introduction-to-python-generators/ >Python generator</a> that you can use in a loop. Here is how you can answer the question above in a memory-efficient way (if needed):</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-58-1><a id=__codelineno-58-1 name=__codelineno-58-1 href=#__codelineno-58-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>results</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-58-2><a id=__codelineno-58-2 name=__codelineno-58-2 href=#__codelineno-58-2></a><span class=gp>&gt;&gt;&gt; </span><span class=k>for</span> <span class=n>mask</span> <span class=ow>in</span> <span class=n>splitter</span><span class=o>.</span><span class=n>get_iter_split_masks</span><span class=p>():</span>
</span><span id=__span-58-3><a id=__codelineno-58-3 name=__codelineno-58-3 href=#__codelineno-58-3></a><span class=gp>... </span>    <span class=n>results</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>mask</span><span class=o>.</span><span class=n>resample</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>offset</span><span class=p>(</span><span class=s2>&quot;Y&quot;</span><span class=p>))</span><span class=o>.</span><span class=n>sum</span><span class=p>())</span>
</span><span id=__span-58-4><a id=__codelineno-58-4 name=__codelineno-58-4 href=#__codelineno-58-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>(</span><span class=n>results</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>keys</span><span class=o>=</span><span class=n>splitter</span><span class=o>.</span><span class=n>split_labels</span><span class=p>)</span>
</span><span id=__span-58-5><a id=__codelineno-58-5 name=__codelineno-58-5 href=#__codelineno-58-5></a><span class=go>split                        0         1         2         3     </span>
</span><span id=__span-58-6><a id=__codelineno-58-6 name=__codelineno-58-6 href=#__codelineno-58-6></a><span class=go>set                         IS  OOS   IS  OOS   IS  OOS   IS  OOS</span>
</span><span id=__span-58-7><a id=__codelineno-58-7 name=__codelineno-58-7 href=#__codelineno-58-7></a><span class=go>Open time                                                        </span>
</span><span id=__span-58-8><a id=__codelineno-58-8 name=__codelineno-58-8 href=#__codelineno-58-8></a><span class=go>2017-01-01 00:00:00+00:00    0    0    0    0    0    0    0    0</span>
</span><span id=__span-58-9><a id=__codelineno-58-9 name=__codelineno-58-9 href=#__codelineno-58-9></a><span class=go>2018-01-01 00:00:00+00:00  183  182    0    0    0    0    0    0</span>
</span><span id=__span-58-10><a id=__codelineno-58-10 name=__codelineno-58-10 href=#__codelineno-58-10></a><span class=go>2019-01-01 00:00:00+00:00    0    1  183  182    0    0    0    0</span>
</span><span id=__span-58-11><a id=__codelineno-58-11 name=__codelineno-58-11 href=#__codelineno-58-11></a><span class=go>2020-01-01 00:00:00+00:00    0    0    0    1  183  183    0    0</span>
</span><span id=__span-58-12><a id=__codelineno-58-12 name=__codelineno-58-12 href=#__codelineno-58-12></a><span class=go>2021-01-01 00:00:00+00:00    0    0    0    0    0    1  183  182</span>
</span><span id=__span-58-13><a id=__codelineno-58-13 name=__codelineno-58-13 href=#__codelineno-58-13></a><span class=go>2022-01-01 00:00:00+00:00    0    0    0    0    0    0    0    1</span>
</span></code></pre></div> <h3 id=coverage>Coverage<a class=headerlink href=#coverage title="Permanent link">&para;</a></h3> <p>Bounds and masks are convenient range formats that let's analyze ranges from different perspectives. To save users extra work, there are additional methods that automate this analysis. Since we are mainly interested in whether and how much splits, sets, and ranges overlap, there are four methods that quickly provide these insights: <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.get_split_coverage>Splitter.get_split_coverage</a> for split coverage, <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.get_set_coverage>Splitter.get_set_coverage</a> for set coverage, <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.get_range_coverage>Splitter.get_range_coverage</a> for range coverage, and <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.get_coverage>Splitter.get_coverage</a> for any of the above. For example, split-relative coverage will return the percentage of bars in the index covered by each split, while total coverage returns the percentage of bars in the index covered by any range.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Most of the methods below, except for the plotting method, require the entire mask array to be loaded in memory.</p> </div> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-59-1><a id=__codelineno-59-1 name=__codelineno-59-1 href=#__codelineno-59-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>get_split_coverage</span><span class=p>()</span>  <span class=c1># (1)!</span>
</span><span id=__span-59-2><a id=__codelineno-59-2 name=__codelineno-59-2 href=#__codelineno-59-2></a><span class=go>split</span>
</span><span id=__span-59-3><a id=__codelineno-59-3 name=__codelineno-59-3 href=#__codelineno-59-3></a><span class=go>0    0.192429</span>
</span><span id=__span-59-4><a id=__codelineno-59-4 name=__codelineno-59-4 href=#__codelineno-59-4></a><span class=go>1    0.192429</span>
</span><span id=__span-59-5><a id=__codelineno-59-5 name=__codelineno-59-5 href=#__codelineno-59-5></a><span class=go>2    0.192955</span>
</span><span id=__span-59-6><a id=__codelineno-59-6 name=__codelineno-59-6 href=#__codelineno-59-6></a><span class=go>3    0.192429</span>
</span><span id=__span-59-7><a id=__codelineno-59-7 name=__codelineno-59-7 href=#__codelineno-59-7></a><span class=go>Name: split_coverage, dtype: float64</span>
</span><span id=__span-59-8><a id=__codelineno-59-8 name=__codelineno-59-8 href=#__codelineno-59-8></a>
</span><span id=__span-59-9><a id=__codelineno-59-9 name=__codelineno-59-9 href=#__codelineno-59-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>get_set_coverage</span><span class=p>()</span>  <span class=c1># (2)!</span>
</span><span id=__span-59-10><a id=__codelineno-59-10 name=__codelineno-59-10 href=#__codelineno-59-10></a><span class=go>set</span>
</span><span id=__span-59-11><a id=__codelineno-59-11 name=__codelineno-59-11 href=#__codelineno-59-11></a><span class=go>IS     0.384858</span>
</span><span id=__span-59-12><a id=__codelineno-59-12 name=__codelineno-59-12 href=#__codelineno-59-12></a><span class=go>OOS    0.385384</span>
</span><span id=__span-59-13><a id=__codelineno-59-13 name=__codelineno-59-13 href=#__codelineno-59-13></a><span class=go>Name: set_coverage, dtype: float64</span>
</span><span id=__span-59-14><a id=__codelineno-59-14 name=__codelineno-59-14 href=#__codelineno-59-14></a>
</span><span id=__span-59-15><a id=__codelineno-59-15 name=__codelineno-59-15 href=#__codelineno-59-15></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>get_range_coverage</span><span class=p>()</span>  <span class=c1># (3)!</span>
</span><span id=__span-59-16><a id=__codelineno-59-16 name=__codelineno-59-16 href=#__codelineno-59-16></a><span class=go>split  set</span>
</span><span id=__span-59-17><a id=__codelineno-59-17 name=__codelineno-59-17 href=#__codelineno-59-17></a><span class=go>0      IS     0.096215</span>
</span><span id=__span-59-18><a id=__codelineno-59-18 name=__codelineno-59-18 href=#__codelineno-59-18></a><span class=go>       OOS    0.096215</span>
</span><span id=__span-59-19><a id=__codelineno-59-19 name=__codelineno-59-19 href=#__codelineno-59-19></a><span class=go>1      IS     0.096215</span>
</span><span id=__span-59-20><a id=__codelineno-59-20 name=__codelineno-59-20 href=#__codelineno-59-20></a><span class=go>       OOS    0.096215</span>
</span><span id=__span-59-21><a id=__codelineno-59-21 name=__codelineno-59-21 href=#__codelineno-59-21></a><span class=go>2      IS     0.096215</span>
</span><span id=__span-59-22><a id=__codelineno-59-22 name=__codelineno-59-22 href=#__codelineno-59-22></a><span class=go>       OOS    0.096740</span>
</span><span id=__span-59-23><a id=__codelineno-59-23 name=__codelineno-59-23 href=#__codelineno-59-23></a><span class=go>3      IS     0.096215</span>
</span><span id=__span-59-24><a id=__codelineno-59-24 name=__codelineno-59-24 href=#__codelineno-59-24></a><span class=go>       OOS    0.096215</span>
</span><span id=__span-59-25><a id=__codelineno-59-25 name=__codelineno-59-25 href=#__codelineno-59-25></a><span class=go>Name: range_coverage, dtype: float64</span>
</span><span id=__span-59-26><a id=__codelineno-59-26 name=__codelineno-59-26 href=#__codelineno-59-26></a>
</span><span id=__span-59-27><a id=__codelineno-59-27 name=__codelineno-59-27 href=#__codelineno-59-27></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>get_coverage</span><span class=p>()</span>  <span class=c1># (4)!</span>
</span><span id=__span-59-28><a id=__codelineno-59-28 name=__codelineno-59-28 href=#__codelineno-59-28></a><span class=go>0.768664563617245</span>
</span></code></pre></div> <ol> <li>Also available via the property <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.split_coverage>Splitter.split_coverage</a>.</li> <li>Also available via the property <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.set_coverage>Splitter.set_coverage</a>.</li> <li>Also available via the property <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.range_coverage>Splitter.range_coverage</a>.</li> <li>Also available via the property <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.coverage>Splitter.coverage</a>.</li> </ol> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The default arguments always return a metric relative to the length of the index.</p> </div> <p>As we saw above, the first split covers 19.24% of the entire period, while both ranges in that split occupy 9.62%, which is exactly 50% of the split. Both sets cover about the same period of time: 38.53% of the entire period. The last metric tells us that 23.14% of the period is not covered by the splitter, which makes sense since the years 2017 and 2022 are incomplete, so no split was made for those years. Finally, why do all ranges cover the same time except for the OOS set in split <code>2</code>? It is because that year was a leap year, so the final months had one more day than those months in other years:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-60-1><a id=__codelineno-60-1 name=__codelineno-60-1 href=#__codelineno-60-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>index_bounds</span><span class=o>.</span><span class=n>loc</span><span class=p>[(</span><span class=mi>2</span><span class=p>,</span> <span class=s2>&quot;OOS&quot;</span><span class=p>),</span> <span class=s2>&quot;start&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>is_leap_year</span>
</span><span id=__span-60-2><a id=__codelineno-60-2 name=__codelineno-60-2 href=#__codelineno-60-2></a><span class=go>True</span>
</span></code></pre></div> <p>So far, we have analyzed coverage relative to the full index. However, there is a special argument, <code>relative</code>, that lets us analyze splits and sets relative to total coverage, and ranges relative to split coverage. For example, here is how to get the fraction of IS and OOS sets in their respective splits:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-61-1><a id=__codelineno-61-1 name=__codelineno-61-1 href=#__codelineno-61-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>get_range_coverage</span><span class=p>(</span><span class=n>relative</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-61-2><a id=__codelineno-61-2 name=__codelineno-61-2 href=#__codelineno-61-2></a><span class=go>split  set</span>
</span><span id=__span-61-3><a id=__codelineno-61-3 name=__codelineno-61-3 href=#__codelineno-61-3></a><span class=go>0      IS     0.500000</span>
</span><span id=__span-61-4><a id=__codelineno-61-4 name=__codelineno-61-4 href=#__codelineno-61-4></a><span class=go>       OOS    0.500000</span>
</span><span id=__span-61-5><a id=__codelineno-61-5 name=__codelineno-61-5 href=#__codelineno-61-5></a><span class=go>1      IS     0.500000</span>
</span><span id=__span-61-6><a id=__codelineno-61-6 name=__codelineno-61-6 href=#__codelineno-61-6></a><span class=go>       OOS    0.500000</span>
</span><span id=__span-61-7><a id=__codelineno-61-7 name=__codelineno-61-7 href=#__codelineno-61-7></a><span class=go>2      IS     0.498638</span>
</span><span id=__span-61-8><a id=__codelineno-61-8 name=__codelineno-61-8 href=#__codelineno-61-8></a><span class=go>       OOS    0.501362</span>
</span><span id=__span-61-9><a id=__codelineno-61-9 name=__codelineno-61-9 href=#__codelineno-61-9></a><span class=go>3      IS     0.500000</span>
</span><span id=__span-61-10><a id=__codelineno-61-10 name=__codelineno-61-10 href=#__codelineno-61-10></a><span class=go>       OOS    0.500000</span>
</span><span id=__span-61-11><a id=__codelineno-61-11 name=__codelineno-61-11 href=#__codelineno-61-11></a><span class=go>Name: range_coverage, dtype: float64</span>
</span></code></pre></div> <p>Most periods, except for the leap year, have a near-perfect 50/50 split as expected. We can expand our analysis to check whether the sets overall also follow this 50/50 split:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-62-1><a id=__codelineno-62-1 name=__codelineno-62-1 href=#__codelineno-62-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>get_set_coverage</span><span class=p>(</span><span class=n>relative</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-62-2><a id=__codelineno-62-2 name=__codelineno-62-2 href=#__codelineno-62-2></a><span class=go>set</span>
</span><span id=__span-62-3><a id=__codelineno-62-3 name=__codelineno-62-3 href=#__codelineno-62-3></a><span class=go>IS     0.500684</span>
</span><span id=__span-62-4><a id=__codelineno-62-4 name=__codelineno-62-4 href=#__codelineno-62-4></a><span class=go>OOS    0.501368</span>
</span><span id=__span-62-5><a id=__codelineno-62-5 name=__codelineno-62-5 href=#__codelineno-62-5></a><span class=go>Name: set_coverage, dtype: float64</span>
</span></code></pre></div> <p>These two numbers do not sum to one, which (again) points to overlapping ranges. Using the <code>overlapping</code> argument, we can check for any overlap of sets within each split, overlap of splits within each set, and any overlaps of ranges globally:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-63-1><a id=__codelineno-63-1 name=__codelineno-63-1 href=#__codelineno-63-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>get_split_coverage</span><span class=p>(</span><span class=n>overlapping</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-63-2><a id=__codelineno-63-2 name=__codelineno-63-2 href=#__codelineno-63-2></a><span class=go>split</span>
</span><span id=__span-63-3><a id=__codelineno-63-3 name=__codelineno-63-3 href=#__codelineno-63-3></a><span class=go>0    0.0</span>
</span><span id=__span-63-4><a id=__codelineno-63-4 name=__codelineno-63-4 href=#__codelineno-63-4></a><span class=go>1    0.0</span>
</span><span id=__span-63-5><a id=__codelineno-63-5 name=__codelineno-63-5 href=#__codelineno-63-5></a><span class=go>2    0.0</span>
</span><span id=__span-63-6><a id=__codelineno-63-6 name=__codelineno-63-6 href=#__codelineno-63-6></a><span class=go>3    0.0</span>
</span><span id=__span-63-7><a id=__codelineno-63-7 name=__codelineno-63-7 href=#__codelineno-63-7></a><span class=go>Name: split_coverage, dtype: float64</span>
</span><span id=__span-63-8><a id=__codelineno-63-8 name=__codelineno-63-8 href=#__codelineno-63-8></a>
</span><span id=__span-63-9><a id=__codelineno-63-9 name=__codelineno-63-9 href=#__codelineno-63-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>get_set_coverage</span><span class=p>(</span><span class=n>overlapping</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-63-10><a id=__codelineno-63-10 name=__codelineno-63-10 href=#__codelineno-63-10></a><span class=go>set</span>
</span><span id=__span-63-11><a id=__codelineno-63-11 name=__codelineno-63-11 href=#__codelineno-63-11></a><span class=go>IS     0.0</span>
</span><span id=__span-63-12><a id=__codelineno-63-12 name=__codelineno-63-12 href=#__codelineno-63-12></a><span class=go>OOS    0.0</span>
</span><span id=__span-63-13><a id=__codelineno-63-13 name=__codelineno-63-13 href=#__codelineno-63-13></a><span class=go>Name: set_coverage, dtype: float64</span>
</span><span id=__span-63-14><a id=__codelineno-63-14 name=__codelineno-63-14 href=#__codelineno-63-14></a>
</span><span id=__span-63-15><a id=__codelineno-63-15 name=__codelineno-63-15 href=#__codelineno-63-15></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>get_coverage</span><span class=p>(</span><span class=n>overlapping</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-63-16><a id=__codelineno-63-16 name=__codelineno-63-16 href=#__codelineno-63-16></a><span class=go>0.002051983584131327</span>
</span></code></pre></div> <p>Ranges do not overlap within each split or within each set. However, some overlapping ranges are detected globally, which means they belong to different splits and sets. To get a better view, we can visualize the coverage using <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.plot_coverage>Splitter.plot_coverage</a>:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-64-1><a id=__codelineno-64-1 name=__codelineno-64-1 href=#__codelineno-64-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>plot_coverage</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/plot_coverage.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/plot_coverage.dark.svg#only-dark></p> <p>The Y-axis shows the total number of ranges that cover a particular date. You can see that there are three dates covered by two ranges at the same time.</p> <p>The last and most powerful tool for detecting overlap is the overlap matrix, which calculates overlaps between splits (<code>by="split"</code>), sets (<code>by="set"</code>), or ranges (<code>by="range"</code>). If <code>normalize</code> is True, which is the default, the intersection of two range masks will be normalized by their union. Although this operation is Numba-compiled, it can still be quite expensive: 100 splits with 2 sets would require comparing all <code>200 * 200 = 40000</code> range pairs to build the range overlap matrix. Let's finally clarify which ranges are overlapping:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-65-1><a id=__codelineno-65-1 name=__codelineno-65-1 href=#__codelineno-65-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>get_overlap_matrix</span><span class=p>(</span><span class=n>by</span><span class=o>=</span><span class=s2>&quot;range&quot;</span><span class=p>,</span> <span class=n>normalize</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-65-2><a id=__codelineno-65-2 name=__codelineno-65-2 href=#__codelineno-65-2></a><span class=go>split        0         1         2         3     </span>
</span><span id=__span-65-3><a id=__codelineno-65-3 name=__codelineno-65-3 href=#__codelineno-65-3></a><span class=go>set         IS  OOS   IS  OOS   IS  OOS   IS  OOS</span>
</span><span id=__span-65-4><a id=__codelineno-65-4 name=__codelineno-65-4 href=#__codelineno-65-4></a><span class=go>split set                                        </span>
</span><span id=__span-65-5><a id=__codelineno-65-5 name=__codelineno-65-5 href=#__codelineno-65-5></a><span class=go>0     IS   183    0    0    0    0    0    0    0</span>
</span><span id=__span-65-6><a id=__codelineno-65-6 name=__codelineno-65-6 href=#__codelineno-65-6></a><span class=go>      OOS    0  183    1    0    0    0    0    0</span>
</span><span id=__span-65-7><a id=__codelineno-65-7 name=__codelineno-65-7 href=#__codelineno-65-7></a><span class=go>1     IS     0    1  183    0    0    0    0    0</span>
</span><span id=__span-65-8><a id=__codelineno-65-8 name=__codelineno-65-8 href=#__codelineno-65-8></a><span class=go>      OOS    0    0    0  183    1    0    0    0</span>
</span><span id=__span-65-9><a id=__codelineno-65-9 name=__codelineno-65-9 href=#__codelineno-65-9></a><span class=go>2     IS     0    0    0    1  183    0    0    0</span>
</span><span id=__span-65-10><a id=__codelineno-65-10 name=__codelineno-65-10 href=#__codelineno-65-10></a><span class=go>      OOS    0    0    0    0    0  184    1    0</span>
</span><span id=__span-65-11><a id=__codelineno-65-11 name=__codelineno-65-11 href=#__codelineno-65-11></a><span class=go>3     IS     0    0    0    0    0    1  183    0</span>
</span><span id=__span-65-12><a id=__codelineno-65-12 name=__codelineno-65-12 href=#__codelineno-65-12></a><span class=go>      OOS    0    0    0    0    0    0    0  183</span>
</span></code></pre></div> <ol> <li>The default version is also available as the property <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.range_overlap_matrix>Splitter.range_overlap_matrix</a>.</li> </ol> <h3 id=grouping>Grouping<a class=headerlink href=#grouping title="Permanent link">&para;</a></h3> <p>Each method above (and many others, including <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.plot>Splitter.plot</a>) accepts the arguments <code>split_group_by</code> and <code>set_group_by</code>, which let you group splits and sets, respectively. Their format matches the <code>group_by</code> argument, which appears throughout the VBT codebase. For example, if you pass <code>True</code>, you can put all ranges in the same bucket and merge them. You can also pass a list with the same length as the number of splits or sets, so that splits or sets with the same unique value will be merged. The actual merging is done by the method <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.merge_split>Splitter.merge_split</a>.</p> <p>For example, let's retrieve the bounds of each entire split:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-66-1><a id=__codelineno-66-1 name=__codelineno-66-1 href=#__codelineno-66-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>get_bounds</span><span class=p>(</span><span class=n>index_bounds</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>set_group_by</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-66-2><a id=__codelineno-66-2 name=__codelineno-66-2 href=#__codelineno-66-2></a><span class=go>bound                               start                       end</span>
</span><span id=__span-66-3><a id=__codelineno-66-3 name=__codelineno-66-3 href=#__codelineno-66-3></a><span class=go>split set_group                                                    </span>
</span><span id=__span-66-4><a id=__codelineno-66-4 name=__codelineno-66-4 href=#__codelineno-66-4></a><span class=go>0     group     2018-01-01 00:00:00+00:00 2019-01-02 00:00:00+00:00</span>
</span><span id=__span-66-5><a id=__codelineno-66-5 name=__codelineno-66-5 href=#__codelineno-66-5></a><span class=go>1     group     2019-01-01 00:00:00+00:00 2020-01-02 00:00:00+00:00</span>
</span><span id=__span-66-6><a id=__codelineno-66-6 name=__codelineno-66-6 href=#__codelineno-66-6></a><span class=go>2     group     2020-01-01 00:00:00+00:00 2021-01-02 00:00:00+00:00</span>
</span><span id=__span-66-7><a id=__codelineno-66-7 name=__codelineno-66-7 href=#__codelineno-66-7></a><span class=go>3     group     2021-01-01 00:00:00+00:00 2022-01-02 00:00:00+00:00</span>
</span></code></pre></div> <p>This makes certain types of analysis much easier <img alt=ðŸª„ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1fa84.svg title=:magic_wand:></p> <h2 id=manipulation>Manipulation<a class=headerlink href=#manipulation title="Permanent link">&para;</a></h2> <p>We will end this page with an overview of the methods that can be used to modify a splitter. Let's build a splitter that includes just one set representing the current year:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-67-1><a id=__codelineno-67-1 name=__codelineno-67-1 href=#__codelineno-67-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Splitter</span><span class=o>.</span><span class=n>from_grouper</span><span class=p>(</span>
</span><span id=__span-67-2><a id=__codelineno-67-2 name=__codelineno-67-2 href=#__codelineno-67-2></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=p>,</span> 
</span><span id=__span-67-3><a id=__codelineno-67-3 name=__codelineno-67-3 href=#__codelineno-67-3></a><span class=gp>... </span>    <span class=n>by</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>year</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=s2>&quot;split_year&quot;</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-67-4><a id=__codelineno-67-4 name=__codelineno-67-4 href=#__codelineno-67-4></a><span class=gp>... </span><span class=p>)</span>
</span></code></pre></div> <ol> <li>Without renaming, the name will be derived from the index and will become "Open time".</li> </ol> <p>Since the class <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter>Splitter</a> is a subclass of <a href=https://vectorbt.pro/pvt_41531c19/documentation/building-blocks/#analyzing>Analyzable</a>, we can get a quick and insightful overview of key metrics and plots:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-68-1><a id=__codelineno-68-1 name=__codelineno-68-1 href=#__codelineno-68-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>stats</span><span class=p>()</span>
</span><span id=__span-68-2><a id=__codelineno-68-2 name=__codelineno-68-2 href=#__codelineno-68-2></a><span class=go>Index Start             2017-08-17 00:00:00+00:00</span>
</span><span id=__span-68-3><a id=__codelineno-68-3 name=__codelineno-68-3 href=#__codelineno-68-3></a><span class=go>Index End               2022-10-31 00:00:00+00:00</span>
</span><span id=__span-68-4><a id=__codelineno-68-4 name=__codelineno-68-4 href=#__codelineno-68-4></a><span class=go>Index Length                                 1902</span>
</span><span id=__span-68-5><a id=__codelineno-68-5 name=__codelineno-68-5 href=#__codelineno-68-5></a><span class=go>Splits                                          6</span>
</span><span id=__span-68-6><a id=__codelineno-68-6 name=__codelineno-68-6 href=#__codelineno-68-6></a><span class=go>Sets                                            1</span>
</span><span id=__span-68-7><a id=__codelineno-68-7 name=__codelineno-68-7 href=#__codelineno-68-7></a><span class=go>Coverage [%]                                100.0</span>
</span><span id=__span-68-8><a id=__codelineno-68-8 name=__codelineno-68-8 href=#__codelineno-68-8></a><span class=go>Overlap Coverage [%]                          0.0</span>
</span><span id=__span-68-9><a id=__codelineno-68-9 name=__codelineno-68-9 href=#__codelineno-68-9></a><span class=go>Name: agg_stats, dtype: object</span>
</span><span id=__span-68-10><a id=__codelineno-68-10 name=__codelineno-68-10 href=#__codelineno-68-10></a>
</span><span id=__span-68-11><a id=__codelineno-68-11 name=__codelineno-68-11 href=#__codelineno-68-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>plots</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/plots1.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/plots1.dark.svg#only-dark></p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Since there is only one split, most metrics are hidden from the statistics.</p> </div> <p>As we have seen, you can select specific splits and sets using standard Pandas indexing (which is another great feature of <a href=https://vectorbt.pro/pvt_41531c19/documentation/building-blocks/#analyzing>Analyzable</a>). Since we are not interested in incomplete years, let's remove the first and last splits:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-69-1><a id=__codelineno-69-1 name=__codelineno-69-1 href=#__codelineno-69-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span> <span class=o>=</span> <span class=n>splitter</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=mi>1</span><span class=p>:</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span><span id=__span-69-2><a id=__codelineno-69-2 name=__codelineno-69-2 href=#__codelineno-69-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>stats</span><span class=p>()</span>
</span><span id=__span-69-3><a id=__codelineno-69-3 name=__codelineno-69-3 href=#__codelineno-69-3></a><span class=go>Index Start             2017-08-17 00:00:00+00:00</span>
</span><span id=__span-69-4><a id=__codelineno-69-4 name=__codelineno-69-4 href=#__codelineno-69-4></a><span class=go>Index End               2022-10-31 00:00:00+00:00</span>
</span><span id=__span-69-5><a id=__codelineno-69-5 name=__codelineno-69-5 href=#__codelineno-69-5></a><span class=go>Index Length                                 1902</span>
</span><span id=__span-69-6><a id=__codelineno-69-6 name=__codelineno-69-6 href=#__codelineno-69-6></a><span class=go>Splits                                          4  &lt;&lt; changed</span>
</span><span id=__span-69-7><a id=__codelineno-69-7 name=__codelineno-69-7 href=#__codelineno-69-7></a><span class=go>Sets                                            1</span>
</span><span id=__span-69-8><a id=__codelineno-69-8 name=__codelineno-69-8 href=#__codelineno-69-8></a><span class=go>Coverage [%]                             76.81388  &lt;&lt; changed</span>
</span><span id=__span-69-9><a id=__codelineno-69-9 name=__codelineno-69-9 href=#__codelineno-69-9></a><span class=go>Overlap Coverage [%]                          0.0</span>
</span><span id=__span-69-10><a id=__codelineno-69-10 name=__codelineno-69-10 href=#__codelineno-69-10></a><span class=go>Name: agg_stats, dtype: object</span>
</span></code></pre></div> <p>Now, let's split the only set into three: a train set covering the first two quarters, a validation set covering the third quarter, and a test set covering the last quarter. This is possible using the method <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.split_set>Splitter.split_set</a>, which accepts the split specification and the labels for the new sets as <code>new_split</code> and <code>new_set_labels</code>, respectively. We will use a function template to divide the set:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-70-1><a id=__codelineno-70-1 name=__codelineno-70-1 href=#__codelineno-70-1></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>new_split</span><span class=p>(</span><span class=n>index</span><span class=p>):</span>  <span class=c1># (1)!</span>
</span><span id=__span-70-2><a id=__codelineno-70-2 name=__codelineno-70-2 href=#__codelineno-70-2></a><span class=gp>... </span>    <span class=k>return</span> <span class=p>[</span>
</span><span id=__span-70-3><a id=__codelineno-70-3 name=__codelineno-70-3 href=#__codelineno-70-3></a><span class=gp>... </span>        <span class=n>np</span><span class=o>.</span><span class=n>isin</span><span class=p>(</span><span class=n>index</span><span class=o>.</span><span class=n>quarter</span><span class=p>,</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>]),</span>  <span class=c1># (2)!</span>
</span><span id=__span-70-4><a id=__codelineno-70-4 name=__codelineno-70-4 href=#__codelineno-70-4></a><span class=gp>... </span>        <span class=n>index</span><span class=o>.</span><span class=n>quarter</span> <span class=o>==</span> <span class=mi>3</span><span class=p>,</span> 
</span><span id=__span-70-5><a id=__codelineno-70-5 name=__codelineno-70-5 href=#__codelineno-70-5></a><span class=gp>... </span>        <span class=n>index</span><span class=o>.</span><span class=n>quarter</span> <span class=o>==</span> <span class=mi>4</span>
</span><span id=__span-70-6><a id=__codelineno-70-6 name=__codelineno-70-6 href=#__codelineno-70-6></a><span class=gp>... </span>    <span class=p>]</span>
</span><span id=__span-70-7><a id=__codelineno-70-7 name=__codelineno-70-7 href=#__codelineno-70-7></a>
</span><span id=__span-70-8><a id=__codelineno-70-8 name=__codelineno-70-8 href=#__codelineno-70-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span> <span class=o>=</span> <span class=n>splitter</span><span class=o>.</span><span class=n>split_set</span><span class=p>(</span>
</span><span id=__span-70-9><a id=__codelineno-70-9 name=__codelineno-70-9 href=#__codelineno-70-9></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>RepFunc</span><span class=p>(</span><span class=n>new_split</span><span class=p>),</span>  <span class=c1># (3)!</span>
</span><span id=__span-70-10><a id=__codelineno-70-10 name=__codelineno-70-10 href=#__codelineno-70-10></a><span class=gp>... </span>    <span class=n>new_set_labels</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;train&quot;</span><span class=p>,</span> <span class=s2>&quot;valid&quot;</span><span class=p>,</span> <span class=s2>&quot;test&quot;</span><span class=p>]</span>  <span class=c1># (4)!</span>
</span><span id=__span-70-11><a id=__codelineno-70-11 name=__codelineno-70-11 href=#__codelineno-70-11></a><span class=gp>... </span><span class=p>)</span>
</span></code></pre></div> <ol> <li><code>index</code> will be recognized as an argument and replaced with the index covered by the original set. Why not the entire index? Because we are only splitting a subset of it.</li> <li><code>index.quarter</code> returns a NumPy array with the quarter number for each date.</li> <li>We can use a template here because it is accepted by <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.split_range>Splitter.split_range</a>, which is used to split each range of the original set.</li> <li>These labels should include only the labels for the new sets.</li> </ol> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Each operation on a splitter returns a new splitter: no information is changed in place, to avoid interfering with caching and to keep the splitter (like any other VBT object) side effect free.</p> </div> <p>Take a look at the new splitter:</p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-71-1><a id=__codelineno-71-1 name=__codelineno-71-1 href=#__codelineno-71-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>stats</span><span class=p>()</span>
</span><span id=__span-71-2><a id=__codelineno-71-2 name=__codelineno-71-2 href=#__codelineno-71-2></a><span class=go>Index Start                     2017-08-17 00:00:00+00:00</span>
</span><span id=__span-71-3><a id=__codelineno-71-3 name=__codelineno-71-3 href=#__codelineno-71-3></a><span class=go>Index End                       2022-10-31 00:00:00+00:00</span>
</span><span id=__span-71-4><a id=__codelineno-71-4 name=__codelineno-71-4 href=#__codelineno-71-4></a><span class=go>Index Length                                         1902</span>
</span><span id=__span-71-5><a id=__codelineno-71-5 name=__codelineno-71-5 href=#__codelineno-71-5></a><span class=go>Splits                                                  4</span>
</span><span id=__span-71-6><a id=__codelineno-71-6 name=__codelineno-71-6 href=#__codelineno-71-6></a><span class=go>Sets                                                    3</span>
</span><span id=__span-71-7><a id=__codelineno-71-7 name=__codelineno-71-7 href=#__codelineno-71-7></a><span class=go>Coverage [%]                                     76.81388</span>
</span><span id=__span-71-8><a id=__codelineno-71-8 name=__codelineno-71-8 href=#__codelineno-71-8></a><span class=go>Coverage [%]: train                             38.117771</span>
</span><span id=__span-71-9><a id=__codelineno-71-9 name=__codelineno-71-9 href=#__codelineno-71-9></a><span class=go>Coverage [%]: valid                             19.348055</span>
</span><span id=__span-71-10><a id=__codelineno-71-10 name=__codelineno-71-10 href=#__codelineno-71-10></a><span class=go>Coverage [%]: test                              19.348055</span>
</span><span id=__span-71-11><a id=__codelineno-71-11 name=__codelineno-71-11 href=#__codelineno-71-11></a><span class=go>Mean Rel Coverage [%]: train                    49.623475</span>
</span><span id=__span-71-12><a id=__codelineno-71-12 name=__codelineno-71-12 href=#__codelineno-71-12></a><span class=go>Mean Rel Coverage [%]: valid                    25.188263</span>
</span><span id=__span-71-13><a id=__codelineno-71-13 name=__codelineno-71-13 href=#__codelineno-71-13></a><span class=go>Mean Rel Coverage [%]: test                     25.188263</span>
</span><span id=__span-71-14><a id=__codelineno-71-14 name=__codelineno-71-14 href=#__codelineno-71-14></a><span class=go>Overlap Coverage [%]                                  0.0</span>
</span><span id=__span-71-15><a id=__codelineno-71-15 name=__codelineno-71-15 href=#__codelineno-71-15></a><span class=go>Overlap Coverage [%]: train                           0.0</span>
</span><span id=__span-71-16><a id=__codelineno-71-16 name=__codelineno-71-16 href=#__codelineno-71-16></a><span class=go>Overlap Coverage [%]: valid                           0.0</span>
</span><span id=__span-71-17><a id=__codelineno-71-17 name=__codelineno-71-17 href=#__codelineno-71-17></a><span class=go>Overlap Coverage [%]: test                            0.0</span>
</span><span id=__span-71-18><a id=__codelineno-71-18 name=__codelineno-71-18 href=#__codelineno-71-18></a><span class=go>Name: agg_stats, dtype: object</span>
</span><span id=__span-71-19><a id=__codelineno-71-19 name=__codelineno-71-19 href=#__codelineno-71-19></a>
</span><span id=__span-71-20><a id=__codelineno-71-20 name=__codelineno-71-20 href=#__codelineno-71-20></a><span class=gp>&gt;&gt;&gt; </span><span class=n>splitter</span><span class=o>.</span><span class=n>plots</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/plots2.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/tutorials/cv/plots2.dark.svg#only-dark></p> <p>As you might have guessed, there is also a method that can merge multiple sets: <a href=https://vectorbt.pro/pvt_41531c19/api/generic/splitting/base/#vectorbtpro.generic.splitting.base.Splitter.merge_sets>Splitter.merge_sets</a>. Your homework is to merge the "valid" and "test" sets into "test" <img alt=ðŸ˜‰ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f609.svg title=:wink:></p> <p>We have done our job perfectly, so let's move on to applications! <img alt=âœˆ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/2708.svg title=:airplane:></p> <p><a class=md-button href=https://vectorbt.pro/pvt_41531c19/assets/jupytext/tutorials/cross-validation/splitter.py.txt target=blank_><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19.14 7.5A2.86 2.86 0 0 1 22 10.36v3.78A2.86 2.86 0 0 1 19.14 17H12c0 .39.32.96.71.96H17v1.68a2.86 2.86 0 0 1-2.86 2.86H9.86A2.86 2.86 0 0 1 7 19.64v-3.75a2.85 2.85 0 0 1 2.86-2.85h5.25a2.85 2.85 0 0 0 2.85-2.86V7.5zm-4.28 11.79c-.4 0-.72.3-.72.89s.32.71.72.71a.71.71 0 0 0 .71-.71c0-.59-.32-.89-.71-.89m-10-1.79A2.86 2.86 0 0 1 2 14.64v-3.78A2.86 2.86 0 0 1 4.86 8H12c0-.39-.32-.96-.71-.96H7V5.36A2.86 2.86 0 0 1 9.86 2.5h4.28A2.86 2.86 0 0 1 17 5.36v3.75a2.85 2.85 0 0 1-2.86 2.85H8.89a2.85 2.85 0 0 0-2.85 2.86v2.68zM9.14 5.71c.4 0 .72-.3.72-.89s-.32-.71-.72-.71c-.39 0-.71.12-.71.71s.32.89.71.89"/></svg></span> Python code</a> <a class=md-button href=https://github.com/polakowo/vectorbt.pro/blob/notebooks/CrossValidation.ipynb target=blank_><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 4v6l-2-2-2 2V4H9v16h10V4zM3 7V5h2V4a2 2 0 0 1 2-2h12c1.05 0 2 .95 2 2v16c0 1.05-.95 2-2 2H7c-1.05 0-2-.95-2-2v-1H3v-2h2v-4H3v-2h2V7zm2-2v2h2V5zm0 14h2v-2H5zm0-6h2v-2H5z"/></svg></span> Notebook</a></p> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/cross-validation/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Cross-validation"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Cross-validation </div> </div> </a> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/cross-validation/applications/ class="md-footer__link md-footer__link--next" aria-label="Next: Applications"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Applications </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2021-2025 Oleg Polakow. All rights reserved. </div> </div> <div class=md-social> <a href=https://www.linkedin.com/in/polakowo target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> <a href=https://github.com/polakowo target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">Accept</button> <label class=md-button for=__settings>Manage settings</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script> <script id=__config type=application/json>{"annotate": null, "base": "../../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.instant", "navigation.instant.progress", "navigation.top", "navigation.prune", "navigation.path", "navigation.footer", "search.suggest", "search.share", "content.code.annotate", "content.code.copy", "content.code.select", "content.tooltips", "content.tabs.link", "toc.follow", "toc.integrate", "announce.dismiss"], "search": "../../../assets/javascripts/workers/search.26099bd0.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=https://vectorbt.pro/pvt_41531c19/assets/javascripts/bundle.9d1edc04.min.js></script> <script src=https://vectorbt.pro/pvt_41531c19/assets/scripts/extra.js></script> <script src=https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js></script> </body> 
<!-- Mirrored from vectorbt.pro/pvt_41531c19/tutorials/cross-validation/splitter/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 22 Nov 2025 03:46:47 GMT -->
</html>