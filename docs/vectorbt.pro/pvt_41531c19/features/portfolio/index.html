<!doctype html><html lang=en class=no-js> 
<!-- Mirrored from vectorbt.pro/pvt_41531c19/features/portfolio/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 22 Nov 2025 03:46:36 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Portfolio features of VectorBT PRO"><meta name=author content="Oleg Polakow"><link href=https://vectorbt.pro/features/portfolio/ rel=canonical><link href=../performance/index.html rel=prev><link href=../productivity/index.html rel=next><link rel=icon href=../../assets/logo/favicon.png><meta name=generator content="mkdocs-1.6.0, mkdocs-material-9.6.21+insiders-4.53.17"><title>Portfolio - VectorBT® PRO</title><link rel=stylesheet href=../../assets/stylesheets/main.010a373c.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=../../../../fonts.gstatic.com/index.html crossorigin><link rel=stylesheet href="../../../../fonts.googleapis.com/cssbe43.css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/stylesheets/extra.css><link rel=stylesheet href=../../assets/stylesheets/custom-light.css><link rel=stylesheet href=../../assets/stylesheets/custom-dark.css><link rel=stylesheet href=../../assets/stylesheets/pygments-light.css><link rel=stylesheet href=../../assets/stylesheets/pygments-dark.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-0C5VNYCFHL"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-0C5VNYCFHL",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="../../../../www.googletagmanager.com/gtag/jsc6c8?id=G-0C5VNYCFHL",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script><meta name=robots content="noindex, nofollow"><meta property=og:title content=Portfolio><meta property=og:type content=website><meta content=https://vectorbt.pro/features/portfolio/ property=og:url><meta property=og:image:url content=https://vectorbt.pro/pvt_41531c19/assets/logo/social-new.png><meta property=og:image:type content=image/png><meta property=og:description content="Portfolio features of VectorBT PRO"><meta property=og:locale content=en-GB><link rel=apple-touch-icon sizes=180x180 href=https://vectorbt.pro/pvt_41531c19/assets/logo/apple-touch-icon.png><link rel=icon type=image/svg+xml href=https://vectorbt.pro/pvt_41531c19/assets/logo/favicon.svg><link rel=icon type=image/png sizes=32x32 href=https://vectorbt.pro/pvt_41531c19/assets/logo/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://vectorbt.pro/pvt_41531c19/assets/logo/favicon-16x16.png><link rel=manifest href=https://vectorbt.pro/pvt_41531c19/assets/logo/site.webmanifest><link rel=mask-icon href=https://vectorbt.pro/pvt_41531c19/assets/logo/safari-pinned-tab.svg color=#1e1f22><link rel="shortcut icon" href=https://vectorbt.pro/pvt_41531c19/assets/logo/favicon.ico><meta name=msapplication-TileColor content=#1e1f22><meta name=msapplication-config content=https://vectorbt.pro/pvt_41531c19/assets/logo/browserconfig.xml><meta name=theme-color content=#1e1f22><link href=https://unpkg.com/aos@2.3.4/dist/aos.css rel=stylesheet><script src=https://unpkg.com/aos@2.3.4/dist/aos.js></script><link href=http://fonts.cdnfonts.com/css/uni-neue rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" crossorigin=anonymous referrerpolicy=no-referrer><script src=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/js/all.min.js integrity="sha512-8pHNiqTlsrRjVD4A/3va++W1sMbUHwWxxRPWNyVlql3T+Hgfd81Qc6FC5WMXDC+tSauxxzp1tgiAvSKFu1qIlA==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js integrity="sha512-q583ppKrCRc7N5O0n2nzUiJ+suUv7Et1JGels4bXOaMFQcamPk9HjdUknZuuFjBNs7tsMuadge5k9RzdmO+1GQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><link rel=preconnect href=https://fonts.googleapis.com/><link rel=preconnect href=https://fonts.gstatic.com/ crossorigin></head> <body dir=ltr data-md-color-scheme=custom-dark data-md-color-primary=custom-dark data-md-color-accent=custom-dark> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#portfolio class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <button class="md-banner__button md-icon" aria-label="Don't show this again"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> <i>What's new</i>: New LLM providers, reasoning steps, function calling, YAML & TOML support, and <a href=https://vectorbt.pro/pvt_41531c19/getting-started/release-notes><strong>more</strong></a> <span class="twemoji announce-icon"><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="m153.6 29.9 16-21.3c4-5.4 10.4-8.6 17.1-8.6C198.4 0 208 9.6 208 21.3v22.1c0 13.1 5.4 25.7 14.9 34.7l84.7 80.9c48.8 46.6 76.4 111.2 76.4 178.7C384 434 306 512 209.7 512H192C86 512 0 426 0 320v-3.8c0-48.8 19.4-95.6 53.9-130.1l3.5-3.5c4.2-4.2 10-6.6 16-6.6 12.5 0 22.6 10.1 22.6 22.6V288c0 35.3 28.7 64 64 64s64-28.7 64-64v-3.9c0-18-7.2-35.3-19.9-48l-38.6-38.6c-24-24-37.5-56.7-37.5-90.7 0-27.7 9-54.8 25.6-76.9"/></svg></span> </div> <script>var el=document.querySelector("[data-md-component=announce]");if(el){var content=el.querySelector(".md-typeset");__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0)}</script> </aside> </div> <!-- Determine class according to configuration --> <!-- Header --> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=header.title> <!-- Link to home --> <a href=https://vectorbt.pro/pvt_41531c19/ title="VectorBT® PRO" class="md-header__button md-logo" aria-label="VectorBT® PRO" data-md-component=logo> <img src=https://vectorbt.pro/pvt_41531c19/assets/logo/logo.svg alt=logo class=logo> </a> <!-- Button to open drawer --> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <!-- Header title --> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> VectorBT® PRO <span class=md-version> v2025.10.15 </span> <span class=unlock-icon><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M192 32c-35.3 0-64 28.7-64 64v64h192c35.3 0 64 28.7 64 64v224c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V224c0-35.3 28.7-64 64-64V96c0-70.7 57.3-128 128-128 63.5 0 116.1 46.1 126.2 106.7 2.9 17.4-8.8 33.9-26.3 36.9S258 102.8 255 85.3C250 55.1 223.7 32 192 32m40 328c13.3 0 24-10.7 24-24s-10.7-24-24-24h-80c-13.3 0-24 10.7-24 24s10.7 24 24 24z"/></svg></span> </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Portfolio </span> </div> </div> </div> <!-- Color palette --> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=custom-dark data-md-color-primary=custom-dark data-md-color-accent=custom-dark aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=custom-light data-md-color-primary=custom-light data-md-color-accent=custom-light aria-label="Switch to dark mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <!-- Site language selector --> <!-- Button to open search modal --> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <!-- Search interface --> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <!-- Repository information --> <div class=md-header__source> <a href=https://github.com/polakowo/vectorbt.pro title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> vectorbt.pro </div> </a> </div> </nav> <!-- Navigation tabs (sticky) --> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/ class=md-tabs__link> Getting started </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=https://vectorbt.pro/pvt_41531c19/features/overview/ class=md-tabs__link> Features </a> </li> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/overview/ class=md-tabs__link> Tutorials </a> </li> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/documentation/overview/ class=md-tabs__link> Documentation </a> </li> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/cookbook/overview/ class=md-tabs__link> Cookbook </a> </li> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/api/ class=md-tabs__link> API </a> </li> <li class=md-tabs__item> <a href=https://vectorbt.pro/pvt_41531c19/terms/terms-of-use/ class=md-tabs__link> Terms </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://vectorbt.pro/pvt_41531c19/ title="VectorBT® PRO" class="md-nav__button md-logo" aria-label="VectorBT® PRO" data-md-component=logo> <img src=https://vectorbt.pro/pvt_41531c19/assets/logo/logo.svg alt=logo class=logo> </a> VectorBT® PRO </label> <div class=md-nav__source> <a href=https://github.com/polakowo/vectorbt.pro title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> vectorbt.pro </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/ class=md-nav__link> <span class=md-ellipsis> Getting started </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> Features </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Features </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/features/overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/features/analysis/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M7.2 11.2c1.77 0 3.2 1.43 3.2 3.2s-1.43 3.2-3.2 3.2S4 16.17 4 14.4s1.43-3.2 3.2-3.2m7.6 4.8a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2m.4-12A4.8 4.8 0 0 1 20 8.8c0 2.65-2.15 4.8-4.8 4.8a4.8 4.8 0 0 1-4.8-4.8c0-2.65 2.15-4.8 4.8-4.8"/></svg> <span class=md-ellipsis> Analysis </span> </a> </li> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/features/data/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 3C7.58 3 4 4.79 4 7s3.58 4 8 4 8-1.79 8-4-3.58-4-8-4M4 9v3c0 2.21 3.58 4 8 4s8-1.79 8-4V9c0 2.21-3.58 4-8 4s-8-1.79-8-4m0 5v3c0 2.21 3.58 4 8 4s8-1.79 8-4v-3c0 2.21-3.58 4-8 4s-8-1.79-8-4"/></svg> <span class=md-ellipsis> Data </span> </a> </li> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/features/indicators/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m3 14 .5.07L8.07 9.5a1.95 1.95 0 0 1 .52-1.91c.78-.79 2.04-.79 2.82 0 .53.52.7 1.26.52 1.91l2.57 2.57.5-.07c.18 0 .35 0 .5.07l3.57-3.57C19 8.35 19 8.18 19 8a2 2 0 0 1 2-2 2 2 0 0 1 2 2 2 2 0 0 1-2 2c-.18 0-.35 0-.5-.07l-3.57 3.57c.07.15.07.32.07.5a2 2 0 0 1-2 2 2 2 0 0 1-2-2l.07-.5-2.57-2.57c-.32.07-.68.07-1 0L4.93 15.5 5 16a2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2"/></svg> <span class=md-ellipsis> Indicators </span> </a> </li> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/features/intelligence/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21.33 12.91c.09 1.55-.62 3.04-1.89 3.95l.77 1.49c.23.45.26.98.06 1.45-.19.47-.58.84-1.06 1l-.79.25a1.687 1.687 0 0 1-1.86-.55L14.44 18c-.89-.15-1.73-.53-2.44-1.1-.5.15-1 .23-1.5.23-.88 0-1.76-.27-2.5-.79-.53.16-1.07.23-1.62.22-.79.01-1.57-.15-2.3-.45a4.1 4.1 0 0 1-2.43-3.61c-.08-.72.04-1.45.35-2.11-.29-.75-.32-1.57-.07-2.33C2.3 7.11 3 6.32 3.87 5.82c.58-1.69 2.21-2.82 4-2.7 1.6-1.5 4.05-1.66 5.83-.37.42-.11.86-.17 1.3-.17 1.36-.03 2.65.57 3.5 1.64 2.04.53 3.5 2.35 3.58 4.47.05 1.11-.25 2.2-.86 3.13.07.36.11.72.11 1.09m-5-1.41c.57.07 1.02.5 1.02 1.07a1 1 0 0 1-1 1h-.63c-.32.9-.88 1.69-1.62 2.29.25.09.51.14.77.21 5.13-.07 4.53-3.2 4.53-3.25a2.59 2.59 0 0 0-2.69-2.49 1 1 0 0 1-1-1 1 1 0 0 1 1-1c1.23.03 2.41.49 3.33 1.3.05-.29.08-.59.08-.89-.06-1.24-.62-2.32-2.87-2.53-1.25-2.96-4.4-1.32-4.4-.4-.03.23.21.72.25.75a1 1 0 0 1 1 1c0 .55-.45 1-1 1-.53-.02-1.03-.22-1.43-.56-.48.31-1.03.5-1.6.56-.57.05-1.04-.35-1.07-.9a.97.97 0 0 1 .88-1.1c.16-.02.94-.14.94-.77 0-.66.25-1.29.68-1.79-.92-.25-1.91.08-2.91 1.29C6.75 5 6 5.25 5.45 7.2 4.5 7.67 4 8 3.78 9c1.08-.22 2.19-.13 3.22.25.5.19.78.75.59 1.29-.19.52-.77.78-1.29.59-.73-.32-1.55-.34-2.3-.06-.32.27-.32.83-.32 1.27 0 .74.37 1.43 1 1.83.53.27 1.12.41 1.71.4q-.225-.39-.39-.81a1.038 1.038 0 0 1 1.96-.68c.4 1.14 1.42 1.92 2.62 2.05 1.37-.07 2.59-.88 3.19-2.13.23-1.38 1.34-1.5 2.56-1.5m2 7.47-.62-1.3-.71.16 1 1.25zm-4.65-8.61a1 1 0 0 0-.91-1.03c-.71-.04-1.4.2-1.93.67-.57.58-.87 1.38-.84 2.19a1 1 0 0 0 1 1c.57 0 1-.45 1-1 0-.27.07-.54.23-.76.12-.1.27-.15.43-.15.55.03 1.02-.38 1.02-.92"/></svg> <span class=md-ellipsis> Intelligence </span> </a> </li> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/features/optimization/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16h-.58l-.81-.81A7.07 7.07 0 0 0 18 11c0-3.87-3.13-7-7-7-1.5 0-3 .5-4.21 1.4-3.09 2.32-3.72 6.71-1.4 9.8s6.71 3.72 9.8 1.4l.81.81V18l5 5 2-2zm-7 0c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5M3 6 1 8V1h7L6 3H3zm18-5v7l-2-2V3h-3l-2-2zM6 19l2 2H1v-7l2 2v3z"/></svg> <span class=md-ellipsis> Optimization </span> </a> </li> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/features/performance/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 16a3 3 0 0 1-3-3c0-1.12.61-2.1 1.5-2.61l9.71-5.62-5.53 9.58c-.5.98-1.51 1.65-2.68 1.65m0-13c1.81 0 3.5.5 4.97 1.32l-2.1 1.21C14 5.19 13 5 12 5a8 8 0 0 0-8 8c0 2.21.89 4.21 2.34 5.65h.01c.39.39.39 1.02 0 1.41s-1.03.39-1.42.01A9.97 9.97 0 0 1 2 13 10 10 0 0 1 12 3m10 10c0 2.76-1.12 5.26-2.93 7.07-.39.38-1.02.38-1.41-.01a.996.996 0 0 1 0-1.41A7.95 7.95 0 0 0 20 13c0-1-.19-2-.54-2.9L20.67 8C21.5 9.5 22 11.18 22 13"/></svg> <span class=md-ellipsis> Performance </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17.45 15.18 22 7.31V21H2V3h2v12.54L9.5 6 16 9.78l4.24-7.33 1.73 1-5.23 9.05-6.51-3.75L4.31 19h2.26l4.39-7.56z"/></svg> <span class=md-ellipsis> Portfolio </span> <span class="md-nav__icon md-icon"></span> </label> <a href=https://vectorbt.pro/pvt_41531c19/features/portfolio/ class="md-nav__link md-nav__link--active"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17.45 15.18 22 7.31V21H2V3h2v12.54L9.5 6 16 9.78l4.24-7.33 1.73 1-5.23 9.05-6.51-3.75L4.31 19h2.26l4.39-7.56z"/></svg> <span class=md-ellipsis> Portfolio </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#asset-weighting class=md-nav__link> <span class=md-ellipsis> Asset weighting </span> </a> </li> <li class=md-nav__item> <a href=#position-views class=md-nav__link> <span class=md-ellipsis> Position views </span> </a> </li> <li class=md-nav__item> <a href=#index-records class=md-nav__link> <span class=md-ellipsis> Index records </span> </a> </li> <li class=md-nav__item> <a href=#portfolio-preparers class=md-nav__link> <span class=md-ellipsis> Portfolio preparers </span> </a> </li> <li class=md-nav__item> <a href=#stop-laddering class=md-nav__link> <span class=md-ellipsis> Stop laddering </span> </a> </li> <li class=md-nav__item> <a href=#staticization class=md-nav__link> <span class=md-ellipsis> Staticization </span> </a> </li> <li class=md-nav__item> <a href=#position-info class=md-nav__link> <span class=md-ellipsis> Position info </span> </a> </li> <li class=md-nav__item> <a href=#time-stops class=md-nav__link> <span class=md-ellipsis> Time stops </span> </a> </li> <li class=md-nav__item> <a href=#target-size-to-signals class=md-nav__link> <span class=md-ellipsis> Target size to signals </span> </a> </li> <li class=md-nav__item> <a href=#target-price class=md-nav__link> <span class=md-ellipsis> Target price </span> </a> </li> <li class=md-nav__item> <a href=#leverage class=md-nav__link> <span class=md-ellipsis> Leverage </span> </a> </li> <li class=md-nav__item> <a href=#order-delays class=md-nav__link> <span class=md-ellipsis> Order delays </span> </a> </li> <li class=md-nav__item> <a href=#signal-callbacks class=md-nav__link> <span class=md-ellipsis> Signal callbacks </span> </a> </li> <li class=md-nav__item> <a href=#limit-orders class=md-nav__link> <span class=md-ellipsis> Limit orders </span> </a> </li> <li class=md-nav__item> <a href=#delta-formats class=md-nav__link> <span class=md-ellipsis> Delta formats </span> </a> </li> <li class=md-nav__item> <a href=#bar-skipping class=md-nav__link> <span class=md-ellipsis> Bar skipping </span> </a> </li> <li class=md-nav__item> <a href=#signal-contexts class=md-nav__link> <span class=md-ellipsis> Signal contexts </span> </a> </li> <li class=md-nav__item> <a href=#pre-computation class=md-nav__link> <span class=md-ellipsis> Pre-computation </span> </a> </li> <li class=md-nav__item> <a href=#cash-deposits class=md-nav__link> <span class=md-ellipsis> Cash deposits </span> </a> </li> <li class=md-nav__item> <a href=#cash-earnings class=md-nav__link> <span class=md-ellipsis> Cash earnings </span> </a> </li> <li class=md-nav__item> <a href=#in-place-outputs class=md-nav__link> <span class=md-ellipsis> In-place outputs </span> </a> </li> <li class=md-nav__item> <a href=#flexible-attributes class=md-nav__link> <span class=md-ellipsis> Flexible attributes </span> </a> </li> <li class=md-nav__item> <a href=#shortcut-properties class=md-nav__link> <span class=md-ellipsis> Shortcut properties </span> </a> </li> <li class=md-nav__item> <a href=#and-many-more class=md-nav__link> <span class=md-ellipsis> And many more... </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=https://vectorbt.pro/pvt_41531c19/features/productivity/ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 16.5c0 .38-.21.71-.53.88l-7.9 4.44c-.16.12-.36.18-.57.18s-.41-.06-.57-.18l-7.9-4.44A.99.99 0 0 1 3 16.5v-9c0-.38.21-.71.53-.88l7.9-4.44c.16-.12.36-.18.57-.18s.41.06.57.18l7.9 4.44c.32.17.53.5.53.88zM12 7a5 5 0 0 0-5 5 5 5 0 0 0 5 5 5 5 0 0 0 5-5 5 5 0 0 0-5-5"/></svg> <span class=md-ellipsis> Productivity </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/tutorials/overview/ class=md-nav__link> <span class=md-ellipsis> Tutorials </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/documentation/overview/ class=md-nav__link> <span class=md-ellipsis> Documentation </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/cookbook/overview/ class=md-nav__link> <span class=md-ellipsis> Cookbook </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/api/ class=md-nav__link> <span class=md-ellipsis> API </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=https://vectorbt.pro/pvt_41531c19/terms/terms-of-use/ class=md-nav__link> <span class=md-ellipsis> Terms </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=portfolio><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17.45 15.18 22 7.31V21H2V3h2v12.54L9.5 6 16 9.78l4.24-7.33 1.73 1-5.23 9.05-6.51-3.75L4.31 19h2.26l4.39-7.56z"/></svg></span> Portfolio<a class=headerlink href=#portfolio title="Permanent link">&para;</a></h1> <h2 id=asset-weighting>Asset weighting<a class=headerlink href=#asset-weighting title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/badges/new-in/v2024_8_20.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Asset weighting lets you fine-tune the influence of individual assets or strategies within your portfolio, giving you enhanced control over your portfolio's overall performance. The key benefit is that these weights are not limited to returns—they are consistently applied to all time series and metrics, including orders, cash flows, and more. This comprehensive approach ensures that every aspect of your portfolio stays precisely aligned.</li> </ul> <div class="language-pycon highlight"><span class=filename>Maximize Sharpe of a random portfolio</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>([</span><span class=s2>&quot;AAPL&quot;</span><span class=p>,</span> <span class=s2>&quot;MSFT&quot;</span><span class=p>,</span> <span class=s2>&quot;GOOG&quot;</span><span class=p>],</span> <span class=n>start</span><span class=o>=</span><span class=s2>&quot;2020&quot;</span><span class=p>)</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;from_random_signals&quot;</span><span class=p>,</span> <span class=n>n</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Default</span><span class=p>(</span><span class=mi>50</span><span class=p>),</span> <span class=n>seed</span><span class=o>=</span><span class=mi>42</span><span class=p>,</span> <span class=n>group_by</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>get_sharpe_ratio</span><span class=p>(</span><span class=n>group_by</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=go>symbol</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=go>AAPL    1.401012</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=go>MSFT    0.456162</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=go>GOOG    0.852490</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=go>Name: sharpe_ratio, dtype: float64</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>sharpe_ratio</span>  <span class=c1># (2)!</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=go>1.2132857343006869</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=gp>&gt;&gt;&gt; </span><span class=n>prices</span> <span class=o>=</span> <span class=n>pf</span><span class=o>.</span><span class=n>get_value</span><span class=p>(</span><span class=n>group_by</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=gp>&gt;&gt;&gt; </span><span class=n>weights</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pypfopt_optimize</span><span class=p>(</span><span class=n>prices</span><span class=o>=</span><span class=n>prices</span><span class=p>)</span>  <span class=c1># (3)!</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=gp>&gt;&gt;&gt; </span><span class=n>weights</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a><span class=go>{&#39;AAPL&#39;: 0.85232, &#39;MSFT&#39;: 0.0, &#39;GOOG&#39;: 0.14768}</span>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a><span class=gp>&gt;&gt;&gt; </span><span class=n>weighted_pf</span> <span class=o>=</span> <span class=n>pf</span><span class=o>.</span><span class=n>apply_weights</span><span class=p>(</span><span class=n>weights</span><span class=p>,</span> <span class=n>rescale</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>  <span class=c1># (4)!</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a><span class=gp>&gt;&gt;&gt; </span><span class=n>weighted_pf</span><span class=o>.</span><span class=n>weights</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a><span class=go>symbol</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a><span class=go>AAPL    2.55696</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a><span class=go>MSFT    0.00000</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a><span class=go>GOOG    0.44304</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a><span class=go>dtype: float64</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26 href=#__codelineno-0-26></a><span class=gp>&gt;&gt;&gt; </span><span class=n>weighted_pf</span><span class=o>.</span><span class=n>get_sharpe_ratio</span><span class=p>(</span><span class=n>group_by</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>  <span class=c1># (5)!</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27 href=#__codelineno-0-27></a><span class=go>1.426112580298898</span>
</span></code></pre></div> <ol> <li>Sharpe ratio for each individual asset.</li> <li>Sharpe ratio for the combined portfolio. The goal is to maximize this value.</li> <li>Maximize Sharpe based on equity (that is, portfolio value) development.</li> <li>Rescale the weights for multiplication and create a new portfolio with the weights applied.</li> <li>Sharpe ratio for the optimized portfolio.</li> </ol> <h2 id=position-views>Position views<a class=headerlink href=#position-views title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/badges/new-in/v2024_8_20.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Position views let you analyze your portfolio by focusing on either long or short positions, providing a clear and distinct perspective for each investment strategy.</li> </ul> <div class="language-pycon highlight"><span class=filename>Separate long and short positions of a basic SMA crossover portfolio</span><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>)</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fast_sma</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;talib_func:sma&quot;</span><span class=p>,</span> <span class=n>timeperiod</span><span class=o>=</span><span class=mi>20</span><span class=p>)</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>slow_sma</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;talib_func:sma&quot;</span><span class=p>,</span> <span class=n>timeperiod</span><span class=o>=</span><span class=mi>50</span><span class=p>)</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>long_entries</span> <span class=o>=</span> <span class=n>fast_sma</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>crossed_above</span><span class=p>(</span><span class=n>slow_sma</span><span class=p>)</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>short_entries</span> <span class=o>=</span> <span class=n>fast_sma</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>crossed_below</span><span class=p>(</span><span class=n>slow_sma</span><span class=p>)</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_signals</span><span class=p>(</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=gp>... </span>    <span class=n>data</span><span class=p>,</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=gp>... </span>    <span class=n>long_entries</span><span class=o>=</span><span class=n>long_entries</span><span class=p>,</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=gp>... </span>    <span class=n>short_entries</span><span class=o>=</span><span class=n>short_entries</span><span class=p>,</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=gp>... </span>    <span class=n>fees</span><span class=o>=</span><span class=mf>0.01</span><span class=p>,</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=gp>... </span>    <span class=n>fixed_fees</span><span class=o>=</span><span class=mf>1.0</span>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a>
</span><span id=__span-1-14><a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=gp>&gt;&gt;&gt; </span><span class=n>long_pf</span> <span class=o>=</span> <span class=n>pf</span><span class=o>.</span><span class=n>long_view</span>
</span><span id=__span-1-15><a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a><span class=gp>&gt;&gt;&gt; </span><span class=n>short_pf</span> <span class=o>=</span> <span class=n>pf</span><span class=o>.</span><span class=n>short_view</span>
</span><span id=__span-1-16><a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a>
</span><span id=__span-1-17><a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>make_subplots</span><span class=p>(</span><span class=n>rows</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>cols</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>shared_xaxes</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>vertical_spacing</span><span class=o>=</span><span class=mf>0.01</span><span class=p>)</span>
</span><span id=__span-1-18><a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span> <span class=o>=</span> <span class=n>long_pf</span><span class=o>.</span><span class=n>assets</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot_against</span><span class=p>(</span>
</span><span id=__span-1-19><a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a><span class=gp>... </span>    <span class=mi>0</span><span class=p>,</span> 
</span><span id=__span-1-20><a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a><span class=gp>... </span>    <span class=n>trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&quot;Long position&quot;</span><span class=p>,</span> <span class=n>line_shape</span><span class=o>=</span><span class=s2>&quot;hv&quot;</span><span class=p>,</span> <span class=n>line_color</span><span class=o>=</span><span class=s2>&quot;mediumseagreen&quot;</span><span class=p>),</span>
</span><span id=__span-1-21><a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a><span class=gp>... </span>    <span class=n>other_trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>visible</span><span class=o>=</span><span class=kc>False</span><span class=p>),</span>
</span><span id=__span-1-22><a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a><span class=gp>... </span>    <span class=n>add_trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>row</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>col</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span>
</span><span id=__span-1-23><a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a><span class=gp>... </span>    <span class=n>fig</span><span class=o>=</span><span class=n>fig</span>
</span><span id=__span-1-24><a id=__codelineno-1-24 name=__codelineno-1-24 href=#__codelineno-1-24></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-1-25><a id=__codelineno-1-25 name=__codelineno-1-25 href=#__codelineno-1-25></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span> <span class=o>=</span> <span class=n>short_pf</span><span class=o>.</span><span class=n>assets</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot_against</span><span class=p>(</span>
</span><span id=__span-1-26><a id=__codelineno-1-26 name=__codelineno-1-26 href=#__codelineno-1-26></a><span class=gp>... </span>    <span class=mi>0</span><span class=p>,</span> 
</span><span id=__span-1-27><a id=__codelineno-1-27 name=__codelineno-1-27 href=#__codelineno-1-27></a><span class=gp>... </span>    <span class=n>trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&quot;Short position&quot;</span><span class=p>,</span> <span class=n>line_shape</span><span class=o>=</span><span class=s2>&quot;hv&quot;</span><span class=p>,</span> <span class=n>line_color</span><span class=o>=</span><span class=s2>&quot;coral&quot;</span><span class=p>),</span>
</span><span id=__span-1-28><a id=__codelineno-1-28 name=__codelineno-1-28 href=#__codelineno-1-28></a><span class=gp>... </span>    <span class=n>other_trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>visible</span><span class=o>=</span><span class=kc>False</span><span class=p>),</span> 
</span><span id=__span-1-29><a id=__codelineno-1-29 name=__codelineno-1-29 href=#__codelineno-1-29></a><span class=gp>... </span>    <span class=n>add_trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>row</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>col</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span>
</span><span id=__span-1-30><a id=__codelineno-1-30 name=__codelineno-1-30 href=#__codelineno-1-30></a><span class=gp>... </span>    <span class=n>fig</span><span class=o>=</span><span class=n>fig</span>
</span><span id=__span-1-31><a id=__codelineno-1-31 name=__codelineno-1-31 href=#__codelineno-1-31></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-1-32><a id=__codelineno-1-32 name=__codelineno-1-32 href=#__codelineno-1-32></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/features/position_views.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/features/position_views.dark.svg#only-dark></p> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>long_pf</span><span class=o>.</span><span class=n>sharpe_ratio</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=go>0.9185961894435091</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>short_pf</span><span class=o>.</span><span class=n>sharpe_ratio</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=go>0.2760864152147919</span>
</span></code></pre></div> <h2 id=index-records>Index records<a class=headerlink href=#index-records title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/badges/new-in/1_12_0.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> How can you backtest time- and asset-anchored queries such as "Order X units of asset Y on date Z"? Typically, you would need to build a full array and set each detail manually. Now, there is a simpler way: with preparers and redesigned smart indexing, you can provide all information in a compressed record format! Behind the scenes, the record array is translated into a set of <a href=https://vectorbt.pro/pvt_41531c19/features/productivity/#index-dictionaries>index dictionaries</a>—one for each argument.</li> </ul> <div class="language-pycon highlight"><span class=filename>Define a basic signal strategy using records</span><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>([</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>,</span> <span class=s2>&quot;ETH-USD&quot;</span><span class=p>],</span> <span class=n>missing_index</span><span class=o>=</span><span class=s2>&quot;drop&quot;</span><span class=p>)</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>records</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=gp>... </span>    <span class=nb>dict</span><span class=p>(</span><span class=n>date</span><span class=o>=</span><span class=s2>&quot;2022&quot;</span><span class=p>,</span> <span class=n>symbol</span><span class=o>=</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>,</span> <span class=n>long_entry</span><span class=o>=</span><span class=kc>True</span><span class=p>),</span>  <span class=c1># (1)!</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=gp>... </span>    <span class=nb>dict</span><span class=p>(</span><span class=n>date</span><span class=o>=</span><span class=s2>&quot;2022&quot;</span><span class=p>,</span> <span class=n>symbol</span><span class=o>=</span><span class=s2>&quot;ETH-USD&quot;</span><span class=p>,</span> <span class=n>short_entry</span><span class=o>=</span><span class=kc>True</span><span class=p>),</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=gp>... </span>    <span class=nb>dict</span><span class=p>(</span><span class=n>row</span><span class=o>=-</span><span class=mi>1</span><span class=p>,</span> <span class=n>exit</span><span class=o>=</span><span class=kc>True</span><span class=p>),</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=gp>... </span><span class=p>]</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_signals</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>records</span><span class=o>=</span><span class=n>records</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>orders</span><span class=o>.</span><span class=n>readable</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a><span class=go>   Order Id   Column              Signal Index            Creation Index   </span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a><span class=go>0         0  BTC-USD 2022-01-01 00:00:00+00:00 2022-01-01 00:00:00+00:00  \</span>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=go>1         1  BTC-USD 2023-04-25 00:00:00+00:00 2023-04-25 00:00:00+00:00   </span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a><span class=go>2         0  ETH-USD 2022-01-01 00:00:00+00:00 2022-01-01 00:00:00+00:00   </span>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a><span class=go>3         1  ETH-USD 2023-04-25 00:00:00+00:00 2023-04-25 00:00:00+00:00   </span>
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a>
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a><span class=go>                 Fill Index      Size         Price  Fees  Side    Type   </span>
</span><span id=__span-3-16><a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a><span class=go>0 2022-01-01 00:00:00+00:00  0.002097  47686.812500   0.0   Buy  Market  \</span>
</span><span id=__span-3-17><a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a><span class=go>1 2023-04-25 00:00:00+00:00  0.002097  27534.675781   0.0  Sell  Market   </span>
</span><span id=__span-3-18><a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a><span class=go>2 2022-01-01 00:00:00+00:00  0.026527   3769.697021   0.0  Sell  Market   </span>
</span><span id=__span-3-19><a id=__codelineno-3-19 name=__codelineno-3-19 href=#__codelineno-3-19></a><span class=go>3 2023-04-25 00:00:00+00:00  0.026527   1834.759644   0.0   Buy  Market   </span>
</span><span id=__span-3-20><a id=__codelineno-3-20 name=__codelineno-3-20 href=#__codelineno-3-20></a>
</span><span id=__span-3-21><a id=__codelineno-3-21 name=__codelineno-3-21 href=#__codelineno-3-21></a><span class=go>  Stop Type  </span>
</span><span id=__span-3-22><a id=__codelineno-3-22 name=__codelineno-3-22 href=#__codelineno-3-22></a><span class=go>0      None  </span>
</span><span id=__span-3-23><a id=__codelineno-3-23 name=__codelineno-3-23 href=#__codelineno-3-23></a><span class=go>1      None  </span>
</span><span id=__span-3-24><a id=__codelineno-3-24 name=__codelineno-3-24 href=#__codelineno-3-24></a><span class=go>2      None  </span>
</span><span id=__span-3-25><a id=__codelineno-3-25 name=__codelineno-3-25 href=#__codelineno-3-25></a><span class=go>3      None  </span>
</span></code></pre></div> <ol> <li>Every broadcastable argument is supported. Rows can be specified using "row", "index", "date", or "datetime". Columns can be specified with "col", "column", or "symbol". If you do not provide a row or column, the entire row or column will be set, respectively. If neither is provided, the whole array will be set. Rows and columns can be given as integer positions, labels, datetimes, or even complex indexers!</li> <li>Arguments not used in records can still be provided as usual. Arguments used in records can also be provided to serve as defaults.</li> </ol> <h2 id=portfolio-preparers>Portfolio preparers<a class=headerlink href=#portfolio-preparers title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/badges/new-in/1_12_0.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> When you pass an argument to a simulation method such as <code>Portfolio.from_signals</code>, it goes through a complex preparation pipeline to convert it into a format suitable for Numba. This pipeline usually involves enum mapping, broadcasting, data type checks, template substitution, and many other steps. To make VBT more transparent, this pipeline has been moved to a separate class, giving you full control over the arguments that reach the Numba functions! You can even extend the preparers to automatically prepare arguments for your own simulators.</li> </ul> <div class="language-pycon highlight"><span class=filename>Get a prepared argument, modify it, and use in a new simulation</span><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>,</span> <span class=n>end</span><span class=o>=</span><span class=s2>&quot;2017-01&quot;</span><span class=p>)</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>prep_result</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_holding</span><span class=p>(</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=gp>... </span>    <span class=n>data</span><span class=p>,</span> 
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=gp>... </span>    <span class=n>stop_ladder</span><span class=o>=</span><span class=s2>&quot;uniform&quot;</span><span class=p>,</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=gp>... </span>    <span class=n>tp_stop</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=gp>... </span>        <span class=p>[</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>,</span> <span class=mf>0.3</span><span class=p>,</span> <span class=mf>0.4</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>],</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=gp>... </span>        <span class=p>[</span><span class=mf>0.4</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>,</span> <span class=mf>0.6</span><span class=p>],</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=gp>... </span>    <span class=p>],</span> <span class=n>keys</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;tp_ladder_1&quot;</span><span class=p>,</span> <span class=s2>&quot;tp_ladder_2&quot;</span><span class=p>]),</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=gp>... </span>    <span class=n>return_prep_result</span><span class=o>=</span><span class=kc>True</span>  <span class=c1># (1)!</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>prep_result</span><span class=o>.</span><span class=n>target_args</span><span class=p>[</span><span class=s2>&quot;tp_stop&quot;</span><span class=p>]</span>  <span class=c1># (2)!</span>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a><span class=go>array([[0.1, 0.4],</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a><span class=go>       [0.2, 0.5],</span>
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a><span class=go>       [0.3, 0.6],</span>
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a><span class=go>       [0.4, nan],</span>
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a><span class=go>       [0.5, nan]])</span>
</span><span id=__span-4-17><a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a>
</span><span id=__span-4-18><a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a><span class=gp>&gt;&gt;&gt; </span><span class=n>new_tp_stop</span> <span class=o>=</span> <span class=n>prep_result</span><span class=o>.</span><span class=n>target_args</span><span class=p>[</span><span class=s2>&quot;tp_stop&quot;</span><span class=p>]</span> <span class=o>+</span> <span class=mf>0.1</span>
</span><span id=__span-4-19><a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a><span class=gp>&gt;&gt;&gt; </span><span class=n>new_prep_result</span> <span class=o>=</span> <span class=n>prep_result</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=n>target_args</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>tp_stop</span><span class=o>=</span><span class=n>new_tp_stop</span><span class=p>),</span> <span class=n>nested_</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>  <span class=c1># (3)!</span>
</span><span id=__span-4-20><a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a><span class=gp>&gt;&gt;&gt; </span><span class=n>new_prep_result</span><span class=o>.</span><span class=n>target_args</span><span class=p>[</span><span class=s2>&quot;tp_stop&quot;</span><span class=p>]</span>
</span><span id=__span-4-21><a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a><span class=go>array([[0.2, 0.5],</span>
</span><span id=__span-4-22><a id=__codelineno-4-22 name=__codelineno-4-22 href=#__codelineno-4-22></a><span class=go>       [0.3, 0.6],</span>
</span><span id=__span-4-23><a id=__codelineno-4-23 name=__codelineno-4-23 href=#__codelineno-4-23></a><span class=go>       [0.4, 0.7],</span>
</span><span id=__span-4-24><a id=__codelineno-4-24 name=__codelineno-4-24 href=#__codelineno-4-24></a><span class=go>       [0.5, nan],</span>
</span><span id=__span-4-25><a id=__codelineno-4-25 name=__codelineno-4-25 href=#__codelineno-4-25></a><span class=go>       [0.6, nan]])</span>
</span><span id=__span-4-26><a id=__codelineno-4-26 name=__codelineno-4-26 href=#__codelineno-4-26></a>
</span><span id=__span-4-27><a id=__codelineno-4-27 name=__codelineno-4-27 href=#__codelineno-4-27></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_signals</span><span class=p>(</span><span class=n>new_prep_result</span><span class=p>)</span>  <span class=c1># (4)!</span>
</span><span id=__span-4-28><a id=__codelineno-4-28 name=__codelineno-4-28 href=#__codelineno-4-28></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>total_return</span>
</span><span id=__span-4-29><a id=__codelineno-4-29 name=__codelineno-4-29 href=#__codelineno-4-29></a><span class=go>tp_stop</span>
</span><span id=__span-4-30><a id=__codelineno-4-30 name=__codelineno-4-30 href=#__codelineno-4-30></a><span class=go>tp_ladder_1    0.4</span>
</span><span id=__span-4-31><a id=__codelineno-4-31 name=__codelineno-4-31 href=#__codelineno-4-31></a><span class=go>tp_ladder_2    0.6</span>
</span><span id=__span-4-32><a id=__codelineno-4-32 name=__codelineno-4-32 href=#__codelineno-4-32></a><span class=go>Name: total_return, dtype: float64</span>
</span><span id=__span-4-33><a id=__codelineno-4-33 name=__codelineno-4-33 href=#__codelineno-4-33></a>
</span><span id=__span-4-34><a id=__codelineno-4-34 name=__codelineno-4-34 href=#__codelineno-4-34></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sim_out</span> <span class=o>=</span> <span class=n>new_prep_result</span><span class=o>.</span><span class=n>target_func</span><span class=p>(</span><span class=o>**</span><span class=n>new_prep_result</span><span class=o>.</span><span class=n>target_args</span><span class=p>)</span>  <span class=c1># (5)!</span>
</span><span id=__span-4-35><a id=__codelineno-4-35 name=__codelineno-4-35 href=#__codelineno-4-35></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=p>(</span><span class=n>order_records</span><span class=o>=</span><span class=n>sim_out</span><span class=p>,</span> <span class=o>**</span><span class=n>new_prep_result</span><span class=o>.</span><span class=n>pf_args</span><span class=p>)</span>
</span><span id=__span-4-36><a id=__codelineno-4-36 name=__codelineno-4-36 href=#__codelineno-4-36></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>total_return</span>
</span><span id=__span-4-37><a id=__codelineno-4-37 name=__codelineno-4-37 href=#__codelineno-4-37></a><span class=go>tp_stop</span>
</span><span id=__span-4-38><a id=__codelineno-4-38 name=__codelineno-4-38 href=#__codelineno-4-38></a><span class=go>tp_ladder_1    0.4</span>
</span><span id=__span-4-39><a id=__codelineno-4-39 name=__codelineno-4-39 href=#__codelineno-4-39></a><span class=go>tp_ladder_2    0.6</span>
</span><span id=__span-4-40><a id=__codelineno-4-40 name=__codelineno-4-40 href=#__codelineno-4-40></a><span class=go>Name: total_return, dtype: float64</span>
</span></code></pre></div> <ol> <li>Returns the result of the preparation.</li> <li>Contains two attributes: target arguments as <code>target_args</code> and portfolio arguments as <code>pf_args</code>.</li> <li>Replace the argument. Since it is inside another dictionary (<code>target_args</code>), you need to enable <code>nested_</code>. The result is a new instance of <code>PFPrepResult</code>.</li> <li>Pass the new preparation result as the first argument to the base simulation method.</li> <li>Or simulate manually!</li> </ol> <h2 id=stop-laddering>Stop laddering<a class=headerlink href=#stop-laddering title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/badges/new-in/1_12_0.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Stop laddering is a technique for incrementally moving out of a position. Instead of providing a single stop value to close a position, you can provide an array of stop values, with each one removing a certain amount of the position when triggered. You can control this amount by choosing a different ladder mode. Thanks to a new broadcasting feature that allows arrays to broadcast along just one axis, the stop values do not need to have the same shape as the data. You can even provide stop arrays of different shapes as parameters!</li> </ul> <div class="language-pycon highlight"><span class=filename>Test two TP ladders</span><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>,</span> <span class=n>end</span><span class=o>=</span><span class=s2>&quot;2017-01&quot;</span><span class=p>)</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_holding</span><span class=p>(</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=gp>... </span>    <span class=n>data</span><span class=p>,</span> 
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=gp>... </span>    <span class=n>stop_ladder</span><span class=o>=</span><span class=s2>&quot;uniform&quot;</span><span class=p>,</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=gp>... </span>    <span class=n>tp_stop</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=gp>... </span>        <span class=p>[</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>,</span> <span class=mf>0.3</span><span class=p>,</span> <span class=mf>0.4</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>],</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=gp>... </span>        <span class=p>[</span><span class=mf>0.4</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>,</span> <span class=mf>0.6</span><span class=p>],</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=gp>... </span>    <span class=p>],</span> <span class=n>keys</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;tp_ladder_1&quot;</span><span class=p>,</span> <span class=s2>&quot;tp_ladder_2&quot;</span><span class=p>])</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>trades</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>column</span><span class=o>=</span><span class=s2>&quot;tp_ladder_1&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/features/stop_laddering.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/features/stop_laddering.dark.svg#only-dark></p> <h2 id=staticization>Staticization<a class=headerlink href=#staticization title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/badges/new-in/1_11_0.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> One major limitation of Numba is that functions passed as arguments (that is, callbacks) make the main function uncacheable, forcing it to be recompiled in every new runtime, again and again. This especially affects the performance of simulator functions, as they can take up to a minute to compile. Thankfully, there is a new trick available: "staticization". Here is how it works. First, the source code of a function is annotated with a special syntax. The annotated code is then extracted (also called "cutting" <img alt=✂ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/2702.svg title=:scissors:>), modified into a cacheable version by removing any callbacks from the arguments, and saved to a Python file. Once the function is called again, the cacheable version is executed. Sound complicated? Take a look below!</li> </ul> <div class="language-python highlight"><span class=filename>Define the signal function in a Python file, here signal_func_nb.py</span><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=kn>from</span><span class=w> </span><span class=nn>vectorbtpro</span><span class=w> </span><span class=kn>import</span> <span class=o>*</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=nd>@njit</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=k>def</span><span class=w> </span><span class=nf>signal_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>fast_sma</span><span class=p>,</span> <span class=n>slow_sma</span><span class=p>):</span>  <span class=c1># (1)!</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>    <span class=n>long</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>iter_crossed_above_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>fast_sma</span><span class=p>,</span> <span class=n>slow_sma</span><span class=p>)</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a>    <span class=n>short</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>iter_crossed_below_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>fast_sma</span><span class=p>,</span> <span class=n>slow_sma</span><span class=p>)</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>    <span class=k>return</span> <span class=n>long</span><span class=p>,</span> <span class=kc>False</span><span class=p>,</span> <span class=n>short</span><span class=p>,</span> <span class=kc>False</span>
</span></code></pre></div> <ol> <li>Make sure the function is named exactly the same as the callback argument.</li> </ol> <div class="language-pycon highlight"><span class=filename>Run a staticized simulation. Running the script again won't re-compile.</span><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>)</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_signals</span><span class=p>(</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=gp>... </span>    <span class=n>data</span><span class=p>,</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=gp>... </span>    <span class=n>signal_func_nb</span><span class=o>=</span><span class=s2>&quot;signal_func_nb.py&quot;</span><span class=p>,</span>  <span class=c1># (1)!</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=gp>... </span>    <span class=n>signal_args</span><span class=o>=</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>Rep</span><span class=p>(</span><span class=s2>&quot;fast_sma&quot;</span><span class=p>),</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Rep</span><span class=p>(</span><span class=s2>&quot;slow_sma&quot;</span><span class=p>)),</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=gp>... </span>    <span class=n>broadcast_named_args</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=gp>... </span>        <span class=n>fast_sma</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;sma&quot;</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=n>hide_params</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>unpack</span><span class=o>=</span><span class=kc>True</span><span class=p>),</span> 
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=gp>... </span>        <span class=n>slow_sma</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;sma&quot;</span><span class=p>,</span> <span class=mi>50</span><span class=p>,</span> <span class=n>hide_params</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>unpack</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=gp>... </span>    <span class=p>),</span>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=gp>... </span>    <span class=n>staticized</span><span class=o>=</span><span class=kc>True</span>  <span class=c1># (2)!</span>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a><span class=gp>... </span><span class=p>)</span>
</span></code></pre></div> <ol> <li>Path to the module where the function is located.</li> <li>Handles all the magic <img alt=✨ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/2728.svg title=:sparkles:></li> </ol> <h2 id=position-info>Position info<a class=headerlink href=#position-info title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/badges/new-in/1_11_0.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Dynamic signal functions now have access to the current position information, such as (open) P&amp;L.</li> </ul> <div class="language-pycon highlight"><span class=filename>Enter randomly, exit randomly but only if in profit</span><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=gp>... </span><span class=k>def</span><span class=w> </span><span class=nf>signal_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>entries</span><span class=p>,</span> <span class=n>exits</span><span class=p>):</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=gp>... </span>    <span class=n>is_entry</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>select_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>entries</span><span class=p>)</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=gp>... </span>    <span class=n>is_exit</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>select_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>exits</span><span class=p>)</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=gp>... </span>    <span class=k>if</span> <span class=n>is_entry</span><span class=p>:</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=gp>... </span>        <span class=k>return</span> <span class=kc>True</span><span class=p>,</span> <span class=kc>False</span><span class=p>,</span> <span class=kc>False</span><span class=p>,</span> <span class=kc>False</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=gp>... </span>    <span class=k>if</span> <span class=n>is_exit</span><span class=p>:</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=gp>... </span>        <span class=n>pos_info</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=n>last_pos_info</span><span class=p>[</span><span class=n>c</span><span class=o>.</span><span class=n>col</span><span class=p>]</span>
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=gp>... </span>        <span class=k>if</span> <span class=n>pos_info</span><span class=p>[</span><span class=s2>&quot;status&quot;</span><span class=p>]</span> <span class=o>==</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_enums</span><span class=o>.</span><span class=n>TradeStatus</span><span class=o>.</span><span class=n>Open</span><span class=p>:</span>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=gp>... </span>            <span class=k>if</span> <span class=n>pos_info</span><span class=p>[</span><span class=s2>&quot;pnl&quot;</span><span class=p>]</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=gp>... </span>                <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=kc>True</span><span class=p>,</span> <span class=kc>False</span><span class=p>,</span> <span class=kc>False</span>
</span><span id=__span-8-12><a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class=gp>... </span>    <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=kc>False</span><span class=p>,</span> <span class=kc>False</span><span class=p>,</span> <span class=kc>False</span>
</span><span id=__span-8-13><a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a>
</span><span id=__span-8-14><a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>)</span>
</span><span id=__span-8-15><a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entries</span><span class=p>,</span> <span class=n>exits</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;RANDNX&quot;</span><span class=p>,</span> <span class=n>n</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span> <span class=n>unpack</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-8-16><a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Portfolio</span><span class=o>.</span><span class=n>from_signals</span><span class=p>(</span>
</span><span id=__span-8-17><a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a><span class=gp>... </span>    <span class=n>data</span><span class=p>,</span>
</span><span id=__span-8-18><a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a><span class=gp>... </span>    <span class=n>signal_func_nb</span><span class=o>=</span><span class=n>signal_func_nb</span><span class=p>,</span>
</span><span id=__span-8-19><a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a><span class=gp>... </span>    <span class=n>signal_args</span><span class=o>=</span><span class=p>(</span><span class=n>vbt</span><span class=o>.</span><span class=n>Rep</span><span class=p>(</span><span class=s2>&quot;entries&quot;</span><span class=p>),</span> <span class=n>vbt</span><span class=o>.</span><span class=n>Rep</span><span class=p>(</span><span class=s2>&quot;exits&quot;</span><span class=p>)),</span>
</span><span id=__span-8-20><a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a><span class=gp>... </span>    <span class=n>broadcast_named_args</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>entries</span><span class=o>=</span><span class=n>entries</span><span class=p>,</span> <span class=n>exits</span><span class=o>=</span><span class=n>exits</span><span class=p>),</span>
</span><span id=__span-8-21><a id=__codelineno-8-21 name=__codelineno-8-21 href=#__codelineno-8-21></a><span class=gp>... </span>    <span class=n>jitted</span><span class=o>=</span><span class=kc>False</span>  <span class=c1># (1)!</span>
</span><span id=__span-8-22><a id=__codelineno-8-22 name=__codelineno-8-22 href=#__codelineno-8-22></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-8-23><a id=__codelineno-8-23 name=__codelineno-8-23 href=#__codelineno-8-23></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>trades</span><span class=o>.</span><span class=n>readable</span><span class=p>[[</span><span class=s2>&quot;Entry Index&quot;</span><span class=p>,</span> <span class=s2>&quot;Exit Index&quot;</span><span class=p>,</span> <span class=s2>&quot;PnL&quot;</span><span class=p>]]</span>
</span><span id=__span-8-24><a id=__codelineno-8-24 name=__codelineno-8-24 href=#__codelineno-8-24></a><span class=go>                Entry Index                Exit Index           PnL</span>
</span><span id=__span-8-25><a id=__codelineno-8-25 name=__codelineno-8-25 href=#__codelineno-8-25></a><span class=go>0 2014-11-01 00:00:00+00:00 2016-01-08 00:00:00+00:00     39.134739</span>
</span><span id=__span-8-26><a id=__codelineno-8-26 name=__codelineno-8-26 href=#__codelineno-8-26></a><span class=go>1 2016-03-27 00:00:00+00:00 2016-09-07 00:00:00+00:00     61.220063</span>
</span><span id=__span-8-27><a id=__codelineno-8-27 name=__codelineno-8-27 href=#__codelineno-8-27></a><span class=go>2 2016-12-24 00:00:00+00:00 2016-12-31 00:00:00+00:00     14.471414</span>
</span><span id=__span-8-28><a id=__codelineno-8-28 name=__codelineno-8-28 href=#__codelineno-8-28></a><span class=go>3 2017-03-16 00:00:00+00:00 2017-08-05 00:00:00+00:00    373.492028</span>
</span><span id=__span-8-29><a id=__codelineno-8-29 name=__codelineno-8-29 href=#__codelineno-8-29></a><span class=go>4 2017-09-12 00:00:00+00:00 2018-05-05 00:00:00+00:00    815.699284</span>
</span><span id=__span-8-30><a id=__codelineno-8-30 name=__codelineno-8-30 href=#__codelineno-8-30></a><span class=go>5 2019-02-15 00:00:00+00:00 2019-11-10 00:00:00+00:00   2107.383227</span>
</span><span id=__span-8-31><a id=__codelineno-8-31 name=__codelineno-8-31 href=#__codelineno-8-31></a><span class=go>6 2019-12-04 00:00:00+00:00 2019-12-10 00:00:00+00:00     12.630214</span>
</span><span id=__span-8-32><a id=__codelineno-8-32 name=__codelineno-8-32 href=#__codelineno-8-32></a><span class=go>7 2020-07-12 00:00:00+00:00 2021-11-14 00:00:00+00:00  21346.035444</span>
</span><span id=__span-8-33><a id=__codelineno-8-33 name=__codelineno-8-33 href=#__codelineno-8-33></a><span class=go>8 2022-01-15 00:00:00+00:00 2023-03-06 00:00:00+00:00 -11925.133817</span>
</span></code></pre></div> <ol> <li>Disable Numba during testing to avoid compilation.</li> </ol> <h2 id=time-stops>Time stops<a class=headerlink href=#time-stops title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/badges/new-in/1_11_0.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Joining other stop orders, time stop orders can close a position either after a certain period of time or on a specific date.</li> </ul> <div class="language-pycon highlight"><span class=filename>Enter randomly, exit before the end of the month</span><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>,</span> <span class=n>start</span><span class=o>=</span><span class=s2>&quot;2022-01&quot;</span><span class=p>,</span> <span class=n>end</span><span class=o>=</span><span class=s2>&quot;2022-04&quot;</span><span class=p>)</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entries</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pd_acc</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>generate_random</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>symbol_wrapper</span><span class=p>,</span> <span class=n>n</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_signals</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>entries</span><span class=p>,</span> <span class=n>dt_stop</span><span class=o>=</span><span class=s2>&quot;M&quot;</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>orders</span><span class=o>.</span><span class=n>readable</span><span class=p>[[</span><span class=s2>&quot;Fill Index&quot;</span><span class=p>,</span> <span class=s2>&quot;Side&quot;</span><span class=p>,</span> <span class=s2>&quot;Stop Type&quot;</span><span class=p>]]</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=go>                 Fill Index  Side Stop Type</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=go>0 2022-01-19 00:00:00+00:00   Buy      None</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=go>1 2022-01-31 00:00:00+00:00  Sell        DT</span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=go>2 2022-02-25 00:00:00+00:00   Buy      None</span>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=go>3 2022-02-28 00:00:00+00:00  Sell        DT</span>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=go>4 2022-03-11 00:00:00+00:00   Buy      None</span>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a><span class=go>5 2022-03-31 00:00:00+00:00  Sell        DT</span>
</span></code></pre></div> <ol> <li>Use <code>dt_stop</code> for datetime-based stops and <code>td_stop</code> for timedelta-based stops. Datetime-based stops can be periods ("D"), timestamps ("2023-01-01"), and even specific times ("18:00").</li> </ol> <h2 id=target-size-to-signals>Target size to signals<a class=headerlink href=#target-size-to-signals title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/badges/new-in/1_10_0.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Target size can be converted to signals using a special signal function, giving access to stop and limit order functionality. This is especially useful, for example, in portfolio optimization.</li> </ul> <div class="language-pycon highlight"><span class=filename>Perform the Mean-Variance Optimization with SL and TP</span><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=gp>... </span>    <span class=p>[</span><span class=s2>&quot;SPY&quot;</span><span class=p>,</span> <span class=s2>&quot;TLT&quot;</span><span class=p>,</span> <span class=s2>&quot;XLF&quot;</span><span class=p>,</span> <span class=s2>&quot;XLE&quot;</span><span class=p>,</span> <span class=s2>&quot;XLU&quot;</span><span class=p>,</span> <span class=s2>&quot;XLK&quot;</span><span class=p>,</span> <span class=s2>&quot;XLB&quot;</span><span class=p>,</span> <span class=s2>&quot;XLP&quot;</span><span class=p>,</span> <span class=s2>&quot;XLY&quot;</span><span class=p>,</span> <span class=s2>&quot;XLI&quot;</span><span class=p>,</span> <span class=s2>&quot;XLV&quot;</span><span class=p>],</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=gp>... </span>    <span class=n>start</span><span class=o>=</span><span class=s2>&quot;2022&quot;</span><span class=p>,</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=gp>... </span>    <span class=n>end</span><span class=o>=</span><span class=s2>&quot;2023&quot;</span><span class=p>,</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=gp>... </span>    <span class=n>missing_index</span><span class=o>=</span><span class=s2>&quot;drop&quot;</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pfo</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PFO</span><span class=o>.</span><span class=n>from_riskfolio</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>returns</span><span class=p>,</span> <span class=n>every</span><span class=o>=</span><span class=s2>&quot;M&quot;</span><span class=p>)</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>pfo</span><span class=o>.</span><span class=n>simulate</span><span class=p>(</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=gp>... </span>    <span class=n>data</span><span class=p>,</span> 
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=gp>... </span>    <span class=n>pf_method</span><span class=o>=</span><span class=s2>&quot;from_signals&quot;</span><span class=p>,</span> 
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=gp>... </span>    <span class=n>sl_stop</span><span class=o>=</span><span class=mf>0.05</span><span class=p>,</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=gp>... </span>    <span class=n>tp_stop</span><span class=o>=</span><span class=mf>0.1</span><span class=p>,</span> 
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a><span class=gp>... </span>    <span class=n>stop_exit_price</span><span class=o>=</span><span class=s2>&quot;close&quot;</span>  <span class=c1># (1)!</span>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>plot_allocations</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Otherwise, user and stop signals will occur at different times within the same bar, making it impossible to establish the correct order of execution.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/features/target_size_to_signals.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/features/target_size_to_signals.dark.svg#only-dark></p> <h2 id=target-price>Target price<a class=headerlink href=#target-price title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/badges/new-in/1_10_0.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Limit and stop orders can now be defined using a target price instead of a delta.</li> </ul> <div class="language-pycon highlight"><span class=filename>Set the SL to the previous low in a random portfolio</span><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>)</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_random_signals</span><span class=p>(</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=gp>... </span>    <span class=n>data</span><span class=p>,</span> 
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=gp>... </span>    <span class=n>n</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span> 
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=gp>... </span>    <span class=n>sl_stop</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>low</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>ago</span><span class=p>(</span><span class=mi>1</span><span class=p>),</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=gp>... </span>    <span class=n>delta_format</span><span class=o>=</span><span class=s2>&quot;target&quot;</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>sl_orders</span> <span class=o>=</span> <span class=n>pf</span><span class=o>.</span><span class=n>orders</span><span class=o>.</span><span class=n>stop_type_sl</span>
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>signal_index</span> <span class=o>=</span> <span class=n>pf</span><span class=o>.</span><span class=n>wrapper</span><span class=o>.</span><span class=n>index</span><span class=p>[</span><span class=n>sl_orders</span><span class=o>.</span><span class=n>signal_idx</span><span class=o>.</span><span class=n>values</span><span class=p>]</span>
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>hit_index</span> <span class=o>=</span> <span class=n>pf</span><span class=o>.</span><span class=n>wrapper</span><span class=o>.</span><span class=n>index</span><span class=p>[</span><span class=n>sl_orders</span><span class=o>.</span><span class=n>idx</span><span class=o>.</span><span class=n>values</span><span class=p>]</span>
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>hit_after</span> <span class=o>=</span> <span class=n>hit_index</span> <span class=o>-</span> <span class=n>signal_index</span>
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a><span class=gp>&gt;&gt;&gt; </span><span class=n>hit_after</span>
</span><span id=__span-11-13><a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a><span class=go>TimedeltaIndex([ &#39;7 days&#39;,  &#39;3 days&#39;,  &#39;1 days&#39;,  &#39;5 days&#39;,  &#39;4 days&#39;,</span>
</span><span id=__span-11-14><a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a><span class=go>                 &#39;1 days&#39;, &#39;28 days&#39;,  &#39;1 days&#39;,  &#39;1 days&#39;,  &#39;1 days&#39;,</span>
</span><span id=__span-11-15><a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a><span class=go>                 &#39;1 days&#39;,  &#39;1 days&#39;, &#39;13 days&#39;, &#39;10 days&#39;,  &#39;5 days&#39;,</span>
</span><span id=__span-11-16><a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a><span class=go>                 &#39;1 days&#39;,  &#39;3 days&#39;,  &#39;4 days&#39;,  &#39;1 days&#39;,  &#39;9 days&#39;,</span>
</span><span id=__span-11-17><a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a><span class=go>                 &#39;5 days&#39;,  &#39;1 days&#39;,  &#39;1 days&#39;,  &#39;2 days&#39;,  &#39;1 days&#39;,</span>
</span><span id=__span-11-18><a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a><span class=go>                 &#39;1 days&#39;,  &#39;1 days&#39;,  &#39;3 days&#39;,  &#39;1 days&#39;,  &#39;1 days&#39;,</span>
</span><span id=__span-11-19><a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a><span class=go>                 &#39;1 days&#39;,  &#39;1 days&#39;,  &#39;1 days&#39;,  &#39;2 days&#39;,  &#39;2 days&#39;,</span>
</span><span id=__span-11-20><a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a><span class=go>                 &#39;1 days&#39;, &#39;12 days&#39;,  &#39;3 days&#39;,  &#39;1 days&#39;,  &#39;1 days&#39;,</span>
</span><span id=__span-11-21><a id=__codelineno-11-21 name=__codelineno-11-21 href=#__codelineno-11-21></a><span class=go>                 &#39;1 days&#39;,  &#39;1 days&#39;,  &#39;1 days&#39;,  &#39;3 days&#39;,  &#39;1 days&#39;,</span>
</span><span id=__span-11-22><a id=__codelineno-11-22 name=__codelineno-11-22 href=#__codelineno-11-22></a><span class=go>                 &#39;1 days&#39;,  &#39;1 days&#39;,  &#39;4 days&#39;,  &#39;1 days&#39;,  &#39;1 days&#39;,</span>
</span><span id=__span-11-23><a id=__codelineno-11-23 name=__codelineno-11-23 href=#__codelineno-11-23></a><span class=go>                 &#39;2 days&#39;,  &#39;6 days&#39;, &#39;11 days&#39;,  &#39;1 days&#39;,  &#39;2 days&#39;,</span>
</span><span id=__span-11-24><a id=__codelineno-11-24 name=__codelineno-11-24 href=#__codelineno-11-24></a><span class=go>                 &#39;1 days&#39;,  &#39;1 days&#39;,  &#39;1 days&#39;,  &#39;1 days&#39;,  &#39;1 days&#39;,</span>
</span><span id=__span-11-25><a id=__codelineno-11-25 name=__codelineno-11-25 href=#__codelineno-11-25></a><span class=go>                 &#39;4 days&#39;, &#39;10 days&#39;,  &#39;1 days&#39;,  &#39;1 days&#39;,  &#39;1 days&#39;,</span>
</span><span id=__span-11-26><a id=__codelineno-11-26 name=__codelineno-11-26 href=#__codelineno-11-26></a><span class=go>                 &#39;2 days&#39;,  &#39;3 days&#39;,  &#39;1 days&#39;],</span>
</span><span id=__span-11-27><a id=__codelineno-11-27 name=__codelineno-11-27 href=#__codelineno-11-27></a><span class=go>               dtype=&#39;timedelta64[ns]&#39;, name=&#39;Date&#39;, freq=None)</span>
</span></code></pre></div> <h2 id=leverage>Leverage<a class=headerlink href=#leverage title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/badges/new-in/1_9_0.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Leverage is now an integral part of portfolio simulation. Supports two leverage modes: <code>lazy</code> (enables leverage only if there is not enough cash) and <code>eager</code> (enables leverage while using only part of the available cash). Allows setting leverage per order, and can also determine the optimal leverage value automatically to fulfill any order requirement! <img alt=🏋 class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f3cb.svg title=:person_lifting_weights:></li> </ul> <div class="language-pycon highlight"><span class=filename>Explore how leverage affects the equity curve in a random portfolio</span><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>,</span> <span class=n>start</span><span class=o>=</span><span class=s2>&quot;2020&quot;</span><span class=p>,</span> <span class=n>end</span><span class=o>=</span><span class=s2>&quot;2022&quot;</span><span class=p>)</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_random_signals</span><span class=p>(</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=gp>... </span>    <span class=n>data</span><span class=p>,</span> 
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=gp>... </span>    <span class=n>n</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span>  
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=gp>... </span>    <span class=n>leverage</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span><span class=mf>0.5</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>]),</span>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>value</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/features/leverage.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/features/leverage.dark.svg#only-dark></p> <h2 id=order-delays>Order delays<a class=headerlink href=#order-delays title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/badges/new-in/1_4_1.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> By default, VBT executes every order at the end of the current bar. Previously, if you wanted to delay execution to the next bar, you had to manually shift all order-related arrays by one bar, which made the process error-prone. Now, you can simply specify how many bars in the past should be used to take order information from. In addition, the price argument now supports "nextopen" and "nextclose" as options, providing a one-line solution.</li> </ul> <div class="language-pycon highlight"><span class=filename>Compare orders without and with a delay in a random portfolio</span><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_random_signals</span><span class=p>(</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>,</span> <span class=n>start</span><span class=o>=</span><span class=s2>&quot;2021-01&quot;</span><span class=p>,</span> <span class=n>end</span><span class=o>=</span><span class=s2>&quot;2021-02&quot;</span><span class=p>),</span> 
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=gp>... </span>    <span class=n>n</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span> 
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=gp>... </span>    <span class=n>price</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>([</span><span class=s2>&quot;close&quot;</span><span class=p>,</span> <span class=s2>&quot;nextopen&quot;</span><span class=p>])</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span> <span class=o>=</span> <span class=n>pf</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=s2>&quot;close&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=gp>... </span>    <span class=n>buy_trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&quot;Buy (close)&quot;</span><span class=p>,</span> <span class=n>marker</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>symbol</span><span class=o>=</span><span class=s2>&quot;triangle-up-open&quot;</span><span class=p>)),</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=gp>... </span>    <span class=n>sell_trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&quot;Buy (close)&quot;</span><span class=p>,</span> <span class=n>marker</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>symbol</span><span class=o>=</span><span class=s2>&quot;triangle-down-open&quot;</span><span class=p>))</span>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>orders</span><span class=p>[</span><span class=s2>&quot;nextopen&quot;</span><span class=p>]</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=gp>... </span>    <span class=n>plot_ohlc</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a><span class=gp>... </span>    <span class=n>plot_close</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span><span id=__span-13-13><a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=gp>... </span>    <span class=n>buy_trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&quot;Buy (nextopen)&quot;</span><span class=p>),</span>
</span><span id=__span-13-14><a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a><span class=gp>... </span>    <span class=n>sell_trace_kwargs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s2>&quot;Sell (nextopen)&quot;</span><span class=p>),</span>
</span><span id=__span-13-15><a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a><span class=gp>... </span>    <span class=n>fig</span><span class=o>=</span><span class=n>fig</span>
</span><span id=__span-13-16><a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-13-17><a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/features/order_delays.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/features/order_delays.dark.svg#only-dark></p> <h2 id=signal-callbacks>Signal callbacks<a class=headerlink href=#signal-callbacks title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/badges/new-in/1_4_0.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Want to customize your simulation based on signals, or even generate signals dynamically according to the current backtesting environment? Two new callbacks now bring simulator flexibility to the next level: one lets you generate or override signals for each asset at every bar, and another allows you to compute user-defined metrics for the entire group at the end of each bar. Both accept a "context" that contains information about the current simulation state, enabling trading decisions to be made in a way similar to event-driven backtesters.</li> </ul> <div class="language-pycon highlight"><span class=filename>Backtest SMA crossover iteratively</span><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>InOutputs</span> <span class=o>=</span> <span class=n>namedtuple</span><span class=p>(</span><span class=s2>&quot;InOutputs&quot;</span><span class=p>,</span> <span class=p>[</span><span class=s2>&quot;fast_sma&quot;</span><span class=p>,</span> <span class=s2>&quot;slow_sma&quot;</span><span class=p>])</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=gp>&gt;&gt;&gt; </span><span class=k>def</span><span class=w> </span><span class=nf>initialize_in_outputs</span><span class=p>(</span><span class=n>target_shape</span><span class=p>):</span>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=gp>... </span>    <span class=k>return</span> <span class=n>InOutputs</span><span class=p>(</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=gp>... </span>        <span class=n>fast_sma</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>full</span><span class=p>(</span><span class=n>target_shape</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>),</span>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=gp>... </span>        <span class=n>slow_sma</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>full</span><span class=p>(</span><span class=n>target_shape</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>)</span>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=gp>... </span>    <span class=p>)</span>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a>
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=gp>... </span><span class=k>def</span><span class=w> </span><span class=nf>signal_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>fast_window</span><span class=p>,</span> <span class=n>slow_window</span><span class=p>):</span>
</span><span id=__span-14-11><a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a><span class=gp>... </span>    <span class=n>fast_sma</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=n>in_outputs</span><span class=o>.</span><span class=n>fast_sma</span>
</span><span id=__span-14-12><a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a><span class=gp>... </span>    <span class=n>slow_sma</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=n>in_outputs</span><span class=o>.</span><span class=n>slow_sma</span>
</span><span id=__span-14-13><a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a><span class=gp>... </span>    <span class=n>fast_start_i</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=n>i</span> <span class=o>-</span> <span class=n>fast_window</span> <span class=o>+</span> <span class=mi>1</span>
</span><span id=__span-14-14><a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a><span class=gp>... </span>    <span class=n>slow_start_i</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=n>i</span> <span class=o>-</span> <span class=n>slow_window</span> <span class=o>+</span> <span class=mi>1</span>
</span><span id=__span-14-15><a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a><span class=gp>... </span>    <span class=k>if</span> <span class=n>fast_start_i</span> <span class=o>&gt;=</span> <span class=mi>0</span> <span class=ow>and</span> <span class=n>slow_start_i</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-14-16><a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a><span class=gp>... </span>        <span class=n>fast_sma</span><span class=p>[</span><span class=n>c</span><span class=o>.</span><span class=n>i</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>col</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nanmean</span><span class=p>(</span><span class=n>c</span><span class=o>.</span><span class=n>close</span><span class=p>[</span><span class=n>fast_start_i</span> <span class=p>:</span> <span class=n>c</span><span class=o>.</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>])</span>
</span><span id=__span-14-17><a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a><span class=gp>... </span>        <span class=n>slow_sma</span><span class=p>[</span><span class=n>c</span><span class=o>.</span><span class=n>i</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>col</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nanmean</span><span class=p>(</span><span class=n>c</span><span class=o>.</span><span class=n>close</span><span class=p>[</span><span class=n>slow_start_i</span> <span class=p>:</span> <span class=n>c</span><span class=o>.</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>])</span>
</span><span id=__span-14-18><a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a><span class=gp>... </span>        <span class=n>is_entry</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>iter_crossed_above_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>fast_sma</span><span class=p>,</span> <span class=n>slow_sma</span><span class=p>)</span>
</span><span id=__span-14-19><a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a><span class=gp>... </span>        <span class=n>is_exit</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pf_nb</span><span class=o>.</span><span class=n>iter_crossed_below_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>fast_sma</span><span class=p>,</span> <span class=n>slow_sma</span><span class=p>)</span>
</span><span id=__span-14-20><a id=__codelineno-14-20 name=__codelineno-14-20 href=#__codelineno-14-20></a><span class=gp>... </span>        <span class=k>return</span> <span class=n>is_entry</span><span class=p>,</span> <span class=n>is_exit</span><span class=p>,</span> <span class=kc>False</span><span class=p>,</span> <span class=kc>False</span>
</span><span id=__span-14-21><a id=__codelineno-14-21 name=__codelineno-14-21 href=#__codelineno-14-21></a><span class=gp>... </span>    <span class=k>return</span> <span class=kc>False</span><span class=p>,</span> <span class=kc>False</span><span class=p>,</span> <span class=kc>False</span><span class=p>,</span> <span class=kc>False</span>
</span><span id=__span-14-22><a id=__codelineno-14-22 name=__codelineno-14-22 href=#__codelineno-14-22></a>
</span><span id=__span-14-23><a id=__codelineno-14-23 name=__codelineno-14-23 href=#__codelineno-14-23></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_signals</span><span class=p>(</span>
</span><span id=__span-14-24><a id=__codelineno-14-24 name=__codelineno-14-24 href=#__codelineno-14-24></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>),</span>
</span><span id=__span-14-25><a id=__codelineno-14-25 name=__codelineno-14-25 href=#__codelineno-14-25></a><span class=gp>... </span>    <span class=n>signal_func_nb</span><span class=o>=</span><span class=n>signal_func_nb</span><span class=p>,</span>
</span><span id=__span-14-26><a id=__codelineno-14-26 name=__codelineno-14-26 href=#__codelineno-14-26></a><span class=gp>... </span>    <span class=n>signal_args</span><span class=o>=</span><span class=p>(</span><span class=mi>50</span><span class=p>,</span> <span class=mi>200</span><span class=p>),</span>
</span><span id=__span-14-27><a id=__codelineno-14-27 name=__codelineno-14-27 href=#__codelineno-14-27></a><span class=gp>... </span>    <span class=n>in_outputs</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>RepFunc</span><span class=p>(</span><span class=n>initialize_in_outputs</span><span class=p>),</span>
</span><span id=__span-14-28><a id=__codelineno-14-28 name=__codelineno-14-28 href=#__codelineno-14-28></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-14-29><a id=__codelineno-14-29 name=__codelineno-14-29 href=#__codelineno-14-29></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span> <span class=o>=</span> <span class=n>pf</span><span class=o>.</span><span class=n>get_in_output</span><span class=p>(</span><span class=s2>&quot;fast_sma&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span>
</span><span id=__span-14-30><a id=__codelineno-14-30 name=__codelineno-14-30 href=#__codelineno-14-30></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>get_in_output</span><span class=p>(</span><span class=s2>&quot;slow_sma&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>fig</span><span class=o>=</span><span class=n>fig</span><span class=p>)</span>
</span><span id=__span-14-31><a id=__codelineno-14-31 name=__codelineno-14-31 href=#__codelineno-14-31></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>orders</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>plot_ohlc</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>plot_close</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>fig</span><span class=o>=</span><span class=n>fig</span><span class=p>)</span>
</span><span id=__span-14-32><a id=__codelineno-14-32 name=__codelineno-14-32 href=#__codelineno-14-32></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/features/signal_callbacks.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/features/signal_callbacks.dark.svg#only-dark></p> <h2 id=limit-orders>Limit orders<a class=headerlink href=#limit-orders title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/badges/new-in/1_4_0.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Long-awaited support for limit orders is now available for signal-based simulation! Includes time-in-force (TIF) orders such as DAY, GTC, GTD, LOO, and FOK <img alt=⏰ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/23f0.svg title=:alarm_clock:> You can also reverse a limit order or create it using a delta for easier testing.</li> </ul> <div class="language-pycon highlight"><span class=filename>Explore how limit delta affects number of orders in a random portfolio</span><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_random_signals</span><span class=p>(</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=gp>... </span>    <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>),</span> 
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=gp>... </span>    <span class=n>n</span><span class=o>=</span><span class=mi>100</span><span class=p>,</span> 
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=gp>... </span>    <span class=n>order_type</span><span class=o>=</span><span class=s2>&quot;limit&quot;</span><span class=p>,</span> 
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=gp>... </span>    <span class=n>limit_delta</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>Param</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mf>0.001</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.001</span><span class=p>)),</span>  <span class=c1># (1)!</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>orders</span><span class=o>.</span><span class=n>count</span><span class=p>()</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span>
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=gp>... </span>    <span class=n>xaxis_title</span><span class=o>=</span><span class=s2>&quot;Limit delta&quot;</span><span class=p>,</span> 
</span><span id=__span-15-9><a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a><span class=gp>... </span>    <span class=n>yaxis_title</span><span class=o>=</span><span class=s2>&quot;Order count&quot;</span>
</span><span id=__span-15-10><a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a><span class=gp>... </span><span class=p>)</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Limit delta is the distance between the close (or any specified price) and the target limit price, expressed as a percentage. The higher the delta, the lower the chance it will eventually be hit.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/features/limit_delta.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/features/limit_delta.dark.svg#only-dark></p> <h2 id=delta-formats>Delta formats<a class=headerlink href=#delta-formats title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/badges/new-in/1_4_0.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Previously, stop orders could only be provided as percentages. While this worked for single values, it often required extra transformations for arrays. For example, setting SL to ATR meant you needed to know the entry price. More generally, to lock in a specific dollar amount of a trade, you might want to use a fixed price trailing stop. To address this, VBT now offers multiple stop value formats ("delta formats") to choose from.</li> </ul> <div class="language-pycon highlight"><span class=filename>Use ATR as SL</span><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>)</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>atr</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>talib</span><span class=p>(</span><span class=s2>&quot;ATR&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>high</span><span class=p>,</span> <span class=n>data</span><span class=o>.</span><span class=n>low</span><span class=p>,</span> <span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>)</span><span class=o>.</span><span class=n>real</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_holding</span><span class=p>(</span>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=s2>&quot;2022-01-01&quot;</span><span class=p>:</span><span class=s2>&quot;2022-01-07&quot;</span><span class=p>],</span> 
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=gp>... </span>    <span class=n>sl_stop</span><span class=o>=</span><span class=n>atr</span><span class=o>.</span><span class=n>loc</span><span class=p>[</span><span class=s2>&quot;2022-01-01&quot;</span><span class=p>:</span><span class=s2>&quot;2022-01-07&quot;</span><span class=p>],</span> 
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=gp>... </span>    <span class=n>delta_format</span><span class=o>=</span><span class=s2>&quot;absolute&quot;</span>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-16-8><a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>orders</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/features/delta_formats.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/features/delta_formats.dark.svg#only-dark></p> <h2 id=bar-skipping>Bar skipping<a class=headerlink href=#bar-skipping title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/badges/new-in/1_4_0.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Simulation based on orders and signals can now (partially) skip bars that do not define any orders, often resulting in significant speedups for strategies with sparsely distributed orders.</li> </ul> <div class="language-pycon highlight"><span class=filename>Benchmark bar skipping in a buy-and-hold portfolio</span><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>BinanceData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTCUSDT&quot;</span><span class=p>,</span> <span class=n>start</span><span class=o>=</span><span class=s2>&quot;one month ago UTC&quot;</span><span class=p>,</span> <span class=n>timeframe</span><span class=o>=</span><span class=s2>&quot;minute&quot;</span><span class=p>)</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>fill</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>)</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>inf</span>
</span></code></pre></div> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=gp>&gt;&gt;&gt; </span><span class=o>%%</span><span class=n>timeit</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_orders</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>size</span><span class=p>,</span> <span class=n>ffill_val_price</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=go>5.92 ms ± 300 µs per loop (mean ± std. dev. of 7 runs, 1 loop each)</span>
</span></code></pre></div> <ol> <li>When enabled (default), this argument forces the simulation to process every bar.</li> </ol> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=gp>&gt;&gt;&gt; </span><span class=o>%%</span><span class=n>timeit</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_orders</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>size</span><span class=p>,</span> <span class=n>ffill_val_price</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=go>2.75 ms ± 16 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)</span>
</span></code></pre></div> <h2 id=signal-contexts>Signal contexts<a class=headerlink href=#signal-contexts title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/badges/new-in/1_2_3.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Signal generation functions have been redesigned to operate on contexts. This allows you to design more complex signal strategies with less namespace pollution.</li> </ul> <div class="admonition example"> <p class=admonition-title>Tutorial</p> <p>Learn more in the <a href=https://vectorbt.pro/pvt_41531c19/tutorials/signal-development>Signal development</a> tutorial.</p> </div> <div class="language-pycon highlight"><span class=filename>Entry at the first bar of the week, exit at the last bar of the week</span><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=gp>... </span><span class=k>def</span><span class=w> </span><span class=nf>entry_place_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>index</span><span class=p>):</span>  
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>c</span><span class=o>.</span><span class=n>from_i</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>to_i</span><span class=p>):</span>  <span class=c1># (1)!</span>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=gp>... </span>        <span class=k>if</span> <span class=n>i</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=gp>... </span>            <span class=k>return</span> <span class=n>i</span> <span class=o>-</span> <span class=n>c</span><span class=o>.</span><span class=n>from_i</span>  <span class=c1># (2)!</span>
</span><span id=__span-20-6><a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=gp>... </span>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-20-7><a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=gp>... </span>            <span class=n>index_before</span> <span class=o>=</span> <span class=n>index</span><span class=p>[</span><span class=n>i</span> <span class=o>-</span> <span class=mi>1</span><span class=p>]</span>
</span><span id=__span-20-8><a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a><span class=gp>... </span>            <span class=n>index_now</span> <span class=o>=</span> <span class=n>index</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span><span id=__span-20-9><a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a><span class=gp>... </span>            <span class=n>index_next_week</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>dt_nb</span><span class=o>.</span><span class=n>future_weekday_nb</span><span class=p>(</span><span class=n>index_before</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span><span id=__span-20-10><a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a><span class=gp>... </span>            <span class=k>if</span> <span class=n>index_now</span> <span class=o>&gt;=</span> <span class=n>index_next_week</span><span class=p>:</span>  <span class=c1># (3)!</span>
</span><span id=__span-20-11><a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a><span class=gp>... </span>                <span class=k>return</span> <span class=n>i</span> <span class=o>-</span> <span class=n>c</span><span class=o>.</span><span class=n>from_i</span>
</span><span id=__span-20-12><a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a><span class=gp>... </span>    <span class=k>return</span> <span class=o>-</span><span class=mi>1</span>
</span><span id=__span-20-13><a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a>
</span><span id=__span-20-14><a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
</span><span id=__span-20-15><a id=__codelineno-20-15 name=__codelineno-20-15 href=#__codelineno-20-15></a><span class=gp>... </span><span class=k>def</span><span class=w> </span><span class=nf>exit_place_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>,</span> <span class=n>index</span><span class=p>):</span>  
</span><span id=__span-20-16><a id=__codelineno-20-16 name=__codelineno-20-16 href=#__codelineno-20-16></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>c</span><span class=o>.</span><span class=n>from_i</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>to_i</span><span class=p>):</span>
</span><span id=__span-20-17><a id=__codelineno-20-17 name=__codelineno-20-17 href=#__codelineno-20-17></a><span class=gp>... </span>        <span class=k>if</span> <span class=n>i</span> <span class=o>==</span> <span class=nb>len</span><span class=p>(</span><span class=n>index</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>:</span>
</span><span id=__span-20-18><a id=__codelineno-20-18 name=__codelineno-20-18 href=#__codelineno-20-18></a><span class=gp>... </span>            <span class=k>return</span> <span class=n>i</span> <span class=o>-</span> <span class=n>c</span><span class=o>.</span><span class=n>from_i</span>
</span><span id=__span-20-19><a id=__codelineno-20-19 name=__codelineno-20-19 href=#__codelineno-20-19></a><span class=gp>... </span>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-20-20><a id=__codelineno-20-20 name=__codelineno-20-20 href=#__codelineno-20-20></a><span class=gp>... </span>            <span class=n>index_now</span> <span class=o>=</span> <span class=n>index</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span><span id=__span-20-21><a id=__codelineno-20-21 name=__codelineno-20-21 href=#__codelineno-20-21></a><span class=gp>... </span>            <span class=n>index_after</span> <span class=o>=</span> <span class=n>index</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span>
</span><span id=__span-20-22><a id=__codelineno-20-22 name=__codelineno-20-22 href=#__codelineno-20-22></a><span class=gp>... </span>            <span class=n>index_next_week</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>dt_nb</span><span class=o>.</span><span class=n>future_weekday_nb</span><span class=p>(</span><span class=n>index_now</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span><span id=__span-20-23><a id=__codelineno-20-23 name=__codelineno-20-23 href=#__codelineno-20-23></a><span class=gp>... </span>            <span class=k>if</span> <span class=n>index_after</span> <span class=o>&gt;=</span> <span class=n>index_next_week</span><span class=p>:</span>  <span class=c1># (4)!</span>
</span><span id=__span-20-24><a id=__codelineno-20-24 name=__codelineno-20-24 href=#__codelineno-20-24></a><span class=gp>... </span>                <span class=k>return</span> <span class=n>i</span> <span class=o>-</span> <span class=n>c</span><span class=o>.</span><span class=n>from_i</span>
</span><span id=__span-20-25><a id=__codelineno-20-25 name=__codelineno-20-25 href=#__codelineno-20-25></a><span class=gp>... </span>    <span class=k>return</span> <span class=o>-</span><span class=mi>1</span>
</span><span id=__span-20-26><a id=__codelineno-20-26 name=__codelineno-20-26 href=#__codelineno-20-26></a>
</span><span id=__span-20-27><a id=__codelineno-20-27 name=__codelineno-20-27 href=#__codelineno-20-27></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>,</span> <span class=n>start</span><span class=o>=</span><span class=s2>&quot;2020-01-01&quot;</span><span class=p>,</span> <span class=n>end</span><span class=o>=</span><span class=s2>&quot;2020-01-14&quot;</span><span class=p>)</span>
</span><span id=__span-20-28><a id=__codelineno-20-28 name=__codelineno-20-28 href=#__codelineno-20-28></a><span class=gp>&gt;&gt;&gt; </span><span class=n>entries</span><span class=p>,</span> <span class=n>exits</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>pd_acc</span><span class=o>.</span><span class=n>signals</span><span class=o>.</span><span class=n>generate_both</span><span class=p>(</span>
</span><span id=__span-20-29><a id=__codelineno-20-29 name=__codelineno-20-29 href=#__codelineno-20-29></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>shape</span><span class=p>,</span>
</span><span id=__span-20-30><a id=__codelineno-20-30 name=__codelineno-20-30 href=#__codelineno-20-30></a><span class=gp>... </span>    <span class=n>entry_place_func_nb</span><span class=o>=</span><span class=n>entry_place_func_nb</span><span class=p>,</span>
</span><span id=__span-20-31><a id=__codelineno-20-31 name=__codelineno-20-31 href=#__codelineno-20-31></a><span class=gp>... </span>    <span class=n>entry_place_args</span><span class=o>=</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>to_ns</span><span class=p>(),),</span>
</span><span id=__span-20-32><a id=__codelineno-20-32 name=__codelineno-20-32 href=#__codelineno-20-32></a><span class=gp>... </span>    <span class=n>exit_place_func_nb</span><span class=o>=</span><span class=n>exit_place_func_nb</span><span class=p>,</span>
</span><span id=__span-20-33><a id=__codelineno-20-33 name=__codelineno-20-33 href=#__codelineno-20-33></a><span class=gp>... </span>    <span class=n>exit_place_args</span><span class=o>=</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>to_ns</span><span class=p>(),),</span>
</span><span id=__span-20-34><a id=__codelineno-20-34 name=__codelineno-20-34 href=#__codelineno-20-34></a><span class=gp>... </span>    <span class=n>wrapper</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>symbol_wrapper</span>
</span><span id=__span-20-35><a id=__codelineno-20-35 name=__codelineno-20-35 href=#__codelineno-20-35></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-20-36><a id=__codelineno-20-36 name=__codelineno-20-36 href=#__codelineno-20-36></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pd</span><span class=o>.</span><span class=n>concat</span><span class=p>((</span>
</span><span id=__span-20-37><a id=__codelineno-20-37 name=__codelineno-20-37 href=#__codelineno-20-37></a><span class=gp>... </span>    <span class=n>entries</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=s2>&quot;Entries&quot;</span><span class=p>),</span> 
</span><span id=__span-20-38><a id=__codelineno-20-38 name=__codelineno-20-38 href=#__codelineno-20-38></a><span class=gp>... </span>    <span class=n>exits</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=s2>&quot;Exits&quot;</span><span class=p>)</span>
</span><span id=__span-20-39><a id=__codelineno-20-39 name=__codelineno-20-39 href=#__codelineno-20-39></a><span class=gp>... </span><span class=p>),</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=o>.</span><span class=n>to_period</span><span class=p>(</span><span class=s2>&quot;W&quot;</span><span class=p>)</span>
</span><span id=__span-20-40><a id=__codelineno-20-40 name=__codelineno-20-40 href=#__codelineno-20-40></a><span class=go>                       Entries  Exits</span>
</span><span id=__span-20-41><a id=__codelineno-20-41 name=__codelineno-20-41 href=#__codelineno-20-41></a><span class=go>Date                                 </span>
</span><span id=__span-20-42><a id=__codelineno-20-42 name=__codelineno-20-42 href=#__codelineno-20-42></a><span class=go>2020-01-06/2020-01-12     True  False</span>
</span><span id=__span-20-43><a id=__codelineno-20-43 name=__codelineno-20-43 href=#__codelineno-20-43></a><span class=go>2020-01-06/2020-01-12    False  False</span>
</span><span id=__span-20-44><a id=__codelineno-20-44 name=__codelineno-20-44 href=#__codelineno-20-44></a><span class=go>2020-01-06/2020-01-12    False  False</span>
</span><span id=__span-20-45><a id=__codelineno-20-45 name=__codelineno-20-45 href=#__codelineno-20-45></a><span class=go>2020-01-06/2020-01-12    False  False</span>
</span><span id=__span-20-46><a id=__codelineno-20-46 name=__codelineno-20-46 href=#__codelineno-20-46></a><span class=go>2020-01-06/2020-01-12    False  False</span>
</span><span id=__span-20-47><a id=__codelineno-20-47 name=__codelineno-20-47 href=#__codelineno-20-47></a><span class=go>2020-01-06/2020-01-12    False  False</span>
</span><span id=__span-20-48><a id=__codelineno-20-48 name=__codelineno-20-48 href=#__codelineno-20-48></a><span class=go>2020-01-06/2020-01-12    False   True</span>
</span><span id=__span-20-49><a id=__codelineno-20-49 name=__codelineno-20-49 href=#__codelineno-20-49></a><span class=go>2020-01-13/2020-01-19     True  False</span>
</span></code></pre></div> <ol> <li>Iterate over the bars in the current period segment.</li> <li>If a signal should be placed, return an index relative to the segment.</li> <li>Place a signal if the current bar crosses Monday.</li> <li>Place a signal if the next bar crosses Monday.</li> </ol> <h2 id=pre-computation>Pre-computation<a class=headerlink href=#pre-computation title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/badges/new-in/1_0_10.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> There is a tradeoff between memory usage and execution speed: a dataset with 1000 columns is usually processed much faster than processing a 1-column dataset 1000 times. However, the first dataset also requires 1000 times more memory than the second. That's why, during the simulation phase, VBT primarily generates orders, while other portfolio attributes such as balances, equity, and returns are reconstructed later during the analysis phase if the user needs them. For cases where performance is the main concern, arguments are now available that let you pre-compute these attributes during simulation! <img alt=⏩ class=twemoji src=https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/23e9.svg title=:fast_forward:></li> </ul> <div class="language-pycon highlight"><span class=filename>Benchmark a random portfolio with 1000 columns without and with pre-computation</span><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>)</span>
</span></code></pre></div> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=gp>&gt;&gt;&gt; </span><span class=o>%%</span><span class=n>timeit</span>  <span class=c1># (1)!</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=gp>&gt;&gt;&gt; </span><span class=k>for</span> <span class=n>n</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1000</span><span class=p>):</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=gp>... </span>    <span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_random_signals</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>n</span><span class=o>=</span><span class=n>n</span><span class=p>,</span> <span class=n>save_returns</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=gp>... </span>    <span class=n>pf</span><span class=o>.</span><span class=n>sharpe_ratio</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=go>15 s ± 829 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)</span>
</span></code></pre></div> <ol> <li>Good for RAM, bad for performance.</li> </ol> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=gp>&gt;&gt;&gt; </span><span class=o>%%</span><span class=n>timeit</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_random_signals</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>n</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>1000</span><span class=p>)</span><span class=o>.</span><span class=n>tolist</span><span class=p>(),</span> <span class=n>save_returns</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>sharpe_ratio</span>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=go>855 ms ± 6.26 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)</span>
</span></code></pre></div> <div class="language-pycon highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=gp>&gt;&gt;&gt; </span><span class=o>%%</span><span class=n>timeit</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_random_signals</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>n</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>1000</span><span class=p>)</span><span class=o>.</span><span class=n>tolist</span><span class=p>(),</span> <span class=n>save_returns</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>sharpe_ratio</span>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=go>593 ms ± 7.07 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)</span>
</span></code></pre></div> <h2 id=cash-deposits>Cash deposits<a class=headerlink href=#cash-deposits title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/badges/new-in/1_0_0.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Cash can be deposited or withdrawn at any time.</li> </ul> <div class="language-pycon highlight"><span class=filename>DCA $10 into Bitcoin each month</span><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>)</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cash_deposits</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>fill</span><span class=p>(</span><span class=mf>0.0</span><span class=p>)</span>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>month_start_mask</span> <span class=o>=</span> <span class=o>~</span><span class=n>data</span><span class=o>.</span><span class=n>index</span><span class=o>.</span><span class=n>tz_convert</span><span class=p>(</span><span class=kc>None</span><span class=p>)</span><span class=o>.</span><span class=n>to_period</span><span class=p>(</span><span class=s2>&quot;M&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>duplicated</span><span class=p>()</span>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>cash_deposits</span><span class=p>[</span><span class=n>month_start_mask</span><span class=p>]</span> <span class=o>=</span> <span class=mi>10</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_orders</span><span class=p>(</span>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>,</span> 
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a><span class=gp>... </span>    <span class=n>init_cash</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> 
</span><span id=__span-25-8><a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=gp>... </span>    <span class=n>cash_deposits</span><span class=o>=</span><span class=n>cash_deposits</span>
</span><span id=__span-25-9><a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-25-10><a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a>
</span><span id=__span-25-11><a id=__codelineno-25-11 name=__codelineno-25-11 href=#__codelineno-25-11></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>input_value</span>  <span class=c1># (1)!</span>
</span><span id=__span-25-12><a id=__codelineno-25-12 name=__codelineno-25-12 href=#__codelineno-25-12></a><span class=go>1020.0</span>
</span><span id=__span-25-13><a id=__codelineno-25-13 name=__codelineno-25-13 href=#__codelineno-25-13></a>
</span><span id=__span-25-14><a id=__codelineno-25-14 name=__codelineno-25-14 href=#__codelineno-25-14></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>final_value</span>
</span><span id=__span-25-15><a id=__codelineno-25-15 name=__codelineno-25-15 href=#__codelineno-25-15></a><span class=go>20674.328828315127</span>
</span></code></pre></div> <ol> <li>Total invested.</li> </ol> <h2 id=cash-earnings>Cash earnings<a class=headerlink href=#cash-earnings title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/badges/new-in/1_0_0.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Cash can be continuously earned or spent depending on the current position.</li> </ul> <div class="language-pycon highlight"><span class=filename>Backtest Apple without and with dividend reinvestment</span><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;AAPL&quot;</span><span class=p>,</span> <span class=n>start</span><span class=o>=</span><span class=s2>&quot;2010&quot;</span><span class=p>)</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf_kept</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_holding</span><span class=p>(</span>  <span class=c1># (1)!</span>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>,</span>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=gp>... </span>    <span class=n>cash_dividends</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Dividends&quot;</span><span class=p>)</span>
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf_kept</span><span class=o>.</span><span class=n>cash</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>  <span class=c1># (2)!</span>
</span><span id=__span-26-8><a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=go>93.9182408043298</span>
</span><span id=__span-26-9><a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a>
</span><span id=__span-26-10><a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf_kept</span><span class=o>.</span><span class=n>assets</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>  <span class=c1># (3)!</span>
</span><span id=__span-26-11><a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a><span class=go>15.37212731743495</span>
</span><span id=__span-26-12><a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a>
</span><span id=__span-26-13><a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf_reinvested</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_orders</span><span class=p>(</span>  <span class=c1># (4)!</span>
</span><span id=__span-26-14><a id=__codelineno-26-14 name=__codelineno-26-14 href=#__codelineno-26-14></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>,</span>
</span><span id=__span-26-15><a id=__codelineno-26-15 name=__codelineno-26-15 href=#__codelineno-26-15></a><span class=gp>... </span>    <span class=n>cash_dividends</span><span class=o>=</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;Dividends&quot;</span><span class=p>)</span>
</span><span id=__span-26-16><a id=__codelineno-26-16 name=__codelineno-26-16 href=#__codelineno-26-16></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-26-17><a id=__codelineno-26-17 name=__codelineno-26-17 href=#__codelineno-26-17></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf_reinvested</span><span class=o>.</span><span class=n>cash</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span><span id=__span-26-18><a id=__codelineno-26-18 name=__codelineno-26-18 href=#__codelineno-26-18></a><span class=go>0.0</span>
</span><span id=__span-26-19><a id=__codelineno-26-19 name=__codelineno-26-19 href=#__codelineno-26-19></a>
</span><span id=__span-26-20><a id=__codelineno-26-20 name=__codelineno-26-20 href=#__codelineno-26-20></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf_reinvested</span><span class=o>.</span><span class=n>assets</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span><span id=__span-26-21><a id=__codelineno-26-21 name=__codelineno-26-21 href=#__codelineno-26-21></a><span class=go>18.203284859405468</span>
</span><span id=__span-26-22><a id=__codelineno-26-22 name=__codelineno-26-22 href=#__codelineno-26-22></a>
</span><span id=__span-26-23><a id=__codelineno-26-23 name=__codelineno-26-23 href=#__codelineno-26-23></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span> <span class=o>=</span> <span class=n>pf_kept</span><span class=o>.</span><span class=n>value</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=s2>&quot;Value (kept)&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>()</span>
</span><span id=__span-26-24><a id=__codelineno-26-24 name=__codelineno-26-24 href=#__codelineno-26-24></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf_reinvested</span><span class=o>.</span><span class=n>value</span><span class=o>.</span><span class=n>rename</span><span class=p>(</span><span class=s2>&quot;Value (reinvested)&quot;</span><span class=p>)</span><span class=o>.</span><span class=n>vbt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>fig</span><span class=o>=</span><span class=n>fig</span><span class=p>)</span>
</span><span id=__span-26-25><a id=__codelineno-26-25 name=__codelineno-26-25 href=#__codelineno-26-25></a><span class=gp>&gt;&gt;&gt; </span><span class=n>fig</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></code></pre></div> <ol> <li>Keep dividends as cash.</li> <li>Final cash balance.</li> <li>Final number of shares in the portfolio.</li> <li>Reinvest dividends at the next bar.</li> </ol> <p><img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/features/dividends.light.svg#only-light> <img alt class=iimg loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/images/features/dividends.dark.svg#only-dark></p> <h2 id=in-place-outputs>In-place outputs<a class=headerlink href=#in-place-outputs title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/badges/new-in/1_0_0.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> The portfolio can now accept and return any user-defined arrays filled during simulation, such as signals. In-place output arrays can broadcast together with regular arrays using templates and broadcastable named arguments. Additionally, VBT will (semi-)automatically determine how to correctly wrap and index each array, for example, whenever you select a column from the entire portfolio.</li> </ul> <div class="language-pycon highlight"><span class=filename>Track the debt of a random portfolio during the simulation</span><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>([</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>,</span> <span class=s2>&quot;ETH-USD&quot;</span><span class=p>],</span> <span class=n>missing_index</span><span class=o>=</span><span class=s2>&quot;drop&quot;</span><span class=p>)</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>fill</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>)</span>
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>rand_indices</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>size</span><span class=p>)),</span> <span class=mi>10</span><span class=p>)</span>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>rand_indices</span><span class=p>[</span><span class=mi>0</span><span class=p>::</span><span class=mi>2</span><span class=p>]]</span> <span class=o>=</span> <span class=o>-</span><span class=n>np</span><span class=o>.</span><span class=n>inf</span>
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>rand_indices</span><span class=p>[</span><span class=mi>1</span><span class=p>::</span><span class=mi>2</span><span class=p>]]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>inf</span>
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a>
</span><span id=__span-27-7><a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
</span><span id=__span-27-8><a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a><span class=gp>... </span><span class=k>def</span><span class=w> </span><span class=nf>post_segment_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>):</span>
</span><span id=__span-27-9><a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>c</span><span class=o>.</span><span class=n>from_col</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>to_col</span><span class=p>):</span>
</span><span id=__span-27-10><a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a><span class=gp>... </span>        <span class=n>col_debt</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=n>last_debt</span><span class=p>[</span><span class=n>col</span><span class=p>]</span>
</span><span id=__span-27-11><a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a><span class=gp>... </span>        <span class=n>c</span><span class=o>.</span><span class=n>in_outputs</span><span class=o>.</span><span class=n>debt</span><span class=p>[</span><span class=n>c</span><span class=o>.</span><span class=n>i</span><span class=p>,</span> <span class=n>col</span><span class=p>]</span> <span class=o>=</span> <span class=n>col_debt</span>
</span><span id=__span-27-12><a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a><span class=gp>... </span>        <span class=k>if</span> <span class=n>col_debt</span> <span class=o>&gt;</span> <span class=n>c</span><span class=o>.</span><span class=n>in_outputs</span><span class=o>.</span><span class=n>max_debt</span><span class=p>[</span><span class=n>col</span><span class=p>]:</span>
</span><span id=__span-27-13><a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a><span class=gp>... </span>            <span class=n>c</span><span class=o>.</span><span class=n>in_outputs</span><span class=o>.</span><span class=n>max_debt</span><span class=p>[</span><span class=n>col</span><span class=p>]</span> <span class=o>=</span> <span class=n>col_debt</span>
</span><span id=__span-27-14><a id=__codelineno-27-14 name=__codelineno-27-14 href=#__codelineno-27-14></a>
</span><span id=__span-27-15><a id=__codelineno-27-15 name=__codelineno-27-15 href=#__codelineno-27-15></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_def_order_func</span><span class=p>(</span>
</span><span id=__span-27-16><a id=__codelineno-27-16 name=__codelineno-27-16 href=#__codelineno-27-16></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>,</span> 
</span><span id=__span-27-17><a id=__codelineno-27-17 name=__codelineno-27-17 href=#__codelineno-27-17></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>,</span>
</span><span id=__span-27-18><a id=__codelineno-27-18 name=__codelineno-27-18 href=#__codelineno-27-18></a><span class=gp>... </span>    <span class=n>post_segment_func_nb</span><span class=o>=</span><span class=n>post_segment_func_nb</span><span class=p>,</span>
</span><span id=__span-27-19><a id=__codelineno-27-19 name=__codelineno-27-19 href=#__codelineno-27-19></a><span class=gp>... </span>    <span class=n>in_outputs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-27-20><a id=__codelineno-27-20 name=__codelineno-27-20 href=#__codelineno-27-20></a><span class=gp>... </span>        <span class=n>debt</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>RepEval</span><span class=p>(</span><span class=s2>&quot;np.empty_like(close)&quot;</span><span class=p>),</span>
</span><span id=__span-27-21><a id=__codelineno-27-21 name=__codelineno-27-21 href=#__codelineno-27-21></a><span class=gp>... </span>        <span class=n>max_debt</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>RepEval</span><span class=p>(</span><span class=s2>&quot;np.full(close.shape[1], 0.)&quot;</span><span class=p>)</span>
</span><span id=__span-27-22><a id=__codelineno-27-22 name=__codelineno-27-22 href=#__codelineno-27-22></a><span class=gp>... </span>    <span class=p>)</span>  <span class=c1># (1)!</span>
</span><span id=__span-27-23><a id=__codelineno-27-23 name=__codelineno-27-23 href=#__codelineno-27-23></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-27-24><a id=__codelineno-27-24 name=__codelineno-27-24 href=#__codelineno-27-24></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>get_in_output</span><span class=p>(</span><span class=s2>&quot;debt&quot;</span><span class=p>)</span>  <span class=c1># (2)!</span>
</span><span id=__span-27-25><a id=__codelineno-27-25 name=__codelineno-27-25 href=#__codelineno-27-25></a><span class=go>symbol                       BTC-USD    ETH-USD</span>
</span><span id=__span-27-26><a id=__codelineno-27-26 name=__codelineno-27-26 href=#__codelineno-27-26></a><span class=go>Date                                           </span>
</span><span id=__span-27-27><a id=__codelineno-27-27 name=__codelineno-27-27 href=#__codelineno-27-27></a><span class=go>2017-11-09 00:00:00+00:00   0.000000   0.000000</span>
</span><span id=__span-27-28><a id=__codelineno-27-28 name=__codelineno-27-28 href=#__codelineno-27-28></a><span class=go>2017-11-10 00:00:00+00:00   0.000000   0.000000</span>
</span><span id=__span-27-29><a id=__codelineno-27-29 name=__codelineno-27-29 href=#__codelineno-27-29></a><span class=go>2017-11-11 00:00:00+00:00   0.000000   0.000000</span>
</span><span id=__span-27-30><a id=__codelineno-27-30 name=__codelineno-27-30 href=#__codelineno-27-30></a><span class=go>2017-11-12 00:00:00+00:00   0.000000   0.000000</span>
</span><span id=__span-27-31><a id=__codelineno-27-31 name=__codelineno-27-31 href=#__codelineno-27-31></a><span class=go>2017-11-13 00:00:00+00:00   0.000000   0.000000</span>
</span><span id=__span-27-32><a id=__codelineno-27-32 name=__codelineno-27-32 href=#__codelineno-27-32></a><span class=go>...                              ...        ...</span>
</span><span id=__span-27-33><a id=__codelineno-27-33 name=__codelineno-27-33 href=#__codelineno-27-33></a><span class=go>2023-02-08 00:00:00+00:00  43.746892  25.054571</span>
</span><span id=__span-27-34><a id=__codelineno-27-34 name=__codelineno-27-34 href=#__codelineno-27-34></a><span class=go>2023-02-09 00:00:00+00:00  43.746892  25.054571</span>
</span><span id=__span-27-35><a id=__codelineno-27-35 name=__codelineno-27-35 href=#__codelineno-27-35></a><span class=go>2023-02-10 00:00:00+00:00  43.746892  25.054571</span>
</span><span id=__span-27-36><a id=__codelineno-27-36 name=__codelineno-27-36 href=#__codelineno-27-36></a><span class=go>2023-02-11 00:00:00+00:00  43.746892  25.054571</span>
</span><span id=__span-27-37><a id=__codelineno-27-37 name=__codelineno-27-37 href=#__codelineno-27-37></a><span class=go>2023-02-12 00:00:00+00:00  43.746892  25.054571</span>
</span><span id=__span-27-38><a id=__codelineno-27-38 name=__codelineno-27-38 href=#__codelineno-27-38></a>
</span><span id=__span-27-39><a id=__codelineno-27-39 name=__codelineno-27-39 href=#__codelineno-27-39></a><span class=go>[1922 rows x 2 columns]</span>
</span><span id=__span-27-40><a id=__codelineno-27-40 name=__codelineno-27-40 href=#__codelineno-27-40></a>
</span><span id=__span-27-41><a id=__codelineno-27-41 name=__codelineno-27-41 href=#__codelineno-27-41></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>get_in_output</span><span class=p>(</span><span class=s2>&quot;max_debt&quot;</span><span class=p>)</span>  <span class=c1># (3)!</span>
</span><span id=__span-27-42><a id=__codelineno-27-42 name=__codelineno-27-42 href=#__codelineno-27-42></a><span class=go>symbol</span>
</span><span id=__span-27-43><a id=__codelineno-27-43 name=__codelineno-27-43 href=#__codelineno-27-43></a><span class=go>BTC-USD    75.890464</span>
</span><span id=__span-27-44><a id=__codelineno-27-44 name=__codelineno-27-44 href=#__codelineno-27-44></a><span class=go>ETH-USD    25.926328</span>
</span><span id=__span-27-45><a id=__codelineno-27-45 name=__codelineno-27-45 href=#__codelineno-27-45></a><span class=go>Name: max_debt, dtype: float64</span>
</span></code></pre></div> <ol> <li>Instruct the portfolio class to wait until all arrays are broadcast and create a new floating array of the final shape.</li> <li>The portfolio instance knows how to properly wrap a custom NumPy array as a pandas object.</li> <li>The same applies to reduced NumPy arrays.</li> </ol> <h2 id=flexible-attributes>Flexible attributes<a class=headerlink href=#flexible-attributes title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/badges/new-in/1_0_0.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> Portfolio attributes can now be partially or even fully computed from user-defined arrays. This gives you greater control over post-simulation analysis, such as overriding some simulation data, testing hyperparameters without re-simulating the entire portfolio, or avoiding repeated reconstruction when caching is disabled.</li> </ul> <div class="language-pycon highlight"><span class=filename>Compute the net exposure by caching its components</span><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>)</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_random_signals</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>,</span> <span class=n>n</span><span class=o>=</span><span class=mi>100</span><span class=p>)</span>
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>value</span> <span class=o>=</span> <span class=n>pf</span><span class=o>.</span><span class=n>get_value</span><span class=p>()</span>  <span class=c1># (1)!</span>
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>long_exposure</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>get_gross_exposure</span><span class=p>(</span>  <span class=c1># (2)!</span>
</span><span id=__span-28-5><a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a><span class=gp>... </span>    <span class=n>asset_value</span><span class=o>=</span><span class=n>pf</span><span class=o>.</span><span class=n>get_asset_value</span><span class=p>(</span><span class=n>direction</span><span class=o>=</span><span class=s2>&quot;longonly&quot;</span><span class=p>),</span>
</span><span id=__span-28-6><a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a><span class=gp>... </span>    <span class=n>value</span><span class=o>=</span><span class=n>value</span><span class=p>,</span>
</span><span id=__span-28-7><a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a><span class=gp>... </span>    <span class=n>wrapper</span><span class=o>=</span><span class=n>pf</span><span class=o>.</span><span class=n>wrapper</span>
</span><span id=__span-28-8><a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-28-9><a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a><span class=gp>&gt;&gt;&gt; </span><span class=n>short_exposure</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>get_gross_exposure</span><span class=p>(</span>
</span><span id=__span-28-10><a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a><span class=gp>... </span>    <span class=n>asset_value</span><span class=o>=</span><span class=n>pf</span><span class=o>.</span><span class=n>get_asset_value</span><span class=p>(</span><span class=n>direction</span><span class=o>=</span><span class=s2>&quot;shortonly&quot;</span><span class=p>),</span>
</span><span id=__span-28-11><a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a><span class=gp>... </span>    <span class=n>value</span><span class=o>=</span><span class=n>value</span><span class=p>,</span>
</span><span id=__span-28-12><a id=__codelineno-28-12 name=__codelineno-28-12 href=#__codelineno-28-12></a><span class=gp>... </span>    <span class=n>wrapper</span><span class=o>=</span><span class=n>pf</span><span class=o>.</span><span class=n>wrapper</span>
</span><span id=__span-28-13><a id=__codelineno-28-13 name=__codelineno-28-13 href=#__codelineno-28-13></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-28-14><a id=__codelineno-28-14 name=__codelineno-28-14 href=#__codelineno-28-14></a><span class=gp>&gt;&gt;&gt; </span><span class=k>del</span> <span class=n>value</span>  <span class=c1># (3)!</span>
</span><span id=__span-28-15><a id=__codelineno-28-15 name=__codelineno-28-15 href=#__codelineno-28-15></a><span class=gp>&gt;&gt;&gt; </span><span class=n>net_exposure</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>get_net_exposure</span><span class=p>(</span>
</span><span id=__span-28-16><a id=__codelineno-28-16 name=__codelineno-28-16 href=#__codelineno-28-16></a><span class=gp>... </span>    <span class=n>long_exposure</span><span class=o>=</span><span class=n>long_exposure</span><span class=p>,</span>
</span><span id=__span-28-17><a id=__codelineno-28-17 name=__codelineno-28-17 href=#__codelineno-28-17></a><span class=gp>... </span>    <span class=n>short_exposure</span><span class=o>=</span><span class=n>short_exposure</span><span class=p>,</span>
</span><span id=__span-28-18><a id=__codelineno-28-18 name=__codelineno-28-18 href=#__codelineno-28-18></a><span class=gp>... </span>    <span class=n>wrapper</span><span class=o>=</span><span class=n>pf</span><span class=o>.</span><span class=n>wrapper</span>
</span><span id=__span-28-19><a id=__codelineno-28-19 name=__codelineno-28-19 href=#__codelineno-28-19></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-28-20><a id=__codelineno-28-20 name=__codelineno-28-20 href=#__codelineno-28-20></a><span class=gp>&gt;&gt;&gt; </span><span class=k>del</span> <span class=n>long_exposure</span>
</span><span id=__span-28-21><a id=__codelineno-28-21 name=__codelineno-28-21 href=#__codelineno-28-21></a><span class=gp>&gt;&gt;&gt; </span><span class=k>del</span> <span class=n>short_exposure</span>
</span><span id=__span-28-22><a id=__codelineno-28-22 name=__codelineno-28-22 href=#__codelineno-28-22></a><span class=gp>&gt;&gt;&gt; </span><span class=n>net_exposure</span>
</span><span id=__span-28-23><a id=__codelineno-28-23 name=__codelineno-28-23 href=#__codelineno-28-23></a><span class=go>Date</span>
</span><span id=__span-28-24><a id=__codelineno-28-24 name=__codelineno-28-24 href=#__codelineno-28-24></a><span class=go>2014-09-17 00:00:00+00:00    1.0</span>
</span><span id=__span-28-25><a id=__codelineno-28-25 name=__codelineno-28-25 href=#__codelineno-28-25></a><span class=go>2014-09-18 00:00:00+00:00    1.0</span>
</span><span id=__span-28-26><a id=__codelineno-28-26 name=__codelineno-28-26 href=#__codelineno-28-26></a><span class=go>2014-09-19 00:00:00+00:00    1.0</span>
</span><span id=__span-28-27><a id=__codelineno-28-27 name=__codelineno-28-27 href=#__codelineno-28-27></a><span class=go>2014-09-20 00:00:00+00:00    1.0</span>
</span><span id=__span-28-28><a id=__codelineno-28-28 name=__codelineno-28-28 href=#__codelineno-28-28></a><span class=go>2014-09-21 00:00:00+00:00    1.0</span>
</span><span id=__span-28-29><a id=__codelineno-28-29 name=__codelineno-28-29 href=#__codelineno-28-29></a><span class=go>                             ... </span>
</span><span id=__span-28-30><a id=__codelineno-28-30 name=__codelineno-28-30 href=#__codelineno-28-30></a><span class=go>2023-02-08 00:00:00+00:00    0.0</span>
</span><span id=__span-28-31><a id=__codelineno-28-31 name=__codelineno-28-31 href=#__codelineno-28-31></a><span class=go>2023-02-09 00:00:00+00:00    0.0</span>
</span><span id=__span-28-32><a id=__codelineno-28-32 name=__codelineno-28-32 href=#__codelineno-28-32></a><span class=go>2023-02-10 00:00:00+00:00    0.0</span>
</span><span id=__span-28-33><a id=__codelineno-28-33 name=__codelineno-28-33 href=#__codelineno-28-33></a><span class=go>2023-02-11 00:00:00+00:00    0.0</span>
</span><span id=__span-28-34><a id=__codelineno-28-34 name=__codelineno-28-34 href=#__codelineno-28-34></a><span class=go>2023-02-12 00:00:00+00:00    0.0</span>
</span><span id=__span-28-35><a id=__codelineno-28-35 name=__codelineno-28-35 href=#__codelineno-28-35></a><span class=go>Freq: D, Length: 3071, dtype: float64</span>
</span></code></pre></div> <ol> <li>Call the instance method to use the data stored in the portfolio.</li> <li>Call the class method to provide all the data explicitly.</li> <li>Delete the object as soon as it is no longer needed to free memory.</li> </ol> <h2 id=shortcut-properties>Shortcut properties<a class=headerlink href=#shortcut-properties title="Permanent link">&para;</a></h2> <p><img alt loading=lazy src=https://vectorbt.pro/pvt_41531c19/assets/badges/new-in/1_0_0.svg></p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled checked><span class=task-list-indicator></span></label> <a href=#in-place-outputs>In-place output arrays</a> can be used to override regular portfolio attributes. The portfolio will automatically pick the pre-computed array and perform all future calculations using this array, avoiding redundant reconstruction.</li> </ul> <div class="language-pycon highlight"><span class=filename>Modify the returns from within the simulation</span><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=gp>&gt;&gt;&gt; </span><span class=n>data</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>YFData</span><span class=o>.</span><span class=n>pull</span><span class=p>(</span><span class=s2>&quot;BTC-USD&quot;</span><span class=p>)</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>symbol_wrapper</span><span class=o>.</span><span class=n>fill</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>nan</span><span class=p>)</span>
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=gp>&gt;&gt;&gt; </span><span class=n>rand_indices</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>size</span><span class=p>)),</span> <span class=mi>10</span><span class=p>)</span>
</span><span id=__span-29-4><a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>rand_indices</span><span class=p>[</span><span class=mi>0</span><span class=p>::</span><span class=mi>2</span><span class=p>]]</span> <span class=o>=</span> <span class=o>-</span><span class=n>np</span><span class=o>.</span><span class=n>inf</span>
</span><span id=__span-29-5><a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=gp>&gt;&gt;&gt; </span><span class=n>size</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>rand_indices</span><span class=p>[</span><span class=mi>1</span><span class=p>::</span><span class=mi>2</span><span class=p>]]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>inf</span>
</span><span id=__span-29-6><a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a>
</span><span id=__span-29-7><a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a><span class=gp>&gt;&gt;&gt; </span><span class=nd>@njit</span>
</span><span id=__span-29-8><a id=__codelineno-29-8 name=__codelineno-29-8 href=#__codelineno-29-8></a><span class=gp>... </span><span class=k>def</span><span class=w> </span><span class=nf>post_segment_func_nb</span><span class=p>(</span><span class=n>c</span><span class=p>):</span>
</span><span id=__span-29-9><a id=__codelineno-29-9 name=__codelineno-29-9 href=#__codelineno-29-9></a><span class=gp>... </span>    <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>c</span><span class=o>.</span><span class=n>from_col</span><span class=p>,</span> <span class=n>c</span><span class=o>.</span><span class=n>to_col</span><span class=p>):</span>
</span><span id=__span-29-10><a id=__codelineno-29-10 name=__codelineno-29-10 href=#__codelineno-29-10></a><span class=gp>... </span>        <span class=n>return_now</span> <span class=o>=</span> <span class=n>c</span><span class=o>.</span><span class=n>last_return</span><span class=p>[</span><span class=n>col</span><span class=p>]</span>
</span><span id=__span-29-11><a id=__codelineno-29-11 name=__codelineno-29-11 href=#__codelineno-29-11></a><span class=gp>... </span>        <span class=n>return_now</span> <span class=o>=</span> <span class=mf>0.5</span> <span class=o>*</span> <span class=n>return_now</span> <span class=k>if</span> <span class=n>return_now</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=n>return_now</span>
</span><span id=__span-29-12><a id=__codelineno-29-12 name=__codelineno-29-12 href=#__codelineno-29-12></a><span class=gp>... </span>        <span class=n>c</span><span class=o>.</span><span class=n>in_outputs</span><span class=o>.</span><span class=n>returns</span><span class=p>[</span><span class=n>c</span><span class=o>.</span><span class=n>i</span><span class=p>,</span> <span class=n>col</span><span class=p>]</span> <span class=o>=</span> <span class=n>return_now</span>
</span><span id=__span-29-13><a id=__codelineno-29-13 name=__codelineno-29-13 href=#__codelineno-29-13></a>
</span><span id=__span-29-14><a id=__codelineno-29-14 name=__codelineno-29-14 href=#__codelineno-29-14></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span> <span class=o>=</span> <span class=n>vbt</span><span class=o>.</span><span class=n>PF</span><span class=o>.</span><span class=n>from_def_order_func</span><span class=p>(</span>
</span><span id=__span-29-15><a id=__codelineno-29-15 name=__codelineno-29-15 href=#__codelineno-29-15></a><span class=gp>... </span>    <span class=n>data</span><span class=o>.</span><span class=n>close</span><span class=p>,</span>
</span><span id=__span-29-16><a id=__codelineno-29-16 name=__codelineno-29-16 href=#__codelineno-29-16></a><span class=gp>... </span>    <span class=n>size</span><span class=o>=</span><span class=n>size</span><span class=p>,</span>
</span><span id=__span-29-17><a id=__codelineno-29-17 name=__codelineno-29-17 href=#__codelineno-29-17></a><span class=gp>... </span>    <span class=n>size_type</span><span class=o>=</span><span class=s2>&quot;targetpercent&quot;</span><span class=p>,</span>
</span><span id=__span-29-18><a id=__codelineno-29-18 name=__codelineno-29-18 href=#__codelineno-29-18></a><span class=gp>... </span>    <span class=n>post_segment_func_nb</span><span class=o>=</span><span class=n>post_segment_func_nb</span><span class=p>,</span>
</span><span id=__span-29-19><a id=__codelineno-29-19 name=__codelineno-29-19 href=#__codelineno-29-19></a><span class=gp>... </span>    <span class=n>in_outputs</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span>
</span><span id=__span-29-20><a id=__codelineno-29-20 name=__codelineno-29-20 href=#__codelineno-29-20></a><span class=gp>... </span>        <span class=n>returns</span><span class=o>=</span><span class=n>vbt</span><span class=o>.</span><span class=n>RepEval</span><span class=p>(</span><span class=s2>&quot;np.empty_like(close)&quot;</span><span class=p>)</span>
</span><span id=__span-29-21><a id=__codelineno-29-21 name=__codelineno-29-21 href=#__codelineno-29-21></a><span class=gp>... </span>    <span class=p>)</span>
</span><span id=__span-29-22><a id=__codelineno-29-22 name=__codelineno-29-22 href=#__codelineno-29-22></a><span class=gp>... </span><span class=p>)</span>
</span><span id=__span-29-23><a id=__codelineno-29-23 name=__codelineno-29-23 href=#__codelineno-29-23></a>
</span><span id=__span-29-24><a id=__codelineno-29-24 name=__codelineno-29-24 href=#__codelineno-29-24></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>returns</span>  <span class=c1># (1)!</span>
</span><span id=__span-29-25><a id=__codelineno-29-25 name=__codelineno-29-25 href=#__codelineno-29-25></a><span class=go>Date</span>
</span><span id=__span-29-26><a id=__codelineno-29-26 name=__codelineno-29-26 href=#__codelineno-29-26></a><span class=go>2014-09-17 00:00:00+00:00    0.000000</span>
</span><span id=__span-29-27><a id=__codelineno-29-27 name=__codelineno-29-27 href=#__codelineno-29-27></a><span class=go>2014-09-18 00:00:00+00:00    0.000000</span>
</span><span id=__span-29-28><a id=__codelineno-29-28 name=__codelineno-29-28 href=#__codelineno-29-28></a><span class=go>2014-09-19 00:00:00+00:00    0.000000</span>
</span><span id=__span-29-29><a id=__codelineno-29-29 name=__codelineno-29-29 href=#__codelineno-29-29></a><span class=go>2014-09-20 00:00:00+00:00    0.000000</span>
</span><span id=__span-29-30><a id=__codelineno-29-30 name=__codelineno-29-30 href=#__codelineno-29-30></a><span class=go>2014-09-21 00:00:00+00:00    0.000000</span>
</span><span id=__span-29-31><a id=__codelineno-29-31 name=__codelineno-29-31 href=#__codelineno-29-31></a><span class=go>                                  ...   </span>
</span><span id=__span-29-32><a id=__codelineno-29-32 name=__codelineno-29-32 href=#__codelineno-29-32></a><span class=go>2023-02-08 00:00:00+00:00   -0.015227</span>
</span><span id=__span-29-33><a id=__codelineno-29-33 name=__codelineno-29-33 href=#__codelineno-29-33></a><span class=go>2023-02-09 00:00:00+00:00   -0.053320</span>
</span><span id=__span-29-34><a id=__codelineno-29-34 name=__codelineno-29-34 href=#__codelineno-29-34></a><span class=go>2023-02-10 00:00:00+00:00   -0.008439</span>
</span><span id=__span-29-35><a id=__codelineno-29-35 name=__codelineno-29-35 href=#__codelineno-29-35></a><span class=go>2023-02-11 00:00:00+00:00    0.005569  &lt;&lt; modified</span>
</span><span id=__span-29-36><a id=__codelineno-29-36 name=__codelineno-29-36 href=#__codelineno-29-36></a><span class=go>2023-02-12 00:00:00+00:00    0.001849  &lt;&lt; modified</span>
</span><span id=__span-29-37><a id=__codelineno-29-37 name=__codelineno-29-37 href=#__codelineno-29-37></a><span class=go>Freq: D, Length: 3071, dtype: float64</span>
</span><span id=__span-29-38><a id=__codelineno-29-38 name=__codelineno-29-38 href=#__codelineno-29-38></a>
</span><span id=__span-29-39><a id=__codelineno-29-39 name=__codelineno-29-39 href=#__codelineno-29-39></a><span class=gp>&gt;&gt;&gt; </span><span class=n>pf</span><span class=o>.</span><span class=n>get_returns</span><span class=p>()</span>  <span class=c1># (2)!</span>
</span><span id=__span-29-40><a id=__codelineno-29-40 name=__codelineno-29-40 href=#__codelineno-29-40></a><span class=go>Date</span>
</span><span id=__span-29-41><a id=__codelineno-29-41 name=__codelineno-29-41 href=#__codelineno-29-41></a><span class=go>2014-09-17 00:00:00+00:00    0.000000</span>
</span><span id=__span-29-42><a id=__codelineno-29-42 name=__codelineno-29-42 href=#__codelineno-29-42></a><span class=go>2014-09-18 00:00:00+00:00    0.000000</span>
</span><span id=__span-29-43><a id=__codelineno-29-43 name=__codelineno-29-43 href=#__codelineno-29-43></a><span class=go>2014-09-19 00:00:00+00:00    0.000000</span>
</span><span id=__span-29-44><a id=__codelineno-29-44 name=__codelineno-29-44 href=#__codelineno-29-44></a><span class=go>2014-09-20 00:00:00+00:00    0.000000</span>
</span><span id=__span-29-45><a id=__codelineno-29-45 name=__codelineno-29-45 href=#__codelineno-29-45></a><span class=go>2014-09-21 00:00:00+00:00    0.000000</span>
</span><span id=__span-29-46><a id=__codelineno-29-46 name=__codelineno-29-46 href=#__codelineno-29-46></a><span class=go>                                  ...   </span>
</span><span id=__span-29-47><a id=__codelineno-29-47 name=__codelineno-29-47 href=#__codelineno-29-47></a><span class=go>2023-02-08 00:00:00+00:00   -0.015227</span>
</span><span id=__span-29-48><a id=__codelineno-29-48 name=__codelineno-29-48 href=#__codelineno-29-48></a><span class=go>2023-02-09 00:00:00+00:00   -0.053320</span>
</span><span id=__span-29-49><a id=__codelineno-29-49 name=__codelineno-29-49 href=#__codelineno-29-49></a><span class=go>2023-02-10 00:00:00+00:00   -0.008439</span>
</span><span id=__span-29-50><a id=__codelineno-29-50 name=__codelineno-29-50 href=#__codelineno-29-50></a><span class=go>2023-02-11 00:00:00+00:00    0.011138</span>
</span><span id=__span-29-51><a id=__codelineno-29-51 name=__codelineno-29-51 href=#__codelineno-29-51></a><span class=go>2023-02-12 00:00:00+00:00    0.003697</span>
</span><span id=__span-29-52><a id=__codelineno-29-52 name=__codelineno-29-52 href=#__codelineno-29-52></a><span class=go>Freq: D, Length: 3071, dtype: float64</span>
</span></code></pre></div> <ol> <li>Pre-computed returns.</li> <li>Actual returns.</li> </ol> <h2 id=and-many-more>And many more...<a class=headerlink href=#and-many-more title="Permanent link">&para;</a></h2> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Look forward to more killer features being added every week!</li> </ul> <p><a class=md-button href=https://vectorbt.pro/pvt_41531c19/assets/jupytext/features/portfolio.py.txt target=blank_><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19.14 7.5A2.86 2.86 0 0 1 22 10.36v3.78A2.86 2.86 0 0 1 19.14 17H12c0 .39.32.96.71.96H17v1.68a2.86 2.86 0 0 1-2.86 2.86H9.86A2.86 2.86 0 0 1 7 19.64v-3.75a2.85 2.85 0 0 1 2.86-2.85h5.25a2.85 2.85 0 0 0 2.85-2.86V7.5zm-4.28 11.79c-.4 0-.72.3-.72.89s.32.71.72.71a.71.71 0 0 0 .71-.71c0-.59-.32-.89-.71-.89m-10-1.79A2.86 2.86 0 0 1 2 14.64v-3.78A2.86 2.86 0 0 1 4.86 8H12c0-.39-.32-.96-.71-.96H7V5.36A2.86 2.86 0 0 1 9.86 2.5h4.28A2.86 2.86 0 0 1 17 5.36v3.75a2.85 2.85 0 0 1-2.86 2.85H8.89a2.85 2.85 0 0 0-2.85 2.86v2.68zM9.14 5.71c.4 0 .72-.3.72-.89s-.32-.71-.72-.71c-.39 0-.71.12-.71.71s.32.89.71.89"/></svg></span> Python code</a></p> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=https://vectorbt.pro/pvt_41531c19/features/performance/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Performance"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Performance </div> </div> </a> <a href=https://vectorbt.pro/pvt_41531c19/features/productivity/ class="md-footer__link md-footer__link--next" aria-label="Next: Productivity"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Productivity </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2021-2025 Oleg Polakow. All rights reserved. </div> </div> <div class=md-social> <a href=https://www.linkedin.com/in/polakowo target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> <a href=https://github.com/polakowo target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">Accept</button> <label class=md-button for=__settings>Manage settings</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script> <script id=__config type=application/json>{"annotate": null, "base": "../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.instant", "navigation.instant.progress", "navigation.top", "navigation.prune", "navigation.path", "navigation.footer", "search.suggest", "search.share", "content.code.annotate", "content.code.copy", "content.code.select", "content.tooltips", "content.tabs.link", "toc.follow", "toc.integrate", "announce.dismiss"], "search": "../../assets/javascripts/workers/search.26099bd0.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=https://vectorbt.pro/pvt_41531c19/assets/javascripts/bundle.9d1edc04.min.js></script> <script src=https://vectorbt.pro/pvt_41531c19/assets/scripts/extra.js></script> <script src=https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js></script> </body> 
<!-- Mirrored from vectorbt.pro/pvt_41531c19/features/portfolio/ by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 22 Nov 2025 03:46:36 GMT -->
</html>